{% extends 'layouts/base/index.njk' %}

{%- set pageContent = pages | getPage(pageID) -%}

{% block content %}
  
  {%- set bannerImageLg -%}
    {%- imageUrlFor pageContent.banner.asset._ref, 2000 -%}
  {%- endset -%}

  <section
    class="relative w-full pt-40 md:pb-20 2xl:py-60 overflow-hidden min-h-[32rem] md:min-h-[400px] flex flex-col justify-end md:justify-center items-center after:absolute after:top-0 after:left-0 after:w-full after:bg-pg-blue-dark/[.4] after:h-full after:grow after:min-h-[50rem] md:after:min-h-[400px]"
  >
    <div class="absolute top-0 left-0 w-full h-full">
      {% bannerImage bannerImageLg, 'Perthshire Gravel', null, 'object-cover object-center', 'high' %}
    </div>
    <div class="flex flex-col z-10 text-white px-4 md:px-12 pb-20 md:pb-0 w-full sm:w-4/5 2xl:w-2/3 4xl:w-1/2 text-center items-center">
      <small class="uppercase text-base font-bold">Welcome to Perthshire Gravel</small>
      <div class="divider w-40"></div>
      <h1 class="leading-[1.1em] min-h-[5em] md:min-h-[3.5em] xl:min-h-[2.5em]">{{ pageContent.title }}</h1>
      <div class="md:flex mt-12">
        <a 
          class="iconButton flex items-center rounded bg-pg-lime text-pg-blue-dark px-4 h-10 md:mr-4 mb-3 md:mb-0 font-bold"
          href="/routes/"
        >
          {% svgIcon 'src/assets/icons/routeExplorerIcon.svg', 'mr-2 h-8 fill-pg-blue-dark' %}
          Route Explorer
        </a>
        <button 
          class="iconButton inline-flex items-center rounded bg-pg-blue-dark text-pg-tan-light px-4 h-10 font-bold"
          id="videoModalButton"
        >
          {% svgIcon 'src/assets/icons/videoIcon.svg', 'mr-2 h-5' %}
          Video Tour
        </button>
      </div>
    </div>
  </section>

  <!-- Video Modal -->
  <div class="modal hidden opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center" style="z-index: 1000000;">
    <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-70"></div>
    
    <div class="modal-container bg-gray-200 w-5/6 lg:w-3/4 md:max-w-5xl mx-auto rounded shadow-lg z-50 overflow-y-auto">
      
      <div class="modal-close absolute top-0 right-0 cursor-pointer flex flex-col items-center mt-4 mr-4 text-white text-sm z-50">
        <svg class="fill-current text-white" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
          <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
        </svg>
      </div>

      <!-- Add margin if you want to see some of the overlay behind the modal-->
      <div class="modal-content p-2 lg:p-4 text-left relative">
        <!--Title-->
        <div class="flex justify-end items-center pb-3">
          <div class="modal-close cursor-pointer z-50">
            <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
              <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
            </svg>
          </div>
        </div>

        <div class="aspect-video">
          <div class="videoWrapper">
            <iframe loading="lazy" width="560" height="315" class="youtube-video" src="https://www.youtube-nocookie.com/embed/{{pageContent.video.url | videoID}}?enablejsapi=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
        </div>
        
      </div>
    </div>
  </div>
  <script>
    const openmodal = document.getElementById('videoModalButton')
    openmodal.addEventListener('click', function(event){
      toggleModal()
    }, {passive: true})
    
    const overlay = document.querySelector('.modal-overlay')
    overlay.addEventListener('click', toggleModal)
    
    const closemodal = document.querySelectorAll('.modal-close')
    for (let i = 0; i < closemodal.length; i++) {
      closemodal[i].addEventListener('click', toggleModal, {passive: true})
    }
    
    document.onkeydown = function(evt) {
      evt = evt || window.event
      let isEscape = false
      if ("key" in evt) {
    	  isEscape = (evt.key === "Escape" || evt.key === "Esc")
      } else {
    	  isEscape = (evt.keyCode === 27)
      }
      if (isEscape && document.body.classList.contains('modal-active')) {
    	  toggleModal()
      }
    };
    
    
    function toggleModal () {

      if (document.body.classList.contains('modal-active')) {
        document.querySelector('.youtube-video').contentWindow.postMessage('{"event":"command","func":"' + 'stopVideo' + '","args":""}', '*');
      }
      const body = document.querySelector('body')
      const modal = document.querySelector('.modal')
      modal.classList.toggle('hidden')
      modal.classList.toggle('opacity-0')
      modal.classList.toggle('pointer-events-none')
      body.classList.toggle('modal-active')
    }
    
     
  </script>
  <!-- Video Modal - END -->

  <section class="flex justify-center px-2 lg:px-4 py-20">
    <div class="w-full max-w-6xl">
      <div class="md:pl-16 pb-8">
        <h1 class="max-w-2xl">Find your next gravel biking adventure in Perthshire!</h1>
        <div class="divider w-40"></div>
        <p class="max-w-prose">Explore our popular single and multi-day gravel biking routes below or bunny hop over to our <a href="/map/" class="underline">Route Map</a>.</p>
      </div>
      {% set routesList = collections.routes | routesData | shuffle  %}
      {% include "./includes/routesList.njk" %}
    </div>
  </section>

  {# {% set linkBlock1 = pageContent.linkBlock1 %}
  {%- set linkBlock1Banner -%}
    {%- imageUrlFor linkBlock1.background.asset._ref, 2000 -%}
  {%- endset -%}
  <section class="relative w-full py-20 2xl:py-36 bg-cover bg-no-repeat bg-center overflow-hidden flex flex-col items-center after:absolute after:top-0 after:left-0 after:w-full after:bg-neutral-800/[.7] after:h-full after:grow"
    style="background-image: url('{{ linkBlock1Banner }}')"
  >
    <div class="w-full max-w-6xl px-4">
      <div class="relative w-4/5 sm:w-3/5 md:w-1/2 xl:w-1/3 text-white z-10">
        <h1 class="max-w-2xl">{{ linkBlock1.title }}</h1>
        <div class="divider w-40"></div>
        <div class="max-w-prose text-lg mb-12">{{ linkBlock1.text | blocksToHTML | safe }}</div>
        <a 
          class="inline-flex items-center rounded bg-pg-tan text-pg-blue-dark px-4 h-10 md:mr-4 mb-3 md:mb-0 font-bold"
          href="{{ linkBlock1.link }}"
        >
          {{ linkBlock1.buttonText }} {% svgIcon 'src/assets/icons/arrow.svg', 'ml-2 h-4' %}
        </a>
      </div>
    </div>
  </section> #}

  {% set linkBlock2 = pageContent.linkBlock2 %}
  {%- set linkBlock2Banner -%}
    {%- imageUrlFor linkBlock2.background.asset._ref, 2000 -%}
  {%- endset -%}
  <section class="relative w-full py-20 2xl:py-36 overflow-hidden flex flex-col items-center after:absolute after:top-0 after:left-0 after:w-full after:bg-gradient-to-r after:from-white/80 after:to-white/40 md:after:from-transparent md:after:via-white/70 md:after:to-white/90 after:h-full after:grow"
  >
    <div class="absolute top-0 left-0 w-full h-full">
      {% bannerImage linkBlock2Banner, 'Become an architect', null, 'object-cover object-center', 'high' %}
    </div>
    <div class="w-full max-w-6xl px-4 flex md:justify-end">
      <div class="relative w-4/5 sm:w-3/5 md:w-1/2 lg:w-2/5 2xl:w-1/3 text-pg-blue-dark z-10">
        <h2 class="max-w-2xl">{{ linkBlock2.title }}</h2>
        <div class="divider w-40"></div>
        <div class="max-w-prose text-lg mb-12">{{ linkBlock2.text | blocksToHTML | safe }}</div>
        <a 
          class="inline-flex items-center rounded bg-pg-tan text-pg-blue-dark px-4 h-10 md:mr-4 mb-3 md:mb-0 font-bold"
          href="{{ linkBlock2.link }}"
        >
          {{ linkBlock2.buttonText }} {% svgIcon 'src/assets/icons/arrow.svg', 'ml-2 h-4' %}
        </a>
      </div>
    </div>
  </section>
{% endblock %}
