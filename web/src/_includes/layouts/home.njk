{% extends 'layouts/base/index.njk' %}

{%- set pageContent = pages | getPage(pageID) -%}

{% set features = [
  {text: 'Quality Guaranteed', color: 'bg-df-black'},
  {text: 'Genuine Parts', color: 'bg-df-orange-dark'},
  {text: 'Simple Pricing', color: 'bg-df-blue'},
  {text: 'Fully Insured', color: 'bg-df-black'}
]%}

{% block content %}
  <div class="relative aspect-[3/1] mt-24 sm:mt-36 md:mt-42 lg:mt-48 w-screen flex flex-col items-center">
    <h1 class="text-center text-4xl sm:text-5xl lg:text-6xl flex flex-col md:flex-row font-df-sans z-20 px-1 rotate-[-6deg] skew-x-[-6deg]">
      <span class="text-shadow text-df-orange font-black uppercase">Bike Servicing</span>
      <span class="block leading-none font-normal sm:leading-none ml-1 mr-2 -mt-2 font-script -rotate-12 skew-x-12 scale-[0.65]">and</span>
      <span class="text-shadow text-df-orange font-black uppercase">Custom Builds</span>
    </h1>
     <ul class="relative mt-4 lg:mt-2 rotate-[-6deg] skew-x-[-6deg] text-white text-center grid grid-cols-2 md:grid-cols-4 grid-flow-row auto-rows-min gap-2 uppercase text-sm lg:text-lg z-20"> 
      {% for feature in features %}
      <li class="py-1 md:py-3 px-2 md:px-4 {{ feature.color }}">
        <span class="block opacity-80">{{ feature.text }}</span>
      </li>
      {% endfor %}
    </ul>
    <div class="relative">
      <div class="w-full mt-2 lg:mt-0 vintage opacity-60 z-10">
        {% bannerImage 'src/static/images/bikes12.png', 'Service & Repairs for All Makes & Models' %}
      </div>
      <div class="w-full bottom-0 md:bottom-[15%] absolute px-2 lg:px-4 flex flex-col justify-end items-center bg-gradient-to-b from-df-tan/0 via-df-tan/50 to-df-tan/80 pt-12 pb-20 -mb-20">
        <a class="cta large" href="/bike-servicing/servicing/">
          View Services
        </a> 
        <div class="justify-self-end">
          <blockquote class="font-script rotate-[-6deg] skew-x-[6deg] text-3xl md:text-4xl xl:text-6xl text-center leading-6 text-gray-800 whitespace-pre-line">
          Top-notch service supplied, for&nbsp;whatever&nbsp;you&nbsp;ride
          </blockquote>
        </div>
      </div>
    </div>
  </div>

  {# Shop #}
  <div>
    <a class="flex justify-center items-center h-48 text-4xl" href="/shop/">Shop</a>
  </div>

  {# Up-Cycle Program #}
  <div class="mx-auto max-w-7xl px-2 lg:px-4 pt-6 mt-6 lg:mt-16 lg:pt-16 border-t-2 border-df-gray">
    <h2 class="text-center text-4xl sm:text-4xl lg:text-5xl flex flex-col md:flex-row justify-center font-df-sans">
      <span class="text-shadow text-df-orange font-black uppercase">Community Up-Cycle Program</span>
    </h2>
    <p class="max-w-prose mx-auto text-center mt-2">We accept donations of bikes and bike components, refurbish them, and put them back into Aberfeldy to give everyone the opportunity to get cycling</p>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
      {% set program = [
          {title: '1. Donate', description: 'Drop-off your old and unused bike', image: 'src/static/images/workshop.jpg', imageAlt: 'Workshop with bike', buttonText: 'Donate a Bike', buttonLink: '/bikes/donate/'},
          {title: '2. Refurb', description: 'We\'ll get it into safe, working order', image1: 'src/static/images/refurb-before.png', image2: 'src/static/images/refurb-after.png', id: 'refurb', image1Alt: 'Broken Bike', image2Alt: 'Fixed Bike' },
          {title: '3. Ride', description: 'And back to use in the community', image: 'src/static/images/riding-still.jpg', imageAlt: 'Riding a bicycle', buttonText: 'Refurbed Bikes', buttonLink: '/bikes/refurbs/'}
        ]%}
      {% for step in program %}
      <div class="mb-8 lg:mb-0">
        <div class="relative md:aspect-square text-center">
          <h3 class="font-df-sans font-bold uppercase text-3xl sm:text-2xl xl:text-4xl">{{ step.title }}</h3>
          <p class="mt-2 lg:mt-6 leading-5">{{ step.description }}</p>
          {% if step.image %}
            <div class="mx-auto mt-4 left-0 w-1/2 md:w-full aspect-video">
              <div class="p-1 md:p-2 border-double border-4 border-df-gray top-0 left-0 w-full transition-opacity duration-500">
              {% image step.image, step.imageAlt, "(min-width: 20em) 50vw, 100vw", null, 'eager', null, [200, 400], 'w-full vintage' %}
              </div>
            </div>
          {% endif %}
          {% if step.image1 and step.image2 %}
            <div class="mx-auto left-0 vintage w-1/2 md:w-full aspect-square">
              <div {% if step.id %}id="{{ step.id }}-1"{% endif %} class="absolute top-0 left-0 w-full transition-opacity duration-500">
              {% image step.image1, step.image1Alt, "(min-width: 20em) 50vw, 100vw", null, 'eager', null, [400, 800], 'w-full' %}
              </div>
              <div {% if step.id %}id="{{ step.id }}-2"{% endif %} class="hide absolute top-0 left-0 w-full transition-opacity duration-200">
              {% image step.image2, step.image2Alt, "(min-width: 20em) 50vw, 100vw", null, 'eager', null, [400, 800], 'w-full' %}
              </div>
            </div>
          {% endif %}
          {% if step.buttonText %}
            <a class="cta mt-6" href="{{ step.buttonLink | url }}">{{ step.buttonText }}</a>
          {% endif %}
        </div>
        <div id="sentinel-{{ step.id }}"></div>
      </div>
      {% endfor %}
    </div>
    <script>

      /* Refurb Images - START */
      const refurbSentinelEl = document.getElementById('sentinel-refurb')
      const refurb1El = document.getElementById('refurb-1')
      const refurb2El = document.getElementById('refurb-2')

      const refurbHandler = (entries) => {
        // If the el is scrolling up/into view, replace it
        if (entries[0].boundingClientRect.top > 0)  {
          if (entries[0].isIntersecting) {
            refurb1El.classList.add('hide')
            refurb2El.classList.remove('hide')
          } else {
            refurb2El.classList.add('hide')
            refurb1El.classList.remove('hide')
          }
        }
      }

      const refurbObserver = new window.IntersectionObserver(refurbHandler, {rootMargin: '0px 0px -50px 0px'})
      refurbObserver.observe(refurbSentinelEl)
      /* Refurb Images - END */
    </script>
  </div>

  <div class="mx-auto max-w-7xl px-2 lg:px-4 pt-6 mt-6 lg:mt-16 lg:py-8 border-t border-zinc-400 grid grid-rows-2 md:grid-rows-1 grid-cols-1 md:grid-cols-8">
    <div class="col-span-3">
      <h2>Social Rides</h2>
    </div>
    <div class="mx-auto w-2/3 sm:w-1/2 md:w-full col-span-2">
    {% image 'src/static/images/daftandslow.png', '', "(min-width: 20em) 50vw, 100vw", null, 'eager', null, [500, 1000], 'w-full' %}
    </div>
    <div class="col-span-3">
      <h2>Social Rides</h2>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Bike Store",
  "image": [
    "https://example.com/photos/1x1/photo.jpg",
    "https://example.com/photos/4x3/photo.jpg",
    "https://example.com/photos/16x9/photo.jpg"
   ],
  "@id": "{{ metadata.url }}",
  "name": "{{ metadata.title }}",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "{{ metadata.contact.address }}",
    "addressLocality": "{{ metadata.contact.city }}",
    "addressRegion": "{{ metadata.contact.region }}",
    "postalCode": "{{ metadata.contact.postalCode }}",
    "addressCountry": "{{ metadata.contact.country }}"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": 56.619729,
    "longitude": -3.866270
  },
  "foundingDate": "2023-04-01",
  "founder": {
    "givenName": "Brett",
    "familyName": "DeWoody"
  },
  "url": "{{ metadata.url }}",
  "telephone": "+12122459600",
  "openingHoursSpecification": [
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": [
        "Monday",
        "Tuesday"
      ],
      "opens": "11:30",
      "closes": "22:00"
    },
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": [
        "Wednesday",
        "Thursday",
        "Friday"
      ],
      "opens": "11:30",
      "closes": "23:00"
    },
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": "Saturday",
      "opens": "16:00",
      "closes": "23:00"
    },
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": "Sunday",
      "opens": "16:00",
      "closes": "22:00"
    }
  ],
}
</script>
{% endblock %}
