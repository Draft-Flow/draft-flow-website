{% set navPages = collections.main | eleventyNavigation %}

{% set logoSrc %}
  {% imageUrlFor metadata.logo.asset._ref, 600 %}
{% endset %}

<div id="sentinel" class="absolute top-0"></div>
<header id="header" class="fixed z-50 top-0 w-screen h-20 sm:h-auto bg-df-tan text-pg-tan-light flex flex-col items-center transition-all duration-150 ease-linear">
  <div id="navbar" class="w-full relative mx-4 max-w-6xl text-center lg:text-left flex flex-col lg:justify-between sm:items-center">
    <div id="logobar" class="relative sm:absolute p-4 sm:p-0 h-16 sm:h-auto flex justify-between lg:justify-center items-center z-10">
      <h1 class="home h-full flex items-center {% if page.url == '/' %} logo-item-active{% endif %}">
        <a id="logo" href="{{ '/' | url }}" class="block opacity-80 overflow-hidden w-12 sm:w-28 lg:w-40 transition-all duration-150 ease-linear origin-top">
          {% set logoSrc %}
            {% imageUrlFor metadata.logo.asset._ref, 600 %}
          {% endset %}
          {% image logoSrc, metadata.logo.alt, "(min-width: 20em) 50vw, 100vw", null, 'eager'  %}
        </a>
      </h1>
      <button class="inline sm:hidden w-6 h-6" id="navToggle" aria-haspopup="true" aria-controls="nav" aria-label="Menu">
        <div class="w-6 h-6" id="navOpen">{% svgIcon 'src/assets/icons/navToggle.svg', 'w-6 h-6' %}</div>
        <div class="w-6 h-6 hidden" id="navClose">{% svgIcon 'src/assets/icons/navClose.svg', 'w-6 h-6' %}</div>
      </button>
    </div>
    <nav class="hidden w-full sm:absolute sm:top-0 h-20 sm:h-28 sm:flex sm:items-end grow sm:grow-0 text-df-gray transition-all duration-150 ease-linear" id="nav">
      <ul class="nav w-full px-6 pt-12 sm:pt-0 flex flex-col sm:flex-row justify-between sm:font-medium text-4xl border-t-2 border-dashed sm:border-0 mb-12 sm:mb-[2px] font-df uppercase tracking-widest leading-tight">
        {%- for item in navPages -%}
        {% set firstHalf = loop.index <= 2 %}
          {% if loop.index == 3 %}<li class="hidden sm:block w-24"></li> {% endif %}
          <li class="nav-item relative sm:flex-1 flex flex-col sm:flex-row leading-6 hover:z-40 focus-within:z-40 {% if firstHalf %}sm:justify-start{% else %}sm:justify-end{% endif %} {% if item.url == page.url %}nav-item-active{% endif %}">
            <a href="{{ item.url | url }}" class="text-center relative inline-flex justify-center sm:pt-4 sm:pb-4 sm:px-3 z-20 bg-df-tan border-transparent border-t-2 border-l-2 border-r-2 sm:items-center items-start" {% if item.url == page.url %}aria-current="page"{% endif %}>{{ item.title }}</a>
            {% if item.children.length > 0 %}
            <ul class="subnav list-style-none flex justify-center sm:justify-start sm:hidden sm:flex-col sm:absolute sm:top-[calc(100%-2px)] sm:px-4 sm:py-2 font-gill tracking-wide border-double border-transparent border-b-2 border-l-2 border-t-2 border-r-2 bg-df-tan text-base sm:text-2xl leading-none z-10">
              {% for child in item.children %}
                <li class="flex-1 sm:flex-none mx-3 sm:mx-0 flex justify-center {% if firstHalf %}sm:justify-start{% else %}sm:justify-end{% endif %} py-2 sm:whitespace-nowrap"">
                  <a class="" href="{{ child.url }}">{{ child.title }}</a>
                </li>
              {% endfor %}
            </ul>
            {% endif %}
          </li>
        {% endfor %}
        <li class="sm:hidden sm:w-0" id="social">
          <ul class="w-full justify-center grid grid-rows-1 grid-flow-col gap-12 pb-12 justify-self-end">
            <li class="">
              <a href="https://www.komoot.com/user/{{ metadata.social.komoot }}" title="Komoot - {{ metadata.social.komoot }}" class="h-full lg:flex items-center">{% svgIcon 'src/assets/icons/socialKomoot.svg', 'fill-df-gray w-8 lg:w-5 hover:fill-black' %}</a>
            </li>
            <li class="">
              <a href="https://www.instagram.com/{{ metadata.social.instagram }}/" title="Instagram - @{{ metadata.social.instagram }}" class="h-full lg:flex items-center">{% svgIcon 'src/assets/icons/socialInstagram.svg', 'fill-df-gray w-8 lg:w-5 hover:fill-black' %}</a>
            </li>
            <li class="">
              <a href="https://twitter.com/{{ metadata.social.twitter }}" title="Twitter - @{{ metadata.social.twitter }}" class="h-full lg:flex items-center">{% svgIcon 'src/assets/icons/socialTwitter.svg', 'fill-df-gray w-8 lg:w-5 hover:fill-black' %}</a>
            </li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>
<script>
  const headerEl = document.getElementById('header')

  /* Menu Toggle - START */
  const bodyEl = document.body
  const navEl = document.getElementById('nav')
  const toggleEl = document.getElementById('navToggle')
  const navOpenEl = document.getElementById('navOpen')
  const navCloseEl = document.getElementById('navClose')

  const toggleNav = () => {
    bodyEl.classList.toggle('navOpen')
    headerEl.classList.toggle('open')
    navEl.classList.toggle('hidden')
    navOpenEl.classList.toggle('hidden')
    navCloseEl.classList.toggle('hidden')
  }

  // Toggle menu on toggle click
  toggleEl.addEventListener('click', () => {
    toggleNav()
  })

  // Close menu on Escape, if open
  document.addEventListener('keydown', event => {
    if (event.key === 'Escape') {
      if (bodyEl.classList.contains('navOpen')) {
        toggleNav()
      }
    }
  })
  /* Menu Toggle - END */

  /* Fixed Nav - START */
  const sentinelEl = document.getElementById('sentinel')
  const stuckClass = 'stuck'

  const handler = (entries) => {
    if (headerEl) {
      if (!entries[0].isIntersecting) {
        headerEl.classList.add(stuckClass)
      } else {
        headerEl.classList.remove(stuckClass)
      }
    }
  }

  const observer = new window.IntersectionObserver(handler)
  observer.observe(sentinelEl)
  /* Fixed Nav - END */

</script>
