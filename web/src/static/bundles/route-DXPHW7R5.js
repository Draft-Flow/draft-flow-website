(()=>{var r2=Object.create;var y0=Object.defineProperty;var s2=Object.getOwnPropertyDescriptor;var o2=Object.getOwnPropertyNames;var a2=Object.getPrototypeOf,l2=Object.prototype.hasOwnProperty;var zl=(l,s)=>()=>(s||l((s={exports:{}}).exports,s),s.exports);var c2=(l,s,o,u)=>{if(s&&typeof s=="object"||typeof s=="function")for(let f of o2(s))!l2.call(l,f)&&f!==o&&y0(l,f,{get:()=>s[f],enumerable:!(u=s2(s,f))||u.enumerable});return l};var x0=(l,s,o)=>(o=l!=null?r2(a2(l)):{},c2(s||!l||!l.__esModule?y0(o,"default",{value:l,enumerable:!0}):o,l));var d1=zl((Hm,Ym)=>{(function(l,s){typeof Hm=="object"&&typeof Ym<"u"?Ym.exports=s():typeof define=="function"&&define.amd?define(s):(l=typeof globalThis<"u"?globalThis:l||self,l.mapboxgl=s())})(Hm,function(){"use strict";var l,s,o;function u(n,x){if(!l)l=x;else if(!s)s=x;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",E={};l(E),o=x(E),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(o.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}u(["exports"],function(n){"use strict";var x="2.8.2",w=E;function E(i,t,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=r,this.p2y=a}E.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},E.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},E.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},E.prototype.solveCurveX=function(i,t){var r,a,h,p,_;for(t===void 0&&(t=1e-6),h=i,_=0;_<8;_++){if(p=this.sampleCurveX(h)-i,Math.abs(p)<t)return h;var g=this.sampleCurveDerivativeX(h);if(Math.abs(g)<1e-6)break;h-=p/g}if((h=i)<(r=0))return r;if(h>(a=1))return a;for(;r<a;){if(p=this.sampleCurveX(h),Math.abs(p-i)<t)return h;i>p?r=h:a=h,h=.5*(a-r)+r}return h},E.prototype.solve=function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))};var A=D;function D(i,t){this.x=i,this.y=t}D.prototype={clone:function(){return new D(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),a=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,t){var r=Math.cos(i),a=Math.sin(i),h=t.y+a*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},D.convert=function(i){return i instanceof D?i:Array.isArray(i)?new D(i[0],i[1]):i};var B=typeof self<"u"?self:{};let G=Math.PI/180,rt=180/Math.PI;function Q(i){return i*G}function dt(i){return i*rt}let W=[[0,0],[1,0],[1,1],[0,1]];function et(i){if(i<=0)return 0;if(i>=1)return 1;let t=i*i,r=t*i;return 4*(i<.5?r:3*(i-t)+r-.75)}function mt(i,t,r,a){let h=new w(i,t,r,a);return function(p){return h.solve(p)}}let St=mt(.25,.1,.25,1);function _t(i,t,r){return Math.min(r,Math.max(t,i))}function Mt(i,t,r){return(r=_t((r-i)/(t-i),0,1))*r*(3-2*r)}function Rt(i,t,r){let a=r-t,h=((i-t)%a+a)%a+t;return h===t?r:h}function Vt(i,t,r){if(!i.length)return r(null,[]);let a=i.length,h=new Array(i.length),p=null;i.forEach((_,g)=>{t(_,(b,S)=>{b&&(p=b),h[g]=S,--a==0&&r(p,h)})})}function Yt(i){let t=[];for(let r in i)t.push(i[r]);return t}function jt(i,...t){for(let r of t)for(let a in r)i[a]=r[a];return i}let ye=1;function le(){return ye++}function me(){return function i(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function He(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Ye(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function be(i,t){i.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function Me(i,t){return i.indexOf(t,i.length-t.length)!==-1}function Ui(i,t,r){let a={};for(let h in i)a[h]=t.call(r||this,i[h],h,i);return a}function Di(i,t,r){let a={};for(let h in i)t.call(r||this,i[h],h,i)&&(a[h]=i[h]);return a}function di(i){return Array.isArray(i)?i.map(di):typeof i=="object"&&i?Ui(i,di):i}let _i={};function qe(i){_i[i]||(typeof console<"u"&&console.warn(i),_i[i]=!0)}function gi(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Ki(i){let t=0;for(let r,a,h=0,p=i.length,_=p-1;h<p;_=h++)r=i[h],a=i[_],t+=(a.x-r.x)*(r.y+a.y);return t}function Xi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Kn(i){let t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,h,p)=>{let _=h||p;return t[a]=!_||_.toLowerCase(),""}),t["max-age"]){let r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let vn,Io,Kr,Jn,Le=null;function Tr(i){if(Le==null){let t=i.navigator?i.navigator.userAgent:null;Le=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Le}function ka(i){try{let t=B[i];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}let Ji={now:()=>Kr!==void 0?Kr:B.performance.now(),setNow(i){Kr=i},restoreNow(){Kr=void 0},frame(i){let t=B.requestAnimationFrame(i);return{cancel:()=>B.cancelAnimationFrame(t)}},getImageData(i,t=0){let{width:r,height:a}=i;Jn||(Jn=B.document.createElement("canvas"));let h=Jn.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return(r>Jn.width||a>Jn.height)&&(Jn.width=r,Jn.height=a),h.clearRect(-t,-t,r+2*t,a+2*t),h.drawImage(i,0,0,r,a),h.getImageData(-t,-t,r+2*t,a+2*t)},resolveURL:i=>(vn||(vn=B.document.createElement("a")),vn.href=i,vn.href),get devicePixelRatio(){return B.devicePixelRatio},get prefersReducedMotion(){return!!B.matchMedia&&(Io==null&&(Io=B.matchMedia("(prefers-reduced-motion: reduce)")),Io.matches)}},Jr,Oe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Jr==null){let i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Jr=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{Jr=i}}return Jr},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Sr={supported:!1,testSupport:function(i){!ts&&bn&&(Rs?ko(i):Qr=i)}},Qr,bn,ts=!1,Rs=!1;function ko(i){let t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,bn),i.isContextLost())return;Sr.supported=!0}catch{}i.deleteTexture(t),ts=!0}B.document&&(bn=B.document.createElement("img"),bn.onload=function(){Qr&&ko(Qr),Qr=null,Rs=!0},bn.onerror=function(){ts=!0,Qr=null},bn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Bs="01",es="NO_ACCESS_TOKEN";function Vn(i){return i.indexOf("mapbox:")===0}function is(i){return Oe.API_URL_REGEX.test(i)}let Zn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Un(i){let t=i.match(Zn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Er(i){let t=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${t}`}function Po(i){if(!i)return null;let t=i.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(B.atob(t[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ns{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let r=Po(Oe.ACCESS_TOKEN),a="";return a=r&&r.u?B.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(Number("0x"+p)))):Oe.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){let t=ka("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{let h=B.localStorage.getItem(r);h&&(this.eventData=JSON.parse(h));let p=B.localStorage.getItem(a);p&&(this.anonId=p)}catch{qe("Unable to read from LocalStorage")}}saveEventData(){let t=ka("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{B.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&B.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{qe("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,a,h){if(!Oe.EVENTS_URL)return;let p=Un(Oe.EVENTS_URL);p.params.push(`access_token=${h||Oe.ACCESS_TOKEN||""}`);let _={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:x,skuId:Bs,userId:this.anonId},g=r?jt(_,r):_,b={url:Er(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=ht(b,S=>{this.pendingRequest=null,a(S),this.saveEventData(),this.processRequests(h)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}let Fs=new class extends ns{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,t){Oe.EVENTS_URL&&Oe.ACCESS_TOKEN&&Array.isArray(i)&&i.some(r=>Vn(r)||is(r))&&this.queueRequest(Date.now(),t)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=Po(Oe.ACCESS_TOKEN),r=t?t.u:Oe.ACCESS_TOKEN,a=r!==this.eventData.tokenU;Ye(this.anonId)||(this.anonId=me(),a=!0);let h=this.queue.shift();if(this.eventData.lastSuccess){let p=new Date(this.eventData.lastSuccess),_=new Date(h),g=(h-this.eventData.lastSuccess)/864e5;a=a||g>=1||g<-1||p.getDate()!==_.getDate()}else a=!0;a?this.postEvent(h,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=r)},i):this.processRequests()}},ic=Fs.postTurnstileEvent.bind(Fs),Pa=new class extends ns{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,t,r,a){this.skuToken=t,this.errorCb=a,Oe.EVENTS_URL&&(r||Oe.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(es)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Ye(this.anonId)||(this.anonId=me()),this.postEvent(r,{skuToken:this.skuToken},a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},i))}},za=Pa.postMapLoadEvent.bind(Pa),Os=new class extends ns{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,t,r,a){if(!Oe.API_URL||!Oe.SESSION_PATH)return;let h=Un(Oe.API_URL+Oe.SESSION_PATH);h.params.push(`sku=${t||""}`),h.params.push(`access_token=${a||Oe.ACCESS_TOKEN||""}`);let p={url:Er(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=vt(p,_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(a)})}getSessionAPI(i,t,r,a){this.skuToken=t,this.errorCb=a,Oe.SESSION_PATH&&Oe.API_URL&&(r||Oe.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(es)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},i)}},Da=Os.getSessionAPI.bind(Os),rs=new Set,La="mapbox-tiles",Nn,Mr,ss=500,os=50;function Vs(){B.caches&&!Nn&&(Nn=B.caches.open(La))}function zo(i){let t=i.indexOf("?");return t<0?i:i.slice(0,t)}let Zs=1/0,J={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(J);class F extends Error{constructor(t,r,a){r===401&&is(a)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Z=Xi()?()=>self.worker&&self.worker.referrer:()=>(B.location.protocol==="blob:"?B.parent:B).location.href,H=function(i,t){if(!(/^file:/.test(r=i.url)||/^file:/.test(Z())&&!/^\w+:/.test(r))){if(B.fetch&&B.Request&&B.AbortController&&B.Request.prototype.hasOwnProperty("signal"))return function(a,h){let p=new B.AbortController,_=new B.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Z(),signal:p.signal}),g=!1,b=!1,S=(C=_.url).indexOf("sku=")>0&&is(C);var C;a.type==="json"&&_.headers.set("Accept","application/json");let I=(R,V,N)=>{if(b)return;if(R&&R.message!=="SecurityError"&&qe(R),V&&N)return P(V);let q=Date.now();B.fetch(_).then(K=>{if(K.ok){let lt=S?K.clone():null;return P(K,lt,q)}return h(new F(K.statusText,K.status,a.url))}).catch(K=>{K.code!==20&&h(new Error(K.message))})},P=(R,V,N)=>{(a.type==="arrayBuffer"?R.arrayBuffer():a.type==="json"?R.json():R.text()).then(q=>{b||(V&&N&&function(K,lt,ut){if(Vs(),!Nn)return;let ft={status:lt.status,statusText:lt.statusText,headers:new B.Headers};lt.headers.forEach((It,Pt)=>ft.headers.set(Pt,It));let gt=Kn(lt.headers.get("Cache-Control")||"");if(gt["no-store"])return;gt["max-age"]&&ft.headers.set("Expires",new Date(ut+1e3*gt["max-age"]).toUTCString());let yt=ft.headers.get("Expires");yt&&(new Date(yt).getTime()-ut<42e4||function(It,Pt){if(Mr===void 0)try{new Response(new ReadableStream),Mr=!0}catch{Mr=!1}Mr?Pt(It.body):It.blob().then(Pt)}(lt,It=>{let Pt=new B.Response(It,ft);Vs(),Nn&&Nn.then(Bt=>Bt.put(zo(K.url),Pt)).catch(Bt=>qe(Bt.message))}))}(_,V,N),g=!0,h(null,q,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(q=>{b||h(new Error(q.message))})};return S?function(R,V){if(Vs(),!Nn)return V(null);let N=zo(R.url);Nn.then(q=>{q.match(N).then(K=>{let lt=function(ut){if(!ut)return!1;let ft=new Date(ut.headers.get("Expires")||0),gt=Kn(ut.headers.get("Cache-Control")||"");return ft>Date.now()&&!gt["no-cache"]}(K);q.delete(N),lt&&q.put(N,K.clone()),V(null,K,lt)}).catch(V)}).catch(V)}(_,I):I(null,null),{cancel:()=>{b=!0,g||p.abort()}}}(i,t);if(Xi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var r;return function(a,h){let p=new B.XMLHttpRequest;p.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(let _ in a.headers)p.setRequestHeader(_,a.headers[_]);return a.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=a.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let _=p.response;if(a.type==="json")try{_=JSON.parse(p.response)}catch(g){return h(g)}h(null,_,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new F(p.statusText,p.status,a.url))},p.send(a.body),{cancel:()=>p.abort()}}(i,t)},ot=function(i,t){return H(jt(i,{type:"arrayBuffer"}),t)},ht=function(i,t){return H(jt(i,{method:"POST"}),t)},vt=function(i,t){return H(jt(i,{method:"GET"}),t)};function xt(i){let t=B.document.createElement("a");return t.href=i,t.protocol===B.document.location.protocol&&t.host===B.document.location.host}let pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Tt,Ft;Tt=[],Ft=0;let Kt=function(i,t){if(Sr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Ft>=Oe.MAX_PARALLEL_IMAGE_REQUESTS){let p={requestParameters:i,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Tt.push(p),p}Ft++;let r=!1,a=()=>{if(!r)for(r=!0,Ft--;Tt.length&&Ft<Oe.MAX_PARALLEL_IMAGE_REQUESTS;){let p=Tt.shift(),{requestParameters:_,callback:g,cancelled:b}=p;b||(p.cancel=Kt(_,g).cancel)}},h=ot(i,(p,_,g,b)=>{a(),p?t(p):_&&(B.createImageBitmap?function(S,C){let I=new B.Blob([new Uint8Array(S)],{type:"image/png"});B.createImageBitmap(I).then(P=>{C(null,P)}).catch(P=>{C(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(S,C)=>t(S,C,g,b)):function(S,C){let I=new B.Image,P=B.URL;I.onload=()=>{C(null,I),P.revokeObjectURL(I.src),I.onload=null,B.requestAnimationFrame(()=>{I.src=pt})},I.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let R=new B.Blob([new Uint8Array(S)],{type:"image/png"});I.src=S.byteLength?P.createObjectURL(R):pt}(_,(S,C)=>t(S,C,g,b)))});return{cancel:()=>{h.cancel(),a()}}};function Zt(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function pe(i,t,r){if(r&&r[i]){let a=r[i].indexOf(t);a!==-1&&r[i].splice(a,1)}}class ce{constructor(t,r={}){jt(this,r),this.type=t}}class he extends ce{constructor(t,r={}){super("error",jt({error:t},r))}}class _e{on(t,r){return this._listeners=this._listeners||{},Zt(t,r,this._listeners),this}off(t,r){return pe(t,r,this._listeners),pe(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Zt(t,r,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,r){typeof t=="string"&&(t=new ce(t,r||{}));let a=t.type;if(this.listens(a)){t.target=this;let h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let g of h)g.call(this,t);let p=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let g of p)pe(a,g,this._oneTimeListeners),g.call(this,t);let _=this._eventedParent;_&&(jt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof he&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Et=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ve(i,...t){for(let r of t)for(let a in r)i[a]=r[a];return i}function se(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Be(i){if(Array.isArray(i))return i.map(Be);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let t={};for(let r in i)t[r]=Be(i[r]);return t}return se(i)}class Ze extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class as{constructor(t,r=[]){this.parent=t,this.bindings={};for(let[a,h]of r)this.bindings[a]=h}concat(t){return new as(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let ar={kind:"null"},Ht={kind:"number"},ze={kind:"string"},Ae={kind:"boolean"},Qn={kind:"color"},ls={kind:"object"},Ie={kind:"value"},cs={kind:"collator"},Us={kind:"formatted"},Hi={kind:"resolvedImage"};function wn(i,t){return{kind:"array",itemType:i,N:t}}function ci(i){if(i.kind==="array"){let t=ci(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}let Tp=[ar,Ht,ze,Ae,Qn,Us,ls,wn(Ie),Hi];function Do(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Do(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(let r of Tp)if(!Do(r,t))return null}}return`Expected ${ci(i)} but found ${ci(t)} instead.`}function Ra(i,t){return t.some(r=>r.kind===i.kind)}function Ns(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Ba(i){var t={exports:{}};return i(t,t.exports),t.exports}var nc=Ba(function(i,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(g){return(g=Math.round(g))<0?0:g>255?255:g}function h(g){return a(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function p(g){return(b=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:b>1?1:b;var b}function _(g,b,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?g+(b-g)*S*6:2*S<1?b:3*S<2?g+(b-g)*(2/3-S)*6:g}try{t.parseCSSColor=function(g){var b,S=g.replace(/ /g,"").toLowerCase();if(S in r)return r[S].slice();if(S[0]==="#")return S.length===4?(b=parseInt(S.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:S.length===7&&(b=parseInt(S.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var C=S.indexOf("("),I=S.indexOf(")");if(C!==-1&&I+1===S.length){var P=S.substr(0,C),R=S.substr(C+1,I-(C+1)).split(","),V=1;switch(P){case"rgba":if(R.length!==4)return null;V=p(R.pop());case"rgb":return R.length!==3?null:[h(R[0]),h(R[1]),h(R[2]),V];case"hsla":if(R.length!==4)return null;V=p(R.pop());case"hsl":if(R.length!==3)return null;var N=(parseFloat(R[0])%360+360)%360/360,q=p(R[1]),K=p(R[2]),lt=K<=.5?K*(q+1):K+q-K*q,ut=2*K-lt;return[a(255*_(ut,lt,N+1/3)),a(255*_(ut,lt,N)),a(255*_(ut,lt,N-1/3)),V];default:return null}}return null}}catch{}});class Fe{constructor(t,r,a,h=1){this.r=t,this.g=r,this.b=a,this.a=h}static parse(t){if(!t)return;if(t instanceof Fe)return t;if(typeof t!="string")return;let r=nc.parseCSSColor(t);return r?new Fe(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){let[t,r,a,h]=this.toArray();return`rgba(${Math.round(t)},${Math.round(r)},${Math.round(a)},${h})`}toArray(){let{r:t,g:r,b:a,a:h}=this;return h===0?[0,0,0,0]:[255*t/h,255*r/h,255*a/h,h]}}Fe.black=new Fe(0,0,0,1),Fe.white=new Fe(1,1,1,1),Fe.transparent=new Fe(0,0,0,0),Fe.red=new Fe(1,0,0,1),Fe.blue=new Fe(0,0,1,1);class js{constructor(t,r,a){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class rc{constructor(t,r,a,h,p){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=a,this.fontStack=h,this.textColor=p}}class Ai{constructor(t){this.sections=t}static fromString(t){return new Ai([new rc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Ai?t:Ai.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){let t=["format"];for(let r of this.sections){if(r.image){t.push(["image",r.image.name]);continue}t.push(r.text);let a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(a)}return t}}class ln{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ln({name:t,available:!1}):null}serialize(){return["image",this.name]}}function jn(i,t,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,t,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,t,r,a]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fa(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Fe||i instanceof js||i instanceof Ai||i instanceof ln)return!0;if(Array.isArray(i)){for(let t of i)if(!Fa(t))return!1;return!0}if(typeof i=="object"){for(let t in i)if(!Fa(i[t]))return!1;return!0}return!1}function wi(i){if(i===null)return ar;if(typeof i=="string")return ze;if(typeof i=="boolean")return Ae;if(typeof i=="number")return Ht;if(i instanceof Fe)return Qn;if(i instanceof js)return cs;if(i instanceof Ai)return Us;if(i instanceof ln)return Hi;if(Array.isArray(i)){let t=i.length,r;for(let a of i){let h=wi(a);if(r){if(r===h)continue;r=Ie;break}r=h}return wn(r||Ie,t)}return ls}function lr(i){let t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Fe||i instanceof Ai||i instanceof ln?i.toString():JSON.stringify(i)}class cr{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Fa(t[1]))return r.error("invalid value");let a=t[1],h=wi(a),p=r.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new cr(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Fe?["rgba"].concat(this.value.toArray()):this.value instanceof Ai?this.value.serialize():this.value}}class Oi{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let sc={string:ze,number:Ht,boolean:Ae,object:ls};class Gn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a,h=1,p=t[0];if(p==="array"){let g,b;if(t.length>2){let S=t[1];if(typeof S!="string"||!(S in sc)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=sc[S],h++}else g=Ie;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}a=wn(g,b)}else a=sc[p];let _=[];for(;h<t.length;h++){let g=r.parse(t[h],h,Ie);if(!g)return null;_.push(g)}return new Gn(a,_)}evaluate(t){for(let r=0;r<this.args.length;r++){let a=this.args[r].evaluate(t);if(!Do(this.type,wi(a)))return a;if(r===this.args.length-1)throw new Oi(`Expected value to be of type ${ci(this.type)}, but found ${ci(wi(a))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=this.type,r=[t.kind];if(t.kind==="array"){let a=t.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);let h=t.N;(typeof h=="number"||this.args.length>1)&&r.push(h)}}return r.concat(this.args.map(a=>a.serialize()))}}class Gs{constructor(t){this.type=Us,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a=t[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");let h=[],p=!1;for(let _=1;_<=t.length-1;++_){let g=t[_];if(p&&typeof g=="object"&&!Array.isArray(g)){p=!1;let b=null;if(g["font-scale"]&&(b=r.parse(g["font-scale"],1,Ht),!b))return null;let S=null;if(g["text-font"]&&(S=r.parse(g["text-font"],1,wn(ze)),!S))return null;let C=null;if(g["text-color"]&&(C=r.parse(g["text-color"],1,Qn),!C))return null;let I=h[h.length-1];I.scale=b,I.font=S,I.textColor=C}else{let b=r.parse(t[_],1,Ie);if(!b)return null;let S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Gs(h)}evaluate(t){return new Ai(this.sections.map(r=>{let a=r.content.evaluate(t);return wi(a)===Hi?new rc("",a,null,null,null):new rc(lr(a),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(let r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){let t=["format"];for(let r of this.sections){t.push(r.content.serialize());let a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),t.push(a)}return t}}class $s{constructor(t){this.type=Hi,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");let a=r.parse(t[1],1,ze);return a?new $s(a):r.error("No image name provided.")}evaluate(t){let r=this.input.evaluate(t),a=ln.fromString(r);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(r)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let Sp={"to-boolean":Ae,"to-color":Qn,"to-number":Ht,"to-string":ze};class $n{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a=t[0];if((a==="to-boolean"||a==="to-string")&&t.length!==2)return r.error("Expected one argument.");let h=Sp[a],p=[];for(let _=1;_<t.length;_++){let g=r.parse(t[_],_,Ie);if(!g)return null;p.push(g)}return new $n(h,p)}evaluate(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){let r,a;for(let h of this.args){if(r=h.evaluate(t),a=null,r instanceof Fe)return r;if(typeof r=="string"){let p=t.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:jn(r[0],r[1],r[2],r[3]),!a))return new Fe(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Oi(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(let a of this.args){if(r=a.evaluate(t),r===null)return 0;let h=Number(r);if(!isNaN(h))return h}throw new Oi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Ai.fromString(lr(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ln.fromString(lr(this.args[0].evaluate(t))):lr(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Gs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $s(this.args[0]).serialize();let t=[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}let Ep=["Unknown","Point","LineString","Polygon"];class Qh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ep[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-t[0])+this.featureDistanceData.bearing[1]*(h*r-t[1])}return 0}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=Fe.parse(t)),r}}class cn{constructor(t,r,a,h){this.name=t,this.type=r,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){let a=t[0],h=cn.definitions[a];if(!h)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let p=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,g=_.filter(([S])=>!Array.isArray(S)||S.length===t.length-1),b=null;for(let[S,C]of g){b=new Cr(r.registry,r.path,null,r.scope);let I=[],P=!1;for(let R=1;R<t.length;R++){let V=t[R],N=Array.isArray(S)?S[R-1]:S.type,q=b.parse(V,1+I.length,N);if(!q){P=!0;break}I.push(q)}if(!P)if(Array.isArray(S)&&S.length!==I.length)b.error(`Expected ${S.length} arguments, but found ${I.length} instead.`);else{for(let R=0;R<I.length;R++){let V=Array.isArray(S)?S[R]:S.type,N=I[R];b.concat(R+1).checkSubtype(V,N.type)}if(b.errors.length===0)return new cn(a,p,C,I)}}if(g.length===1)r.errors.push(...b.errors);else{let S=(g.length?g:_).map(([I])=>{return P=I,Array.isArray(P)?`(${P.map(ci).join(", ")})`:`(${ci(P.type)}...)`;var P}).join(" | "),C=[];for(let I=1;I<t.length;I++){let P=r.parse(t[I],1+C.length);if(!P)return null;C.push(ci(P.type))}r.error(`Expected arguments of type ${S}, but found (${C.join(", ")}) instead.`)}return null}static register(t,r){cn.definitions=r;for(let a in r)t[a]=cn}}class Oa{constructor(t,r,a){this.type=cs,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");let a=t[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");let h=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Ae);if(!h)return null;let p=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Ae);if(!p)return null;let _=null;return a.locale&&(_=r.parse(a.locale,1,ze),!_)?null:new Oa(h,p,_)}evaluate(t){return new js(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){let t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}let Ar=8192;function oc(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Va(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function tu(i,t){let r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(r*h*Ar),Math.round(a*h*Ar)]}function Za(i,t,r){let a=i[0]-t[0],h=i[1]-t[1],p=i[0]-r[0],_=i[1]-r[1];return a*_-p*h==0&&a*p<=0&&h*_<=0}function ac(i,t){let r=!1;for(let _=0,g=t.length;_<g;_++){let b=t[_];for(let S=0,C=b.length;S<C-1;S++){if(Za(i,b[S],b[S+1]))return!1;(h=b[S])[1]>(a=i)[1]!=(p=b[S+1])[1]>a[1]&&a[0]<(p[0]-h[0])*(a[1]-h[1])/(p[1]-h[1])+h[0]&&(r=!r)}}var a,h,p;return r}function Mp(i,t){for(let r=0;r<t.length;r++)if(ac(i,t[r]))return!0;return!1}function eu(i,t,r,a){let h=a[0]-r[0],p=a[1]-r[1],_=(i[0]-r[0])*p-h*(i[1]-r[1]),g=(t[0]-r[0])*p-h*(t[1]-r[1]);return _>0&&g<0||_<0&&g>0}function Ap(i,t,r){for(let S of r)for(let C=0;C<S.length-1;++C)if((g=[(_=S[C+1])[0]-(p=S[C])[0],_[1]-p[1]])[0]*(b=[(h=t)[0]-(a=i)[0],h[1]-a[1]])[1]-g[1]*b[0]!=0&&eu(a,h,p,_)&&eu(p,_,a,h))return!0;var a,h,p,_,g,b;return!1}function iu(i,t){for(let r=0;r<i.length;++r)if(!ac(i[r],t))return!1;for(let r=0;r<i.length-1;++r)if(Ap(i[r],i[r+1],t))return!1;return!0}function Cp(i,t){for(let r=0;r<t.length;r++)if(iu(i,t[r]))return!0;return!1}function Ua(i,t,r){let a=[];for(let h=0;h<i.length;h++){let p=[];for(let _=0;_<i[h].length;_++){let g=tu(i[h][_],r);oc(t,g),p.push(g)}a.push(p)}return a}function Lo(i,t,r){let a=[];for(let h=0;h<i.length;h++){let p=Ua(i[h],t,r);a.push(p)}return a}function nu(i,t,r,a){if(i[0]<r[0]||i[0]>r[2]){let h=.5*a,p=i[0]-r[0]>h?-a:r[0]-i[0]>h?a:0;p===0&&(p=i[0]-r[2]>h?-a:r[2]-i[0]>h?a:0),i[0]+=p}oc(t,i)}function ru(i,t,r,a){let h=Math.pow(2,a.z)*Ar,p=[a.x*Ar,a.y*Ar],_=[];if(!i)return _;for(let g of i)for(let b of g){let S=[b.x+p[0],b.y+p[1]];nu(S,t,r,h),_.push(S)}return _}function su(i,t,r,a){let h=Math.pow(2,a.z)*Ar,p=[a.x*Ar,a.y*Ar],_=[];if(!i)return _;for(let b of i){let S=[];for(let C of b){let I=[C.x+p[0],C.y+p[1]];oc(t,I),S.push(I)}_.push(S)}if(t[2]-t[0]<=h/2){(g=t)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(let b of _)for(let S of b)nu(S,t,r,h)}var g;return _}class hs{constructor(t,r){this.type=Ae,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Fa(t[1])){let a=t[1];if(a.type==="FeatureCollection")for(let h=0;h<a.features.length;++h){let p=a.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new hs(a,a.features[h].geometry)}else if(a.type==="Feature"){let h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new hs(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new hs(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){let h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(a.type==="Polygon"){let g=Ua(a.coordinates,p,_),b=ru(r.geometry(),h,p,_);if(!Va(h,p))return!1;for(let S of b)if(!ac(S,g))return!1}if(a.type==="MultiPolygon"){let g=Lo(a.coordinates,p,_),b=ru(r.geometry(),h,p,_);if(!Va(h,p))return!1;for(let S of b)if(!Mp(S,g))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){let h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(a.type==="Polygon"){let g=Ua(a.coordinates,p,_),b=su(r.geometry(),h,p,_);if(!Va(h,p))return!1;for(let S of b)if(!iu(S,g))return!1}if(a.type==="MultiPolygon"){let g=Lo(a.coordinates,p,_),b=su(r.geometry(),h,p,_);if(!Va(h,p))return!1;for(let S of b)if(!Cp(S,g))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Qi(i){if(i instanceof cn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof hs)return!1;let t=!0;return i.eachChild(r=>{t&&!Qi(r)&&(t=!1)}),t}function Ro(i){if(i instanceof cn&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!Ro(r)&&(t=!1)}),t}function Bo(i,t){if(i instanceof cn&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!Bo(a,t)&&(r=!1)}),r}class us{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let a=t[1];return r.scope.has(a)?new us(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Cr{constructor(t,r=[],a,h=new as,p=[]){this.registry=t,this.path=r,this.key=r.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=p,this.expectedType=a}parse(t,r,a,h,p={}){return r?this.concat(r,a,h)._parse(t,p):this._parse(t,p)}_parse(t,r){function a(h,p,_){return _==="assert"?new Gn(p,[h]):_==="coerce"?new $n(p,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let p=this.registry[h];if(p){let _=p.parse(t,this);if(!_)return null;if(this.expectedType){let g=this.expectedType,b=_.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else _=a(_,g,r.typeAnnotation||"coerce");else _=a(_,g,r.typeAnnotation||"assert")}if(!(_ instanceof cr)&&_.type.kind!=="resolvedImage"&&Na(_)){let g=new Qh;try{_=new cr(_.type,_.evaluate(g))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,a){let h=typeof t=="number"?this.path.concat(t):this.path,p=a?this.scope.concat(a):this.scope;return new Cr(this.registry,h,r||null,p,this.errors)}error(t,...r){let a=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ze(a,t))}checkSubtype(t,r){let a=Do(t,r);return a&&this.error(a),a}}function Na(i){if(i instanceof us)return Na(i.boundExpression);if(i instanceof cn&&i.name==="error"||i instanceof Oa||i instanceof hs)return!1;let t=i instanceof $n||i instanceof Gn,r=!0;return i.eachChild(a=>{r=t?r&&Na(a):r&&a instanceof cr}),!!r&&Qi(i)&&Bo(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Fo(i,t){let r=i.length-1,a,h,p=0,_=r,g=0;for(;p<=_;)if(g=Math.floor((p+_)/2),a=i[g],h=i[g+1],a<=t){if(g===r||t<h)return g;p=g+1}else{if(!(a>t))throw new Oi("Input is not a number.");_=g-1}return 0}class Oo{constructor(t,r,a){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(let[h,p]of a)this.labels.push(h),this.outputs.push(p)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");let a=r.parse(t[1],1,Ht);if(!a)return null;let h=[],p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let _=1;_<t.length;_+=2){let g=_===1?-1/0:t[_],b=t[_+1],S=_,C=_+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(h.length&&h[h.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);let I=r.parse(b,C,p);if(!I)return null;p=p||I.type,h.push([g,I])}return new Oo(p,a,h)}evaluate(t){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);let h=this.input.evaluate(t);if(h<=r[0])return a[0].evaluate(t);let p=r.length;return h>=r[p-1]?a[p-1].evaluate(t):a[Fo(r,h)].evaluate(t)}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}function de(i,t,r){return i*(1-r)+t*r}var ja=Object.freeze({__proto__:null,number:de,color:function(i,t,r){return new Fe(de(i.r,t.r,r),de(i.g,t.g,r),de(i.b,t.b,r),de(i.a,t.a,r))},array:function(i,t,r){return i.map((a,h)=>de(a,t[h],r))}});let ou=.95047,au=1.08883,lc=4/29,cc=6/29,hc=3*cc*cc,lu=Math.PI/180,cu=180/Math.PI;function Ga(i){return i>.008856451679035631?Math.pow(i,1/3):i/hc+lc}function Ir(i){return i>cc?i*i*i:hc*(i-lc)}function qs(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function uc(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function $a(i){let t=uc(i.r),r=uc(i.g),a=uc(i.b),h=Ga((.4124564*t+.3575761*r+.1804375*a)/ou),p=Ga((.2126729*t+.7151522*r+.072175*a)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Ga((.0193339*t+.119192*r+.9503041*a)/au)),alpha:i.a}}function dc(i){let t=(i.l+16)/116,r=isNaN(i.a)?t:t+i.a/500,a=isNaN(i.b)?t:t-i.b/200;return t=1*Ir(t),r=ou*Ir(r),a=au*Ir(a),new Fe(qs(3.2404542*r-1.5371385*t-.4985314*a),qs(-.969266*r+1.8760108*t+.041556*a),qs(.0556434*r-.2040259*t+1.0572252*a),i.alpha)}function Ip(i,t,r){let a=t-i;return i+r*(a>180||a<-180?a-360*Math.round(a/360):a)}let Vo={forward:$a,reverse:dc,interpolate:function(i,t,r){return{l:de(i.l,t.l,r),a:de(i.a,t.a,r),b:de(i.b,t.b,r),alpha:de(i.alpha,t.alpha,r)}}},Zo={forward:function(i){let{l:t,a:r,b:a}=$a(i),h=Math.atan2(a,r)*cu;return{h:h<0?h+360:h,c:Math.sqrt(r*r+a*a),l:t,alpha:i.a}},reverse:function(i){let t=i.h*lu,r=i.c;return dc({l:i.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:i.alpha})},interpolate:function(i,t,r){return{h:Ip(i.h,t.h,r),c:de(i.c,t.c,r),l:de(i.l,t.l,r),alpha:de(i.alpha,t.alpha,r)}}};var pc=Object.freeze({__proto__:null,lab:Vo,hcl:Zo});class hn{constructor(t,r,a,h,p){this.type=t,this.operator=r,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(let[_,g]of p)this.labels.push(_),this.outputs.push(g)}static interpolationFactor(t,r,a,h){let p=0;if(t.name==="exponential")p=qa(r,t.base,a,h);else if(t.name==="linear")p=qa(r,1,a,h);else if(t.name==="cubic-bezier"){let _=t.controlPoints;p=new w(_[0],_[1],_[2],_[3]).solve(qa(r,1,a,h))}return p}static parse(t,r){let[a,h,p,..._]=t;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){let S=h[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{let S=h.slice(1);if(S.length!==4||S.some(C=>typeof C!="number"||C<0||C>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:S}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Ht),!p)return null;let g=[],b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=Qn:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let S=0;S<_.length;S+=2){let C=_[S],I=_[S+1],P=S+3,R=S+4;if(typeof C!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(g.length&&g[g.length-1][0]>=C)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);let V=r.parse(I,R,b);if(!V)return null;b=b||V.type,g.push([C,V])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new hn(b,a,h,p,g):r.error(`Type ${ci(b)} is not interpolatable.`)}evaluate(t){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);let h=this.input.evaluate(t);if(h<=r[0])return a[0].evaluate(t);let p=r.length;if(h>=r[p-1])return a[p-1].evaluate(t);let _=Fo(r,h),g=hn.interpolationFactor(this.interpolation,h,r[_],r[_+1]),b=a[_].evaluate(t),S=a[_+1].evaluate(t);return this.operator==="interpolate"?ja[this.type.kind.toLowerCase()](b,S,g):this.operator==="interpolate-hcl"?Zo.reverse(Zo.interpolate(Zo.forward(b),Zo.forward(S),g)):Vo.reverse(Vo.interpolate(Vo.forward(b),Vo.forward(S),g))}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let r=[this.operator,t,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function qa(i,t,r,a){let h=a-r,p=i-r;return h===0?0:t===1?p/h:(Math.pow(t,p)-1)/(Math.pow(t,h)-1)}class Uo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let a=null,h=r.expectedType;h&&h.kind!=="value"&&(a=h);let p=[];for(let g of t.slice(1)){let b=r.parse(g,1+p.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,p.push(b)}let _=h&&p.some(g=>Do(h,g.type));return new Uo(_?Ie:a,p)}evaluate(t){let r,a=null,h=0;for(let p of this.args){if(h++,a=p.evaluate(t),a&&a instanceof ln&&!a.available&&(r||(r=a),a=null,h===this.args.length))return r;if(a!==null)break}return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class No{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let a=[];for(let p=1;p<t.length-1;p+=2){let _=t[p];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);let g=r.parse(t[p+1],p+1);if(!g)return null;a.push([_,g])}let h=r.parse(t[t.length-1],t.length-1,r.expectedType,a);return h?new No(a,h):null}outputDefined(){return this.result.outputDefined()}serialize(){let t=["let"];for(let[r,a]of this.bindings)t.push(r,a.serialize());return t.push(this.result.serialize()),t}}class fc{constructor(t,r,a){this.type=t,this.index=r,this.input=a}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Ht),h=r.parse(t[2],2,wn(r.expectedType||Ie));return a&&h?new fc(h.type.itemType,a,h):null}evaluate(t){let r=this.index.evaluate(t),a=this.input.evaluate(t);if(r<0)throw new Oi(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Oi(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Oi(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Wa{constructor(t,r){this.type=Ae,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Ie),h=r.parse(t[2],2,Ie);return a&&h?Ra(a.type,[Ae,ze,Ht,ar,Ie])?new Wa(a,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(a.type)} instead`):null}evaluate(t){let r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(a==null)return!1;if(!Ns(r,["boolean","string","number","null"]))throw new Oi(`Expected first argument to be of type boolean, string, number or null, but found ${ci(wi(r))} instead.`);if(!Ns(a,["string","array"]))throw new Oi(`Expected second argument to be of type array or string, but found ${ci(wi(a))} instead.`);return a.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Xa{constructor(t,r,a){this.type=Ht,this.needle=t,this.haystack=r,this.fromIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Ie),h=r.parse(t[2],2,Ie);if(!a||!h)return null;if(!Ra(a.type,[Ae,ze,Ht,ar,Ie]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(a.type)} instead`);if(t.length===4){let p=r.parse(t[3],3,Ht);return p?new Xa(a,h,p):null}return new Xa(a,h)}evaluate(t){let r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Ns(r,["boolean","string","number","null"]))throw new Oi(`Expected first argument to be of type boolean, string, number or null, but found ${ci(wi(r))} instead.`);if(!Ns(a,["string","array"]))throw new Oi(`Expected second argument to be of type array or string, but found ${ci(wi(a))} instead.`);if(this.fromIndex){let h=this.fromIndex.evaluate(t);return a.indexOf(r,h)}return a.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ha{constructor(t,r,a,h,p,_){this.inputType=t,this.type=r,this.input=a,this.cases=h,this.outputs=p,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let a,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);let p={},_=[];for(let S=2;S<t.length-1;S+=2){let C=t[S],I=t[S+1];Array.isArray(C)||(C=[C]);let P=r.concat(S);if(C.length===0)return P.error("Expected at least one branch label.");for(let V of C){if(typeof V!="number"&&typeof V!="string")return P.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,wi(V)))return null}else a=wi(V);if(p[String(V)]!==void 0)return P.error("Branch labels must be unique.");p[String(V)]=_.length}let R=r.parse(I,S,h);if(!R)return null;h=h||R.type,_.push(R)}let g=r.parse(t[1],1,Ie);if(!g)return null;let b=r.parse(t[t.length-1],t.length-1,h);return b?g.type.kind!=="value"&&r.concat(1).checkSubtype(a,g.type)?null:new Ha(a,h,g,p,_,b):null}evaluate(t){let r=this.input.evaluate(t);return(wi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],h={};for(let _ of r){let g=h[this.cases[_]];g===void 0?(h[this.cases[_]]=a.length,a.push([this.cases[_],[_]])):a[g][1].push(_)}let p=_=>this.inputType.kind==="number"?Number(_):_;for(let[_,g]of a)t.push(g.length===1?p(g[0]):g.map(p)),t.push(this.outputs[_].serialize());return t.push(this.otherwise.serialize()),t}}class Ya{constructor(t,r,a){this.type=t,this.branches=r,this.otherwise=a}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);let h=[];for(let _=1;_<t.length-1;_+=2){let g=r.parse(t[_],_,Ae);if(!g)return null;let b=r.parse(t[_+1],_+1,a);if(!b)return null;h.push([g,b]),a=a||b.type}let p=r.parse(t[t.length-1],t.length-1,a);return p?new Ya(a,h,p):null}evaluate(t){for(let[r,a]of this.branches)if(r.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[r,a]of this.branches)t(r),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class Ka{constructor(t,r,a,h){this.type=t,this.input=r,this.beginIndex=a,this.endIndex=h}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Ie),h=r.parse(t[2],2,Ht);if(!a||!h)return null;if(!Ra(a.type,[wn(Ie),ze,Ie]))return r.error(`Expected first argument to be of type array or string, but found ${ci(a.type)} instead`);if(t.length===4){let p=r.parse(t[3],3,Ht);return p?new Ka(a.type,a,h,p):null}return new Ka(a.type,a,h)}evaluate(t){let r=this.input.evaluate(t),a=this.beginIndex.evaluate(t);if(!Ns(r,["string","array"]))throw new Oi(`Expected first argument to be of type array or string, but found ${ci(wi(r))} instead.`);if(this.endIndex){let h=this.endIndex.evaluate(t);return r.slice(a,h)}return r.slice(a)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function hu(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function uu(i,t,r,a){return a.compare(t,r)===0}function Ws(i,t,r){let a=i!=="=="&&i!=="!=";return class u1{constructor(p,_,g){this.type=Ae,this.lhs=p,this.rhs=_,this.collator=g,this.hasUntypedArgument=p.type.kind==="value"||_.type.kind==="value"}static parse(p,_){if(p.length!==3&&p.length!==4)return _.error("Expected two or three arguments.");let g=p[0],b=_.parse(p[1],1,Ie);if(!b)return null;if(!hu(g,b.type))return _.concat(1).error(`"${g}" comparisons are not supported for type '${ci(b.type)}'.`);let S=_.parse(p[2],2,Ie);if(!S)return null;if(!hu(g,S.type))return _.concat(2).error(`"${g}" comparisons are not supported for type '${ci(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return _.error(`Cannot compare types '${ci(b.type)}' and '${ci(S.type)}'.`);a&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new Gn(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new Gn(b.type,[S])));let C=null;if(p.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(C=_.parse(p[3],3,cs),!C)return null}return new u1(b,S,C)}evaluate(p){let _=this.lhs.evaluate(p),g=this.rhs.evaluate(p);if(a&&this.hasUntypedArgument){let b=wi(_),S=wi(g);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new Oi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let b=wi(_),S=wi(g);if(b.kind!=="string"||S.kind!=="string")return t(p,_,g)}return this.collator?r(p,_,g,this.collator.evaluate(p)):t(p,_,g)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){let p=[i];return this.eachChild(_=>{p.push(_.serialize())}),p}}}let kp=Ws("==",function(i,t,r){return t===r},uu),Pp=Ws("!=",function(i,t,r){return t!==r},function(i,t,r,a){return!uu(0,t,r,a)}),du=Ws("<",function(i,t,r){return t<r},function(i,t,r,a){return a.compare(t,r)<0}),zp=Ws(">",function(i,t,r){return t>r},function(i,t,r,a){return a.compare(t,r)>0}),Dp=Ws("<=",function(i,t,r){return t<=r},function(i,t,r,a){return a.compare(t,r)<=0}),Lp=Ws(">=",function(i,t,r){return t>=r},function(i,t,r,a){return a.compare(t,r)>=0});class mc{constructor(t,r,a,h,p){this.type=ze,this.number=t,this.locale=r,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");let a=r.parse(t[1],1,Ht);if(!a)return null;let h=t[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=r.parse(h.locale,1,ze),!p))return null;let _=null;if(h.currency&&(_=r.parse(h.currency,1,ze),!_))return null;let g=null;if(h["min-fraction-digits"]&&(g=r.parse(h["min-fraction-digits"],1,Ht),!g))return null;let b=null;return h["max-fraction-digits"]&&(b=r.parse(h["max-fraction-digits"],1,Ht),!b)?null:new mc(a,p,_,g,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Ja{constructor(t){this.type=Ht,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=r.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ci(a.type)} instead.`):new Ja(a):null}evaluate(t){let r=this.input.evaluate(t);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Oi(`Expected value to be of type string or array, but found ${ci(wi(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){let t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}let ds={"==":kp,"!=":Pp,">":zp,"<":du,">=":Lp,"<=":Dp,array:Gn,at:fc,boolean:Gn,case:Ya,coalesce:Uo,collator:Oa,format:Gs,image:$s,in:Wa,"index-of":Xa,interpolate:hn,"interpolate-hcl":hn,"interpolate-lab":hn,length:Ja,let:No,literal:cr,match:Ha,number:Gn,"number-format":mc,object:Gn,slice:Ka,step:Oo,string:Gn,"to-boolean":$n,"to-color":$n,"to-number":$n,"to-string":$n,var:us,within:hs};function _c(i,[t,r,a,h]){t=t.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);let p=h?h.evaluate(i):1,_=jn(t,r,a,p);if(_)throw new Oi(_);return new Fe(t/255*p,r/255*p,a/255*p,p)}function pu(i,t){return i in t}function gc(i,t){let r=t[i];return r===void 0?null:r}function kr(i){return{type:i}}function yc(i){return{result:"success",value:i}}function ps(i){return{result:"error",value:i}}function Xs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function fu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function xc(i){return!!i.expression&&i.expression.interpolated}function We(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function fs(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function mu(i){return i}function vc(i,t){let r=t.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",h=a||!(a||i.property!==void 0),p=i.type||(xc(t)?"exponential":"interval");if(r&&((i=Ve({},i)).stops&&(i.stops=i.stops.map(S=>[S[0],Fe.parse(S[1])])),i.default=Fe.parse(i.default?i.default:t.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!pc[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,g,b;if(p==="exponential")_=bc;else if(p==="interval")_=Bp;else if(p==="categorical"){_=Rp,g=Object.create(null);for(let S of i.stops)g[S[0]]=S[1];b=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);_=_u}if(a){let S={},C=[];for(let R=0;R<i.stops.length;R++){let V=i.stops[R],N=V[0].zoom;S[N]===void 0&&(S[N]={zoom:N,type:i.type,property:i.property,default:i.default,stops:[]},C.push(N)),S[N].stops.push([V[0].value,V[1]])}let I=[];for(let R of C)I.push([S[R].zoom,vc(S[R],t)]);let P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:hn.interpolationFactor.bind(void 0,P),zoomStops:I.map(R=>R[0]),evaluate:({zoom:R},V)=>bc({stops:I,base:i.base},t,R).evaluate(R,V)}}if(h){let S=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:hn.interpolationFactor.bind(void 0,S),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>_(i,t,C,g,b)}}return{kind:"source",evaluate(S,C){let I=C&&C.properties?C.properties[i.property]:void 0;return I===void 0?jo(i.default,t.default):_(i,t,I,g,b)}}}function jo(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function Rp(i,t,r,a,h){return jo(typeof r===h?a[r]:void 0,i.default,t.default)}function Bp(i,t,r){if(We(r)!=="number")return jo(i.default,t.default);let a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];let h=Fo(i.stops.map(p=>p[0]),r);return i.stops[h][1]}function bc(i,t,r){let a=i.base!==void 0?i.base:1;if(We(r)!=="number")return jo(i.default,t.default);let h=i.stops.length;if(h===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[h-1][0])return i.stops[h-1][1];let p=Fo(i.stops.map(C=>C[0]),r),_=function(C,I,P,R){let V=R-P,N=C-P;return V===0?0:I===1?N/V:(Math.pow(I,N)-1)/(Math.pow(I,V)-1)}(r,a,i.stops[p][0],i.stops[p+1][0]),g=i.stops[p][1],b=i.stops[p+1][1],S=ja[t.type]||mu;if(i.colorSpace&&i.colorSpace!=="rgb"){let C=pc[i.colorSpace];S=(I,P)=>C.reverse(C.interpolate(C.forward(I),C.forward(P),_))}return typeof g.evaluate=="function"?{evaluate(...C){let I=g.evaluate.apply(void 0,C),P=b.evaluate.apply(void 0,C);if(I!==void 0&&P!==void 0)return S(I,P,_)}}:S(g,b,_)}function _u(i,t,r){return t.type==="color"?r=Fe.parse(r):t.type==="formatted"?r=Ai.fromString(r.toString()):t.type==="resolvedImage"?r=ln.fromString(r.toString()):We(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),jo(r,i.default,t.default)}cn.register(ds,{error:[{kind:"error"},[ze],(i,[t])=>{throw new Oi(t.evaluate(i))}],typeof:[ze,[Ie],(i,[t])=>ci(wi(t.evaluate(i)))],"to-rgba":[wn(Ht,4),[Qn],(i,[t])=>t.evaluate(i).toArray()],rgb:[Qn,[Ht,Ht,Ht],_c],rgba:[Qn,[Ht,Ht,Ht,Ht],_c],has:{type:Ae,overloads:[[[ze],(i,[t])=>pu(t.evaluate(i),i.properties())],[[ze,ls],(i,[t,r])=>pu(t.evaluate(i),r.evaluate(i))]]},get:{type:Ie,overloads:[[[ze],(i,[t])=>gc(t.evaluate(i),i.properties())],[[ze,ls],(i,[t,r])=>gc(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Ie,[ze],(i,[t])=>gc(t.evaluate(i),i.featureState||{})],properties:[ls,[],i=>i.properties()],"geometry-type":[ze,[],i=>i.geometryType()],id:[Ie,[],i=>i.id()],zoom:[Ht,[],i=>i.globals.zoom],pitch:[Ht,[],i=>i.globals.pitch||0],"distance-from-center":[Ht,[],i=>i.distanceFromCenter()],"heatmap-density":[Ht,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ht,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Ht,[],i=>i.globals.skyRadialProgress||0],accumulated:[Ie,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ht,kr(Ht),(i,t)=>{let r=0;for(let a of t)r+=a.evaluate(i);return r}],"*":[Ht,kr(Ht),(i,t)=>{let r=1;for(let a of t)r*=a.evaluate(i);return r}],"-":{type:Ht,overloads:[[[Ht,Ht],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[Ht],(i,[t])=>-t.evaluate(i)]]},"/":[Ht,[Ht,Ht],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[Ht,[Ht,Ht],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[Ht,[Ht],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Ht,[Ht],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Ht,[Ht],(i,[t])=>Math.log(t.evaluate(i))],log2:[Ht,[Ht],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Ht,[Ht],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Ht,[Ht],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Ht,[Ht],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Ht,[Ht],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Ht,[Ht],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Ht,[Ht],(i,[t])=>Math.atan(t.evaluate(i))],min:[Ht,kr(Ht),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[Ht,kr(Ht),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[Ht,[Ht],(i,[t])=>Math.abs(t.evaluate(i))],round:[Ht,[Ht],(i,[t])=>{let r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ht,[Ht],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Ht,[Ht],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ae,[ze,Ie],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Ae,[Ie],(i,[t])=>i.id()===t.value],"filter-type-==":[Ae,[ze],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ae,[ze,Ie],(i,[t,r])=>{let a=i.properties()[t.value],h=r.value;return typeof a==typeof h&&a<h}],"filter-id-<":[Ae,[Ie],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r<a}],"filter->":[Ae,[ze,Ie],(i,[t,r])=>{let a=i.properties()[t.value],h=r.value;return typeof a==typeof h&&a>h}],"filter-id->":[Ae,[Ie],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r>a}],"filter-<=":[Ae,[ze,Ie],(i,[t,r])=>{let a=i.properties()[t.value],h=r.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[Ae,[Ie],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r<=a}],"filter->=":[Ae,[ze,Ie],(i,[t,r])=>{let a=i.properties()[t.value],h=r.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[Ae,[Ie],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r>=a}],"filter-has":[Ae,[Ie],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ae,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ae,[wn(ze)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ae,[wn(Ie)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ae,[ze,wn(Ie)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ae,[ze,wn(Ie)],(i,[t,r])=>function(a,h,p,_){for(;p<=_;){let g=p+_>>1;if(h[g]===a)return!0;h[g]>a?_=g-1:p=g+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ae,overloads:[[[Ae,Ae],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[kr(Ae),(i,t)=>{for(let r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ae,overloads:[[[Ae,Ae],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[kr(Ae),(i,t)=>{for(let r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Ae,[Ae],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ae,[ze],(i,[t])=>{let r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[ze,[ze],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[ze,[ze],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[ze,kr(Ie),(i,t)=>t.map(r=>lr(r.evaluate(i))).join("")],"resolved-locale":[ze,[cs],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Qa{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new Qh,this._defaultValue=r?function(a){return a.type==="color"&&fs(a.default)?new Fe(0,0,0,0):a.type==="color"?Fe.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,a,h,p,_,g,b){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,a,h,p,_,g,b){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null;try{let S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Oi(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function Hs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ds}function Go(i,t){let r=new Cr(ds,[],t?function(h){let p={color:Qn,string:ze,number:Ht,enum:ze,boolean:Ae,formatted:Us,resolvedImage:Hi};return h.type==="array"?wn(p[h.value]||Ie,h.length):p[h.type]}(t):void 0),a=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?yc(new Qa(a,t)):ps(r.errors)}class wc{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Ro(r.expression)}evaluateWithoutErrorHandling(t,r,a,h,p,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,h,p,_)}evaluate(t,r,a,h,p,_){return this._styleExpression.evaluate(t,r,a,h,p,_)}}class Tc{constructor(t,r,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Ro(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,r,a,h,p,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,h,p,_)}evaluate(t,r,a,h,p,_){return this._styleExpression.evaluate(t,r,a,h,p,_)}interpolationFactor(t,r,a){return this.interpolationType?hn.interpolationFactor(this.interpolationType,t,r,a):0}}function gu(i,t){if((i=Go(i,t)).result==="error")return i;let r=i.value.expression,a=Qi(r);if(!a&&!Xs(t))return ps([new Ze("","data expressions not supported")]);let h=Bo(r,["zoom","pitch","distance-from-center"]);if(!h&&!fu(t))return ps([new Ze("","zoom expressions not supported")]);let p=el(r);return p||h?p instanceof Ze?ps([p]):p instanceof hn&&!xc(t)?ps([new Ze("",'"interpolate" expressions cannot be used with this property')]):yc(p?new Tc(a?"camera":"composite",i.value,p.labels,p instanceof hn?p.interpolation:void 0):new wc(a?"constant":"source",i.value)):ps([new Ze("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class tl{constructor(t,r){this._parameters=t,this._specification=r,Ve(this,vc(this._parameters,this._specification))}static deserialize(t){return new tl(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function el(i){let t=null;if(i instanceof No)t=el(i.result);else if(i instanceof Uo){for(let r of i.args)if(t=el(r),t)break}else(i instanceof Oo||i instanceof hn)&&i.input instanceof cn&&i.input.name==="zoom"&&(t=i);return t instanceof Ze||i.eachChild(r=>{let a=el(r);a instanceof Ze?t=a:!t&&a?t=new Ze("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Ze("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class Jt{constructor(t,r,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function Tn(i){let t=i.key,r=i.value,a=i.valueSpec||{},h=i.objectElementValidators||{},p=i.style,_=i.styleSpec,g=[],b=We(r);if(b!=="object")return[new Jt(t,r,`object expected, ${b} found`)];for(let S in r){let C=S.split(".")[0],I=a[C]||a["*"],P;h[C]?P=h[C]:a[C]?P=Pi:h["*"]?P=h["*"]:a["*"]&&(P=Pi),P?g=g.concat(P({key:(t&&`${t}.`)+S,value:r[S],valueSpec:I,style:p,styleSpec:_,object:r,objectKey:S},r)):g.push(new Jt(t,r[S],`unknown property "${S}"`))}for(let S in a)h[S]||a[S].required&&a[S].default===void 0&&r[S]===void 0&&g.push(new Jt(t,r,`missing required property "${S}"`));return g}function $o(i){let t=i.value,r=i.valueSpec,a=i.style,h=i.styleSpec,p=i.key,_=i.arrayElementValidator||Pi;if(We(t)!=="array")return[new Jt(p,t,`array expected, ${We(t)} found`)];if(r.length&&t.length!==r.length)return[new Jt(p,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Jt(p,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let g={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};h.$version<7&&(g.function=r.function),We(r.value)==="object"&&(g=r.value);let b=[];for(let S=0;S<t.length;S++)b=b.concat(_({array:t,arrayIndex:S,value:t[S],valueSpec:g,style:a,styleSpec:h,key:`${p}[${S}]`}));return b}function yu(i){let t=i.key,r=i.value,a=i.valueSpec,h=We(r);if(h==="number"&&r!=r&&(h="NaN"),h!=="number")return[new Jt(t,r,`number expected, ${h} found`)];if("minimum"in a){let p=a.minimum;if(We(a.minimum)==="array"&&(p=a.minimum[i.arrayIndex]),r<p)return[new Jt(t,r,`${r} is less than the minimum value ${p}`)]}if("maximum"in a){let p=a.maximum;if(We(a.maximum)==="array"&&(p=a.maximum[i.arrayIndex]),r>p)return[new Jt(t,r,`${r} is greater than the maximum value ${p}`)]}return[]}function xu(i){let t=i.valueSpec,r=se(i.value.type),a,h,p,_={},g=r!=="categorical"&&i.value.property===void 0,b=!g,S=We(i.value.stops)==="array"&&We(i.value.stops[0])==="array"&&We(i.value.stops[0][0])==="object",C=Tn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(R){if(r==="identity")return[new Jt(R.key,R.value,'identity function may not have a "stops" property')];let V=[],N=R.value;return V=V.concat($o({key:R.key,value:N,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:I})),We(N)==="array"&&N.length===0&&V.push(new Jt(R.key,N,"array must have at least one stop")),V},default:function(R){return Pi({key:R.key,value:R.value,valueSpec:t,style:R.style,styleSpec:R.styleSpec})}}});return r==="identity"&&g&&C.push(new Jt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||C.push(new Jt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!xc(i.valueSpec)&&C.push(new Jt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!Xs(i.valueSpec)?C.push(new Jt(i.key,i.value,"property functions not supported")):g&&!fu(i.valueSpec)&&C.push(new Jt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!S||i.value.property!==void 0||C.push(new Jt(i.key,i.value,'"property" property is required')),C;function I(R){let V=[],N=R.value,q=R.key;if(We(N)!=="array")return[new Jt(q,N,`array expected, ${We(N)} found`)];if(N.length!==2)return[new Jt(q,N,`array length 2 expected, length ${N.length} found`)];if(S){if(We(N[0])!=="object")return[new Jt(q,N,`object expected, ${We(N[0])} found`)];if(N[0].zoom===void 0)return[new Jt(q,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new Jt(q,N,"object stop key must have value")];let K=se(N[0].zoom);if(typeof K!="number")return[new Jt(q,N[0].zoom,"stop zoom values must be numbers")];if(p&&p>K)return[new Jt(q,N[0].zoom,"stop zoom values must appear in ascending order")];K!==p&&(p=K,h=void 0,_={}),V=V.concat(Tn({key:`${q}[0]`,value:N[0],valueSpec:{zoom:{}},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:yu,value:P}}))}else V=V.concat(P({key:`${q}[0]`,value:N[0],valueSpec:{},style:R.style,styleSpec:R.styleSpec},N));return Hs(Be(N[1]))?V.concat([new Jt(`${q}[1]`,N[1],"expressions are not allowed in function stops.")]):V.concat(Pi({key:`${q}[1]`,value:N[1],valueSpec:t,style:R.style,styleSpec:R.styleSpec}))}function P(R,V){let N=We(R.value),q=se(R.value),K=R.value!==null?R.value:V;if(a){if(N!==a)return[new Jt(R.key,K,`${N} stop domain type must match previous stop domain type ${a}`)]}else a=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new Jt(R.key,K,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&r!=="categorical"){let lt=`number expected, ${N} found`;return Xs(t)&&r===void 0&&(lt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Jt(R.key,K,lt)]}return r!=="categorical"||N!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?r!=="categorical"&&N==="number"&&typeof q=="number"&&typeof h=="number"&&h!==void 0&&q<h?[new Jt(R.key,K,"stop domain values must appear in ascending order")]:(h=q,r==="categorical"&&q in _?[new Jt(R.key,K,"stop domain values must be unique")]:(_[q]=!0,[])):[new Jt(R.key,K,`integer expected, found ${String(q)}`)]}}function Ys(i){let t=(i.expressionContext==="property"?gu:Go)(Be(i.value),i.valueSpec);if(t.result==="error")return t.value.map(a=>new Jt(`${i.key}${a.key}`,i.value,a.message));let r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Jt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ro(r))return[new Jt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return hr(r,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Bo(r,["zoom","feature-state"]))return[new Jt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Qi(r))return[new Jt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hr(i,t){let r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let h of t.valueSpec.expression.parameters)r.delete(h);if(r.size===0)return[];let a=[];return i instanceof cn&&r.has(i.name)?[new Jt(t.key,t.value,`["${i.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(i.eachChild(h=>{a.push(...hr(h,t))}),a)}function qo(i){let t=i.key,r=i.value,a=i.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(se(r))===-1&&h.push(new Jt(t,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(se(r))===-1&&h.push(new Jt(t,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function Pr(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let t of i.slice(1))if(!Pr(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function zr(i,t="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Pr(i)||(i=Wo(i));let r=i,a=!0;try{a=function(S){if(!Dr(S))return S;let C=Be(S);return vu(C),C=Sc(C),C}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}let h=Et[`filter_${t}`],p=Go(a,h),_=null;if(p.result==="error")throw new Error(p.value.map(S=>`${S.key}: ${S.message}`).join(", "));_=(S,C,I)=>p.value.evaluate(S,C,{},I);let g=null,b=null;if(a!==r){let S=Go(r,h);if(S.result==="error")throw new Error(S.value.map(C=>`${C.key}: ${C.message}`).join(", "));g=(C,I,P,R,V)=>S.value.evaluate(C,I,{},P,void 0,void 0,R,V),b=!Qi(S.value.expression)}return _=_,{filter:_,dynamicFilter:g||void 0,needGeometry:il(a),needFeature:!!b}}function Sc(i){if(!Array.isArray(i))return i;let t=function(r){if(bu.has(r[0])){for(let a=1;a<r.length;a++)if(Dr(r[a]))return!0}return r}(i);return t===!0?t:t.map(r=>Sc(r))}function vu(i){let t=!1,r=[];if(i[0]==="case"){for(let a=1;a<i.length-1;a+=2)t=t||Dr(i[a]),r.push(i[a+1]);r.push(i[i.length-1])}else if(i[0]==="match"){t=t||Dr(i[1]);for(let a=2;a<i.length-1;a+=2)r.push(i[a+1]);r.push(i[i.length-1])}else if(i[0]==="step"){t=t||Dr(i[1]);for(let a=1;a<i.length-1;a+=2)r.push(i[a+1])}t&&(i.length=0,i.push("any",...r));for(let a=1;a<i.length;a++)vu(i[a])}function Dr(i){if(!Array.isArray(i))return!1;if((t=i[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let r=1;r<i.length;r++)if(Dr(i[r]))return!0;return!1}let bu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ec(i,t){return i<t?-1:i>t?1:0}function il(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(il(i[t]))return!0;return!1}function Wo(i){if(!i)return!0;let t=i[0];return i.length<=1?t!=="any":t==="=="?Xo(i[1],i[2],"=="):t==="!="?Ho(Xo(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Xo(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(Wo))):t==="all"?["all"].concat(i.slice(1).map(Wo)):t==="none"?["all"].concat(i.slice(1).map(Wo).map(Ho)):t==="in"?Mc(i[1],i.slice(2)):t==="!in"?Ho(Mc(i[1],i.slice(2))):t==="has"?Ac(i[1]):t==="!has"?Ho(Ac(i[1])):t!=="within"||i;var r}function Xo(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function Mc(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Ec)]]:["filter-in-small",i,["literal",t]]}}function Ac(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ho(i){return["!",i]}function Lr(i){return Pr(Be(i.value))?Ys(Ve({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Cc(i)}function Cc(i){let t=i.value,r=i.key;if(We(t)!=="array")return[new Jt(r,t,`array expected, ${We(t)} found`)];let a=i.styleSpec,h,p=[];if(t.length<1)return[new Jt(r,t,"filter array must have at least 1 element")];switch(p=p.concat(qo({key:`${r}[0]`,value:t[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),se(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&se(t[1])==="$type"&&p.push(new Jt(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new Jt(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=We(t[1]),h!=="string"&&p.push(new Jt(`${r}[1]`,t[1],`string expected, ${h} found`)));for(let _=2;_<t.length;_++)h=We(t[_]),se(t[1])==="$type"?p=p.concat(qo({key:`${r}[${_}]`,value:t[_],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new Jt(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)p=p.concat(Cc({key:`${r}[${_}]`,value:t[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=We(t[1]),t.length!==2?p.push(new Jt(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new Jt(`${r}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=We(t[1]),t.length!==2?p.push(new Jt(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="object"&&p.push(new Jt(`${r}[1]`,t[1],`object expected, ${h} found`))}return p}function Ic(i,t){let r=i.key,a=i.style,h=i.styleSpec,p=i.value,_=i.objectKey,g=h[`${t}_${i.layerType}`];if(!g)return[];let b=_.match(/^(.*)-transition$/);if(t==="paint"&&b&&g[b[1]]&&g[b[1]].transition)return Pi({key:r,value:p,valueSpec:h.transition,style:a,styleSpec:h});let S=i.valueSpec||g[_];if(!S)return[new Jt(r,p,`unknown property "${_}"`)];let C;if(We(p)==="string"&&Xs(S)&&!S.tokens&&(C=/^{([^}]+)}$/.exec(p)))return[new Jt(r,p,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];let I=[];return i.layerType==="symbol"&&(_==="text-field"&&a&&!a.glyphs&&I.push(new Jt(r,p,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&fs(Be(p))&&se(p.type)==="identity"&&I.push(new Jt(r,p,'"text-font" does not support identity functions'))),I.concat(Pi({key:i.key,value:p,valueSpec:S,style:a,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:_}))}function nl(i){return Ic(i,"paint")}function kc(i){return Ic(i,"layout")}function wu(i){let t=[],r=i.value,a=i.key,h=i.style,p=i.styleSpec;r.type||r.ref||t.push(new Jt(a,r,'either "type" or "ref" is required'));let _=se(r.type),g=se(r.ref);if(r.id){let b=se(r.id);for(let S=0;S<i.arrayIndex;S++){let C=h.layers[S];se(C.id)===b&&t.push(new Jt(a,r.id,`duplicate layer id "${r.id}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(S=>{S in r&&t.push(new Jt(a,r[S],`"${S}" is prohibited for ref layers`))}),h.layers.forEach(S=>{se(S.id)===g&&(b=S)}),b?b.ref?t.push(new Jt(a,r.ref,"ref cannot reference another ref layer")):_=se(b.type):typeof g=="string"&&t.push(new Jt(a,r.ref,`ref layer "${g}" not found`))}else if(_!=="background"&&_!=="sky")if(r.source){let b=h.sources&&h.sources[r.source],S=b&&se(b.type);b?S==="vector"&&_==="raster"?t.push(new Jt(a,r.source,`layer "${r.id}" requires a raster source`)):S==="raster"&&_!=="raster"?t.push(new Jt(a,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&_!=="hillshade"?t.push(new Jt(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||S==="geojson"&&b.lineMetrics||t.push(new Jt(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Jt(a,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Jt(a,r.source,`source "${r.source}" not found`))}else t.push(new Jt(a,r,'missing required property "source"'));return t=t.concat(Tn({key:a,value:r,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pi({key:`${a}.type`,value:r.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:b=>Lr(Ve({layerType:_},b)),layout:b=>Tn({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":S=>kc(Ve({layerType:_},S))}}),paint:b=>Tn({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":S=>nl(Ve({layerType:_},S))}})}})),t}function ur(i){let t=i.value,r=i.key,a=We(t);return a!=="string"?[new Jt(r,t,`string expected, ${a} found`)]:[]}let Tu={promoteId:function({key:i,value:t}){if(We(t)==="string")return ur({key:i,value:t});{let r=[];for(let a in t)r.push(...ur({key:`${i}.${a}`,value:t[a]}));return r}}};function Su(i){let t=i.value,r=i.key,a=i.styleSpec,h=i.style;if(!t.type)return[new Jt(r,t,'"type" is required')];let p=se(t.type),_;switch(p){case"vector":case"raster":case"raster-dem":return _=Tn({key:r,value:t,valueSpec:a[`source_${p.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Tu}),_;case"geojson":if(_=Tn({key:r,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,objectElementValidators:Tu}),t.cluster)for(let g in t.clusterProperties){let[b,S]=t.clusterProperties[g],C=typeof b=="string"?[b,["accumulated"],["get",g]]:b;_.push(...Ys({key:`${r}.${g}.map`,value:S,expressionContext:"cluster-map"})),_.push(...Ys({key:`${r}.${g}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return _;case"video":return Tn({key:r,value:t,valueSpec:a.source_video,style:h,styleSpec:a});case"image":return Tn({key:r,value:t,valueSpec:a.source_image,style:h,styleSpec:a});case"canvas":return[new Jt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qo({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:a})}}function Eu(i){let t=i.value,r=i.styleSpec,a=r.light,h=i.style,p=[],_=We(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new Jt("light",t,`object expected, ${_} found`)]),p;for(let g in t){let b=g.match(/^(.*)-transition$/);p=p.concat(b&&a[b[1]]&&a[b[1]].transition?Pi({key:g,value:t[g],valueSpec:r.transition,style:h,styleSpec:r}):a[g]?Pi({key:g,value:t[g],valueSpec:a[g],style:h,styleSpec:r}):[new Jt(g,t[g],`unknown property "${g}"`)])}return p}function Mu(i){let t=i.value,r=i.key,a=i.style,h=i.styleSpec,p=h.terrain,_=[],g=We(t);if(t===void 0)return _;if(g!=="object")return _=_.concat([new Jt("terrain",t,`object expected, ${g} found`)]),_;for(let b in t){let S=b.match(/^(.*)-transition$/);_=_.concat(S&&p[S[1]]&&p[S[1]].transition?Pi({key:b,value:t[b],valueSpec:h.transition,style:a,styleSpec:h}):p[b]?Pi({key:b,value:t[b],valueSpec:p[b],style:a,styleSpec:h}):[new Jt(b,t[b],`unknown property "${b}"`)])}if(t.source){let b=a.sources&&a.sources[t.source],S=b&&se(b.type);b?S!=="raster-dem"&&_.push(new Jt(r,t.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):_.push(new Jt(r,t.source,`source "${t.source}" not found`))}else _.push(new Jt(r,t,'terrain is missing required property "source"'));return _}function Au(i){let t=i.value,r=i.style,a=i.styleSpec,h=a.fog,p=[],_=We(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new Jt("fog",t,`object expected, ${_} found`)]),p;for(let g in t){let b=g.match(/^(.*)-transition$/);p=p.concat(b&&h[b[1]]&&h[b[1]].transition?Pi({key:g,value:t[g],valueSpec:a.transition,style:r,styleSpec:a}):h[g]?Pi({key:g,value:t[g],valueSpec:h[g],style:r,styleSpec:a}):[new Jt(g,t[g],`unknown property "${g}"`)])}return p}let Yo={"*":()=>[],array:$o,boolean:function(i){let t=i.value,r=i.key,a=We(t);return a!=="boolean"?[new Jt(r,t,`boolean expected, ${a} found`)]:[]},number:yu,color:function(i){let t=i.key,r=i.value,a=We(r);return a!=="string"?[new Jt(t,r,`color expected, ${a} found`)]:nc.parseCSSColor(r)===null?[new Jt(t,r,`color expected, "${r}" found`)]:[]},enum:qo,filter:Lr,function:xu,layer:wu,object:Tn,source:Su,light:Eu,terrain:Mu,fog:Au,string:ur,formatted:function(i){return ur(i).length===0?[]:Ys(i)},resolvedImage:function(i){return ur(i).length===0?[]:Ys(i)},projection:function(i){let t=i.value,r=i.styleSpec,a=r.projection,h=i.style,p=[],_=We(t);if(_==="object")for(let g in t)p=p.concat(Pi({key:g,value:t[g],valueSpec:a[g],style:h,styleSpec:r}));else _!=="string"&&(p=p.concat([new Jt("projection",t,`object or string expected, ${_} found`)]));return p}};function Pi(i){let t=i.value,r=i.valueSpec,a=i.styleSpec;return r.expression&&fs(se(t))?xu(i):r.expression&&Hs(Be(t))?Ys(i):r.type&&Yo[r.type]?Yo[r.type](i):Tn(Ve({},i,{valueSpec:r.type?a[r.type]:r}))}function un(i){let t=i.value,r=i.key,a=ur(i);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Jt(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Jt(r,t,'"glyphs" url must include a "{range}" token'))),a}function Ko(i,t=Et){return dr(Pi({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,objectElementValidators:{glyphs:un,"*":()=>[]}}))}let Fp=i=>dr(nl(i)),Op=i=>dr(kc(i));function dr(i){return i.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function Cu(i,t){let r=!1;if(t&&t.length)for(let a of t)i.fire(new he(new Error(a.message))),r=!0;return r}var Rr=tr;function tr(i,t,r){var a=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(t=h[1])+2*(r=h[2]);for(var p=0;p<this.d*this.d;p++){var _=h[3+p],g=h[3+p+1];a.push(_===g?null:h.subarray(_,g))}var b=h[3+a.length+1];this.keys=h.subarray(h[3+a.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var S=0;S<this.d*this.d;S++)a.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=i,this.padding=r,this.scale=t/i,this.uid=0;var C=r/t*i;this.min=-C,this.max=i+C}tr.prototype.insert=function(i,t,r,a,h){this._forEachCell(t,r,a,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(h)},tr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},tr.prototype._insertCell=function(i,t,r,a,h,p){this.cells[h].push(p)},tr.prototype.query=function(i,t,r,a,h){var p=this.min,_=this.max;if(i<=p&&t<=p&&_<=r&&_<=a&&!h)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(i,t,r,a,this._queryCell,g,{},h),g},tr.prototype._queryCell=function(i,t,r,a,h,p,_,g){var b=this.cells[h];if(b!==null)for(var S=this.keys,C=this.bboxes,I=0;I<b.length;I++){var P=b[I];if(_[P]===void 0){var R=4*P;(g?g(C[R+0],C[R+1],C[R+2],C[R+3]):i<=C[R+2]&&t<=C[R+3]&&r>=C[R+0]&&a>=C[R+1])?(_[P]=!0,p.push(S[P])):_[P]=!1}}},tr.prototype._forEachCell=function(i,t,r,a,h,p,_,g){for(var b=this._convertToCellCoord(i),S=this._convertToCellCoord(t),C=this._convertToCellCoord(r),I=this._convertToCellCoord(a),P=b;P<=C;P++)for(var R=S;R<=I;R++){var V=this.d*R+P;if((!g||g(this._convertFromCellCoord(P),this._convertFromCellCoord(R),this._convertFromCellCoord(P+1),this._convertFromCellCoord(R+1)))&&h.call(this,i,t,r,a,V,p,_,g))return}},tr.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},tr.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},tr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,t=3+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var h=new Int32Array(t+r+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=t,_=0;_<i.length;_++){var g=i[_];h[3+_]=p,h.set(g,p),p+=g.length}return h[3+i.length]=p,h.set(this.keys,p),h[3+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};let Ks={};function te(i,t,r={}){Object.defineProperty(i,"_classRegistryKey",{value:t,writeable:!1}),Ks[t]={klass:i,omit:r.omit||[]}}te(Object,"Object"),Rr.serialize=function(i,t){let r=i.toArrayBuffer();return t&&t.push(r),{buffer:r}},Rr.deserialize=function(i){return new Rr(i.buffer)},Object.defineProperty(Rr,"name",{value:"Grid"}),te(Rr,"Grid"),te(Fe,"Color"),te(Error,"Error"),te(F,"AJAXError"),te(ln,"ResolvedImage"),te(tl,"StylePropertyFunction"),te(Qa,"StyleExpression",{omit:["_evaluator"]}),te(Tc,"ZoomDependentExpression"),te(wc,"ZoomConstantExpression"),te(cn,"CompoundExpression",{omit:["_evaluate"]});for(let i in ds)Ks[ds[i]._classRegistryKey]||te(ds[i],`Expression${i}`);function Iu(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function rl(i){return B.ImageBitmap&&i instanceof B.ImageBitmap}function Jo(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Iu(i)||rl(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){let r=i;return t&&t.push(r.buffer),r}if(i instanceof B.ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){let r=[];for(let a of i)r.push(Jo(a,t));return r}if(typeof i=="object"){let r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let h=r.serialize?r.serialize(i,t):{};if(!r.serialize){for(let p in i)i.hasOwnProperty(p)&&(Ks[a].omit.indexOf(p)>=0||(h[p]=Jo(i[p],t)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof i)}function Js(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Iu(i)||rl(i)||ArrayBuffer.isView(i)||i instanceof B.ImageData)return i;if(Array.isArray(i))return i.map(Js);if(typeof i=="object"){let t=i.$name||"Object",{klass:r}=Ks[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);let a=Object.create(r.prototype);for(let h of Object.keys(i))h!=="$name"&&(a[h]=Js(i[h]));return a}throw new Error("can't deserialize object of type "+typeof i)}class Pc{constructor(){this.first=!0}update(t,r){let a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}let ku=i=>i>=1536&&i<=1791,sl=i=>i>=1872&&i<=1919,Qo=i=>i>=2208&&i<=2303,zc=i=>i>=11904&&i<=12031,Pu=i=>i>=12032&&i<=12255,Dc=i=>i>=12272&&i<=12287,ol=i=>i>=12288&&i<=12351,ta=i=>i>=12352&&i<=12447,al=i=>i>=12448&&i<=12543,zu=i=>i>=12544&&i<=12591,Du=i=>i>=12704&&i<=12735,Lu=i=>i>=12736&&i<=12783,Lc=i=>i>=12784&&i<=12799,Ru=i=>i>=12800&&i<=13055,Bu=i=>i>=13056&&i<=13311,Fu=i=>i>=13312&&i<=19903,Rc=i=>i>=19968&&i<=40959,Ou=i=>i>=40960&&i<=42127,Vu=i=>i>=42128&&i<=42191,Zu=i=>i>=44032&&i<=55215,ea=i=>i>=63744&&i<=64255,Bc=i=>i>=64336&&i<=65023,Uu=i=>i>=65040&&i<=65055,Qs=i=>i>=65072&&i<=65103,Nu=i=>i>=65104&&i<=65135,ll=i=>i>=65136&&i<=65279,Fc=i=>i>=65280&&i<=65519;function cl(i){for(let t of i)if(hl(t.charCodeAt(0)))return!0;return!1}function ju(i){for(let t of i)if(!Gu(t.charCodeAt(0)))return!1;return!0}function Gu(i){return!(ku(i)||sl(i)||Qo(i)||Bc(i)||ll(i))}function hl(i){return!(i!==746&&i!==747&&(i<4352||!(Du(i)||zu(i)||Qs(i)&&!(i>=65097&&i<=65103)||ea(i)||Bu(i)||zc(i)||Lu(i)||!(!ol(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Fu(i)||Rc(i)||Ru(i)||(t=>t>=12592&&t<=12687)(i)||(t=>t>=43360&&t<=43391)(i)||(t=>t>=55216&&t<=55295)(i)||(t=>t>=4352&&t<=4607)(i)||Zu(i)||ta(i)||Dc(i)||(t=>t>=12688&&t<=12703)(i)||Pu(i)||Lc(i)||al(i)&&i!==12540||!(!Fc(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Nu(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(t=>t>=5120&&t<=5759)(i)||(t=>t>=6320&&t<=6399)(i)||Uu(i)||(t=>t>=19904&&t<=19967)(i)||Ou(i)||Vu(i))))}function ul(i){return!(hl(i)||function(t){return!!((r=>r>=128&&r<=255)(t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||(r=>r>=8192&&r<=8303)(t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||(r=>r>=8448&&r<=8527)(t)||(r=>r>=8528&&r<=8591)(t)||(r=>r>=8960&&r<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||(r=>r>=9216&&r<=9279)(t)&&t!==9251||(r=>r>=9280&&r<=9311)(t)||(r=>r>=9312&&r<=9471)(t)||(r=>r>=9632&&r<=9727)(t)||(r=>r>=9728&&r<=9983)(t)&&!(t>=9754&&t<=9759)||(r=>r>=11008&&r<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ol(t)||al(t)||(r=>r>=57344&&r<=63743)(t)||Qs(t)||Nu(t)||Fc(t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function dl(i){return i>=1424&&i<=2303||Bc(i)||ll(i)}function Vp(i,t){return!(!t&&dl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(r=>r>=6016&&r<=6143)(i))}function Zp(i){for(let t of i)if(dl(t.charCodeAt(0)))return!0;return!1}let Oc="deferred",ia="loading",Vc="loaded",Zc=null,tn="unavailable",dn=null,na=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(tn="error"),Zc&&Zc(i)};function ms(){Uc.fire(new ce("pluginStateChange",{pluginStatus:tn,pluginURL:dn}))}let Uc=new _e,pl=function(){return tn},to=function(){if(tn!==Oc||!dn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");tn=ia,ms(),dn&&ot({url:dn},i=>{i?na(i):(tn=Vc,ms())})},Sn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>tn===Vc||Sn.applyArabicShaping!=null,isLoading:()=>tn===ia,setState(i){tn=i.pluginStatus,dn=i.pluginURL},isParsed:()=>Sn.applyArabicShaping!=null&&Sn.processBidirectionalText!=null&&Sn.processStyledBidirectionalText!=null,getPluginURL:()=>dn};class ii{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Pc,this.transition={},this.pitch=0)}isSupportedScript(t){return function(r,a){for(let h of r)if(!Vp(h.charCodeAt(0),a))return!1;return!0}(t,Sn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,r=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class ra{constructor(t,r){this.property=t,this.value=r,this.expression=function(a,h){if(fs(a))return new tl(a,h);if(Hs(a)){let p=gu(a,h);if(p.result==="error")throw new Error(p.value.map(_=>`${_.key}: ${_.message}`).join(", "));return p.value}{let p=a;return typeof a=="string"&&h.type==="color"&&(p=Fe.parse(a)),{kind:"constant",evaluate:()=>p}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,a){return this.property.possiblyEvaluate(this,t,r,a)}}class eo{constructor(t){this.property=t,this.value=new ra(t,void 0)}transitioned(t,r){return new e(this.property,this.value,r,jt({},t.transition,this.transition),t.now)}untransitioned(){return new e(this.property,this.value,null,{},0)}}class d{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return di(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new eo(this._values[t].property)),this._values[t].value=new ra(this._values[t].property,r===null?void 0:di(r))}getTransition(t){return di(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new eo(this._values[t].property)),this._values[t].transition=di(r)||void 0}serialize(){let t={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(t[r]=a);let h=this.getTransition(r);h!==void 0&&(t[`${r}-transition`]=h)}return t}transitioned(t,r){let a=new c(this._properties);for(let h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,r._values[h]);return a}untransitioned(){let t=new c(this._properties);for(let r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class e{constructor(t,r,a,h,p){let _=h.delay||0,g=h.duration||0;p=p||0,this.property=t,this.value=r,this.begin=p+_,this.end=this.begin+g,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,r,a){let h=t.now||0,p=this.value.possiblyEvaluate(t,r,a),_=this.prior;if(_){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return _.possiblyEvaluate(t,r,a);{let g=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,a),p,et(g))}}return p}}class c{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,a){let h=new v(this._properties);for(let p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,r,a);return h}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class m{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return di(this._values[t].value)}setValue(t,r){this._values[t]=new ra(this._values[t].property,r===null?void 0:di(r))}serialize(){let t={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(t[r]=a)}return t}possiblyEvaluate(t,r,a){let h=new v(this._properties);for(let p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,r,a);return h}}class y{constructor(t,r,a){this.property=t,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,a,h){return this.property.evaluate(this.value,this.parameters,t,r,a,h)}}class v{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class T{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,a){let h=ja[this.specification.type];return h?h(t,r,a):t}}class M{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,a,h){return new y(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},a,h)}:t.expression,r)}interpolate(t,r,a){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new y(this,{kind:"constant",value:void 0},t.parameters);let h=ja[this.specification.type];return h?new y(this,{kind:"constant",value:h(t.value.value,r.value.value,a)},t.parameters):t}evaluate(t,r,a,h,p,_){return t.kind==="constant"?t.value:t.evaluate(r,a,h,p,_)}}class k extends M{possiblyEvaluate(t,r,a,h){if(t.value===void 0)return new y(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){let p=t.expression.evaluate(r,null,{},a,h),_=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,g=this._calculate(_,_,_,r);return new y(this,{kind:"constant",value:g},r)}if(t.expression.kind==="camera"){let p=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new y(this,{kind:"constant",value:p},r)}return new y(this,t.expression,r)}evaluate(t,r,a,h,p,_){if(t.kind==="source"){let g=t.evaluate(r,a,h,p,_);return this._calculate(g,g,g,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},a,h),t.evaluate({zoom:Math.floor(r.zoom)},a,h),t.evaluate({zoom:Math.floor(r.zoom)+1},a,h),r):t.value}_calculate(t,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r,other:a}:{from:a,to:r,other:t}}interpolate(t){return t}}class z{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){let p=t.expression.evaluate(r,null,{},a,h);return this._calculate(p,p,p,r)}return this._calculate(t.expression.evaluate(new ii(Math.floor(r.zoom-1),r)),t.expression.evaluate(new ii(Math.floor(r.zoom),r)),t.expression.evaluate(new ii(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class L{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,h){return!!t.expression.evaluate(r,null,{},a,h)}interpolate(){return!1}}class O{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let r in t){let a=t[r];a.specification.overridable&&this.overridableProperties.push(r);let h=this.defaultPropertyValues[r]=new ra(a,void 0),p=this.defaultTransitionablePropertyValues[r]=new eo(a);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}function j(i,t){return 256*(i=_t(Math.floor(i),0,255))+_t(Math.floor(t),0,255)}te(M,"DataDrivenProperty"),te(T,"DataConstantProperty"),te(k,"CrossFadedDataDrivenProperty"),te(z,"CrossFadedProperty"),te(L,"ColorRampProperty");let X={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ${constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class U{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function st(i,t=1){let r=0,a=0;return{members:i.map(h=>{let p=X[h.type].BYTES_PER_ELEMENT,_=r=Y(r,Math.max(t,p)),g=h.components||1;return a=Math.max(a,p),r+=p*g,{name:h.name,type:h.type,components:g,offset:_}}),size:Y(r,Math.max(a,t)),alignment:t}}function Y(i,t){return Math.ceil(i/t)*t}class it extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let h=2*t;return this.int16[h+0]=r,this.int16[h+1]=a,t}}it.prototype.bytesPerElement=4,te(it,"StructArrayLayout2i4");class nt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,r,a)}emplace(t,r,a,h){let p=3*t;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=h,t}}nt.prototype.bytesPerElement=6,te(nt,"StructArrayLayout3i6");class at extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,h)}emplace(t,r,a,h,p){let _=4*t;return this.int16[_+0]=r,this.int16[_+1]=a,this.int16[_+2]=h,this.int16[_+3]=p,t}}at.prototype.bytesPerElement=8,te(at,"StructArrayLayout4i8");class tt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,t,r,a,h,p,_,g)}emplace(t,r,a,h,p,_,g,b){let S=6*t,C=12*t,I=3*t;return this.int16[S+0]=r,this.int16[S+1]=a,this.uint8[C+4]=h,this.uint8[C+5]=p,this.uint8[C+6]=_,this.uint8[C+7]=g,this.float32[I+2]=b,t}}tt.prototype.bytesPerElement=12,te(tt,"StructArrayLayout2i4ub1f12");class ct extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,h){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,h)}emplace(t,r,a,h,p){let _=4*t;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=h,this.float32[_+3]=p,t}}ct.prototype.bytesPerElement=16,te(ct,"StructArrayLayout4f16");class bt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g,b,S,C){let I=this.length;return this.resize(I+1),this.emplace(I,t,r,a,h,p,_,g,b,S,C)}emplace(t,r,a,h,p,_,g,b,S,C,I){let P=10*t;return this.uint16[P+0]=r,this.uint16[P+1]=a,this.uint16[P+2]=h,this.uint16[P+3]=p,this.uint16[P+4]=_,this.uint16[P+5]=g,this.uint16[P+6]=b,this.uint16[P+7]=S,this.uint16[P+8]=C,this.uint16[P+9]=I,t}}bt.prototype.bytesPerElement=20,te(bt,"StructArrayLayout10ui20");class Ct extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g,b){let S=this.length;return this.resize(S+1),this.emplace(S,t,r,a,h,p,_,g,b)}emplace(t,r,a,h,p,_,g,b,S){let C=8*t;return this.uint16[C+0]=r,this.uint16[C+1]=a,this.uint16[C+2]=h,this.uint16[C+3]=p,this.uint16[C+4]=_,this.uint16[C+5]=g,this.uint16[C+6]=b,this.uint16[C+7]=S,t}}Ct.prototype.bytesPerElement=16,te(Ct,"StructArrayLayout8ui16");class zt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_){let g=this.length;return this.resize(g+1),this.emplace(g,t,r,a,h,p,_)}emplace(t,r,a,h,p,_,g){let b=6*t;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=p,this.int16[b+4]=_,this.int16[b+5]=g,t}}zt.prototype.bytesPerElement=12,te(zt,"StructArrayLayout6i12");class kt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q){let K=this.length;return this.resize(K+1),this.emplace(K,t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q)}emplace(t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q,K){let lt=16*t;return this.int16[lt+0]=r,this.int16[lt+1]=a,this.int16[lt+2]=h,this.int16[lt+3]=p,this.uint16[lt+4]=_,this.uint16[lt+5]=g,this.uint16[lt+6]=b,this.uint16[lt+7]=S,this.int16[lt+8]=C,this.int16[lt+9]=I,this.int16[lt+10]=P,this.int16[lt+11]=R,this.int16[lt+12]=V,this.int16[lt+13]=N,this.int16[lt+14]=q,this.int16[lt+15]=K,t}}kt.prototype.bytesPerElement=32,te(kt,"StructArrayLayout4i4ui4i4i32");class $t extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,r,a)}emplace(t,r,a,h){let p=3*t;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=h,t}}$t.prototype.bytesPerElement=12,te($t,"StructArrayLayout3f12");class wt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}wt.prototype.bytesPerElement=4,te(wt,"StructArrayLayout1ul4");class qt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g,b,S,C,I,P,R){let V=this.length;return this.resize(V+1),this.emplace(V,t,r,a,h,p,_,g,b,S,C,I,P,R)}emplace(t,r,a,h,p,_,g,b,S,C,I,P,R,V){let N=20*t,q=10*t;return this.int16[N+0]=r,this.int16[N+1]=a,this.int16[N+2]=h,this.int16[N+3]=p,this.int16[N+4]=_,this.float32[q+3]=g,this.float32[q+4]=b,this.float32[q+5]=S,this.float32[q+6]=C,this.int16[N+14]=I,this.uint32[q+8]=P,this.uint16[N+18]=R,this.uint16[N+19]=V,t}}qt.prototype.bytesPerElement=40,te(qt,"StructArrayLayout5i4f1i1ul2ui40");class Nt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,t,r,a,h,p,_,g)}emplace(t,r,a,h,p,_,g,b){let S=8*t;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+4]=p,this.int16[S+5]=_,this.int16[S+6]=g,this.int16[S+7]=b,t}}Nt.prototype.bytesPerElement=16,te(Nt,"StructArrayLayout3i2i2i16");class re extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p){let _=this.length;return this.resize(_+1),this.emplace(_,t,r,a,h,p)}emplace(t,r,a,h,p,_){let g=4*t,b=8*t;return this.float32[g+0]=r,this.float32[g+1]=a,this.float32[g+2]=h,this.int16[b+6]=p,this.int16[b+7]=_,t}}re.prototype.bytesPerElement=16,te(re,"StructArrayLayout2f1f2i16");class Dt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,h){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,h)}emplace(t,r,a,h,p){let _=12*t,g=3*t;return this.uint8[_+0]=r,this.uint8[_+1]=a,this.float32[g+1]=h,this.float32[g+2]=p,t}}Dt.prototype.bytesPerElement=12,te(Dt,"StructArrayLayout2ub2f12");class ee extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,r,a)}emplace(t,r,a,h){let p=3*t;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=h,t}}ee.prototype.bytesPerElement=6,te(ee,"StructArrayLayout3ui6");class ue extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q,K,lt,ut,ft,gt){let yt=this.length;return this.resize(yt+1),this.emplace(yt,t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q,K,lt,ut,ft,gt)}emplace(t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q,K,lt,ut,ft,gt,yt){let It=30*t,Pt=15*t,Bt=60*t;return this.int16[It+0]=r,this.int16[It+1]=a,this.int16[It+2]=h,this.float32[Pt+2]=p,this.float32[Pt+3]=_,this.uint16[It+8]=g,this.uint16[It+9]=b,this.uint32[Pt+5]=S,this.uint32[Pt+6]=C,this.uint32[Pt+7]=I,this.uint16[It+16]=P,this.uint16[It+17]=R,this.uint16[It+18]=V,this.float32[Pt+10]=N,this.float32[Pt+11]=q,this.uint8[Bt+48]=K,this.uint8[Bt+49]=lt,this.uint8[Bt+50]=ut,this.uint32[Pt+13]=ft,this.int16[It+28]=gt,this.uint8[Bt+58]=yt,t}}ue.prototype.bytesPerElement=60,te(ue,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ie extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q,K,lt,ut,ft,gt,yt,It,Pt,Bt,Ot,At,Lt,Ut,Xt){let Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q,K,lt,ut,ft,gt,yt,It,Pt,Bt,Ot,At,Lt,Ut,Xt)}emplace(t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q,K,lt,ut,ft,gt,yt,It,Pt,Bt,Ot,At,Lt,Ut,Xt,Gt){let Wt=38*t,xe=19*t;return this.int16[Wt+0]=r,this.int16[Wt+1]=a,this.int16[Wt+2]=h,this.float32[xe+2]=p,this.float32[xe+3]=_,this.int16[Wt+8]=g,this.int16[Wt+9]=b,this.int16[Wt+10]=S,this.int16[Wt+11]=C,this.int16[Wt+12]=I,this.int16[Wt+13]=P,this.uint16[Wt+14]=R,this.uint16[Wt+15]=V,this.uint16[Wt+16]=N,this.uint16[Wt+17]=q,this.uint16[Wt+18]=K,this.uint16[Wt+19]=lt,this.uint16[Wt+20]=ut,this.uint16[Wt+21]=ft,this.uint16[Wt+22]=gt,this.uint16[Wt+23]=yt,this.uint16[Wt+24]=It,this.uint16[Wt+25]=Pt,this.uint16[Wt+26]=Bt,this.uint16[Wt+27]=Ot,this.uint16[Wt+28]=At,this.uint32[xe+15]=Lt,this.float32[xe+16]=Ut,this.float32[xe+17]=Xt,this.float32[xe+18]=Gt,t}}ie.prototype.bytesPerElement=76,te(ie,"StructArrayLayout3i2f6i15ui1ul3f76");class ne extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}ne.prototype.bytesPerElement=4,te(ne,"StructArrayLayout1f4");class fe extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,t,r,a,h,p,_,g)}emplace(t,r,a,h,p,_,g,b){let S=7*t;return this.float32[S+0]=r,this.float32[S+1]=a,this.float32[S+2]=h,this.float32[S+3]=p,this.float32[S+4]=_,this.float32[S+5]=g,this.float32[S+6]=b,t}}fe.prototype.bytesPerElement=28,te(fe,"StructArrayLayout7f28");class Se extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p){let _=this.length;return this.resize(_+1),this.emplace(_,t,r,a,h,p)}emplace(t,r,a,h,p,_){let g=5*t;return this.float32[g+0]=r,this.float32[g+1]=a,this.float32[g+2]=h,this.float32[g+3]=p,this.float32[g+4]=_,t}}Se.prototype.bytesPerElement=20,te(Se,"StructArrayLayout5f20");class ae extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,h){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,h)}emplace(t,r,a,h,p){let _=6*t;return this.uint32[3*t+0]=r,this.uint16[_+2]=a,this.uint16[_+3]=h,this.uint16[_+4]=p,t}}ae.prototype.bytesPerElement=12,te(ae,"StructArrayLayout1ul3ui12");class ge extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let h=2*t;return this.uint16[h+0]=r,this.uint16[h+1]=a,t}}ge.prototype.bytesPerElement=4,te(ge,"StructArrayLayout2ui4");class Re extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Re.prototype.bytesPerElement=2,te(Re,"StructArrayLayout1ui2");class hi extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let h=2*t;return this.float32[h+0]=r,this.float32[h+1]=a,t}}hi.prototype.bytesPerElement=8,te(hi,"StructArrayLayout2f8");class Ni extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,h,p,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,t,r,a,h,p,_,g)}emplace(t,r,a,h,p,_,g,b){let S=8*t,C=4*t;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+3]=p,this.int16[S+4]=_,this.int16[S+5]=g,this.float32[C+3]=b,t}}Ni.prototype.bytesPerElement=16,te(Ni,"StructArrayLayout6i1f16");class ji extends ${get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ji.prototype.size=12;class pn extends zt{get(t){return new ji(this,t)}}te(pn,"FillExtrusionExtArray");class qn extends ${get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}qn.prototype.size=40;class pr extends qt{get(t){return new qn(this,t)}}te(pr,"CollisionBoxArray");class Br extends ${get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Br.prototype.size=60;class fr extends ue{get(t){return new Br(this,t)}}te(fr,"PlacedSymbolArray");class pi extends ${get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}pi.prototype.size=76;class yi extends ie{get(t){return new pi(this,t)}}te(yi,"SymbolInstanceArray");class Ue extends ne{getoffsetX(t){return this.float32[1*t+0]}}te(Ue,"GlyphOffsetArray");class Ti extends nt{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}te(Ti,"SymbolLineVertexArray");class fn extends ${get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}fn.prototype.size=12;class ui extends ae{get(t){return new fn(this,t)}}te(ui,"FeatureIndexArray");class En extends ${get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}En.prototype.size=4;class sa extends ge{get(t){return new En(this,t)}}te(sa,"FillExtrusionCentroidArray");class mn extends ${get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}mn.prototype.size=16;class _s extends Ni{get(t){return new mn(this,t)}}te(_s,"CircleGlobeExtArray");let $u=st([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Nc=st([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var io=Ba(function(i){i.exports=function(t,r){var a,h,p,_,g,b,S,C;for(h=t.length-(a=3&t.length),p=r,g=3432918353,b=461845907,C=0;C<h;)S=255&t.charCodeAt(C)|(255&t.charCodeAt(++C))<<8|(255&t.charCodeAt(++C))<<16|(255&t.charCodeAt(++C))<<24,++C,p=27492+(65535&(_=5*(65535&(p=(p^=S=(65535&(S=(S=(65535&S)*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(S=0,a){case 3:S^=(255&t.charCodeAt(C+2))<<16;case 2:S^=(255&t.charCodeAt(C+1))<<8;case 1:p^=S=(65535&(S=(S=(65535&(S^=255&t.charCodeAt(C)))*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return p^=t.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),Up=Ba(function(i){i.exports=function(t,r){for(var a,h=t.length,p=r^h,_=0;h>=4;)a=1540483477*(65535&(a=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24))+((1540483477*(a>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:p^=(255&t.charCodeAt(_+2))<<16;case 2:p^=(255&t.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&t.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),Fr=io,jc=Up;Fr.murmur3=io,Fr.murmur2=jc;class qu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,a,h){this.ids.push(p_(t)),this.positions.push(r,a,h)}getPositions(t){let r=p_(t),a=0,h=this.ids.length-1;for(;a<h;){let _=a+h>>1;this.ids[_]>=r?h=_:a=_+1}let p=[];for(;this.ids[a]===r;)p.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return p}static serialize(t,r){let a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Np(a,h,0,a.length-1),r&&r.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){let r=new qu;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function p_(i){let t=+i;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Fr(String(i))}function Np(i,t,r,a){for(;r<a;){let h=i[r+a>>1],p=r-1,_=a+1;for(;;){do p++;while(i[p]<h);do _--;while(i[_]>h);if(p>=_)break;Wu(i,p,_),Wu(t,3*p,3*_),Wu(t,3*p+1,3*_+1),Wu(t,3*p+2,3*_+2)}_-r<a-_?(Np(i,t,r,_),r=_+1):(Np(i,t,_+1,a),a=_)}}function Wu(i,t,r){let a=i[t];i[t]=i[r],i[r]=a}te(qu,"FeaturePositionMap");class gs{constructor(t,r){this.gl=t.gl,this.location=r}}class Xu extends gs{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class f_ extends gs{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class m_ extends gs{constructor(t,r){super(t,r),this.current=Fe.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let B1=new Float32Array(16),F1=new Float32Array(9),O1=new Float32Array(4);function jp(i){return[j(255*i.r,255*i.g),j(255*i.b,255*i.a)]}class Gc{constructor(t,r,a){this.value=t,this.uniformNames=r.map(h=>`u_${h}`),this.type=a}setUniform(t,r,a){t.set(a.constantOr(this.value))}getBinding(t,r,a){return this.type==="color"?new m_(t,r):new Xu(t,r)}}class fl{constructor(t,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio||1,this.pixelRatioTo=t.pixelRatio||1,this.patternFrom=r.tl.concat(r.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,r,a,h){let p=h==="u_pattern_to"||h==="u_dash_to"?this.patternTo:h==="u_pattern_from"||h==="u_dash_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,r,a){return a==="u_pattern_from"||a==="u_pattern_to"||a==="u_dash_from"||a==="u_dash_to"?new f_(t,r):new Xu(t,r)}}class ys{constructor(t,r,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,r,a,h,p,_){let g=this.paintVertexArray.length,b=this.expression.evaluate(new ii(0),r,{},p,h,_);this.paintVertexArray.resize(t),this._setPaintValue(g,t,b)}updatePaintArray(t,r,a,h,p){let _=this.expression.evaluate({zoom:0},a,h,void 0,p);this._setPaintValue(t,r,_)}_setPaintValue(t,r,a){if(this.type==="color"){let h=jp(a);for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mr{constructor(t,r,a,h,p,_){this.expression=t,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,r,a,h,p,_){let g=this.expression.evaluate(new ii(this.zoom),r,{},p,h,_),b=this.expression.evaluate(new ii(this.zoom+1),r,{},p,h,_),S=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(S,t,g,b)}updatePaintArray(t,r,a,h,p){let _=this.expression.evaluate({zoom:this.zoom},a,h,void 0,p),g=this.expression.evaluate({zoom:this.zoom+1},a,h,void 0,p);this._setPaintValue(t,r,_,g)}_setPaintValue(t,r,a,h){if(this.type==="color"){let p=jp(a),_=jp(h);for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,p[0],p[1],_[0],_[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){let a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=_t(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,r,a){return new Xu(t,r)}}class no{constructor(t,r,a,h,p,_,g){this.expression=t,this.type=a,this.useIntegerZoom=h,this.zoom=p,this.layerId=g,this.paintVertexAttributes=(a==="array"?Nc:$u).members;for(let b=0;b<r.length;++b);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,r,a){let h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(t,r,a,h,p,_){this._setPaintValues(t,r,a.patterns&&a.patterns[this.layerId],_)}_setPaintValues(t,r,a,h){if(!h||!a)return;let{min:p,mid:_,max:g}=a,b=h[p],S=h[_],C=h[g];if(b&&S&&C)for(let I=t;I<r;I++)this._setPaintValue(this.zoomInPaintVertexArray,I,S,b),this._setPaintValue(this.zoomOutPaintVertexArray,I,S,C)}_setPaintValue(t,r,a,h){t.emplace(r,a.tl[0],a.tl[1],a.br[0],a.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],a.pixelRatio,h.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ro{constructor(t,r,a=()=>!0){this.binders={},this._buffers=[];let h=[];for(let p in t.paint._values){if(!a(p))continue;let _=t.paint.get(p);if(!(_ instanceof y&&Xs(_.property.specification)))continue;let g=Z1(p,t.type),b=_.value,S=_.property.specification.type,C=_.property.useIntegerZoom,I=_.property.specification["property-type"],P=I==="cross-faded"||I==="cross-faded-data-driven",R=String(p)==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||R)if(b.kind==="source"||R||P){let V=__(p,S,"source");this.binders[p]=P?new no(b,g,S,C,r,V,t.id):new ys(b,g,S,V),h.push(`/a_${p}`)}else{let V=__(p,S,"composite");this.binders[p]=new mr(b,g,S,C,r,V),h.push(`/z_${p}`)}else this.binders[p]=P?new fl(b.value,g):new Gc(b.value,g,S),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(t){let r=this.binders[t];return r instanceof ys||r instanceof mr?r.maxValue:0}populatePaintArrays(t,r,a,h,p,_){for(let g in this.binders){let b=this.binders[g];(b instanceof ys||b instanceof mr||b instanceof no)&&b.populatePaintArray(t,r,a,h,p,_)}}setConstantPatternPositions(t,r){for(let a in this.binders){let h=this.binders[a];h instanceof fl&&h.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,a,h,p,_){let g=!1;for(let b in t){let S=r.getPositions(b);for(let C of S){let I=a.feature(C.index);for(let P in this.binders){let R=this.binders[P];if((R instanceof ys||R instanceof mr||R instanceof no)&&R.expression.isStateDependent===!0){let V=h.paint.get(P);R.expression=V.value,R.updatePaintArray(C.start,C.end,I,t[b],p,_),g=!0}}}}return g}defines(){let t=[];for(let r in this.binders){let a=this.binders[r];(a instanceof Gc||a instanceof fl)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){let t=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof ys||a instanceof mr||a instanceof no)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name)}return t}getBinderUniforms(){let t=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof Gc||a instanceof fl||a instanceof mr)for(let h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){let a=[];for(let h in this.binders){let p=this.binders[h];if(p instanceof Gc||p instanceof fl||p instanceof mr){for(let _ of p.uniformNames)if(r[_]){let g=p.getBinding(t,r[_],_);a.push({name:_,property:h,binding:g})}}}return a}setUniforms(t,r,a,h){for(let{name:p,property:_,binding:g}of r)this.binders[_].setUniform(g,h,a.get(_),p)}updatePaintBuffers(t){this._buffers=[];for(let r in this.binders){let a=this.binders[r];if(t&&a instanceof no){let h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof ys||a instanceof mr)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(let r in this.binders){let a=this.binders[r];(a instanceof ys||a instanceof mr||a instanceof no)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let r=this.binders[t];(r instanceof ys||r instanceof mr||r instanceof no)&&r.destroy()}}}class oa{constructor(t,r,a=()=>!0){this.programConfigurations={};for(let h of t)this.programConfigurations[h.id]=new ro(h,r,a);this.needsUpload=!1,this._featureMap=new qu,this._bufferOffset=0}populatePaintArrays(t,r,a,h,p,_,g){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(t,r,h,p,_,g);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,a,h,p){for(let _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,r,_,h,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}let V1={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Z1(i,t){return V1[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}let U1={"line-pattern":{source:bt,composite:bt},"fill-pattern":{source:bt,composite:bt},"fill-extrusion-pattern":{source:bt,composite:bt},"line-dasharray":{source:Ct,composite:Ct}},N1={color:{source:hi,composite:ct},number:{source:ne,composite:hi}};function __(i,t,r){let a=U1[i];return a&&a[r]||N1[t][r]}te(Gc,"ConstantBinder"),te(fl,"CrossFadedConstantBinder"),te(ys,"SourceExpressionBinder"),te(no,"CrossFadedCompositeBinder"),te(mr,"CompositeExpressionBinder"),te(ro,"ProgramConfiguration",{omit:["_buffers"]}),te(oa,"ProgramConfigurationSet");let Hu="-transition";class _r extends _e{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,t.type!=="custom"&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new m(r.layout)),r.paint)){this._transitionablePaint=new d(r.paint);for(let a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(let a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new v(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,a={}){r!=null&&this._validate(Op,`layers.${this.id}.layout.${t}`,t,r,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return Me(t,Hu)?this._transitionablePaint.getTransition(t.slice(0,-Hu.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,a={}){if(r!=null&&this._validate(Fp,`layers.${this.id}.paint.${t}`,t,r,a))return!1;if(Me(t,Hu))return this._transitionablePaint.setTransition(t.slice(0,-Hu.length),r||void 0),!1;{let h=this._transitionablePaint._values[t],p=h.property.specification["property-type"]==="cross-faded-data-driven",_=h.value.isDataDriven(),g=h.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);let b=this._transitionablePaint._values[t].value;return b.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(t,g,b)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,r,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Di(t,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(t,r,a,h,p={}){return(!p||p.validate!==!1)&&Cu(this,t.call(Ko,{key:r,layerType:this.type,objectKey:a,value:h,styleSpec:Et,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let r=this.paint.get(t);if(r instanceof y&&Xs(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=zr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}let j1=st([{name:"a_pos",components:2,type:"Int16"}],4),G1=st([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class xi{constructor(t=[]){this.segments=t}prepareSegment(t,r,a,h){let p=this.segments[this.segments.length-1];return t>xi.MAX_VERTEX_ARRAY_LENGTH&&qe(`Max vertices per segment is ${xi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>xi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}get(){return this.segments}destroy(){for(let t of this.segments)for(let r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,a,h){return new xi([{vertexOffset:t,primitiveOffset:r,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}xi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,te(xi,"SegmentVector");var we=8192;class so{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Ke?new Ke(t.lng,t.lat):Ke.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ke?new Ke(t.lng,t.lat):Ke.convert(t),this}extend(t){let r=this._sw,a=this._ne,h,p;if(t instanceof Ke)h=t,p=t;else{if(!(t instanceof so))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(so.convert(t)):this.extend(Ke.convert(t)):this;if(h=t._sw,p=t._ne,!h||!p)return this}return r||a?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),a.lng=Math.max(p.lng,a.lng),a.lat=Math.max(p.lat,a.lat)):(this._sw=new Ke(h.lng,h.lat),this._ne=new Ke(p.lng,p.lat)),this}getCenter(){return new Ke((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ke(this.getWest(),this.getNorth())}getSouthEast(){return new Ke(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:r,lat:a}=Ke.convert(t),h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&h}static convert(t){return!t||t instanceof so?t:new so(t)}}let Gp=63710088e-1;class Ke{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ke(Rt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let r=Math.PI/180,a=this.lat*r,h=t.lat*r,p=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*r);return Gp*Math.acos(Math.min(p,1))}toBounds(t=0){let r=360*t/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new so(new Ke(this.lng-a,this.lat-r),new Ke(this.lng+a,this.lat+r))}static convert(t){if(t instanceof Ke)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ke(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ke(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let g_=2*Math.PI*Gp;function $p(i){return g_*Math.cos(i*Math.PI/180)}function $c(i){return(180+i)/360}function ml(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function _l(i,t){return i/$p(t)}function er(i){return 360*i-180}function Gi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function y_(i,t){return i*$p(Gi(t))}let Or=85.051129;class Yu{constructor(t,r,a=0){this.x=+t,this.y=+r,this.z=+a}static fromLngLat(t,r=0){let a=Ke.convert(t);return new Yu($c(a.lng),ml(a.lat),_l(r,a.lat))}toLngLat(){return new Ke(er(this.x),Gi(this.y))}toAltitude(){return y_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/g_*(t=Gi(this.y),1/Math.cos(t*Math.PI/180));var t}}function qp(i,t,r,a,h,p,_,g,b){let S=(t+a)/2,C=(r+h)/2,I=new A(S,C);g(I),function(P,R,V,N,q,K){let lt=V-q,ut=N-K;return Math.abs((N-R)*lt-(V-P)*ut)/Math.hypot(lt,ut)}(I.x,I.y,p.x,p.y,_.x,_.y)>=b?(qp(i,t,r,S,C,p,I,g,b),qp(i,S,C,a,h,I,_,g,b)):i.push(_)}function $1(i,t,r){let a=i[0],h=a.x,p=a.y;t(a);let _=[a];for(let g=1;g<i.length;g++){let b=i[g],{x:S,y:C}=b;t(b),qp(_,h,p,S,C,a,b,t,r),h=S,p=C,a=b}return _}let Wp=Math.pow(2,14)-1,x_=-Wp-1;function q1(i,t){let r=Math.round(i.x*t),a=Math.round(i.y*t);return i.x=_t(r,x_,Wp),i.y=_t(a,x_,Wp),(r<i.x||r>i.x+1||a<i.y||a>i.y+1)&&qe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function xs(i,t,r){let a=i.loadGeometry(),h=i.extent,p=we/h;if(t&&r&&r.projection.isReprojectedInTileSpace){let _=1<<t.z,{scale:g,x:b,y:S,projection:C}=r,I=P=>{let R=er((t.x+P.x/h)/_),V=Gi((t.y+P.y/h)/_),N=C.project(R,V);P.x=(N.x*g-b)*h,P.y=(N.y*g-S)*h};for(let P=0;P<a.length;P++)if(i.type!==1)a[P]=$1(a[P],I,1);else{let R=[];for(let V of a[P])V.x<0||V.x>=h||V.y<0||V.y>=h||(I(V),R.push(V));a[P]=R}}for(let _ of a)for(let g of _)q1(g,p);return a}function aa(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?xs(i):[]}}function Ku(i,t,r,a,h){i.emplaceBack(2*t+(a+1)/2,2*r+(h+1)/2)}function Ju(i,t,r,a){i.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384,a)}class Xp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new it,this.indexArray=new ee,this.segments=new xi,this.programConfigurations=new oa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a,h){let p=this.layers[0],_=[],g=null;p.type==="circle"&&(g=p.layout.get("circle-sort-key"));for(let{feature:S,id:C,index:I,sourceLayerIndex:P}of t){let R=this.layers[0]._featureFilter.needGeometry,V=aa(S,R);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),V,a))continue;let N=g?g.evaluate(V,{},a):void 0,q={id:C,properties:S.properties,type:S.type,sourceLayerIndex:P,index:I,geometry:R?V.geometry:xs(S,a,h),patterns:{},sortKey:N};_.push(q)}g&&_.sort((S,C)=>S.sortKey-C.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new _s,b=h.projection);for(let S of _){let{geometry:C,index:I,sourceLayerIndex:P}=S,R=t[I].feature;this.addFeature(S,C,I,r.availableImages,a,b),r.featureIndex.insert(R,C,I,P,this.index)}}update(t,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,j1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,G1.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,r,a,h,p,_){for(let g of r)for(let b of g){let S=b.x,C=b.y;if(S<0||S>=we||C<0||C>=we)continue;if(_){let R=_.projectTilePoint(S,C,p),V=_.upVector(p,S,C),N=Gi((C/we+p.y)/(1<<p.z)),q=_.pixelsPerMeter(N,1)/_l(1,N),K=this.globeExtVertexArray;Ju(K,R,V,q),Ju(K,R,V,q),Ju(K,R,V,q),Ju(K,R,V,q)}let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),P=I.vertexLength;Ku(this.layoutVertexArray,S,C,-1,-1),Ku(this.layoutVertexArray,S,C,1,-1),Ku(this.layoutVertexArray,S,C,1,1),Ku(this.layoutVertexArray,S,C,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h,p)}}function v_(i,t){for(let r=0;r<i.length;r++)if(gl(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(gl(i,t[r]))return!0;return!!Hp(i,t)}function W1(i,t,r){return!!gl(i,t)||!!Yp(t,i,r)}function b_(i,t){if(i.length===1)return T_(t,i[0]);for(let r=0;r<t.length;r++){let a=t[r];for(let h=0;h<a.length;h++)if(gl(i,a[h]))return!0}for(let r=0;r<i.length;r++)if(T_(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Hp(i,t[r]))return!0;return!1}function X1(i,t,r){if(i.length>1){if(Hp(i,t))return!0;for(let a=0;a<t.length;a++)if(Yp(t[a],i,r))return!0}for(let a=0;a<i.length;a++)if(Yp(i[a],t,r))return!0;return!1}function Hp(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){let a=i[r],h=i[r+1];for(let p=0;p<t.length-1;p++)if(H1(a,h,t[p],t[p+1]))return!0}return!1}function H1(i,t,r,a){return gi(i,r,a)!==gi(t,r,a)&&gi(i,t,r)!==gi(i,t,a)}function Yp(i,t,r){let a=r*r;if(t.length===1)return i.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(w_(i,t[h-1],t[h])<a)return!0;return!1}function w_(i,t,r){let a=t.distSqr(r);if(a===0)return i.distSqr(t);let h=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/a;return i.distSqr(h<0?t:h>1?r:r.sub(t)._mult(h)._add(t))}function T_(i,t){let r,a,h,p=!1;for(let _=0;_<i.length;_++){r=i[_];for(let g=0,b=r.length-1;g<r.length;b=g++)a=r[g],h=r[b],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(p=!p)}return p}function gl(i,t){let r=!1;for(let a=0,h=i.length-1;a<i.length;h=a++){let p=i[a],_=i[h];p.y>t.y!=_.y>t.y&&t.x<(_.x-p.x)*(t.y-p.y)/(_.y-p.y)+p.x&&(r=!r)}return r}function S_(i,t,r,a,h){for(let _ of i)if(t<=_.x&&r<=_.y&&a>=_.x&&h>=_.y)return!0;let p=[new A(t,r),new A(t,h),new A(a,h),new A(a,r)];if(i.length>2){for(let _ of p)if(gl(i,_))return!0}for(let _=0;_<i.length-1;_++)if(Y1(i[_],i[_+1],p))return!0;return!1}function Y1(i,t,r){let a=r[0],h=r[2];if(i.x<a.x&&t.x<a.x||i.x>h.x&&t.x>h.x||i.y<a.y&&t.y<a.y||i.y>h.y&&t.y>h.y)return!1;let p=gi(i,t,r[0]);return p!==gi(i,t,r[1])||p!==gi(i,t,r[2])||p!==gi(i,t,r[3])}function yl(i,t,r){let a=t.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Qu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function E_(i,t,r,a,h){if(!t[0]&&!t[1])return i;let p=A.convert(t)._mult(h);r==="viewport"&&p._rotate(-a);let _=[];for(let g=0;g<i.length;g++)_.push(i[g].sub(p));return _}function M_(i,t,r,a){let h=A.convert(i)._mult(a);return t==="viewport"&&h._rotate(-r),h}te(Xp,"CircleBucket",{omit:["layers"]});let K1=new O({"circle-sort-key":new M(Et.layout_circle["circle-sort-key"])});var J1={paint:new O({"circle-radius":new M(Et.paint_circle["circle-radius"]),"circle-color":new M(Et.paint_circle["circle-color"]),"circle-blur":new M(Et.paint_circle["circle-blur"]),"circle-opacity":new M(Et.paint_circle["circle-opacity"]),"circle-translate":new T(Et.paint_circle["circle-translate"]),"circle-translate-anchor":new T(Et.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new T(Et.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new T(Et.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new M(Et.paint_circle["circle-stroke-width"]),"circle-stroke-color":new M(Et.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new M(Et.paint_circle["circle-stroke-opacity"])}),layout:K1},Kp=1e-6,Mn=typeof Float32Array<"u"?Float32Array:Array;function A_(){var i=new Mn(9);return Mn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Vr(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Jp(i,t,r){var a=t[0],h=t[1],p=t[2],_=t[3],g=t[4],b=t[5],S=t[6],C=t[7],I=t[8],P=t[9],R=t[10],V=t[11],N=t[12],q=t[13],K=t[14],lt=t[15],ut=r[0],ft=r[1],gt=r[2],yt=r[3];return i[0]=ut*a+ft*g+gt*I+yt*N,i[1]=ut*h+ft*b+gt*P+yt*q,i[2]=ut*p+ft*S+gt*R+yt*K,i[3]=ut*_+ft*C+gt*V+yt*lt,i[4]=(ut=r[4])*a+(ft=r[5])*g+(gt=r[6])*I+(yt=r[7])*N,i[5]=ut*h+ft*b+gt*P+yt*q,i[6]=ut*p+ft*S+gt*R+yt*K,i[7]=ut*_+ft*C+gt*V+yt*lt,i[8]=(ut=r[8])*a+(ft=r[9])*g+(gt=r[10])*I+(yt=r[11])*N,i[9]=ut*h+ft*b+gt*P+yt*q,i[10]=ut*p+ft*S+gt*R+yt*K,i[11]=ut*_+ft*C+gt*V+yt*lt,i[12]=(ut=r[12])*a+(ft=r[13])*g+(gt=r[14])*I+(yt=r[15])*N,i[13]=ut*h+ft*b+gt*P+yt*q,i[14]=ut*p+ft*S+gt*R+yt*K,i[15]=ut*_+ft*C+gt*V+yt*lt,i}function la(i,t,r){var a,h,p,_,g,b,S,C,I,P,R,V,N=r[0],q=r[1],K=r[2];return t===i?(i[12]=t[0]*N+t[4]*q+t[8]*K+t[12],i[13]=t[1]*N+t[5]*q+t[9]*K+t[13],i[14]=t[2]*N+t[6]*q+t[10]*K+t[14],i[15]=t[3]*N+t[7]*q+t[11]*K+t[15]):(h=t[1],p=t[2],_=t[3],g=t[4],b=t[5],S=t[6],C=t[7],I=t[8],P=t[9],R=t[10],V=t[11],i[0]=a=t[0],i[1]=h,i[2]=p,i[3]=_,i[4]=g,i[5]=b,i[6]=S,i[7]=C,i[8]=I,i[9]=P,i[10]=R,i[11]=V,i[12]=a*N+g*q+I*K+t[12],i[13]=h*N+b*q+P*K+t[13],i[14]=p*N+S*q+R*K+t[14],i[15]=_*N+C*q+V*K+t[15]),i}function oo(i,t,r){var a=r[0],h=r[1],p=r[2];return i[0]=t[0]*a,i[1]=t[1]*a,i[2]=t[2]*a,i[3]=t[3]*a,i[4]=t[4]*h,i[5]=t[5]*h,i[6]=t[6]*h,i[7]=t[7]*h,i[8]=t[8]*p,i[9]=t[9]*p,i[10]=t[10]*p,i[11]=t[11]*p,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function Qp(i,t,r){var a=Math.sin(r),h=Math.cos(r),p=t[4],_=t[5],g=t[6],b=t[7],S=t[8],C=t[9],I=t[10],P=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=p*h+S*a,i[5]=_*h+C*a,i[6]=g*h+I*a,i[7]=b*h+P*a,i[8]=S*h-p*a,i[9]=C*h-_*a,i[10]=I*h-g*a,i[11]=P*h-b*a,i}function tf(i,t,r){var a=Math.sin(r),h=Math.cos(r),p=t[0],_=t[1],g=t[2],b=t[3],S=t[8],C=t[9],I=t[10],P=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*h-S*a,i[1]=_*h-C*a,i[2]=g*h-I*a,i[3]=b*h-P*a,i[8]=p*a+S*h,i[9]=_*a+C*h,i[10]=g*a+I*h,i[11]=b*a+P*h,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Q1=Jp;function ef(){var i=new Mn(3);return Mn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function C_(i){var t=new Mn(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function I_(i){return Math.hypot(i[0],i[1],i[2])}function qc(i,t,r){var a=new Mn(3);return a[0]=i,a[1]=t,a[2]=r,a}function k_(i,t,r){return i[0]=t[0]+r[0],i[1]=t[1]+r[1],i[2]=t[2]+r[2],i}function P_(i,t,r){return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],i}function z_(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i}function nf(i,t,r){return i[0]=Math.min(t[0],r[0]),i[1]=Math.min(t[1],r[1]),i[2]=Math.min(t[2],r[2]),i}function rf(i,t,r){return i[0]=Math.max(t[0],r[0]),i[1]=Math.max(t[1],r[1]),i[2]=Math.max(t[2],r[2]),i}function Wc(i,t,r){return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i}function sf(i,t,r,a){return i[0]=t[0]+r[0]*a,i[1]=t[1]+r[1]*a,i[2]=t[2]+r[2]*a,i}function Xc(i,t){var r=t[0],a=t[1],h=t[2],p=r*r+a*a+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=t[0]*p,i[1]=t[1]*p,i[2]=t[2]*p,i}function Hc(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function D_(i,t,r){var a=t[0],h=t[1],p=t[2],_=r[0],g=r[1],b=r[2];return i[0]=h*b-p*g,i[1]=p*_-a*b,i[2]=a*g-h*_,i}function ca(i,t,r){var a=t[0],h=t[1],p=t[2],_=r[3]*a+r[7]*h+r[11]*p+r[15];return i[0]=(r[0]*a+r[4]*h+r[8]*p+r[12])/(_=_||1),i[1]=(r[1]*a+r[5]*h+r[9]*p+r[13])/_,i[2]=(r[2]*a+r[6]*h+r[10]*p+r[14])/_,i}function L_(i,t,r){var a=r[0],h=r[1],p=r[2],_=t[0],g=t[1],b=t[2],S=h*b-p*g,C=p*_-a*b,I=a*g-h*_,P=h*I-p*C,R=p*S-a*I,V=a*C-h*S,N=2*r[3];return C*=N,I*=N,R*=2,V*=2,i[0]=_+(S*=N)+(P*=2),i[1]=g+C+R,i[2]=b+I+V,i}var Yc,xl=P_,tx=z_,ex=I_;function vl(i,t,r){var a=t[0],h=t[1],p=t[2],_=t[3];return i[0]=r[0]*a+r[4]*h+r[8]*p+r[12]*_,i[1]=r[1]*a+r[5]*h+r[9]*p+r[13]*_,i[2]=r[2]*a+r[6]*h+r[10]*p+r[14]*_,i[3]=r[3]*a+r[7]*h+r[11]*p+r[15]*_,i}function R_(){var i=new Mn(4);return Mn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function B_(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function F_(i,t,r){r*=.5;var a=t[0],h=t[1],p=t[2],_=t[3],g=Math.sin(r),b=Math.cos(r);return i[0]=a*b+_*g,i[1]=h*b+p*g,i[2]=p*b-h*g,i[3]=_*b-a*g,i}ef(),Yc=new Mn(4),Mn!=Float32Array&&(Yc[0]=0,Yc[1]=0,Yc[2]=0,Yc[3]=0),ef(),qc(1,0,0),qc(0,1,0),R_(),R_(),A_();class of{constructor(t,r){this.points=t,this.planes=r}static fromInvProjectionMatrix(t,r,a,h){let p=Math.pow(2,a),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let S=vl([],b,t),C=1/S[3]/r*p;return function(I,P,R){return I[0]=P[0]*R[0],I[1]=P[1]*R[1],I[2]=P[2]*R[2],I[3]=P[3]*R[3],I}(S,S,[C,C,h?1/S[3]:C,C])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let S=Xc([],D_([],xl([],_[b[0]],_[b[1]]),xl([],_[b[2]],_[b[1]]))),C=-Hc(S,_[b[1]]);return S.concat(C)});return new of(_,g)}}class Wn{constructor(t,r){this.min=t,this.max=r,this.center=Wc([],k_([],this.min,this.max),.5)}quadrant(t){let r=[t%2==0,t<2],a=C_(this.min),h=C_(this.max);for(let p=0;p<r.length;p++)a[p]=r[p]?this.min[p]:this.center[p],h[p]=r[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new Wn(a,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){let t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){let r=this.getCorners(),a=!0;for(let h=0;h<t.planes.length;h++){let p=t.planes[h],_=0;for(let g=0;g<r.length;g++)_+=Hc(p,r[g])+p[3]>=0;if(_===0)return 0;_!==r.length&&(a=!1)}if(a)return 2;for(let h=0;h<3;h++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let g=0;g<t.points.length;g++){let b=t.points[g][h]-this.min[h];p=Math.min(p,b),_=Math.max(_,b)}if(_<0||p>this.max[h]-this.min[h])return 0}return 1}}function O_(i,t,r,a,h,p,_,g,b){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(b*=i.pixelToTileUnitsFactor);for(let S of t)for(let C of S){let I=C.add(g),P=h&&r.elevation?r.elevation.exaggeration()*h.getElevationAt(I.x,I.y,!0):0,R=p?I:ix(I,P,a),V=p?i.tilespaceRays.map(q=>rx(q,P)):i.queryGeometry.screenGeometry,N=vl([],[C.x,C.y,P,1],a);if(!_&&p?b*=N[3]/r.cameraToCenterDistance:_&&!p&&(b*=r.cameraToCenterDistance/N[3]),W1(V,R,b))return!0}return!1}function ix(i,t,r){let a=vl([],[i.x,i.y,t,1],r);return new A(a[0]/a[3],a[1]/a[3])}let V_=qc(0,0,0),nx=qc(0,0,1);function rx(i,t){let r=ef();return V_[2]=t,i.intersectsPlane(V_,nx,r),new A(r[0],r[1])}class Z_ extends Xp{}function U_(i,{width:t,height:r},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*r*a)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*r*a);return i.width=t,i.height=r,i.data=h,i}function N_(i,t,r){let{width:a,height:h}=t;a===i.width&&h===i.height||(af(i,t,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,a),height:Math.min(i.height,h)},r),i.width=a,i.height=h,i.data=t.data)}function af(i,t,r,a,h,p){if(h.width===0||h.height===0)return t;if(h.width>i.width||h.height>i.height||r.x>i.width-h.width||r.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");let _=i.data,g=t.data;for(let b=0;b<h.height;b++){let S=((r.y+b)*i.width+r.x)*p,C=((a.y+b)*t.width+a.x)*p;for(let I=0;I<h.width*p;I++)g[C+I]=_[S+I]}return t}te(Z_,"HeatmapBucket",{omit:["layers"]});class vs{constructor(t,r){U_(this,t,1,r)}resize(t){N_(this,new vs(t),1)}clone(){return new vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,h,p){af(t,r,a,h,p,1)}}class An{constructor(t,r){U_(this,t,4,r)}resize(t){N_(this,new An(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new An({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,h,p){af(t,r,a,h,p,4)}}te(vs,"AlphaImage"),te(An,"RGBAImage");var sx={paint:new O({"heatmap-radius":new M(Et.paint_heatmap["heatmap-radius"]),"heatmap-weight":new M(Et.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new T(Et.paint_heatmap["heatmap-intensity"]),"heatmap-color":new L(Et.paint_heatmap["heatmap-color"]),"heatmap-opacity":new T(Et.paint_heatmap["heatmap-opacity"])})};function lf(i){let t={},r=i.resolution||256,a=i.clips?i.clips.length:1,h=i.image||new An({width:r,height:a}),p=(_,g,b)=>{t[i.evaluationKey]=b;let S=i.expression.evaluate(t);h.data[_+g+0]=Math.floor(255*S.r/S.a),h.data[_+g+1]=Math.floor(255*S.g/S.a),h.data[_+g+2]=Math.floor(255*S.b/S.a),h.data[_+g+3]=Math.floor(255*S.a)};if(i.clips)for(let _=0,g=0;_<a;++_,g+=4*r)for(let b=0,S=0;b<r;b++,S+=4){let C=b/(r-1),{start:I,end:P}=i.clips[_];p(g,S,I*(1-C)+P*C)}else for(let _=0,g=0;_<r;_++,g+=4)p(0,g,_/(r-1));return h}var ox={paint:new O({"hillshade-illumination-direction":new T(Et.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new T(Et.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new T(Et.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new T(Et.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new T(Et.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new T(Et.paint_hillshade["hillshade-accent-color"])})};let ax=st([{name:"a_pos",components:2,type:"Int16"}],4),{members:lx}=ax;var td=ed,cx=ed;function ed(i,t,r){r=r||2;var a,h,p,_,g,b,S,C=t&&t.length,I=C?t[0]*r:i.length,P=j_(i,0,I,r,!0),R=[];if(!P||P.next===P.prev)return R;if(C&&(P=function(N,q,K,lt){var ut,ft,gt,yt=[];for(ut=0,ft=q.length;ut<ft;ut++)(gt=j_(N,q[ut]*lt,ut<ft-1?q[ut+1]*lt:N.length,lt,!1))===gt.next&&(gt.steiner=!0),yt.push(gx(gt));for(yt.sort(fx),ut=0;ut<yt.length;ut++)K=ao(K=mx(yt[ut],K),K.next);return K}(i,t,P,r)),i.length>80*r){a=p=i[0],h=_=i[1];for(var V=r;V<I;V+=r)(g=i[V])<a&&(a=g),(b=i[V+1])<h&&(h=b),g>p&&(p=g),b>_&&(_=b);S=(S=Math.max(p-a,_-h))!==0?1/S:0}return Kc(P,R,r,a,h,S),R}function j_(i,t,r,a,h){var p,_;if(h===uf(i,t,r,a)>0)for(p=t;p<r;p+=a)_=q_(p,i[p],i[p+1],_);else for(p=r-a;p>=t;p-=a)_=q_(p,i[p],i[p+1],_);return _&&id(_,_.next)&&(Qc(_),_=_.next),_}function ao(i,t){if(!i)return i;t||(t=i);var r,a=i;do if(r=!1,a.steiner||!id(a,a.next)&&Si(a.prev,a,a.next)!==0)a=a.next;else{if(Qc(a),(a=t=a.prev)===a.next)break;r=!0}while(r||a!==t);return t}function Kc(i,t,r,a,h,p,_){if(i){!_&&p&&function(C,I,P,R){var V=C;do V.z===null&&(V.z=cf(V.x,V.y,I,P,R)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==C);V.prevZ.nextZ=null,V.prevZ=null,function(N){var q,K,lt,ut,ft,gt,yt,It,Pt=1;do{for(K=N,N=null,ft=null,gt=0;K;){for(gt++,lt=K,yt=0,q=0;q<Pt&&(yt++,lt=lt.nextZ);q++);for(It=Pt;yt>0||It>0&&lt;)yt!==0&&(It===0||!lt||K.z<=lt.z)?(ut=K,K=K.nextZ,yt--):(ut=lt,lt=lt.nextZ,It--),ft?ft.nextZ=ut:N=ut,ut.prevZ=ft,ft=ut;K=lt}ft.nextZ=null,Pt*=2}while(gt>1)}(V)}(i,a,h,p);for(var g,b,S=i;i.prev!==i.next;)if(g=i.prev,b=i.next,p?ux(i,a,h,p):hx(i))t.push(g.i/r),t.push(i.i/r),t.push(b.i/r),Qc(i),i=b.next,S=b.next;else if((i=b)===S){_?_===1?Kc(i=dx(ao(i),t,r),t,r,a,h,p,2):_===2&&px(i,t,r,a,h,p):Kc(ao(i),t,r,a,h,p,1);break}}}function hx(i){var t=i.prev,r=i,a=i.next;if(Si(t,r,a)>=0)return!1;for(var h=i.next.next;h!==i.prev;){if(bl(t.x,t.y,r.x,r.y,a.x,a.y,h.x,h.y)&&Si(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function ux(i,t,r,a){var h=i.prev,p=i,_=i.next;if(Si(h,p,_)>=0)return!1;for(var g=h.x>p.x?h.x>_.x?h.x:_.x:p.x>_.x?p.x:_.x,b=h.y>p.y?h.y>_.y?h.y:_.y:p.y>_.y?p.y:_.y,S=cf(h.x<p.x?h.x<_.x?h.x:_.x:p.x<_.x?p.x:_.x,h.y<p.y?h.y<_.y?h.y:_.y:p.y<_.y?p.y:_.y,t,r,a),C=cf(g,b,t,r,a),I=i.prevZ,P=i.nextZ;I&&I.z>=S&&P&&P.z<=C;){if(I!==i.prev&&I!==i.next&&bl(h.x,h.y,p.x,p.y,_.x,_.y,I.x,I.y)&&Si(I.prev,I,I.next)>=0||(I=I.prevZ,P!==i.prev&&P!==i.next&&bl(h.x,h.y,p.x,p.y,_.x,_.y,P.x,P.y)&&Si(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;I&&I.z>=S;){if(I!==i.prev&&I!==i.next&&bl(h.x,h.y,p.x,p.y,_.x,_.y,I.x,I.y)&&Si(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;P&&P.z<=C;){if(P!==i.prev&&P!==i.next&&bl(h.x,h.y,p.x,p.y,_.x,_.y,P.x,P.y)&&Si(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function dx(i,t,r){var a=i;do{var h=a.prev,p=a.next.next;!id(h,p)&&G_(h,a,a.next,p)&&Jc(h,p)&&Jc(p,h)&&(t.push(h.i/r),t.push(a.i/r),t.push(p.i/r),Qc(a),Qc(a.next),a=i=p),a=a.next}while(a!==i);return ao(a)}function px(i,t,r,a,h,p){var _=i;do{for(var g=_.next.next;g!==_.prev;){if(_.i!==g.i&&yx(_,g)){var b=$_(_,g);return _=ao(_,_.next),b=ao(b,b.next),Kc(_,t,r,a,h,p),void Kc(b,t,r,a,h,p)}g=g.next}_=_.next}while(_!==i)}function fx(i,t){return i.x-t.x}function mx(i,t){var r=function(p,_){var g,b=_,S=p.x,C=p.y,I=-1/0;do{if(C<=b.y&&C>=b.next.y&&b.next.y!==b.y){var P=b.x+(C-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(P<=S&&P>I){if(I=P,P===S){if(C===b.y)return b;if(C===b.next.y)return b.next}g=b.x<b.next.x?b:b.next}}b=b.next}while(b!==_);if(!g)return null;if(S===I)return g;var R,V=g,N=g.x,q=g.y,K=1/0;b=g;do S>=b.x&&b.x>=N&&S!==b.x&&bl(C<q?S:I,C,N,q,C<q?I:S,C,b.x,b.y)&&(R=Math.abs(C-b.y)/(S-b.x),Jc(b,p)&&(R<K||R===K&&(b.x>g.x||b.x===g.x&&_x(g,b)))&&(g=b,K=R)),b=b.next;while(b!==V);return g}(i,t);if(!r)return t;var a=$_(r,i),h=ao(r,r.next);return ao(a,a.next),t===r?h:t}function _x(i,t){return Si(i.prev,i,t.prev)<0&&Si(t.next,i,i.next)<0}function cf(i,t,r,a,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)*h)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-a)*h)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function gx(i){var t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function bl(i,t,r,a,h,p,_,g){return(h-_)*(t-g)-(i-_)*(p-g)>=0&&(i-_)*(a-g)-(r-_)*(t-g)>=0&&(r-_)*(p-g)-(h-_)*(a-g)>=0}function yx(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,a){var h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==a.i&&h.next.i!==a.i&&G_(h,h.next,r,a))return!0;h=h.next}while(h!==r);return!1}(i,t)&&(Jc(i,t)&&Jc(t,i)&&function(r,a){var h=r,p=!1,_=(r.x+a.x)/2,g=(r.y+a.y)/2;do h.y>g!=h.next.y>g&&h.next.y!==h.y&&_<(h.next.x-h.x)*(g-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==r);return p}(i,t)&&(Si(i.prev,i,t.prev)||Si(i,t.prev,t))||id(i,t)&&Si(i.prev,i,i.next)>0&&Si(t.prev,t,t.next)>0)}function Si(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function id(i,t){return i.x===t.x&&i.y===t.y}function G_(i,t,r,a){var h=rd(Si(i,t,r)),p=rd(Si(i,t,a)),_=rd(Si(r,a,i)),g=rd(Si(r,a,t));return h!==p&&_!==g||!(h!==0||!nd(i,r,t))||!(p!==0||!nd(i,a,t))||!(_!==0||!nd(r,i,a))||!(g!==0||!nd(r,t,a))}function nd(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function rd(i){return i>0?1:i<0?-1:0}function Jc(i,t){return Si(i.prev,i,i.next)<0?Si(i,t,i.next)>=0&&Si(i,i.prev,t)>=0:Si(i,t,i.prev)<0||Si(i,i.next,t)<0}function $_(i,t){var r=new hf(i.i,i.x,i.y),a=new hf(t.i,t.x,t.y),h=i.next,p=t.prev;return i.next=t,t.prev=i,r.next=h,h.prev=r,a.next=r,r.prev=a,p.next=a,a.prev=p,a}function q_(i,t,r,a){var h=new hf(i,t,r);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Qc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function hf(i,t,r){this.i=i,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function uf(i,t,r,a){for(var h=0,p=t,_=r-a;p<r;p+=a)h+=(i[_]-i[p])*(i[p+1]+i[_+1]),_=p;return h}function xx(i,t,r,a,h){W_(i,t,r||0,a||i.length-1,h||vx)}function W_(i,t,r,a,h){for(;a>r;){if(a-r>600){var p=a-r+1,_=t-r+1,g=Math.log(p),b=.5*Math.exp(2*g/3),S=.5*Math.sqrt(g*b*(p-b)/p)*(_-p/2<0?-1:1);W_(i,t,Math.max(r,Math.floor(t-_*b/p+S)),Math.min(a,Math.floor(t+(p-_)*b/p+S)),h)}var C=i[t],I=r,P=a;for(th(i,r,t),h(i[a],C)>0&&th(i,r,a);I<P;){for(th(i,I,P),I++,P--;h(i[I],C)<0;)I++;for(;h(i[P],C)>0;)P--}h(i[r],C)===0?th(i,r,P):th(i,++P,a),P<=t&&(r=P+1),t<=P&&(a=P-1)}}function th(i,t,r){var a=i[t];i[t]=i[r],i[r]=a}function vx(i,t){return i<t?-1:i>t?1:0}function df(i,t){let r=i.length;if(r<=1)return[i];let a=[],h,p;for(let _=0;_<r;_++){let g=Ki(i[_]);g!==0&&(i[_].area=Math.abs(g),p===void 0&&(p=g<0),p===g<0?(h&&a.push(h),h=[i[_]]):h.push(i[_]))}if(h&&a.push(h),t>1)for(let _=0;_<a.length;_++)a[_].length<=t||(xx(a[_],t,1,a[_].length-1,bx),a[_]=a[_].slice(0,t));return a}function bx(i,t){return t.area-i.area}function pf(i,t,r){let a=r.patternDependencies,h=!1;for(let p of t){let _=p.paint.get(`${i}-pattern`);_.isConstant()||(h=!0);let g=_.constantOr(null);g&&(h=!0,a[g.to]=!0,a[g.from]=!0)}return h}function ff(i,t,r,a,h){let p=h.patternDependencies;for(let _ of t){let g=_.paint.get(`${i}-pattern`).value;if(g.kind!=="constant"){let b=g.evaluate({zoom:a-1},r,{},h.availableImages),S=g.evaluate({zoom:a},r,{},h.availableImages),C=g.evaluate({zoom:a+1},r,{},h.availableImages);b=b&&b.name?b.name:b,S=S&&S.name?S.name:S,C=C&&C.name?C.name:C,p[b]=!0,p[S]=!0,p[C]=!0,r.patterns[_.id]={min:b,mid:S,max:C}}}return r}ed.deviation=function(i,t,r,a){var h=t&&t.length,p=Math.abs(uf(i,0,h?t[0]*r:i.length,r));if(h)for(var _=0,g=t.length;_<g;_++)p-=Math.abs(uf(i,t[_]*r,_<g-1?t[_+1]*r:i.length,r));var b=0;for(_=0;_<a.length;_+=3){var S=a[_]*r,C=a[_+1]*r,I=a[_+2]*r;b+=Math.abs((i[S]-i[I])*(i[C+1]-i[S+1])-(i[S]-i[C])*(i[I+1]-i[S+1]))}return p===0&&b===0?0:Math.abs((b-p)/p)},ed.flatten=function(i){for(var t=i[0][0].length,r={vertices:[],holes:[],dimensions:t},a=0,h=0;h<i.length;h++){for(var p=0;p<i[h].length;p++)for(var _=0;_<t;_++)r.vertices.push(i[h][p][_]);h>0&&r.holes.push(a+=i[h-1].length)}return r},td.default=cx;class sd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new it,this.indexArray=new ee,this.indexArray2=new ge,this.programConfigurations=new oa(t.layers,t.zoom),this.segments=new xi,this.segments2=new xi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection}populate(t,r,a,h){this.hasPattern=pf("fill",this.layers,r);let p=this.layers[0].layout.get("fill-sort-key"),_=[];for(let{feature:g,id:b,index:S,sourceLayerIndex:C}of t){let I=this.layers[0]._featureFilter.needGeometry,P=aa(g,I);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),P,a))continue;let R=p?p.evaluate(P,{},a,r.availableImages):void 0,V={id:b,properties:g.properties,type:g.type,sourceLayerIndex:C,index:S,geometry:I?P.geometry:xs(g,a,h),patterns:{},sortKey:R};_.push(V)}p&&_.sort((g,b)=>g.sortKey-b.sortKey);for(let g of _){let{geometry:b,index:S,sourceLayerIndex:C}=g;if(this.hasPattern){let I=ff("fill",this.layers,g,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(g,b,S,a,{},r.availableImages);r.featureIndex.insert(t[S].feature,b,S,C,this.index)}}update(t,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a,h)}addFeatures(t,r,a,h,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lx),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,a,h,p,_=[]){for(let g of df(r,500)){let b=0;for(let V of g)b+=V.length;let S=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),C=S.vertexLength,I=[],P=[];for(let V of g){if(V.length===0)continue;V!==g[0]&&P.push(I.length/2);let N=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),q=N.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(q+V.length-1,q),I.push(V[0].x),I.push(V[0].y);for(let K=1;K<V.length;K++)this.layoutVertexArray.emplaceBack(V[K].x,V[K].y),this.indexArray2.emplaceBack(q+K-1,q+K),I.push(V[K].x),I.push(V[K].y);N.vertexLength+=V.length,N.primitiveLength+=V.length}let R=td(I,P);for(let V=0;V<R.length;V+=3)this.indexArray.emplaceBack(C+R[V],C+R[V+1],C+R[V+2]);S.vertexLength+=b,S.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,p,_,h)}}te(sd,"FillBucket",{omit:["layers","patternFeatures"]});let wx=new O({"fill-sort-key":new M(Et.layout_fill["fill-sort-key"])});var Tx={paint:new O({"fill-antialias":new T(Et.paint_fill["fill-antialias"]),"fill-opacity":new M(Et.paint_fill["fill-opacity"]),"fill-color":new M(Et.paint_fill["fill-color"]),"fill-outline-color":new M(Et.paint_fill["fill-outline-color"]),"fill-translate":new T(Et.paint_fill["fill-translate"]),"fill-translate-anchor":new T(Et.paint_fill["fill-translate-anchor"]),"fill-pattern":new k(Et.paint_fill["fill-pattern"])}),layout:wx};let Sx=st([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ex=st([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Mx=st([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ax}=Sx;var X_=wl;function wl(i,t,r,a,h){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=h,i.readFields(Cx,this,t)}function Cx(i,t,r){i==1?t.id=r.readVarint():i==2?function(a,h){for(var p=a.readVarint()+a.pos;a.pos<p;){var _=h._keys[a.readVarint()],g=h._values[a.readVarint()];h.properties[_]=g}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function Ix(i){for(var t,r,a=0,h=0,p=i.length,_=p-1;h<p;_=h++)a+=((r=i[_]).x-(t=i[h]).x)*(t.y+r.y);return a}wl.types=["Unknown","Point","LineString","Polygon"],wl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,a=1,h=0,p=0,_=0,g=[];i.pos<r;){if(h<=0){var b=i.readVarint();a=7&b,h=b>>3}if(h--,a===1||a===2)p+=i.readSVarint(),_+=i.readSVarint(),a===1&&(t&&g.push(t),t=[]),t.push(new A(p,_));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&g.push(t),g},wl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,a=0,h=0,p=0,_=1/0,g=-1/0,b=1/0,S=-1/0;i.pos<t;){if(a<=0){var C=i.readVarint();r=7&C,a=C>>3}if(a--,r===1||r===2)(h+=i.readSVarint())<_&&(_=h),h>g&&(g=h),(p+=i.readSVarint())<b&&(b=p),p>S&&(S=p);else if(r!==7)throw new Error("unknown command "+r)}return[_,b,g,S]},wl.prototype.toGeoJSON=function(i,t,r){var a,h,p=this.extent*Math.pow(2,r),_=this.extent*i,g=this.extent*t,b=this.loadGeometry(),S=wl.types[this.type];function C(R){for(var V=0;V<R.length;V++){var N=R[V];R[V]=[360*(N.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+g)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(a=0;a<b.length;a++)I[a]=b[a][0];C(b=I);break;case 2:for(a=0;a<b.length;a++)C(b[a]);break;case 3:for(b=function(R){var V=R.length;if(V<=1)return[R];for(var N,q,K=[],lt=0;lt<V;lt++){var ut=Ix(R[lt]);ut!==0&&(q===void 0&&(q=ut<0),q===ut<0?(N&&K.push(N),N=[R[lt]]):N.push(R[lt]))}return N&&K.push(N),K}(b),a=0;a<b.length;a++)for(h=0;h<b[a].length;h++)C(b[a][h])}b.length===1?b=b[0]:S="Multi"+S;var P={type:"Feature",geometry:{type:S,coordinates:b},properties:this.properties};return"id"in this&&(P.id=this.id),P};var H_=Y_;function Y_(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(kx,this,t),this.length=this._features.length}function kx(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(a){for(var h=null,p=a.readVarint()+a.pos;a.pos<p;){var _=a.readVarint()>>3;h=_===1?a.readString():_===2?a.readFloat():_===3?a.readDouble():_===4?a.readVarint64():_===5?a.readVarint():_===6?a.readSVarint():_===7?a.readBoolean():null}return h}(r))}function Px(i,t,r){if(i===3){var a=new H_(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}Y_.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new X_(this._pbf,t,this.extent,this._keys,this._values)};var ha={VectorTile:function(i,t){this.layers=i.readFields(Px,{},t)},VectorTileFeature:X_,VectorTileLayer:H_};function od(i,t,r,a){let h=[],p=a===0?(_,g,b,S,C,I)=>{_.push(new A(I,b+(I-g)/(S-g)*(C-b)))}:(_,g,b,S,C,I)=>{_.push(new A(g+(I-b)/(C-b)*(S-g),I))};for(let _ of i){let g=[];for(let b of _){if(b.length<=2)continue;let S=[];for(let P=0;P<b.length-1;P++){let R=b[P].x,V=b[P].y,N=b[P+1].x,q=b[P+1].y,K=a===0?R:V,lt=a===0?N:q;K<t?lt>t&&p(S,R,V,N,q,t):K>r?lt<r&&p(S,R,V,N,q,r):S.push(b[P]),lt<t&&K>=t&&p(S,R,V,N,q,t),lt>r&&K<=r&&p(S,R,V,N,q,r)}let C=b[b.length-1],I=a===0?C.x:C.y;I>=t&&I<=r&&S.push(C),S.length&&(C=S[S.length-1],S[0].x===C.x&&S[0].y===C.y||S.push(S[0]),g.push(S))}g.length&&h.push(g)}return h}let zx=ha.VectorTileFeature.types,Dx=Math.pow(2,13);function eh(i,t,r,a,h,p,_,g){i.emplaceBack((t<<1)+_,(r<<1)+p,(Math.floor(a*Dx)<<1)+h,Math.round(g))}function ih(i,t,r){i.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class K_{constructor(){this.acc=new A(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new A(t.x,t.y),this.max=new A(t.x,t.y))}append(t,r){this.currentPolyCount.edges++,this.acc._add(t);let a=this.min,h=this.max;t.x<a.x?a.x=t.x:t.x>h.x&&(h.x=t.x),t.y<a.y?a.y=t.y:t.y>h.y&&(h.y=t.y),((t.x===0||t.x===we)&&t.x===r.x)!=((t.y===0||t.y===we)&&t.y===r.y)&&this.processBorderOverlap(t,r),r.x<0!=t.x<0&&this.addBorderIntersection(0,de(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>we!=t.x>we&&this.addBorderIntersection(1,de(r.y,t.y,(we-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,de(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>we!=t.y>we&&this.addBorderIntersection(3,de(r.x,t.x,(we-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[t];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;let a=t.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,t.y)}else{let a=t.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,t.x)}}centroid(){let t=this.polyCount.reduce((r,a)=>r+a.edges,0);return t!==0?this.acc.div(t)._round():new A(0,0)}span(){return new A(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0)}}class nh{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new at,this.centroidVertexArray=new sa,this.indexArray=new ee,this.programConfigurations=new oa(t.layers,t.zoom),this.segments=new xi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=t.enableTerrain}populate(t,r,a,h){this.features=[],this.hasPattern=pf("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){let _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/we/(1<<p.z)}(a);for(let{feature:p,id:_,index:g,sourceLayerIndex:b}of t){let S=this.layers[0]._featureFilter.needGeometry,C=aa(p,S);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),C,a))continue;let I={id:_,sourceLayerIndex:b,index:g,geometry:S?C.geometry:xs(p,a,h),properties:p.properties,type:p.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(ff("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,g,a,{},r.availableImages,h),r.featureIndex.insert(p,I.geometry,g,b,this.index,P)}this.sortBorders()}addFeatures(t,r,a,h,p){for(let _ of this.features){let{geometry:g}=_;this.addFeature(_,g,_.index,r,a,h,p)}this.sortBorders()}update(t,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ax),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Mx.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ex.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,a,h,p,_,g){let b=[new A(0,0),new A(we,we)],S=g.projection,C=S.name==="globe",I=this.enableTerrain&&!C?new K_:null;C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new pn);let P=df(r,500);for(let N=P.length-1;N>=0;N--){let q=P[N];(q.length===0||(R=q[0]).every(K=>K.x<=0)||R.every(K=>K.x>=we)||R.every(K=>K.y<=0)||R.every(K=>K.y>=we))&&P.splice(N,1)}var R;let V;if(C){let q=1<<h.z,K=er(h.x/q),lt=er((h.x+1)/q),ut=Gi(h.y/q),ft=Gi((h.y+1)/q);V=function(gt,yt,It,Pt,Bt=0,Ot){let At=[];if(!gt.length||!It||!Pt)return At;let Lt=(ve,Ee)=>{for(let oe of ve)At.push({polygon:oe,bounds:Ee})},Ut=Math.ceil(Math.log2(It)),Xt=Math.ceil(Math.log2(Pt)),Gt=Ut-Xt,Wt=[];for(let ve=0;ve<Math.abs(Gt);ve++)Wt.push(Gt>0?0:1);for(let ve=0;ve<Math.min(Ut,Xt);ve++)Wt.push(0),Wt.push(1);let xe=gt;if(xe=od(xe,yt[0].y-Bt,yt[1].y+Bt,1),xe=od(xe,yt[0].x-Bt,yt[1].x+Bt,0),!xe.length)return At;let Ce=[];for(Wt.length?Ce.push({polygons:xe,bounds:yt,depth:0}):Lt(xe,yt);Ce.length;){let ve=Ce.pop(),Ee=ve.depth,oe=Wt[Ee],Qt=ve.bounds[0],ke=ve.bounds[1],Ne=oe===0?Qt.x:Qt.y,Ci=oe===0?ke.x:ke.y,ni=Ot?Ot(oe,Ne,Ci):.5*(Ne+Ci),Ii=od(ve.polygons,Ne-Bt,ni+Bt,oe),je=od(ve.polygons,ni-Bt,Ci+Bt,oe);if(Ii.length){let De=[Qt,new A(oe===0?ni:ke.x,oe===1?ni:ke.y)];Wt.length>Ee+1?Ce.push({polygons:Ii,bounds:De,depth:Ee+1}):Lt(Ii,De)}if(je.length){let De=[new A(oe===0?ni:Qt.x,oe===1?ni:Qt.y),ke];Wt.length>Ee+1?Ce.push({polygons:je,bounds:De,depth:Ee+1}):Lt(je,De)}}return At}(P,b,Math.ceil((lt-K)/11.25),Math.ceil((ut-ft)/11.25),1,(gt,yt,It)=>{if(gt===0)return .5*(yt+It);{let Pt=Gi((h.y+yt/we)/q);return(ml(.5*(Gi((h.y+It/we)/q)+Pt))*q-h.y)*we}})}else{V=[];for(let N of P)V.push({polygon:N,bounds:b})}for(let N of V){let q=N.polygon,K=0,lt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let It=0;It<q.length;It++){let Pt=q[It];if(Pt.length===0)continue;K+=Pt.length;let Bt=0;I&&I.startRing(Pt[0]);for(let Ot=0;Ot<Pt.length;Ot++){let At=Pt[Ot];if(Ot>=1){let Lt=Pt[Ot-1];if(!Lx(At,Lt,N.bounds)){I&&I.append(At,Lt),lt.vertexLength+4>xi.MAX_VERTEX_ARRAY_LENGTH&&(lt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let Ut=At.sub(Lt)._perp(),Xt=Ut.x/(Math.abs(Ut.x)+Math.abs(Ut.y)),Gt=Ut.y>0?1:0,Wt=Lt.dist(At);Bt+Wt>32768&&(Bt=0),eh(this.layoutVertexArray,At.x,At.y,Xt,Gt,0,0,Bt),eh(this.layoutVertexArray,At.x,At.y,Xt,Gt,0,1,Bt),Bt+=Wt,eh(this.layoutVertexArray,Lt.x,Lt.y,Xt,Gt,0,0,Bt),eh(this.layoutVertexArray,Lt.x,Lt.y,Xt,Gt,0,1,Bt);let xe=lt.vertexLength;if(this.indexArray.emplaceBack(xe,xe+2,xe+1),this.indexArray.emplaceBack(xe+1,xe+2,xe+3),lt.vertexLength+=4,lt.primitiveLength+=2,C){let Ce=this.layoutVertexExtArray,ve=S.projectTilePoint(At.x,At.y,h),Ee=S.projectTilePoint(Lt.x,Lt.y,h),oe=S.upVector(h,At.x,At.y),Qt=S.upVector(h,Lt.x,Lt.y);ih(Ce,ve,oe),ih(Ce,ve,oe),ih(Ce,Ee,Qt),ih(Ce,Ee,Qt)}}}}}if(lt.vertexLength+K>xi.MAX_VERTEX_ARRAY_LENGTH&&(lt=this.segments.prepareSegment(K,this.layoutVertexArray,this.indexArray)),zx[t.type]!=="Polygon")continue;let ut=[],ft=[],gt=lt.vertexLength;for(let It=0;It<q.length;It++){let Pt=q[It];if(Pt.length!==0){Pt!==q[0]&&ft.push(ut.length/2);for(let Bt=0;Bt<Pt.length;Bt++){let Ot=Pt[Bt];eh(this.layoutVertexArray,Ot.x,Ot.y,0,0,1,1,0),ut.push(Ot.x),ut.push(Ot.y),I&&I.currentPolyCount.top++,C&&ih(this.layoutVertexExtArray,S.projectTilePoint(Ot.x,Ot.y,h),S.upVector(h,Ot.x,Ot.y))}}}let yt=td(ut,ft);for(let It=0;It<yt.length;It+=3)this.indexArray.emplaceBack(gt+yt[It],gt+yt[It+2],gt+yt[It+1]);lt.primitiveLength+=yt.length/3,lt.vertexLength+=K}if(I&&I.polyCount.length>0){if(I.borders){I.vertexArrayOffset=this.centroidVertexArray.length;let N=I.borders,q=this.featuresOnBorder.push(I)-1;for(let K=0;K<4;K++)N[K][0]!==Number.MAX_VALUE&&this.borders[K].push(q)}this.encodeCentroid(I.borders?void 0:I.centroid(),I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,p,_,h)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((r,a)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[a].borders[t][0])}encodeCentroid(t,r,a=!0){let h,p;if(t)if(t.y!==0){let g=r.span()._mult(this.tileToMeter);h=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(g.x/10)),p=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else h=Math.ceil(7*(t.x+450)),p=0;else h=0,p=+a;let _=a?this.centroidVertexArray.length:r.vertexArrayOffset;for(let g of r.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let b=0;b<2*g.edges;b++)this.centroidVertexArray.emplace(_++,0,p),this.centroidVertexArray.emplace(_++,h,p);for(let b=0;b<g.top;b++)this.centroidVertexArray.emplace(_++,h,p)}}}function Lx(i,t,r){return i.x===t.x&&(i.x<r[0].x||i.x>r[1].x)||i.y===t.y&&(i.y<r[0].y||i.y>r[1].y)}te(nh,"FillExtrusionBucket",{omit:["layers","features"]}),te(K_,"PartMetadata");var Rx={paint:new O({"fill-extrusion-opacity":new T(Et["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new M(Et["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new T(Et["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new T(Et["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new k(Et["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new M(Et["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new M(Et["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new T(Et["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function rh(i,t){return i.x*t.x+i.y*t.y}function J_(i,t){if(i.length===1){let r=0,a=t[r++],h;for(;!h||a.equals(h);)if(h=t[r++],!h)return 1/0;for(;r<t.length;r++){let p=t[r],_=i[0],g=h.sub(a),b=p.sub(a),S=_.sub(a),C=rh(g,g),I=rh(g,b),P=rh(b,b),R=rh(S,g),V=rh(S,b),N=C*P-I*I,q=(P*R-I*V)/N,K=(C*V-I*R)/N,lt=a.z*(1-q-K)+h.z*q+p.z*K;if(isFinite(lt))return lt}return 1/0}{let r=1/0;for(let a of t)r=Math.min(r,a.z);return r}}function Q_(i){let t=new A(i[0],i[1]);return t.z=i[2],t}function Bx(i,t,r,a,h,p,_,g){let b=_*h.getElevationAt(i,t,!0,!0),S=p[0]!==0,C=S?p[1]===0?_*(p[0]/7-450):_*function(I,P,R){let V=Math.floor(P[0]/8),N=Math.floor(P[1]/8),q=10*(P[0]-8*V),K=10*(P[1]-8*N),lt=I.getElevationAt(V,N,!0,!0),ut=I.getMeterToDEM(R),ft=Math.floor(.5*(q*ut-1)),gt=Math.floor(.5*(K*ut-1)),yt=I.tileCoordToPixel(V,N),It=2*ft+1,Pt=2*gt+1,Bt=function(Gt,Wt,xe,Ce,ve){return[Gt.getElevationAtPixel(Wt,xe,!0),Gt.getElevationAtPixel(Wt+ve,xe,!0),Gt.getElevationAtPixel(Wt,xe+ve,!0),Gt.getElevationAtPixel(Wt+Ce,xe+ve,!0)]}(I,yt.x-ft,yt.y-gt,It,Pt),Ot=Math.abs(Bt[0]-Bt[1]),At=Math.abs(Bt[2]-Bt[3]),Lt=Math.abs(Bt[0]-Bt[2])+Math.abs(Bt[1]-Bt[3]),Ut=Math.min(.25,.5*ut*(Ot+At)/It),Xt=Math.min(.25,.5*ut*Lt/Pt);return lt+Math.max(Ut*q,Xt*K)}(h,p,g):b;return{base:b+(r===0)?-1:r,top:S?Math.max(C+a,b+r+2):b+a}}let Fx=st([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ox}=Fx,Vx=st([{name:"a_packed",components:3,type:"Float32"}]),{members:Zx}=Vx,Ux=ha.VectorTileFeature.types,Nx=Math.cos(Math.PI/180*37.5);class ad{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new tt,this.layoutVertexArray2=new $t,this.indexArray=new ee,this.programConfigurations=new oa(t.layers,t.zoom),this.segments=new xi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a,h){this.hasPattern=pf("line",this.layers,r);let p=this.layers[0].layout.get("line-sort-key"),_=[];for(let{feature:C,id:I,index:P,sourceLayerIndex:R}of t){let V=this.layers[0]._featureFilter.needGeometry,N=aa(C,V);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),N,a))continue;let q=p?p.evaluate(N,{},a):void 0,K={id:I,properties:C.properties,type:C.type,sourceLayerIndex:R,index:P,geometry:V?N.geometry:xs(C,a,h),patterns:{},sortKey:q};_.push(K)}p&&_.sort((C,I)=>C.sortKey-I.sortKey);let{lineAtlas:g,featureIndex:b}=r,S=this.addConstantDashes(g);for(let C of _){let{geometry:I,index:P,sourceLayerIndex:R}=C;if(S&&this.addFeatureDashes(C,g),this.hasPattern){let V=ff("line",this.layers,C,this.zoom,r);this.patternFeatures.push(V)}else this.addFeature(C,I,P,a,g.positions,r.availableImages);b.insert(t[P].feature,I,P,R,this.index)}}addConstantDashes(t){let r=!1;for(let a of this.layers){let h=a.paint.get("line-dasharray").value,p=a.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")r=!0;else{let _=p.value,g=h.value;if(!g)continue;t.addDash(g.from,_),t.addDash(g.to,_),g.other&&t.addDash(g.other,_)}}return r}addFeatureDashes(t,r){let a=this.zoom;for(let h of this.layers){let p=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(p.kind==="constant"&&_.kind==="constant")continue;let g,b,S,C,I,P;if(p.kind==="constant"){let q=p.value;if(!q)continue;g=q.other||q.to,b=q.to,S=q.from}else g=p.evaluate({zoom:a-1},t),b=p.evaluate({zoom:a},t),S=p.evaluate({zoom:a+1},t);_.kind==="constant"?C=I=P=_.value:(C=_.evaluate({zoom:a-1},t),I=_.evaluate({zoom:a},t),P=_.evaluate({zoom:a+1},t)),r.addDash(g,C),r.addDash(b,I),r.addDash(S,P);let R=r.getKey(g,C),V=r.getKey(b,I),N=r.getKey(S,P);t.patterns[h.id]={min:R,mid:V,max:N}}}update(t,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a,h)}addFeatures(t,r,a,h,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Zx)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ox),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,a,h,p,_){let g=this.layers[0].layout,b=g.get("line-join").evaluate(t,{}),S=g.get("line-cap").evaluate(t,{}),C=g.get("line-miter-limit"),I=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let P of r)this.addLine(P,t,b,S,C,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,p,_,h)}addLine(t,r,a,h,p,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<t.length-1;K++)this.totalDistance+=t[K].dist(t[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let g=Ux[r.type]==="Polygon",b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let S=0;for(;S<b-1&&t[S].equals(t[S+1]);)S++;if(b<(g?3:2))return;a==="bevel"&&(p=1.05);let C=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray),P,R,V,N,q;this.e1=this.e2=-1,g&&(P=t[b-2],q=t[S].sub(P)._unit()._perp());for(let K=S;K<b;K++){if(V=K===b-1?g?t[S+1]:void 0:t[K+1],V&&t[K].equals(V))continue;q&&(N=q),P&&(R=P),P=t[K],q=V?V.sub(P)._unit()._perp():N,N=N||q;let lt=N.add(q);lt.x===0&&lt.y===0||lt._unit();let ut=N.x*q.x+N.y*q.y,ft=lt.x*q.x+lt.y*q.y,gt=ft!==0?1/ft:1/0,yt=2*Math.sqrt(2-2*ft),It=ft<Nx&&R&&V,Pt=N.x*q.y-N.y*q.x>0;if(It&&K>S){let At=P.dist(R);if(At>2*C){let Lt=P.sub(P.sub(R)._mult(C/At)._round());this.updateDistance(R,Lt),this.addCurrentVertex(Lt,N,0,0,I),R=Lt}}let Bt=R&&V,Ot=Bt?a:g?"butt":h;if(Bt&&Ot==="round"&&(gt<_?Ot="miter":gt<=2&&(Ot="fakeround")),Ot==="miter"&&gt>p&&(Ot="bevel"),Ot==="bevel"&&(gt>2&&(Ot="flipbevel"),gt<p&&(Ot="miter")),R&&this.updateDistance(R,P),Ot==="miter")lt._mult(gt),this.addCurrentVertex(P,lt,0,0,I);else if(Ot==="flipbevel"){if(gt>100)lt=q.mult(-1);else{let At=gt*N.add(q).mag()/N.sub(q).mag();lt._perp()._mult(At*(Pt?-1:1))}this.addCurrentVertex(P,lt,0,0,I),this.addCurrentVertex(P,lt.mult(-1),0,0,I)}else if(Ot==="bevel"||Ot==="fakeround"){let At=-Math.sqrt(gt*gt-1),Lt=Pt?At:0,Ut=Pt?0:At;if(R&&this.addCurrentVertex(P,N,Lt,Ut,I),Ot==="fakeround"){let Xt=Math.round(180*yt/Math.PI/20);for(let Gt=1;Gt<Xt;Gt++){let Wt=Gt/Xt;if(Wt!==.5){let Ce=Wt-.5;Wt+=Wt*Ce*(Wt-1)*((1.0904+ut*(ut*(3.55645-1.43519*ut)-3.2452))*Ce*Ce+(.848013+ut*(.215638*ut-1.06021)))}let xe=q.sub(N)._mult(Wt)._add(N)._unit()._mult(Pt?-1:1);this.addHalfVertex(P,xe.x,xe.y,!1,Pt,0,I)}}V&&this.addCurrentVertex(P,q,-Lt,-Ut,I)}else if(Ot==="butt")this.addCurrentVertex(P,lt,0,0,I);else if(Ot==="square"){let At=R?1:-1;R||this.addCurrentVertex(P,lt,At,At,I),this.addCurrentVertex(P,lt,0,0,I),R&&this.addCurrentVertex(P,lt,At,At,I)}else Ot==="round"&&(R&&(this.addCurrentVertex(P,N,0,0,I),this.addCurrentVertex(P,N,1,1,I,!0)),V&&(this.addCurrentVertex(P,q,-1,-1,I,!0),this.addCurrentVertex(P,q,0,0,I)));if(It&&K<b-1){let At=P.dist(V);if(At>2*C){let Lt=P.add(V.sub(P)._mult(C/At)._round());this.updateDistance(P,Lt),this.addCurrentVertex(Lt,q,0,0,I),P=Lt}}}}addCurrentVertex(t,r,a,h,p,_=!1){let g=r.y*h-r.x,b=-r.y-r.x*h;this.addHalfVertex(t,r.x+r.y*a,r.y-r.x*a,_,!1,a,p),this.addHalfVertex(t,g,b,_,!0,-h,p)}addHalfVertex({x:t,y:r},a,h,p,_,g,b){this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(r<<1)+(_?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);let S=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),b.primitiveLength++),_?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){let t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}te(ad,"LineBucket",{omit:["layers","patternFeatures"]});let jx=new O({"line-cap":new M(Et.layout_line["line-cap"]),"line-join":new M(Et.layout_line["line-join"]),"line-miter-limit":new T(Et.layout_line["line-miter-limit"]),"line-round-limit":new T(Et.layout_line["line-round-limit"]),"line-sort-key":new M(Et.layout_line["line-sort-key"])});var tg={paint:new O({"line-opacity":new M(Et.paint_line["line-opacity"]),"line-color":new M(Et.paint_line["line-color"]),"line-translate":new T(Et.paint_line["line-translate"]),"line-translate-anchor":new T(Et.paint_line["line-translate-anchor"]),"line-width":new M(Et.paint_line["line-width"]),"line-gap-width":new M(Et.paint_line["line-gap-width"]),"line-offset":new M(Et.paint_line["line-offset"]),"line-blur":new M(Et.paint_line["line-blur"]),"line-dasharray":new k(Et.paint_line["line-dasharray"]),"line-pattern":new k(Et.paint_line["line-pattern"]),"line-gradient":new L(Et.paint_line["line-gradient"])}),layout:jx};let eg=new class extends M{possiblyEvaluate(i,t){return t=new ii(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(i,t)}evaluate(i,t,r,a){return t=jt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(i,t,r,a)}}(tg.paint.properties["line-width"].specification);function ig(i,t){return t>0?t+2*i:i}eg.useIntegerZoom=!0;let Gx=st([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),$x=st([{name:"a_projected_pos",components:3,type:"Float32"}],4);st([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let qx=st([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Wx=st([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);st([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let ng=st([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xx=st([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);st([{name:"triangle",components:3,type:"Uint16"}]),st([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),st([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),st([{type:"Float32",name:"offsetX"}]),st([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var $i=24;let Zr=128;function mf(i,t){let{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ii(i+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:h}=r,p=0;for(;p<a.length&&a[p]<=i;)p++;p=Math.max(0,p-1);let _=p;for(;_<a.length&&a[_]<i+1;)_++;_=Math.min(a.length-1,_);let g=a[p],b=a[_];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:g,maxZoom:b,minSize:r.evaluate(new ii(g)),maxSize:r.evaluate(new ii(b)),interpolationType:h}}}function ld(i,{uSize:t,uSizeT:r},{lowerSize:a,upperSize:h}){return i.kind==="source"?a/Zr:i.kind==="composite"?de(a/Zr,h/Zr,r):t}function Tl(i,t){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:h,minZoom:p,maxZoom:_}=i,g=h?_t(hn.interpolationFactor(h,t,p,_),0,1):0;i.kind==="camera"?a=de(i.minSize,i.maxSize,g):r=g}return{uSizeT:r,uSize:a}}var Hx=Object.freeze({__proto__:null,getSizeData:mf,evaluateSizeForFeature:ld,evaluateSizeForZoom:Tl,SIZE_PACK_FACTOR:Zr});function Yx(i,t,r){return i.sections.forEach(a=>{a.text=function(h,p,_){let g=p.layout.get("text-transform").evaluate(_,{});return g==="uppercase"?h=h.toLocaleUpperCase():g==="lowercase"&&(h=h.toLocaleLowerCase()),Sn.applyArabicShaping&&(h=Sn.applyArabicShaping(h)),h}(a.text,t,r)}),i}let sh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Kx(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function Jx(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var rg=function(i,t,r,a,h){var p,_,g=8*h-a-1,b=(1<<g)-1,S=b>>1,C=-7,I=r?h-1:0,P=r?-1:1,R=i[t+I];for(I+=P,p=R&(1<<-C)-1,R>>=-C,C+=g;C>0;p=256*p+i[t+I],I+=P,C-=8);for(_=p&(1<<-C)-1,p>>=-C,C+=a;C>0;_=256*_+i[t+I],I+=P,C-=8);if(p===0)p=1-S;else{if(p===b)return _?NaN:1/0*(R?-1:1);_+=Math.pow(2,a),p-=S}return(R?-1:1)*_*Math.pow(2,p-a)},sg=function(i,t,r,a,h,p){var _,g,b,S=8*p-h-1,C=(1<<S)-1,I=C>>1,P=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=a?0:p-1,V=a?1:-1,N=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(g=isNaN(t)?1:0,_=C):(_=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-_))<1&&(_--,b*=2),(t+=_+I>=1?P/b:P*Math.pow(2,1-I))*b>=2&&(_++,b/=2),_+I>=C?(g=0,_=C):_+I>=1?(g=(t*b-1)*Math.pow(2,h),_+=I):(g=t*Math.pow(2,I-1)*Math.pow(2,h),_=0));h>=8;i[r+R]=255&g,R+=V,g/=256,h-=8);for(_=_<<h|g,S+=h;S>0;i[r+R]=255&_,R+=V,_/=256,S-=8);i[r+R-V]|=128*N},oh=ti;function ti(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ti.Varint=0,ti.Fixed64=1,ti.Bytes=2,ti.Fixed32=5;var _f=4294967296,og=1/_f,ag=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function bs(i){return i.type===ti.Bytes?i.readVarint()+i.pos:i.pos+1}function Sl(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function lg(i,t,r){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(a);for(var h=r.pos-1;h>=i;h--)r.buf[h+a]=r.buf[h]}function Qx(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function tv(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function ev(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function iv(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function nv(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function rv(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function sv(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function ov(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function av(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function cd(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function El(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function cg(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}function lv(i,t,r){t.glyphs=[],i===1&&r.readMessage(cv,t)}function cv(i,t,r){if(i===3){let{id:a,bitmap:h,width:p,height:_,left:g,top:b,advance:S}=r.readMessage(hv,{});t.glyphs.push({id:a,bitmap:new vs({width:p+6,height:_+6},h),metrics:{width:p,height:_,left:g,top:b,advance:S}})}else i===4?t.ascender=r.readSVarint():i===5&&(t.descender=r.readSVarint())}function hv(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}function gf(i){let t=0,r=0;for(let _ of i)t+=_.w*_.h,r=Math.max(r,_.w);i.sort((_,g)=>g.h-_.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],h=0,p=0;for(let _ of i)for(let g=a.length-1;g>=0;g--){let b=a[g];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,p=Math.max(p,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===b.w&&_.h===b.h){let S=a.pop();g<a.length&&(a[g]=S)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(a.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:h,h:p,fill:t/(h*p)||0}}ti.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),h=a>>3,p=this.pos;this.type=7&a,i(h,t,this),this.pos===p&&this.skip(a)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=cd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=cg(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=cd(this.buf,this.pos)+cd(this.buf,this.pos+4)*_f;return this.pos+=8,i},readSFixed64:function(){var i=cd(this.buf,this.pos)+cg(this.buf,this.pos+4)*_f;return this.pos+=8,i},readFloat:function(){var i=rg(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=rg(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,a=this.buf;return t=127&(r=a[this.pos++]),r<128?t:(t|=(127&(r=a[this.pos++]))<<7,r<128?t:(t|=(127&(r=a[this.pos++]))<<14,r<128?t:(t|=(127&(r=a[this.pos++]))<<21,r<128?t:function(h,p,_){var g,b,S=_.buf;if(g=(112&(b=S[_.pos++]))>>4,b<128||(g|=(127&(b=S[_.pos++]))<<3,b<128)||(g|=(127&(b=S[_.pos++]))<<10,b<128)||(g|=(127&(b=S[_.pos++]))<<17,b<128)||(g|=(127&(b=S[_.pos++]))<<24,b<128)||(g|=(1&(b=S[_.pos++]))<<31,b<128))return Sl(h,g,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&ag?function(r,a,h){return ag.decode(r.subarray(a,h))}(this.buf,t,i):function(r,a,h){for(var p="",_=a;_<h;){var g,b,S,C=r[_],I=null,P=C>239?4:C>223?3:C>191?2:1;if(_+P>h)break;P===1?C<128&&(I=C):P===2?(192&(g=r[_+1]))==128&&(I=(31&C)<<6|63&g)<=127&&(I=null):P===3?(b=r[_+2],(192&(g=r[_+1]))==128&&(192&b)==128&&((I=(15&C)<<12|(63&g)<<6|63&b)<=2047||I>=55296&&I<=57343)&&(I=null)):P===4&&(b=r[_+2],S=r[_+3],(192&(g=r[_+1]))==128&&(192&b)==128&&(192&S)==128&&((I=(15&C)<<18|(63&g)<<12|(63&b)<<6|63&S)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,P=1):I>65535&&(I-=65536,p+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),p+=String.fromCharCode(I),_+=P}return p}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==ti.Bytes)return i.push(this.readVarint(t));var r=bs(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==ti.Bytes)return i.push(this.readSVarint());var t=bs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ti.Bytes)return i.push(this.readBoolean());var t=bs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ti.Bytes)return i.push(this.readFloat());var t=bs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ti.Bytes)return i.push(this.readDouble());var t=bs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ti.Bytes)return i.push(this.readFixed32());var t=bs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ti.Bytes)return i.push(this.readSFixed32());var t=bs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ti.Bytes)return i.push(this.readFixed64());var t=bs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ti.Bytes)return i.push(this.readSFixed64());var t=bs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===ti.Varint)for(;this.buf[this.pos++]>127;);else if(t===ti.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ti.Fixed32)this.pos+=4;else{if(t!==ti.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),El(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),El(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),El(this.buf,-1&i,this.pos),El(this.buf,Math.floor(i*og),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),El(this.buf,-1&i,this.pos),El(this.buf,Math.floor(i*og),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var a,h;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(p,_,g){g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,g.buf[g.pos]=127&(p>>>=7)}(a,0,r),function(p,_){var g=(7&p)<<4;_.buf[_.pos++]|=g|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(h,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(a,h,p){for(var _,g,b=0;b<h.length;b++){if((_=h.charCodeAt(b))>55295&&_<57344){if(!g){_>56319||b+1===h.length?(a[p++]=239,a[p++]=191,a[p++]=189):g=_;continue}if(_<56320){a[p++]=239,a[p++]=191,a[p++]=189,g=_;continue}_=g-55296<<10|_-56320|65536,g=null}else g&&(a[p++]=239,a[p++]=191,a[p++]=189,g=null);_<128?a[p++]=_:(_<2048?a[p++]=_>>6|192:(_<65536?a[p++]=_>>12|224:(a[p++]=_>>18|240,a[p++]=_>>12&63|128),a[p++]=_>>6&63|128),a[p++]=63&_|128)}return p}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&lg(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),sg(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),sg(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var a=this.pos-r;a>=128&&lg(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,t,r){this.writeTag(i,ti.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Qx,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,tv,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,nv,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,ev,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,iv,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,rv,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,sv,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,ov,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,av,t)},writeBytesField:function(i,t){this.writeTag(i,ti.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,ti.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,ti.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,ti.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,ti.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,ti.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,ti.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,ti.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,ti.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,ti.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,Boolean(t))}};class yf{constructor(t,{pixelRatio:r,version:a,stretchX:h,stretchY:p,content:_}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=h,this.stretchY=p,this.content=_,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class hg{constructor(t,r){let a={},h={};this.haveRenderCallbacks=[];let p=[];this.addImages(t,a,p),this.addImages(r,h,p);let{w:_,h:g}=gf(p),b=new An({width:_||1,height:g||1});for(let S in t){let C=t[S],I=a[S].paddedRect;An.copy(C.data,b,{x:0,y:0},{x:I.x+1,y:I.y+1},C.data)}for(let S in r){let C=r[S],I=h[S].paddedRect,P=I.x+1,R=I.y+1,V=C.data.width,N=C.data.height;An.copy(C.data,b,{x:0,y:0},{x:P,y:R},C.data),An.copy(C.data,b,{x:0,y:N-1},{x:P,y:R-1},{width:V,height:1}),An.copy(C.data,b,{x:0,y:0},{x:P,y:R+N},{width:V,height:1}),An.copy(C.data,b,{x:V-1,y:0},{x:P-1,y:R},{width:1,height:N}),An.copy(C.data,b,{x:0,y:0},{x:P+V,y:R},{width:1,height:N})}this.image=b,this.iconPositions=a,this.patternPositions=h}addImages(t,r,a){for(let h in t){let p=t[h],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};a.push(_),r[h]=new yf(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>t.hasImage(a)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),r)}patchUpdatedImage(t,r,a){if(!t||!r||t.version===r.version)return;t.version=r.version;let[h,p]=t.tl;a.update(r.data,void 0,{x:h,y:p})}}te(yf,"ImagePosition"),te(hg,"ImageAtlas");let Xn={horizontal:1,vertical:2,horizontalOnly:3};class ah{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){let a=new ah;return a.scale=t||1,a.fontStack=r,a}static forImage(t){let r=new ah;return r.imageName=t,r}}class Ml{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){let a=new Ml;for(let h=0;h<t.sections.length;h++){let p=t.sections[h];p.image?a.addImageSection(p):a.addTextSection(p,r)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(r,a){let h="";for(let p=0;p<r.length;p++){let _=r.charCodeAt(p+1)||null,g=r.charCodeAt(p-1)||null;h+=!a&&(_&&ul(_)&&!sh[r[p+1]]||g&&ul(g)&&!sh[r[p-1]])||!sh[r[p]]?r[p]:sh[r[p]]}return h}(this.text,t)}trim(){let t=0;for(let a=0;a<this.text.length&&hd[this.text.charCodeAt(a)];a++)t++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&hd[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){let a=new Ml;return a.text=this.text.substring(t,r),a.sectionIndex=this.sectionIndex.slice(t,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(ah.forText(t.scale,t.fontStack||r));let a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){let r=t.image?t.image.name:"";if(r.length===0)return void qe("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(ah.forImage(r)),this.sectionIndex.push(this.sections.length-1)):qe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xf(i,t,r,a,h,p,_,g,b,S,C,I,P,R,V,N){let q=Ml.fromFeature(i,h),K;I===Xn.vertical&&q.verticalizePunctuation(P);let{processBidirectionalText:lt,processStyledBidirectionalText:ut}=Sn;if(lt&&q.sections.length===1){K=[];let yt=lt(q.toString(),vf(q,S,p,t,a,R,V));for(let It of yt){let Pt=new Ml;Pt.text=It,Pt.sections=q.sections;for(let Bt=0;Bt<It.length;Bt++)Pt.sectionIndex.push(0);K.push(Pt)}}else if(ut){K=[];let yt=ut(q.text,q.sectionIndex,vf(q,S,p,t,a,R,V));for(let It of yt){let Pt=new Ml;Pt.text=It[0],Pt.sectionIndex=It[1],Pt.sections=q.sections,K.push(Pt)}}else K=function(yt,It){let Pt=[],Bt=yt.text,Ot=0;for(let At of It)Pt.push(yt.substring(Ot,At)),Ot=At;return Ot<Bt.length&&Pt.push(yt.substring(Ot,Bt.length)),Pt}(q,vf(q,S,p,t,a,R,V));let ft=[],gt={positionedLines:ft,text:q.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(yt,It,Pt,Bt,Ot,At,Lt,Ut,Xt,Gt,Wt,xe){let Ce=0,ve=0,Ee=0,oe=Ut==="right"?1:Ut==="left"?0:.5,Qt=!1;for(let je of Ot){let De=je.getSections();for(let Je of De){if(Je.imageName)continue;let fi=It[Je.fontStack];if(fi&&(Qt=fi.ascender!==void 0&&fi.descender!==void 0,!Qt))break}if(!Qt)break}let ke=0;for(let je of Ot){je.trim();let De=je.getMaxScale(),Je=(De-1)*$i,fi={positionedGlyphs:[],lineOffset:0};yt.positionedLines[ke]=fi;let vi=fi.positionedGlyphs,ki=0;if(!je.length()){ve+=At,++ke;continue}let Li=0,kn=0;for(let Qe=0;Qe<je.length();Qe++){let nn=je.getSection(Qe),Pn=je.getSectionIndex(Qe),Vi=je.getCharCode(Qe),Ri=nn.scale,oi=null,ri=null,gn=null,rn=$i,Ei=0,sn=!(Xt===Xn.horizontal||!Wt&&!hl(Vi)||Wt&&(hd[Vi]||(Ne=Vi,ku(Ne)||sl(Ne)||Qo(Ne)||Bc(Ne)||ll(Ne))));if(nn.imageName){let Yi=Bt[nn.imageName];if(!Yi)continue;gn=nn.imageName,yt.iconsInText=yt.iconsInText||!0,ri=Yi.paddedRect;let Bi=Yi.displaySize;Ri=Ri*$i/xe,oi={width:Bi[0],height:Bi[1],left:1,top:-3,advance:sn?Bi[1]:Bi[0],localGlyph:!1},Ei=Qt?-oi.height*Ri:De*$i-17-Bi[1]*Ri,rn=oi.advance;let nr=(sn?Bi[0]:Bi[1])*Ri-$i*De;nr>0&&nr>ki&&(ki=nr)}else{let Yi=Pt[nn.fontStack];if(!Yi)continue;Yi[Vi]&&(ri=Yi[Vi]);let Bi=It[nn.fontStack];if(!Bi)continue;let nr=Bi.glyphs[Vi];if(!nr)continue;if(oi=nr.metrics,rn=Vi!==8203?$i:0,Qt){let mo=Bi.ascender!==void 0?Math.abs(Bi.ascender):0,gh=Bi.descender!==void 0?Math.abs(Bi.descender):0,yh=(mo+gh)*Ri;Li<yh&&(Li=yh,kn=(mo-gh)/2*Ri),Ei=-mo*Ri}else Ei=(De-Ri)*$i-17}sn?(yt.verticalizable=!0,vi.push({glyph:Vi,imageName:gn,x:Ce,y:ve+Ei,vertical:sn,scale:Ri,localGlyph:oi.localGlyph,fontStack:nn.fontStack,sectionIndex:Pn,metrics:oi,rect:ri}),Ce+=rn*Ri+Gt):(vi.push({glyph:Vi,imageName:gn,x:Ce,y:ve+Ei,vertical:sn,scale:Ri,localGlyph:oi.localGlyph,fontStack:nn.fontStack,sectionIndex:Pn,metrics:oi,rect:ri}),Ce+=oi.advance*Ri+Gt)}vi.length!==0&&(Ee=Math.max(Ce-Gt,Ee),Qt?mg(vi,oe,ki,kn,At*De/2):mg(vi,oe,ki,0,At/2)),Ce=0;let _n=At*De+ki;fi.lineOffset=Math.max(ki,Je),ve+=_n,++ke}var Ne;let Ci=ve,{horizontalAlign:ni,verticalAlign:Ii}=bf(Lt);(function(je,De,Je,fi,vi,ki){let Li=(De-Je)*vi,kn=-ki*fi;for(let _n of je)for(let Qe of _n.positionedGlyphs)Qe.x+=Li,Qe.y+=kn})(yt.positionedLines,oe,ni,Ii,Ee,Ci),yt.top+=-Ii*Ci,yt.bottom=yt.top+Ci,yt.left+=-ni*Ee,yt.right=yt.left+Ee,yt.hasBaseline=Qt}(gt,t,r,a,K,_,g,b,I,S,P,N),!function(yt){for(let It of yt)if(It.positionedGlyphs.length!==0)return!1;return!0}(ft)&&gt}let hd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ug(i,t,r,a,h,p){if(t.imageName){let _=a[t.imageName];return _?_.displaySize[0]*t.scale*$i/p+h:0}{let _=r[t.fontStack],g=_&&_.glyphs[i];return g?g.metrics.advance*t.scale+h:0}}function dg(i,t,r,a){let h=Math.pow(i-t,2);return a?i<t?h/2:2*h:h+Math.abs(r)*r}function dv(i,t,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function pg(i,t,r,a,h,p){let _=null,g=dg(t,r,h,p);for(let b of a){let S=dg(t-b.x,r,h,p)+b.badness;S<=g&&(_=b,g=S)}return{index:i,x:t,priorBreak:_,badness:g}}function fg(i){return i?fg(i.priorBreak).concat(i.index):[]}function vf(i,t,r,a,h,p,_){if(p!=="point")return[];if(!i)return[];let g=[],b=function(P,R,V,N,q,K){let lt=0;for(let ut=0;ut<P.length();ut++){let ft=P.getSection(ut);lt+=ug(P.getCharCode(ut),ft,N,q,R,K)}return lt/Math.max(1,Math.ceil(lt/V))}(i,t,r,a,h,_),S=i.text.indexOf("\u200B")>=0,C=0;for(let P=0;P<i.length();P++){let R=i.getSection(P),V=i.getCharCode(P);if(hd[V]||(C+=ug(V,R,a,h,t,_)),P<i.length()-1){let N=!((I=V)<11904||!(Du(I)||zu(I)||Qs(I)||ea(I)||Bu(I)||zc(I)||Lu(I)||ol(I)||Fu(I)||Rc(I)||Ru(I)||Fc(I)||ta(I)||Dc(I)||Pu(I)||Lc(I)||al(I)||Uu(I)||Vu(I)||Ou(I)));(uv[V]||N||R.imageName)&&g.push(pg(P+1,C,b,g,dv(V,i.getCharCode(P+1),N&&S),!1))}}var I;return fg(pg(i.length(),C,b,g,0,!0))}function bf(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function mg(i,t,r,a,h){if(!(t||r||a||h))return;let p=i.length-1,_=i[p],g=(_.x+_.metrics.advance*_.scale)*t;for(let b=0;b<=p;b++)i[b].x-=g,i[b].y+=r+a+h}function pv(i,t,r){let{horizontalAlign:a,verticalAlign:h}=bf(r),p=t[0]-i.displaySize[0]*a,_=t[1]-i.displaySize[1]*h;return{image:i,top:_,bottom:_+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function _g(i,t,r,a,h,p){let _=i.image,g;if(_.content){let q=_.content,K=_.pixelRatio||1;g=[q[0]/K,q[1]/K,_.displaySize[0]-q[2]/K,_.displaySize[1]-q[3]/K]}let b=t.left*p,S=t.right*p,C,I,P,R;r==="width"||r==="both"?(R=h[0]+b-a[3],I=h[0]+S+a[1]):(R=h[0]+(b+S-_.displaySize[0])/2,I=R+_.displaySize[0]);let V=t.top*p,N=t.bottom*p;return r==="height"||r==="both"?(C=h[1]+V-a[0],P=h[1]+N+a[2]):(C=h[1]+(V+N-_.displaySize[1])/2,P=C+_.displaySize[1]),{image:_,top:C,right:I,bottom:P,left:R,collisionPadding:g}}class ws extends A{constructor(t,r,a,h,p){super(t,r),this.angle=h,this.z=a,p!==void 0&&(this.segment=p)}clone(){return new ws(this.x,this.y,this.z,this.angle,this.segment)}}function gg(i,t,r,a,h){if(t.segment===void 0)return!0;let p=t,_=t.segment+1,g=0;for(;g>-r/2;){if(_--,_<0)return!1;g-=i[_].dist(p),p=i[_]}g+=i[_].dist(i[_+1]),_++;let b=[],S=0;for(;g<r/2;){let C=i[_],I=i[_+1];if(!I)return!1;let P=i[_-1].angleTo(C)-C.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:g,angleDelta:P}),S+=P;g-b[0].distance>a;)S-=b.shift().angleDelta;if(S>h)return!1;_++,g+=C.dist(I)}return!0}function yg(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function xg(i,t,r){return i?.6*t*r:0}function vg(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function fv(i,t,r,a,h,p){let _=xg(r,h,p),g=vg(r,a)*p,b=0,S=yg(i)/2;for(let C=0;C<i.length-1;C++){let I=i[C],P=i[C+1],R=I.dist(P);if(b+R>S){let V=(S-b)/R,N=de(I.x,P.x,V),q=de(I.y,P.y,V),K=new ws(N,q,0,P.angleTo(I),C);return!_||gg(i,K,g,_,t)?K:void 0}b+=R}}function mv(i,t,r,a,h,p,_,g,b){let S=xg(a,p,_),C=vg(a,h),I=C*_,P=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return t-I<t/4&&(t=I+t/4),bg(i,P?t/2*g%t:(C/2+2*p)*_*g%t,t,S,r,I,P,!1,b)}function bg(i,t,r,a,h,p,_,g,b){let S=p/2,C=yg(i),I=0,P=t-r,R=[];for(let V=0;V<i.length-1;V++){let N=i[V],q=i[V+1],K=N.dist(q),lt=q.angleTo(N);for(;P+r<I+K;){P+=r;let ut=(P-I)/K,ft=de(N.x,q.x,ut),gt=de(N.y,q.y,ut);if(ft>=0&&ft<b&&gt>=0&&gt<b&&P-S>=0&&P+S<=C){let yt=new ws(ft,gt,0,lt,V);yt._round(),a&&!gg(i,yt,p,a,h)||R.push(yt)}}I+=K}return g||R.length||_||(R=bg(i,I/2,r,a,h,p,_,!0,b)),R}function wg(i,t,r,a,h){let p=[];for(let _=0;_<i.length;_++){let g=i[_],b;for(let S=0;S<g.length-1;S++){let C=g[S],I=g[S+1];C.x<t&&I.x<t||(C.x<t?C=new A(t,C.y+(t-C.x)/(I.x-C.x)*(I.y-C.y))._round():I.x<t&&(I=new A(t,C.y+(t-C.x)/(I.x-C.x)*(I.y-C.y))._round()),C.y<r&&I.y<r||(C.y<r?C=new A(C.x+(r-C.y)/(I.y-C.y)*(I.x-C.x),r)._round():I.y<r&&(I=new A(C.x+(r-C.y)/(I.y-C.y)*(I.x-C.x),r)._round()),C.x>=a&&I.x>=a||(C.x>=a?C=new A(a,C.y+(a-C.x)/(I.x-C.x)*(I.y-C.y))._round():I.x>=a&&(I=new A(a,C.y+(a-C.x)/(I.x-C.x)*(I.y-C.y))._round()),C.y>=h&&I.y>=h||(C.y>=h?C=new A(C.x+(h-C.y)/(I.y-C.y)*(I.x-C.x),h)._round():I.y>=h&&(I=new A(C.x+(h-C.y)/(I.y-C.y)*(I.x-C.x),h)._round()),b&&C.equals(b[b.length-1])||(b=[C],p.push(b)),b.push(I)))))}}return p}te(ws,"Anchor");let lh=1e20;function Tg(i,t,r,a,h,p,_,g,b){for(let S=t;S<t+a;S++)Sg(i,r*p+S,p,h,_,g,b);for(let S=r;S<r+h;S++)Sg(i,S*p+t,1,a,_,g,b)}function Sg(i,t,r,a,h,p,_){p[0]=0,_[0]=-lh,_[1]=lh,h[0]=i[t];for(let g=1,b=0,S=0;g<a;g++){h[g]=i[t+g*r];let C=g*g;do{let I=p[b];S=(h[g]-h[I]+C-I*I)/(g-I)/2}while(S<=_[b]&&--b>-1);b++,p[b]=g,_[b]=S,_[b+1]=lh}for(let g=0,b=0;g<a;g++){for(;_[b+1]<g;)b++;let S=p[b],C=g-S;i[t+g*r]=h[S]+C*C}}let wf={none:0,ideographs:1,all:2};class Al{constructor(t,r,a){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,r){let a=[];for(let h in t)for(let p of t[h])a.push({stack:h,id:p});Vt(a,({stack:h,id:p},_)=>{let g=this.entries[h];g||(g=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=g.glyphs[p];if(b!==void 0)return void _(null,{stack:h,id:p,glyph:b});if(b=this._tinySDF(g,h,p),b)return g.glyphs[p]=b,void _(null,{stack:h,id:p,glyph:b});let S=Math.floor(p/256);if(256*S>65535)return void _(new Error("glyphs > 65535 not supported"));if(g.ranges[S])return void _(null,{stack:h,id:p,glyph:b});let C=g.requests[S];C||(C=g.requests[S]=[],Al.loadGlyphRange(h,S,this.url,this.requestManager,(I,P)=>{if(P){g.ascender=P.ascender,g.descender=P.descender;for(let R in P.glyphs)this._doesCharSupportLocalGlyph(+R)||(g.glyphs[+R]=P.glyphs[+R]);g.ranges[S]=!0}for(let R of C)R(I,P);delete g.requests[S]})),C.push((I,P)=>{I?_(I):P&&_(null,{stack:h,id:p,glyph:P.glyphs[p]||null})})},(h,p)=>{if(h)r(h);else if(p){let _={};for(let{stack:g,id:b,glyph:S}of p)_[g]===void 0&&(_[g]={}),_[g].glyphs===void 0&&(_[g].glyphs={}),_[g].glyphs[b]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},_[g].ascender=this.entries[g].ascender,_[g].descender=this.entries[g].descender;r(null,_)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==wf.none&&(this.localGlyphMode===wf.all?!!this.localFontFamily:!!this.localFontFamily&&(Rc(t)||Zu(t)||ta(t)||al(t)||ol(t)))}_tinySDF(t,r,a){let h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(a))return;let p=t.tinySDF;if(!p){let N="400";/bold/i.test(r)?N="900":/medium/i.test(r)?N="500":/light/i.test(r)&&(N="200"),p=t.tinySDF=new Al.TinySDF({fontFamily:h,fontWeight:N,fontSize:48,buffer:6,radius:16}),p.fontWeight=N}if(this.localGlyphs[p.fontWeight][a])return this.localGlyphs[p.fontWeight][a];let _=String.fromCharCode(a),{data:g,width:b,height:S,glyphWidth:C,glyphHeight:I,glyphLeft:P,glyphTop:R,glyphAdvance:V}=p.draw(_);return this.localGlyphs[p.fontWeight][a]={id:a,bitmap:new vs({width:b,height:S},g),metrics:{width:C/2,height:I/2,left:P/2,top:R/2-27,advance:V/2,localGlyph:!0}}}}function Eg(i,t,r,a){let h=[],p=i.image,_=p.pixelRatio,g=p.paddedRect.w-2,b=p.paddedRect.h-2,S=i.right-i.left,C=i.bottom-i.top,I=p.stretchX||[[0,g]],P=p.stretchY||[[0,b]],R=(At,Lt)=>At+Lt[1]-Lt[0],V=I.reduce(R,0),N=P.reduce(R,0),q=g-V,K=b-N,lt=0,ut=V,ft=0,gt=N,yt=0,It=q,Pt=0,Bt=K;if(p.content&&a){let At=p.content;lt=ud(I,0,At[0]),ft=ud(P,0,At[1]),ut=ud(I,At[0],At[2]),gt=ud(P,At[1],At[3]),yt=At[0]-lt,Pt=At[1]-ft,It=At[2]-At[0]-ut,Bt=At[3]-At[1]-gt}let Ot=(At,Lt,Ut,Xt)=>{let Gt=dd(At.stretch-lt,ut,S,i.left),Wt=pd(At.fixed-yt,It,At.stretch,V),xe=dd(Lt.stretch-ft,gt,C,i.top),Ce=pd(Lt.fixed-Pt,Bt,Lt.stretch,N),ve=dd(Ut.stretch-lt,ut,S,i.left),Ee=pd(Ut.fixed-yt,It,Ut.stretch,V),oe=dd(Xt.stretch-ft,gt,C,i.top),Qt=pd(Xt.fixed-Pt,Bt,Xt.stretch,N),ke=new A(Gt,xe),Ne=new A(ve,xe),Ci=new A(ve,oe),ni=new A(Gt,oe),Ii=new A(Wt/_,Ce/_),je=new A(Ee/_,Qt/_),De=t*Math.PI/180;if(De){let vi=Math.sin(De),ki=Math.cos(De),Li=[ki,-vi,vi,ki];ke._matMult(Li),Ne._matMult(Li),ni._matMult(Li),Ci._matMult(Li)}let Je=At.stretch+At.fixed,fi=Lt.stretch+Lt.fixed;return{tl:ke,tr:Ne,bl:ni,br:Ci,tex:{x:p.paddedRect.x+1+Je,y:p.paddedRect.y+1+fi,w:Ut.stretch+Ut.fixed-Je,h:Xt.stretch+Xt.fixed-fi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ii,pixelOffsetBR:je,minFontScaleX:It/_/S,minFontScaleY:Bt/_/C,isSDF:r}};if(a&&(p.stretchX||p.stretchY)){let At=Mg(I,q,V),Lt=Mg(P,K,N);for(let Ut=0;Ut<At.length-1;Ut++){let Xt=At[Ut],Gt=At[Ut+1];for(let Wt=0;Wt<Lt.length-1;Wt++)h.push(Ot(Xt,Lt[Wt],Gt,Lt[Wt+1]))}}else h.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:b+1}));return h}function ud(i,t,r){let a=0;for(let h of i)a+=Math.max(t,Math.min(r,h[1]))-Math.max(t,Math.min(r,h[0]));return a}function Mg(i,t,r){let a=[{fixed:-1,stretch:0}];for(let[h,p]of i){let _=a[a.length-1];a.push({fixed:h-_.stretch,stretch:_.stretch}),a.push({fixed:h-_.stretch,stretch:_.stretch+(p-h)})}return a.push({fixed:t+1,stretch:r}),a}function dd(i,t,r,a){return i/t*r+a}function pd(i,t,r,a){return i-t*r/a}function _v(i,t,r,a){let h=t+i.positionedLines[a].lineOffset;return a===0?r+h/2:r+(h+(t+i.positionedLines[a-1].lineOffset))/2}Al.loadGlyphRange=function(i,t,r,a,h){let p=256*t,_=p+255,g=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${p}-${_}`),J.Glyphs);ot(g,(b,S)=>{if(b)h(b);else if(S){let C={},I=function(P){return new oh(P).readFields(lv,{})}(S);for(let P of I.glyphs)C[P.id]=P;h(null,{glyphs:C,ascender:I.ascender,descender:I.descender})}})},Al.TinySDF=class{constructor({fontSize:i=24,buffer:t=3,radius:r=8,cutoff:a=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}){this.buffer=t,this.cutoff=a,this.radius=r;let g=this.size=i+4*t,b=this._createCanvas(g),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${_} ${p} ${i}px ${h}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(i){let t=document.createElement("canvas");return t.width=t.height=i,t}draw(i){let{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(i),_=Math.floor(r),g=Math.min(this.size-this.buffer,Math.ceil(p-h)),b=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(a)),S=g+2*this.buffer,C=b+2*this.buffer,I=S*C,P=new Uint8ClampedArray(I),R={data:P,width:S,height:C,glyphWidth:g,glyphHeight:b,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(g===0||b===0)return R;let{ctx:V,buffer:N,gridInner:q,gridOuter:K}=this;V.clearRect(N,N,g,b),V.fillText(i,N,N+_+1);let lt=V.getImageData(N,N,g,b);K.fill(lh,0,I),q.fill(0,0,I);for(let ut=0;ut<b;ut++)for(let ft=0;ft<g;ft++){let gt=lt.data[4*(ut*g+ft)+3]/255;if(gt===0)continue;let yt=(ut+N)*S+ft+N;if(gt===1)K[yt]=0,q[yt]=lh;else{let It=.5-gt;K[yt]=It>0?It*It:0,q[yt]=It<0?It*It:0}}Tg(K,0,0,S,C,S,this.f,this.v,this.z),Tg(q,N,N,g,b,S,this.f,this.v,this.z);for(let ut=0;ut<I;ut++){let ft=Math.sqrt(K[ut])-Math.sqrt(q[ut]);P[ut]=Math.round(255-255*(ft/this.radius+this.cutoff))}return R}};class gv{constructor(t=[],r=yv){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let t=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:r,compare:a}=this,h=r[t];for(;t>0;){let p=t-1>>1,_=r[p];if(a(h,_)>=0)break;r[t]=_,t=p}r[t]=h}_down(t){let{data:r,compare:a}=this,h=this.length>>1,p=r[t];for(;t<h;){let _=1+(t<<1),g=r[_],b=_+1;if(b<this.length&&a(r[b],g)<0&&(_=b,g=r[b]),a(g,p)>=0)break;r[t]=g,t=_}r[t]=p}}function yv(i,t){return i<t?-1:i>t?1:0}function xv(i,t=1,r=!1){let a=1/0,h=1/0,p=-1/0,_=-1/0,g=i[0];for(let R=0;R<g.length;R++){let V=g[R];(!R||V.x<a)&&(a=V.x),(!R||V.y<h)&&(h=V.y),(!R||V.x>p)&&(p=V.x),(!R||V.y>_)&&(_=V.y)}let b=Math.min(p-a,_-h),S=b/2,C=new gv([],vv);if(b===0)return new A(a,h);for(let R=a;R<p;R+=b)for(let V=h;V<_;V+=b)C.push(new Cl(R+S,V+S,S,i));let I=function(R){let V=0,N=0,q=0,K=R[0];for(let lt=0,ut=K.length,ft=ut-1;lt<ut;ft=lt++){let gt=K[lt],yt=K[ft],It=gt.x*yt.y-yt.x*gt.y;N+=(gt.x+yt.x)*It,q+=(gt.y+yt.y)*It,V+=3*It}return new Cl(N/V,q/V,0,R)}(i),P=C.length;for(;C.length;){let R=C.pop();(R.d>I.d||!I.d)&&(I=R,r&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,P)),R.max-I.d<=t||(S=R.h/2,C.push(new Cl(R.p.x-S,R.p.y-S,S,i)),C.push(new Cl(R.p.x+S,R.p.y-S,S,i)),C.push(new Cl(R.p.x-S,R.p.y+S,S,i)),C.push(new Cl(R.p.x+S,R.p.y+S,S,i)),P+=4)}return r&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function vv(i,t){return t.max-i.max}function Cl(i,t,r,a){this.p=new A(i,t),this.h=r,this.d=function(h,p){let _=!1,g=1/0;for(let b=0;b<p.length;b++){let S=p[b];for(let C=0,I=S.length,P=I-1;C<I;P=C++){let R=S[C],V=S[P];R.y>h.y!=V.y>h.y&&h.x<(V.x-R.x)*(h.y-R.y)/(V.y-R.y)+R.x&&(_=!_),g=Math.min(g,w_(h,R,V))}}return(_?1:-1)*Math.sqrt(g)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}let Tf=Number.POSITIVE_INFINITY,bv=Math.sqrt(2);function Ag(i,t){return t[1]!==Tf?function(r,a,h){let p=0,_=0;switch(a=Math.abs(a),h=Math.abs(h),r){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(r){case"top-right":case"bottom-right":case"right":p=-a;break;case"top-left":case"bottom-left":case"left":p=a}return[p,_]}(i,t[0],t[1]):function(r,a){let h=0,p=0;a<0&&(a=0);let _=a/bv;switch(r){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-a;break;case"top":p=a-7}switch(r){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=a;break;case"right":h=-a}return[h,p]}(i,t[0])}function wv(i,t,r,a,h,p,_,g,b,S){i.createArrays(),i.tilePixelRatio=we/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;let C=i.layers[0].layout,I=i.layers[0]._unevaluatedLayout._values,P={};if(i.textSizeData.kind==="composite"){let{minZoom:N,maxZoom:q}=i.textSizeData;P.compositeTextSizes=[I["text-size"].possiblyEvaluate(new ii(N),g),I["text-size"].possiblyEvaluate(new ii(q),g)]}if(i.iconSizeData.kind==="composite"){let{minZoom:N,maxZoom:q}=i.iconSizeData;P.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new ii(N),g),I["icon-size"].possiblyEvaluate(new ii(q),g)]}P.layoutTextSize=I["text-size"].possiblyEvaluate(new ii(b+1),g),P.layoutIconSize=I["icon-size"].possiblyEvaluate(new ii(b+1),g),P.textMaxSize=I["text-size"].possiblyEvaluate(new ii(18),g);let R=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",V=C.get("text-size");for(let N of i.features){let q=C.get("text-font").evaluate(N,{},g).join(","),K=V.evaluate(N,{},g),lt=P.layoutTextSize.evaluate(N,{},g),ut=(P.layoutIconSize.evaluate(N,{},g),{horizontal:{},vertical:void 0}),ft=N.text,gt,yt=[0,0];if(ft){let Bt=ft.toString(),Ot=C.get("text-letter-spacing").evaluate(N,{},g)*$i,At=C.get("text-line-height").evaluate(N,{},g)*$i,Lt=ju(Bt)?Ot:0,Ut=C.get("text-anchor").evaluate(N,{},g),Xt=C.get("text-variable-anchor");if(!Xt){let Ee=C.get("text-radial-offset").evaluate(N,{},g);yt=Ee?Ag(Ut,[Ee*$i,Tf]):C.get("text-offset").evaluate(N,{},g).map(oe=>oe*$i)}let Gt=R?"center":C.get("text-justify").evaluate(N,{},g),Wt=C.get("symbol-placement"),xe=Wt==="point",Ce=Wt==="point"?C.get("text-max-width").evaluate(N,{},g)*$i:0,ve=Ee=>{i.allowVerticalPlacement&&cl(Bt)&&(ut.vertical=xf(ft,t,r,h,q,Ce,At,Ut,Ee,Lt,yt,Xn.vertical,!0,Wt,lt,K))};if(!R&&Xt){let Ee=Gt==="auto"?Xt.map(Qt=>Sf(Qt)):[Gt],oe=!1;for(let Qt=0;Qt<Ee.length;Qt++){let ke=Ee[Qt];if(!ut.horizontal[ke])if(oe)ut.horizontal[ke]=ut.horizontal[0];else{let Ne=xf(ft,t,r,h,q,Ce,At,"center",ke,Lt,yt,Xn.horizontal,!1,Wt,lt,K);Ne&&(ut.horizontal[ke]=Ne,oe=Ne.positionedLines.length===1)}}ve("left")}else{if(Gt==="auto"&&(Gt=Sf(Ut)),xe||C.get("text-writing-mode").indexOf("horizontal")>=0||!cl(Bt)){let Ee=xf(ft,t,r,h,q,Ce,At,Ut,Gt,Lt,yt,Xn.horizontal,!1,Wt,lt,K);Ee&&(ut.horizontal[Gt]=Ee)}ve(Wt==="point"?"left":Gt)}}let It=!1;if(N.icon&&N.icon.name){let Bt=a[N.icon.name];Bt&&(gt=pv(h[N.icon.name],C.get("icon-offset").evaluate(N,{},g),C.get("icon-anchor").evaluate(N,{},g)),It=Bt.sdf,i.sdfIcons===void 0?i.sdfIcons=Bt.sdf:i.sdfIcons!==Bt.sdf&&qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Bt.pixelRatio!==i.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}let Pt=Ig(ut.horizontal)||ut.vertical;i.iconsInText||(i.iconsInText=!!Pt&&Pt.iconsInText),(Pt||gt)&&Tv(i,N,ut,gt,a,P,lt,0,yt,It,_,g,S)}p&&i.generateCollisionDebugBuffers(b,i.collisionBoxArray)}function Sf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Tv(i,t,r,a,h,p,_,g,b,S,C,I,P){let R=p.textMaxSize.evaluate(t,{},I);R===void 0&&(R=_);let V=i.layers[0].layout,N=V.get("icon-offset").evaluate(t,{},I),q=Ig(r.horizontal)||r.vertical,K=_/24,lt=i.tilePixelRatio*R/24,ut=(At=i.overscaling,i.zoom>18&&At>2&&(At>>=1),Math.max(we/(512*At),1)*V.get("symbol-spacing")),ft=V.get("text-padding")*i.tilePixelRatio,gt=V.get("icon-padding")*i.tilePixelRatio,yt=Q(V.get("text-max-angle")),It=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Pt=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Bt=V.get("symbol-placement"),Ot=ut/2;var At;let Lt=V.get("icon-text-fit"),Ut;a&&Lt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ut=_g(a,r.vertical,Lt,V.get("icon-text-fit-padding"),N,K)),q&&(a=_g(a,q,Lt,V.get("icon-text-fit-padding"),N,K)));let Xt=(Gt,Wt,xe)=>{if(Wt.x<0||Wt.x>=we||Wt.y<0||Wt.y>=we)return;let{x:Ce,y:ve,z:Ee}=P.projectTilePoint(Wt.x,Wt.y,xe),oe=new ws(Ce,ve,Ee,0,void 0);(function(Qt,ke,Ne,Ci,ni,Ii,je,De,Je,fi,vi,ki,Li,kn,_n,Qe,nn,Pn,Vi,Ri,oi,ri,gn,rn,Ei){let sn=Qt.addToLineVertexArray(ke,Ci),Yi,Bi,nr,mo,gh,yh,u0,d0=0,p0=0,f0=0,m0=0,Uf=-1,Nf=-1,Gr={},_0=Fr(""),jf=0,Gf=0;if(Je._unevaluatedLayout.getValue("text-radial-offset")===void 0?[jf,Gf]=Je.layout.get("text-offset").evaluate(oi,{},Ei).map(zn=>zn*$i):(jf=Je.layout.get("text-radial-offset").evaluate(oi,{},Ei)*$i,Gf=Tf),Qt.allowVerticalPlacement&&ni.vertical){let zn=ni.vertical;if(_n)yh=Ef(zn),De&&(u0=Ef(De));else{let Dn=Je.layout.get("text-rotate").evaluate(oi,{},Ei)+90;nr=fd(fi,Ne,ke,vi,ki,Li,zn,kn,Dn,Qe),De&&(mo=fd(fi,Ne,ke,vi,ki,Li,De,Pn,Dn))}}if(Ii){let zn=Je.layout.get("icon-rotate").evaluate(oi,{},Ei),Dn=Je.layout.get("icon-text-fit")!=="none",xh=Eg(Ii,zn,gn,Dn),qf=De?Eg(De,zn,gn,Dn):void 0;Bi=fd(fi,Ne,ke,vi,ki,Li,Ii,Pn,zn),d0=4*xh.length;let g0=Qt.iconSizeData,pa=null;g0.kind==="source"?(pa=[Zr*Je.layout.get("icon-size").evaluate(oi,{},Ei)],pa[0]>lo&&qe(`${Qt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):g0.kind==="composite"&&(pa=[Zr*ri.compositeIconSizes[0].evaluate(oi,{},Ei),Zr*ri.compositeIconSizes[1].evaluate(oi,{},Ei)],(pa[0]>lo||pa[1]>lo)&&qe(`${Qt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,xh,pa,Ri,Vi,oi,!1,Ne,ke,sn.lineStartIndex,sn.lineLength,-1,rn,Ei),Uf=Qt.icon.placedSymbolArray.length-1,qf&&(p0=4*qf.length,Qt.addSymbols(Qt.icon,qf,pa,Ri,Vi,oi,Xn.vertical,Ne,ke,sn.lineStartIndex,sn.lineLength,-1,rn,Ei),Nf=Qt.icon.placedSymbolArray.length-1)}for(let zn in ni.horizontal){let Dn=ni.horizontal[zn];Yi||(_0=Fr(Dn.text),_n?gh=Ef(Dn):Yi=fd(fi,Ne,ke,vi,ki,Li,Dn,kn,Je.layout.get("text-rotate").evaluate(oi,{},Ei),Qe));let xh=Dn.positionedLines.length===1;if(f0+=Cg(Qt,Ne,ke,Dn,je,Je,_n,oi,Qe,sn,ni.vertical?Xn.horizontal:Xn.horizontalOnly,xh?Object.keys(ni.horizontal):[zn],Gr,Uf,ri,rn,Ei),xh)break}ni.vertical&&(m0+=Cg(Qt,Ne,ke,ni.vertical,je,Je,_n,oi,Qe,sn,Xn.vertical,["vertical"],Gr,Nf,ri,rn,Ei));let _o=-1,$f=(zn,Dn)=>zn?Math.max(zn,Dn):Dn;_o=$f(gh,_o),_o=$f(yh,_o),_o=$f(u0,_o);let n2=_o>-1?1:0;Qt.glyphOffsetArray.length>=co.MAX_GLYPHS&&qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),oi.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,oi.sortKey),Qt.symbolInstances.emplaceBack(Ne.x,Ne.y,Ne.z,ke.x,ke.y,Gr.right>=0?Gr.right:-1,Gr.center>=0?Gr.center:-1,Gr.left>=0?Gr.left:-1,Gr.vertical>=0?Gr.vertical:-1,Uf,Nf,_0,Yi!==void 0?Yi:Qt.collisionBoxArray.length,Yi!==void 0?Yi+1:Qt.collisionBoxArray.length,nr!==void 0?nr:Qt.collisionBoxArray.length,nr!==void 0?nr+1:Qt.collisionBoxArray.length,Bi!==void 0?Bi:Qt.collisionBoxArray.length,Bi!==void 0?Bi+1:Qt.collisionBoxArray.length,mo||Qt.collisionBoxArray.length,mo?mo+1:Qt.collisionBoxArray.length,vi,f0,m0,d0,p0,n2,0,jf,Gf,_o)})(i,Wt,oe,Gt,r,a,h,Ut,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,ft,It,b,0,gt,Pt,N,t,p,S,C,I)};if(Bt==="line")for(let Gt of wg(t.geometry,0,0,we,we)){let Wt=mv(Gt,ut,yt,r.vertical||q,a,24,lt,i.overscaling,we);for(let xe of Wt){let Ce=q;Ce&&Sv(i,Ce.text,Ot,xe)||Xt(Gt,xe,I)}}else if(Bt==="line-center"){for(let Gt of t.geometry)if(Gt.length>1){let Wt=fv(Gt,yt,r.vertical||q,a,24,lt);Wt&&Xt(Gt,Wt,I)}}else if(t.type==="Polygon")for(let Gt of df(t.geometry,0)){let Wt=xv(Gt,16);Xt(Gt[0],new ws(Wt.x,Wt.y,0,0,void 0),I)}else if(t.type==="LineString")for(let Gt of t.geometry)Xt(Gt,new ws(Gt[0].x,Gt[0].y,0,0,void 0),I);else if(t.type==="Point")for(let Gt of t.geometry)for(let Wt of Gt)Xt([Wt],new ws(Wt.x,Wt.y,0,0,void 0),I)}let lo=32640;function Cg(i,t,r,a,h,p,_,g,b,S,C,I,P,R,V,N,q){let K=function(ft,gt,yt,It,Pt,Bt,Ot,At){let Lt=[];if(gt.positionedLines.length===0)return Lt;let Ut=It.layout.get("text-rotate").evaluate(Bt,{})*Math.PI/180,Xt=function(ve){let Ee=ve[0],oe=ve[1],Qt=Ee*oe;return Qt>0?[Ee,-oe]:Qt<0?[-Ee,oe]:Ee===0?[oe,Ee]:[oe,-Ee]}(yt),Gt=Math.abs(gt.top-gt.bottom);for(let ve of gt.positionedLines)Gt-=ve.lineOffset;let Wt=gt.positionedLines.length,xe=Gt/Wt,Ce=gt.top-yt[1];for(let ve=0;ve<Wt;++ve){let Ee=gt.positionedLines[ve];Ce=_v(gt,xe,Ce,ve);for(let oe of Ee.positionedGlyphs){if(!oe.rect)continue;let Qt=oe.rect||{},ke=4,Ne=!0,Ci=1,ni=0;if(oe.imageName){let ri=Ot[oe.imageName];if(!ri)continue;if(ri.sdf){qe("SDF images are not supported in formatted text and will be ignored.");continue}Ne=!1,Ci=ri.pixelRatio,ke=1/Ci}let Ii=(Pt||At)&&oe.vertical,je=oe.metrics.advance*oe.scale/2,De=oe.metrics,Je=oe.rect;if(Je===null)continue;At&&gt.verticalizable&&(ni=oe.imageName?je-oe.metrics.width*oe.scale/2:0);let fi=Pt?[oe.x+je,oe.y]:[0,0],vi=[0,0],ki=[0,0],Li=!1;Pt||(Ii?(ki=[oe.x+je+Xt[0],oe.y+Xt[1]-ni],Li=!0):vi=[oe.x+je+yt[0],oe.y+yt[1]-ni]);let kn=Je.w*oe.scale/(Ci*(oe.localGlyph?2:1)),_n=Je.h*oe.scale/(Ci*(oe.localGlyph?2:1)),Qe,nn,Pn,Vi;if(Ii){let ri=oe.y-Ce,gn=new A(-je,je-ri),rn=-Math.PI/2,Ei=new A(...ki);Qe=new A(-je+vi[0],vi[1]),Qe._rotateAround(rn,gn)._add(Ei),Qe.x+=-ri+je,Qe.y-=(De.left-ke)*oe.scale;let sn=oe.imageName?De.advance*oe.scale:$i*oe.scale,Yi=String.fromCharCode(oe.glyph);Kx(Yi)?Qe.x+=(1-ke)*oe.scale:Jx(Yi)?Qe.x+=sn-De.height*oe.scale+(-ke-1)*oe.scale:Qe.x+=oe.imageName||De.width+2*ke===Je.w&&De.height+2*ke===Je.h?(sn-_n)/2:(sn-(De.height+2*ke)*oe.scale)/2,nn=new A(Qe.x,Qe.y-kn),Pn=new A(Qe.x+_n,Qe.y),Vi=new A(Qe.x+_n,Qe.y-kn)}else{let ri=(De.left-ke)*oe.scale-je+vi[0],gn=(-De.top-ke)*oe.scale+vi[1],rn=ri+kn,Ei=gn+_n;Qe=new A(ri,gn),nn=new A(rn,gn),Pn=new A(ri,Ei),Vi=new A(rn,Ei)}if(Ut){let ri;ri=Pt?new A(0,0):Li?new A(Xt[0],Xt[1]):new A(yt[0],yt[1]),Qe._rotateAround(Ut,ri),nn._rotateAround(Ut,ri),Pn._rotateAround(Ut,ri),Vi._rotateAround(Ut,ri)}let Ri=new A(0,0),oi=new A(0,0);Lt.push({tl:Qe,tr:nn,bl:Pn,br:Vi,tex:Qt,writingMode:gt.writingMode,glyphOffset:fi,sectionIndex:oe.sectionIndex,isSDF:Ne,pixelOffsetTL:Ri,pixelOffsetBR:oi,minFontScaleX:0,minFontScaleY:0})}}return Lt}(0,a,b,p,_,g,h,i.allowVerticalPlacement),lt=i.textSizeData,ut=null;lt.kind==="source"?(ut=[Zr*p.layout.get("text-size").evaluate(g,{},q)],ut[0]>lo&&qe(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):lt.kind==="composite"&&(ut=[Zr*V.compositeTextSizes[0].evaluate(g,{},q),Zr*V.compositeTextSizes[1].evaluate(g,{},q)],(ut[0]>lo||ut[1]>lo)&&qe(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,K,ut,b,_,g,C,t,r,S.lineStartIndex,S.lineLength,R,N,q);for(let ft of I)P[ft]=i.text.placedSymbolArray.length-1;return 4*K.length}function Ig(i){for(let t in i)return i[t];return null}function fd(i,t,r,a,h,p,_,g,b,S){let C=_.top,I=_.bottom,P=_.left,R=_.right,V=_.collisionPadding;if(V&&(P-=V[0],C-=V[1],R+=V[2],I+=V[3]),b){let N=new A(P,C),q=new A(R,C),K=new A(P,I),lt=new A(R,I),ut=Q(b),ft=new A(0,0);S&&(ft=new A(S[0],S[1])),N._rotateAround(ut,ft),q._rotateAround(ut,ft),K._rotateAround(ut,ft),lt._rotateAround(ut,ft),P=Math.min(N.x,q.x,K.x,lt.x),R=Math.max(N.x,q.x,K.x,lt.x),C=Math.min(N.y,q.y,K.y,lt.y),I=Math.max(N.y,q.y,K.y,lt.y)}return i.emplaceBack(t.x,t.y,t.z,r.x,r.y,P,C,R,I,g,a,h,p),i.length-1}function Ef(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);let t=i.bottom-i.top;return t>0?Math.max(10,t):null}function Sv(i,t,r,a){let h=i.compareText;if(t in h){let p=h[t];for(let _=p.length-1;_>=0;_--)if(a.dist(p[_])<r)return!0}else h[t]=[];return h[t].push(a),!1}let Ev=ha.VectorTileFeature.types,Mv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function md(i,t,r,a,h,p,_,g,b,S,C,I,P,R,V,N){let q=C?Math.min(lo,Math.round(C[0])):0,K=C?Math.min(lo,Math.round(C[1])):0;i.emplaceBack(t,r,Math.round(32*_),Math.round(32*g),b,S,(q<<1)+(I?1:0),K,16*P,16*R,256*V,256*N,a,h,p,0)}function Mf(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function Av(i){for(let t of i.sections)if(Zp(t.text))return!0;return!1}class Af{constructor(t){this.layoutVertexArray=new kt,this.indexArray=new ee,this.programConfigurations=t,this.segments=new xi,this.dynamicLayoutVertexArray=new $t,this.opacityVertexArray=new wt,this.placedSymbolArray=new fr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,$x.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Mv,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}te(Af,"SymbolBuffers");class Cf{constructor(t,r,a){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new a,this.segments=new xi,this.collisionVertexArray=new Dt,this.collisionVertexArrayExt=new $t}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,qx.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Wx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}te(Cf,"CollisionBuffers");class co{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vr([]),this.placementViewportMatrix=Vr([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mf(this.zoom,r["text-size"]),this.iconSizeData=mf(this.zoom,r["icon-size"]);let a=this.layers[0].layout,h=a.get("symbol-sort-key"),p=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(_=>Xn[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new Af(new oa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Af(new oa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Ue,this.lineVertexArray=new Ti,this.symbolInstances=new yi}calculateGlyphDependencies(t,r,a,h,p){for(let _=0;_<t.length;_++)if(r[t.charCodeAt(_)]=!0,h&&p){let g=sh[t.charAt(_)];g&&(r[g.charCodeAt(0)]=!0)}}populate(t,r,a,h){let p=this.layers[0],_=p.layout,g=_.get("text-font"),b=_.get("text-field"),S=_.get("icon-image"),C=(b.value.kind!=="constant"||b.value.value instanceof Ai&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),I=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,P=_.get("symbol-sort-key");if(this.features=[],!C&&!I)return;let R=r.iconDependencies,V=r.glyphDependencies,N=r.availableImages,q=new ii(this.zoom);for(let{feature:K,id:lt,index:ut,sourceLayerIndex:ft}of t){let gt=p._featureFilter.needGeometry,yt=aa(K,gt);if(!p._featureFilter.filter(q,yt,a))continue;let It,Pt;if(gt||(yt.geometry=xs(K,a,h)),C){let Ot=p.getValueAndResolveTokens("text-field",yt,a,N),At=Ai.factory(Ot);Av(At)&&(this.hasRTLText=!0),(!this.hasRTLText||pl()==="unavailable"||this.hasRTLText&&Sn.isParsed())&&(It=Yx(At,p,yt))}if(I){let Ot=p.getValueAndResolveTokens("icon-image",yt,a,N);Pt=Ot instanceof ln?Ot:ln.fromString(Ot)}if(!It&&!Pt)continue;let Bt=this.sortFeaturesByKey?P.evaluate(yt,{},a):void 0;if(this.features.push({id:lt,text:It,icon:Pt,index:ut,sourceLayerIndex:ft,geometry:yt.geometry,properties:K.properties,type:Ev[K.type],sortKey:Bt}),Pt&&(R[Pt.name]=!0),It){let Ot=g.evaluate(yt,{},a).join(","),At=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xn.vertical)>=0;for(let Lt of It.sections)if(Lt.image)R[Lt.image.name]=!0;else{let Ut=cl(It.toString()),Xt=Lt.fontStack||Ot,Gt=V[Xt]=V[Xt]||{};this.calculateGlyphDependencies(Lt.text,Gt,At,this.allowVerticalPlacement,Ut)}}}_.get("symbol-placement")==="line"&&(this.features=function(K){let lt={},ut={},ft=[],gt=0;function yt(Ot){ft.push(K[Ot]),gt++}function It(Ot,At,Lt){let Ut=ut[Ot];return delete ut[Ot],ut[At]=Ut,ft[Ut].geometry[0].pop(),ft[Ut].geometry[0]=ft[Ut].geometry[0].concat(Lt[0]),Ut}function Pt(Ot,At,Lt){let Ut=lt[At];return delete lt[At],lt[Ot]=Ut,ft[Ut].geometry[0].shift(),ft[Ut].geometry[0]=Lt[0].concat(ft[Ut].geometry[0]),Ut}function Bt(Ot,At,Lt){let Ut=Lt?At[0][At[0].length-1]:At[0][0];return`${Ot}:${Ut.x}:${Ut.y}`}for(let Ot=0;Ot<K.length;Ot++){let At=K[Ot],Lt=At.geometry,Ut=At.text?At.text.toString():null;if(!Ut){yt(Ot);continue}let Xt=Bt(Ut,Lt),Gt=Bt(Ut,Lt,!0);if(Xt in ut&&Gt in lt&&ut[Xt]!==lt[Gt]){let Wt=Pt(Xt,Gt,Lt),xe=It(Xt,Gt,ft[Wt].geometry);delete lt[Xt],delete ut[Gt],ut[Bt(Ut,ft[xe].geometry,!0)]=xe,ft[Wt].geometry=null}else Xt in ut?It(Xt,Gt,Lt):Gt in lt?Pt(Xt,Gt,Lt):(yt(Ot),lt[Xt]=gt-1,ut[Gt]=gt-1)}return ft.filter(Ot=>Ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,lt)=>K.sortKey-lt.sortKey)}update(t,r,a,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,a,h),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,a,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){let a=this.lineVertexArray.length,h=t.segment;if(h!==void 0){let p=t.dist(r[h+1]),_=t.dist(r[h]),g={};for(let b=h+1;b<r.length;b++)g[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:p},b<r.length-1&&(p+=r[b+1].dist(r[b]));for(let b=h||0;b>=0;b--)g[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=r[b-1].dist(r[b]));for(let b=0;b<r.length;b++){let S=g[b];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,r,a,h,p,_,g,b,S,C,I,P,R,V){let N=t.indexArray,q=t.layoutVertexArray,K=t.segments.prepareSegment(4*r.length,q,N,this.canOverlap?_.sortKey:void 0),lt=this.glyphOffsetArray.length,ut=K.vertexLength,ft=this.allowVerticalPlacement&&g===Xn.vertical?Math.PI/2:0,gt=_.text&&_.text.sections;for(let yt=0;yt<r.length;yt++){let{tl:It,tr:Pt,bl:Bt,br:Ot,tex:At,pixelOffsetTL:Lt,pixelOffsetBR:Ut,minFontScaleX:Xt,minFontScaleY:Gt,glyphOffset:Wt,isSDF:xe,sectionIndex:Ce}=r[yt],ve=K.vertexLength,Ee=Wt[1];md(q,b.x,b.y,b.z,S.x,S.y,It.x,Ee+It.y,At.x,At.y,a,xe,Lt.x,Lt.y,Xt,Gt),md(q,b.x,b.y,b.z,S.x,S.y,Pt.x,Ee+Pt.y,At.x+At.w,At.y,a,xe,Ut.x,Lt.y,Xt,Gt),md(q,b.x,b.y,b.z,S.x,S.y,Bt.x,Ee+Bt.y,At.x,At.y+At.h,a,xe,Lt.x,Ut.y,Xt,Gt),md(q,b.x,b.y,b.z,S.x,S.y,Ot.x,Ee+Ot.y,At.x+At.w,At.y+At.h,a,xe,Ut.x,Ut.y,Xt,Gt),Mf(t.dynamicLayoutVertexArray,b,ft),N.emplaceBack(ve,ve+1,ve+2),N.emplaceBack(ve+1,ve+2,ve+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wt[0]),yt!==r.length-1&&Ce===r[yt+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,_,_.index,{},R,V,gt&&gt[Ce])}t.placedSymbolArray.emplaceBack(b.x,b.y,b.z,S.x,S.y,lt,this.glyphOffsetArray.length-lt,ut,C,I,S.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],g,0,!1,0,P,0)}_commitLayoutVertex(t,r,a,h,p,_,g){t.emplaceBack(r,a,h,p,_,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(t,r,a,h,p,_,g){let b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),S=b.vertexLength,C=g.tileAnchorX,I=g.tileAnchorY;for(let R=0;R<4;R++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(r,t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(r,t.padding,t.padding),a.collisionVertexArrayExt.emplaceBack(r,-t.padding,t.padding),this._commitLayoutVertex(a.layoutVertexArray,h,p,_,C,I,new A(t.x1,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,p,_,C,I,new A(t.x2,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,p,_,C,I,new A(t.x2,t.y2)),this._commitLayoutVertex(a.layoutVertexArray,h,p,_,C,I,new A(t.x1,t.y2)),b.vertexLength+=4;let P=a.indexArray;P.emplaceBack(S,S+1),P.emplaceBack(S+1,S+2),P.emplaceBack(S+2,S+3),P.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,a,h,p,_){for(let g=h;g<p;g++){let b=a.get(g),S=this.getSymbolInstanceTextSize(t,_,r,g);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(t,r,a,h,p,_){for(let g=h;g<p;g++){let b=a.get(g),S=this.getSymbolInstanceIconSize(t,r,g);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}generateCollisionDebugBuffers(t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cf(Nt,ng.members,ge),this.iconCollisionBox=new Cf(Nt,ng.members,ge);let a=Tl(this.iconSizeData,t),h=Tl(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){let _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,t,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,t,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(a,t,r,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(a,t,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(t,r,a,h){let p=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:h),_=ld(this.textSizeData,t,p)/$i;return this.tilePixelRatio*_}getSymbolInstanceIconSize(t,r,a){let h=this.icon.placedSymbolArray.get(a),p=ld(this.iconSizeData,t,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(t,r,a){t.emplaceBack(r,-a,-a),t.emplaceBack(r,a,-a),t.emplaceBack(r,a,a),t.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(t,r,a,h,p,_){for(let g=h;g<p;g++){let b=a.get(g),S=this.getSymbolInstanceTextSize(t,_,r,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,b.padding)}}_updateIconDebugCollisionBoxes(t,r,a,h,p){for(let _=h;_<p;_++){let g=a.get(_),b=this.getSymbolInstanceIconSize(t,r,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,g.padding)}}updateCollisionDebugBuffers(t,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=Tl(this.iconSizeData,t),h=Tl(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){let _=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,t,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,t,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(a,t,r,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(a,t,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,a,h,p,_,g,b,S){let C={};for(let I=r;I<a;I++){let P=t.get(I);C.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},C.textFeatureIndex=P.featureIndex;break}for(let I=h;I<p;I++){let P=t.get(I);C.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},C.verticalTextFeatureIndex=P.featureIndex;break}for(let I=_;I<g;I++){let P=t.get(I);C.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},C.iconFeatureIndex=P.featureIndex;break}for(let I=b;I<S;I++){let P=t.get(I);C.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},C.verticalIconFeatureIndex=P.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){let a=t.placedSymbolArray.get(r),h=a.vertexStartIndex+4*a.numGlyphs;for(let p=a.vertexStartIndex;p<h;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(t),a=Math.cos(t),h=[],p=[],_=[];for(let g=0;g<this.symbolInstances.length;++g){_.push(g);let b=this.symbolInstances.get(g);h.push(0|Math.round(r*b.tileAnchorX+a*b.tileAnchorY)),p.push(b.featureIndex)}return _.sort((g,b)=>h[g]-h[b]||p[b]-p[g]),_}addToSortKeyRanges(t,r){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,p,_)=>{h>=0&&_.indexOf(h)===p&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}te(co,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),co.MAX_GLYPHS=65535,co.addDynamicAttributes=Mf;let Cv=new O({"symbol-placement":new T(Et.layout_symbol["symbol-placement"]),"symbol-spacing":new T(Et.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new T(Et.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new M(Et.layout_symbol["symbol-sort-key"]),"symbol-z-order":new T(Et.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new T(Et.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new T(Et.layout_symbol["icon-ignore-placement"]),"icon-optional":new T(Et.layout_symbol["icon-optional"]),"icon-rotation-alignment":new T(Et.layout_symbol["icon-rotation-alignment"]),"icon-size":new M(Et.layout_symbol["icon-size"]),"icon-text-fit":new T(Et.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new T(Et.layout_symbol["icon-text-fit-padding"]),"icon-image":new M(Et.layout_symbol["icon-image"]),"icon-rotate":new M(Et.layout_symbol["icon-rotate"]),"icon-padding":new T(Et.layout_symbol["icon-padding"]),"icon-keep-upright":new T(Et.layout_symbol["icon-keep-upright"]),"icon-offset":new M(Et.layout_symbol["icon-offset"]),"icon-anchor":new M(Et.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new T(Et.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new T(Et.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new T(Et.layout_symbol["text-rotation-alignment"]),"text-field":new M(Et.layout_symbol["text-field"]),"text-font":new M(Et.layout_symbol["text-font"]),"text-size":new M(Et.layout_symbol["text-size"]),"text-max-width":new M(Et.layout_symbol["text-max-width"]),"text-line-height":new M(Et.layout_symbol["text-line-height"]),"text-letter-spacing":new M(Et.layout_symbol["text-letter-spacing"]),"text-justify":new M(Et.layout_symbol["text-justify"]),"text-radial-offset":new M(Et.layout_symbol["text-radial-offset"]),"text-variable-anchor":new T(Et.layout_symbol["text-variable-anchor"]),"text-anchor":new M(Et.layout_symbol["text-anchor"]),"text-max-angle":new T(Et.layout_symbol["text-max-angle"]),"text-writing-mode":new T(Et.layout_symbol["text-writing-mode"]),"text-rotate":new M(Et.layout_symbol["text-rotate"]),"text-padding":new T(Et.layout_symbol["text-padding"]),"text-keep-upright":new T(Et.layout_symbol["text-keep-upright"]),"text-transform":new M(Et.layout_symbol["text-transform"]),"text-offset":new M(Et.layout_symbol["text-offset"]),"text-allow-overlap":new T(Et.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new T(Et.layout_symbol["text-ignore-placement"]),"text-optional":new T(Et.layout_symbol["text-optional"])});var If={paint:new O({"icon-opacity":new M(Et.paint_symbol["icon-opacity"]),"icon-color":new M(Et.paint_symbol["icon-color"]),"icon-halo-color":new M(Et.paint_symbol["icon-halo-color"]),"icon-halo-width":new M(Et.paint_symbol["icon-halo-width"]),"icon-halo-blur":new M(Et.paint_symbol["icon-halo-blur"]),"icon-translate":new T(Et.paint_symbol["icon-translate"]),"icon-translate-anchor":new T(Et.paint_symbol["icon-translate-anchor"]),"text-opacity":new M(Et.paint_symbol["text-opacity"]),"text-color":new M(Et.paint_symbol["text-color"],{runtimeType:Qn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new M(Et.paint_symbol["text-halo-color"]),"text-halo-width":new M(Et.paint_symbol["text-halo-width"]),"text-halo-blur":new M(Et.paint_symbol["text-halo-blur"]),"text-translate":new T(Et.paint_symbol["text-translate"]),"text-translate-anchor":new T(Et.paint_symbol["text-translate-anchor"])}),layout:Cv};class kg{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ar,this.defaultValue=t}evaluate(t){if(t.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}te(kg,"FormatSectionOverride",{omit:["defaultValue"]});class _d extends _r{constructor(t){super(t,If)}recalculate(t,r){super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let h=[];for(let p of a)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,r,a,h){let p=this.layout.get(t).evaluate(r,{},a,h),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Hs(_.value)||!p?p:function(g,b){return b.replace(/{([^{}]+)}/g,(S,C)=>C in g?String(g[C]):"")}(r.properties,p)}createBucket(t){return new co(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let t of If.paint.overridableProperties){if(!_d.hasPaintOverride(this.layout,t))continue;let r=this.paint.get(t),a=new kg(r),h=new Qa(a,r.property.specification),p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new wc("source",h):new Tc("composite",h,r.value.zoomStops,r.value._interpolationType),this.paint._values[t]=new y(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&_d.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){let a=t.get("text-field"),h=If.paint.properties[r],p=!1,_=g=>{for(let b of g)if(h.overrides&&h.overrides.hasOverride(b))return void(p=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Ai)_(a.value.value.sections);else if(a.value.kind==="source"){let g=S=>{p||(S instanceof cr&&wi(S.value)===Us?_(S.value.sections):S instanceof Gs?_(S.sections):S.eachChild(g))},b=a.value;b._styleExpression&&g(b._styleExpression.expression)}return p}getProgramConfiguration(t){return new ro(this,t)}}var Iv={paint:new O({"background-color":new T(Et.paint_background["background-color"]),"background-pattern":new z(Et.paint_background["background-pattern"]),"background-opacity":new T(Et.paint_background["background-opacity"])})},kv={paint:new O({"raster-opacity":new T(Et.paint_raster["raster-opacity"]),"raster-hue-rotate":new T(Et.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new T(Et.paint_raster["raster-brightness-min"]),"raster-brightness-max":new T(Et.paint_raster["raster-brightness-max"]),"raster-saturation":new T(Et.paint_raster["raster-saturation"]),"raster-contrast":new T(Et.paint_raster["raster-contrast"]),"raster-resampling":new T(Et.paint_raster["raster-resampling"]),"raster-fade-duration":new T(Et.paint_raster["raster-fade-duration"])})};class Pv extends _r{constructor(t){super(t,{}),this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var zv={paint:new O({"sky-type":new T(Et.paint_sky["sky-type"]),"sky-atmosphere-sun":new T(Et.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new T(Et.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new T(Et.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new T(Et.paint_sky["sky-gradient-radius"]),"sky-gradient":new L(Et.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new T(Et.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new T(Et.paint_sky["sky-atmosphere-color"]),"sky-opacity":new T(Et.paint_sky["sky-opacity"])})};function kf(i,t,r){let a=[0,0,1],h=B_([]);return function(p,_,g){g*=.5;var b=_[0],S=_[1],C=_[2],I=_[3],P=Math.sin(g),R=Math.cos(g);p[0]=b*R-C*P,p[1]=S*R+I*P,p[2]=C*R+b*P,p[3]=I*R-S*P}(h,h,r?-Q(i)+Math.PI:Q(i)),F_(h,h,-Q(t)),L_(a,a,h),Xc(a,a)}let Dv={circle:class extends _r{constructor(i){super(i,J1)}createBucket(i){return new Xp(i)}queryRadius(i){let t=i;return yl("circle-radius",this,t)+yl("circle-stroke-width",this,t)+Qu(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,r,a,h,p,_,g){let b=M_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return O_(i,a,p,_,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new ro(this,i)}},heatmap:class extends _r{createBucket(i){return new Z_(i)}constructor(i){super(i,sx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return yl("heatmap-radius",this,i)}queryIntersectsFeature(i,t,r,a,h,p,_,g){let b=this.paint.get("heatmap-radius").evaluate(t,r);return O_(i,a,p,_,g,!0,!0,new A(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new ro(this,i)}},hillshade:class extends _r{constructor(i){super(i,ox)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends _r{constructor(i){super(i,Tx)}getProgramIds(){let i=this.paint.get("fill-pattern"),t=i&&i.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(i){return new ro(this,i)}recalculate(i,t){super.recalculate(i,t);let r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new sd(i)}queryRadius(){return Qu(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,r,a,h,p){return!i.queryGeometry.isAboveHorizon&&b_(E_(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends _r{constructor(i){super(i,Rx)}createBucket(i){return new nh(i)}queryRadius(){return Qu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new ro(this,i)}queryIntersectsFeature(i,t,r,a,h,p,_,g,b){let S=M_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(t,r),I=this.paint.get("fill-extrusion-base").evaluate(t,r),P=[0,0],R=g&&p.elevation,V=p.elevation?p.elevation.exaggeration():1,N=i.tile.getBucket(this);if(R&&N instanceof nh){let lt=N.centroidVertexArray,ut=b+1;if(ut<lt.length){let ft=lt.get(ut);P[0]=ft.a_centroid_pos0,P[1]=ft.a_centroid_pos1}}if(P[0]===0&&P[1]===1)return!1;let q=function(lt,ut,ft,gt,yt,It,Pt,Bt,Ot){return It?function(At,Lt,Ut,Xt,Gt,Wt,xe,Ce,ve){let Ee=[],oe=[],Qt=[0,0,0,1];for(let ke of At){let Ne=[],Ci=[];for(let ni of ke){let Ii=ni.x+Xt.x,je=ni.y+Xt.y,De=Bx(Ii,je,Lt,Ut,Wt,xe,Ce,ve);Qt[0]=Ii,Qt[1]=je,Qt[2]=De.base,Qt[3]=1,vl(Qt,Qt,Gt),Qt[3]=Math.max(Qt[3],1e-5);let Je=Q_([Qt[0]/Qt[3],Qt[1]/Qt[3],Qt[2]/Qt[3]]);Qt[0]=Ii,Qt[1]=je,Qt[2]=De.top,Qt[3]=1,vl(Qt,Qt,Gt),Qt[3]=Math.max(Qt[3],1e-5);let fi=Q_([Qt[0]/Qt[3],Qt[1]/Qt[3],Qt[2]/Qt[3]]);Ne.push(Je),Ci.push(fi)}Ee.push(Ne),oe.push(Ci)}return[Ee,oe]}(lt,ut,ft,gt,yt,It,Pt,Bt,Ot):function(At,Lt,Ut,Xt,Gt){let Wt=[],xe=[],Ce=Gt[8]*Lt,ve=Gt[9]*Lt,Ee=Gt[10]*Lt,oe=Gt[11]*Lt,Qt=Gt[8]*Ut,ke=Gt[9]*Ut,Ne=Gt[10]*Ut,Ci=Gt[11]*Ut;for(let ni of At){let Ii=[],je=[];for(let De of ni){let Je=De.x+Xt.x,fi=De.y+Xt.y,vi=Gt[0]*Je+Gt[4]*fi+Gt[12],ki=Gt[1]*Je+Gt[5]*fi+Gt[13],Li=Gt[2]*Je+Gt[6]*fi+Gt[14],kn=Gt[3]*Je+Gt[7]*fi+Gt[15],_n=vi+Ce,Qe=ki+ve,nn=Li+Ee,Pn=Math.max(kn+oe,1e-5),Vi=vi+Qt,Ri=ki+ke,oi=Li+Ne,ri=Math.max(kn+Ci,1e-5),gn=new A(_n/Pn,Qe/Pn);gn.z=nn/Pn,Ii.push(gn);let rn=new A(Vi/ri,Ri/ri);rn.z=oi/ri,je.push(rn)}Wt.push(Ii),xe.push(je)}return[Wt,xe]}(lt,ut,ft,gt,yt)}(a,I,C,S,_,R?g:null,P,V,p.center.lat),K=i.queryGeometry;return function(lt,ut,ft){let gt=1/0;b_(ft,ut)&&(gt=J_(ft,ut[0]));for(let yt=0;yt<ut.length;yt++){let It=ut[yt],Pt=lt[yt];for(let Bt=0;Bt<It.length-1;Bt++){let Ot=It[Bt],At=[Ot,It[Bt+1],Pt[Bt+1],Pt[Bt],Ot];v_(ft,At)&&(gt=Math.min(gt,J_(ft,At)))}}return gt!==1/0&&gt}(q[0],q[1],K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends _r{constructor(i){super(i,tg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){let t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Oo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=eg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new ad(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new ro(this,i)}queryRadius(i){let t=i,r=ig(yl("line-width",this,t),yl("line-gap-width",this,t)),a=yl("line-offset",this,t);return r/2+Math.abs(a)+Qu(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,r,a,h,p){if(i.queryGeometry.isAboveHorizon)return!1;let _=E_(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),g=i.pixelToTileUnitsFactor/2*ig(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),b=this.paint.get("line-offset").evaluate(t,r);return b&&(a=function(S,C){let I=[],P=new A(0,0);for(let R=0;R<S.length;R++){let V=S[R],N=[];for(let q=0;q<V.length;q++){let K=V[q-1],lt=V[q],ut=V[q+1],ft=q===0?P:lt.sub(K)._unit()._perp(),gt=q===V.length-1?P:ut.sub(lt)._unit()._perp(),yt=ft._add(gt)._unit();yt._mult(1/(yt.x*gt.x+yt.y*gt.y)),N.push(yt._mult(C)._add(lt))}I.push(N)}return I}(a,b*i.pixelToTileUnitsFactor)),function(S,C,I){for(let P=0;P<C.length;P++){let R=C[P];if(S.length>=3){for(let V=0;V<R.length;V++)if(gl(S,R[V]))return!0}if(X1(S,R,I))return!0}return!1}(_,a,g)}isTileClipped(){return!0}},symbol:_d,background:class extends _r{constructor(i){super(i,Iv)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends _r{constructor(i){super(i,kv)}getProgramIds(){return["raster"]}},sky:class extends _r{constructor(i){super(i,zv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=lf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let t=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(i,t){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),h=!a,p=i.style.light,_=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&qe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?kf(_.azimuthal,90-_.polar,t):kf(a[0],90-a[1],t)}let r=this.paint.get("sky-gradient-center");return kf(r[0],90-r[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class ch{constructor(t,r,a,h){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(r,h)}update(t,r,a){let{width:h,height:p}=t,{context:_}=this,{gl:g}=_,{HTMLImageElement:b,HTMLCanvasElement:S,HTMLVideoElement:C,ImageData:I,ImageBitmap:P}=B;if(g.bindTexture(g.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===h&&this.size[1]===p){let{x:R,y:V}=a||{x:0,y:0};t instanceof b||t instanceof S||t instanceof C||t instanceof I||P&&t instanceof P?g.texSubImage2D(g.TEXTURE_2D,0,R,V,g.RGBA,g.UNSIGNED_BYTE,t):g.texSubImage2D(g.TEXTURE_2D,0,R,V,h,p,g.RGBA,g.UNSIGNED_BYTE,t.data)}else this.size=[h,p],t instanceof b||t instanceof S||t instanceof C||t instanceof I||P&&t instanceof P?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,t):g.texImage2D(g.TEXTURE_2D,0,this.format,h,p,0,this.format,g.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(t,r){let{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:t),this.filter=t),r!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Pf{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new vs({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){let a=this.getKey(t,r);return this.positions[a]}trim(){let t=this.width,r=this.height=He(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,a){let h=[],p=t.length%2==1?-t[t.length-1]*a:0,_=t[0]*a,g=!0;h.push({left:p,right:_,isDash:g,zeroLength:t[0]===0});let b=t[0];for(let S=1;S<t.length;S++){g=!g;let C=t[S];p=b*a,b+=C,_=b*a,h.push({left:p,right:_,isDash:g,zeroLength:C===0})}return h}addRoundDash(t,r,a){let h=r/2;for(let p=-a;p<=a;p++){let _=this.width*(this.nextRow+a+p),g=0,b=t[g];for(let S=0;S<this.width;S++){S/b.right>1&&(b=t[++g]);let C=Math.abs(S-b.left),I=Math.abs(S-b.right),P=Math.min(C,I),R,V=p/a*(h+1);if(b.isDash){let N=h-Math.abs(V);R=Math.sqrt(P*P+N*N)}else R=h-Math.sqrt(P*P+V*V);this.image.data[_+S]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(t,r){for(let b=t.length-1;b>=0;--b){let S=t[b],C=t[b+1];S.zeroLength?t.splice(b,1):C&&C.isDash===S.isDash&&(C.left=S.left,t.splice(b,1))}let a=t[0],h=t[t.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);let p=this.width*this.nextRow,_=0,g=t[_];for(let b=0;b<this.width;b++){b/g.right>1&&(g=t[++_]);let S=Math.abs(b-g.left),C=Math.abs(b-g.right),I=Math.min(S,C);this.image.data[p+b]=Math.max(0,Math.min(255,(g.isDash?I:-I)+r+128))}}addDash(t,r){let a=this.getKey(t,r);if(this.positions[a])return this.positions[a];let h=r==="round",p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return qe("LineAtlas out of space"),null;t.length===0&&t.push(1);let g=0;for(let C=0;C<t.length;C++)t[C]<0&&(qe("Negative value is found in line dasharray, replacing values with 0"),t[C]=0),g+=t[C];if(g!==0){let C=this.width/g,I=this.getDashRanges(t,this.width,C);h?this.addRoundDash(I,C,p):this.addRegularDash(I,r==="square"?.5*C:0)}let b=this.nextRow+p;this.nextRow+=_;let S={tl:[b,p],br:[g,0]};return this.positions[a]=S,S}}te(Pf,"LineAtlas");class Lv{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}let Rv=B.performance;function Pg(i){let t=i?i.url.toString():void 0;return Rv.getEntriesByName(t)}class Bv{constructor(){this.tasks={},this.taskQueue=[],be(["process"],this),this.invoker=new Lv(this.process),this.nextId=0}add(t,r){let a=this.nextId++,h=function({type:p,isSymbolTile:_,zoom:g}){return g=g||0,p==="message"?0:p!=="maybePrepare"||_?p!=="parseTile"||_?p==="parseTile"&&_?300-g:p==="maybePrepare"&&_?400-g:500:200-g:100-g}(r);if(h===0){Xi();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:t,metadata:r,priority:h,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Xi();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let t=this.pick();if(t===null)return;let r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let h=0;h<this.taskQueue.length;h++){let p=this.tasks[this.taskQueue[h]];p.priority<r&&(r=p.priority,t=h)}if(t===null)return null;let a=this.taskQueue[t];return this.taskQueue.splice(t,1),a}remove(){this.invoker.remove()}}let Fv=st([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),Ov=st([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:zg}=Fv,Dg=st([{name:"a_pos_3",components:3,type:"Int16"}]);var hh=st([{name:"a_pos",type:"Int16",components:2}]);let Il=we/Math.PI/2,Cn=-Il,In=Il,Vv=[new Wn([Cn,Cn,Cn],[In,In,In]),new Wn([Cn,Cn,Cn],[0,0,In]),new Wn([0,Cn,Cn],[In,0,In]),new Wn([Cn,0,Cn],[0,In,In]),new Wn([0,0,Cn],[In,In,In])];class Zv{constructor(t,r,a){this.a=xl([],t,a),this.b=xl([],r,a),this.center=a;let h=Xc([],this.a),p=Xc([],this.b);this.angle=Math.acos(Hc(h,p))}}function zf(i,t){if(i.angle===0)return null;let r;return r=i.a[t]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[t]/i.a[t]/Math.sin(i.angle)-1/Math.tan(i.angle)),r<0||r>1?null:function(a,h,p,_){let g=Math.sin(p);return a*(Math.sin((1-_)*p)/g)+h*(Math.sin(_*p)/g)}(i.a[t],i.b[t],i.angle,_t(r,0,1))+i.center[t]}function uh(i){if(i.z<=1)return Vv[i.z+2*i.y+i.x];let[t,r]=Df(i),a=[Ts(t[0],t[1]),Ts(t[0],r[1]),Ts(r[0],t[1]),Ts(r[0],r[1])],h=[In,In,In],p=[Cn,Cn,Cn];for(let _ of a)h[0]=Math.min(h[0],_[0]),h[1]=Math.min(h[1],_[1]),h[2]=Math.min(h[2],_[2]),p[0]=Math.max(p[0],_[0]),p[1]=Math.max(p[1],_[1]),p[2]=Math.max(p[2],_[2]);return new Wn(h,p)}function Uv(i,t,r){let a=t/i.worldSize,h=(Lt,Ut)=>{Wc(Lt,Lt,a),Wc(Ut,Ut,a)},p=Number.MAX_VALUE,_=[-p,-p,-p],g=[p,p,p],b=Og(i);if(r.z<=1){let Lt=uh(r).getCorners();for(let Ut=0;Ut<Lt.length;Ut++)ca(Lt[Ut],Lt[Ut],b),nf(g,g,Lt[Ut]),rf(_,_,Lt[Ut]);return h(g,_),new Wn(g,_)}let[S,C]=Df(r),I=new so;I.setSouthWest([S[1],C[0]]),I.setNorthEast([C[1],S[0]]);let P=[Ts(I.getSouth(),I.getWest()),Ts(I.getSouth(),I.getEast()),Ts(I.getNorth(),I.getEast()),Ts(I.getNorth(),I.getWest())];for(let Lt=0;Lt<P.length;Lt++)ca(P[Lt],P[Lt],b),nf(g,g,P[Lt]),rf(_,_,P[Lt]);if(I.contains(i.center))return _[2]=0,h(g,_),new Wn(g,_);let R=[b[12],b[13],b[14]],V=i.center.lng,N=_t(i.center.lat,-85.051129,Or),q=[$c(V),ml(N)],K=I.getCenter().lng,lt=_t(I.getCenter().lat,-85.051129,Or),ut=[$c(K),ml(lt)],ft=new Array(3),gt=0,yt=q[0]-ut[0],It=q[1]-ut[1];if(Math.abs(yt)>Math.abs(It))gt=yt>=0?1:3,ft=R;else{gt=It>=0?0:2;let Lt=[b[4],b[5],b[6]],Ut;Ut=It>=0?-Math.sin(Q(I.getSouth()))*Il:-Math.sin(Q(I.getNorth()))*Il,ft=sf(ft,R,Lt,Ut)}let Pt=P[gt],Bt=P[(gt+1)%4],Ot=new Zv(Pt,Bt,ft),At=[zf(Ot,0)||Pt[0],zf(Ot,1)||Pt[1],zf(Ot,2)||Pt[2]];return g[2]=Math.min(Pt[2],Bt[2]),nf(g,g,At),rf(_,_,At),h(g,_),new Wn(g,_)}function Df(i){let t=1<<i.z,r=i.x/t,a=(i.x+1)/t,h=(i.y+1)/t;return[[Gi(i.y/t),er(r)],[Gi(h),er(a)]]}function Lg(i,t,r,a=Il){return r=Q(r),[i*Math.sin(r)*a,-t*a,i*Math.cos(r)*a]}function Ts(i,t,r){return Lg(Math.cos(Q(i)),Math.sin(Q(i)),t,r)}function Rg(i,t,r){let a=Math.pow(2,r.z),h=(i/we+r.x)/a;return Ts(Gi((t/we+r.y)/a),er(h))}function Lf(i){return 16383/Math.max(...xl([],i.max,i.min))}function Bg(i){let t=Vr(new Float64Array(16)),r=Lf(i);var a,h;return oo(t,t,[r,r,r]),la(t,t,((a=[])[0]=-(h=i.min)[0],a[1]=-h[1],a[2]=-h[2],a)),t}function Fg(i,t,r,a,h){let p=function(b){let S=we/(2*Math.PI);return b/(2*Math.PI)/S}(r),_=[i,t,-r/(2*Math.PI)],g=Vr(new Float64Array(16));return la(g,g,_),oo(g,g,[p,p,p]),Qp(g,g,Q(-h)),tf(g,g,Q(-a)),g}function Og(i){let{x:t,y:r}=i.point,{lng:a,lat:h}=i._center;return Fg(t,r,i.worldSize,a,h)}let Vg=Q(85),Nv=Math.cos(Vg),jv=Math.sin(Vg);function Zg(i,t,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class gd{constructor(t,r,a){this.z=t,this.x=r,this.y=a,this.key=dh(0,t,t,r,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r){let a=function(p,_,g){var b=Zg(256*p,256*(_=Math.pow(2,g)-_-1),g),S=Zg(256*(p+1),256*(_+1),g);return b[0]+","+b[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),h=function(p,_,g){let b,S="";for(let C=p;C>0;C--)b=1<<C-1,S+=(_&b?1:0)+(g&b?2:0);return S}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ug{constructor(t,r){this.wrap=t,this.canonical=r,this.key=dh(t,r.z,r.z,r.x,r.y)}}class en{constructor(t,r,a,h,p){this.overscaledZ=t,this.wrap=r,this.canonical=new gd(a,+h,+p),this.key=r===0&&t===a?this.canonical.key:dh(r,t,a,h,p)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){let r=this.canonical.z-t;return t>this.canonical.z?new en(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new en(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return dh(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-t;return dh(this.wrap*+r,t,t,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;let r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new en(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new en(r,this.wrap,r,a,h),new en(r,this.wrap,r,a+1,h),new en(r,this.wrap,r,a,h+1),new en(r,this.wrap,r,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new en(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new en(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ug(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function dh(i,t,r,a,h){let p=1<<Math.min(r,22),_=p*(h%p)+a%p;return i&&r<22&&(_+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*_+r)+(t-r)}function ua(i,t){if(!t.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:t};let r=Math.pow(2,-i.z),a=i.x*r,h=(i.x+1)*r,p=i.y*r,_=(i.y+1)*r,g=er(a),b=er(h),S=Gi(p),C=Gi(_),I=t.project(g,S),P=t.project(b,S),R=t.project(b,C),V=t.project(g,C),N=Math.min(I.x,P.x,R.x,V.x),q=Math.min(I.y,P.y,R.y,V.y),K=Math.max(I.x,P.x,R.x,V.x),lt=Math.max(I.y,P.y,R.y,V.y),ut=r/16;function ft(yt,It,Pt,Bt,Ot,At){let Lt=(Pt+Ot)/2,Ut=(Bt+At)/2,Xt=t.project(er(Lt),Gi(Ut)),Gt=Math.max(0,N-Xt.x,q-Xt.y,Xt.x-K,Xt.y-lt);N=Math.min(N,Xt.x),K=Math.max(K,Xt.x),q=Math.min(q,Xt.y),lt=Math.max(lt,Xt.y),Gt>ut&&(ft(yt,Xt,Pt,Bt,Lt,Ut),ft(Xt,It,Lt,Ut,Ot,At))}ft(I,P,a,p,h,p),ft(P,R,h,p,h,_),ft(R,V,h,_,a,_),ft(V,I,a,_,a,p),N-=ut,q-=ut,K+=ut,lt+=ut;let gt=1/Math.max(K-N,lt-q);return{scale:gt,x:N*gt,y:q*gt,x2:K*gt,y2:lt*gt,projection:t}}te(gd,"CanonicalTileID"),te(en,"OverscaledTileID",{omit:["projMatrix"]});class Ng{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){let a=t[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}let Gv=["tile","layer","source","sourceLayer","state"];class jg{constructor(t,r,a,h,p){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=a,this._y=h,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(let r of Gv)this[r]!==void 0&&(t[r]=this[r]);return t}}let ir=32,Ur=33,ho=new Uint16Array(8184);for(let i=0;i<2046;i++){let t=i+2,r=0,a=0,h=0,p=0,_=0,g=0;for(1&t?h=p=_=ir:r=a=g=ir;(t>>=1)>1;){let S=r+h>>1,C=a+p>>1;1&t?(h=r,p=a,r=_,a=g):(r=h,a=p,h=_,p=g),_=S,g=C}let b=4*i;ho[b+0]=r,ho[b+1]=a,ho[b+2]=h,ho[b+3]=p}let Nr=new Uint16Array(2178),uo=new Uint8Array(1089),yd=new Uint16Array(1089);function Gg(i){return i===0?-.03125:i===32?.03125:0}var $g=st([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let qg={type:2,extent:we,loadGeometry:()=>[[new A(0,0),new A(8193,0),new A(8193,8193),new A(0,8193),new A(0,0)]]};class Rf{constructor(t,r,a,h,p){this.tileID=t,this.uid=le(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(t){let r=t+this.timeAdded;r<Ji.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ua(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,a){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,p){let _={};if(!p)return _;for(let g of h){let b=g.layerIds.map(S=>p.getLayer(S)).filter(Boolean);if(b.length!==0){g.layers=b,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(S=>b.filter(C=>C.id===S)[0]));for(let S of b)_[S.id]=g}}return _}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(let h in this.buckets){let p=this.buckets[h];if(p instanceof co){if(this.hasSymbolBuckets=!0,!a)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let h in this.buckets){let p=this.buckets[h];if(p instanceof co&&p.hasRTLText){this.hasRTLText=!0,Sn.isLoading()||Sn.isLoaded()||pl()!=="deferred"||to();break}}this.queryPadding=0;for(let h in this.buckets){let p=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new pr}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(let a in this.buckets){let h=this.buckets[a];h.uploadPending()&&h.upload(t)}let r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ch(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ch(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ch(t,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,a,h,p,_,g,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:g,transform:_,params:p,tileTransform:this.tileTransform},t,r,a):{}}querySourceFeatures(t,r){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let h=a.loadVTLayers(),p=r?r.sourceLayer:"",_=h._geojsonTileLayer||h[p];if(!_)return;let g=zr(r&&r.filter),{z:b,x:S,y:C}=this.tileID.canonical,I={z:b,x:S,y:C};for(let P=0;P<_.length;P++){let R=_.feature(P);if(g.needGeometry){let q=aa(R,!0);if(!g.filter(new ii(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!g.filter(new ii(this.tileID.overscaledZ),R))continue;let V=a.getId(R,p),N=new jg(R,b,S,C,V);N.tile=I,t.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let r=this.expirationTime;if(t.cacheControl){let a=Kn(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let a=Date.now(),h=!1;if(this.expirationTime>a)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{let p=this.expirationTime-r;p?this.expirationTime=a+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0||!r)return;let a=this.latestFeatureIndex.loadVTLayers(),h=r.style.listImages();for(let p in this.buckets){if(!r.style.hasLayer(p))continue;let _=this.buckets[p],g=_.layers[0].sourceLayer||"_geojsonTileLayer",b=a[g],S=t[g];if(!b||!S||Object.keys(S).length===0)continue;if(_.update(S,b,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof ad||_ instanceof sd){let I=r.style._getSourceCache(_.layers[0].source);r._terrain&&r._terrain.enabled&&I&&_.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(I.id,this.tileID)}let C=r&&r.style&&r.style.getLayer(p);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ji.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Ji.now()+t}setTexture(t,r){let a=r.context,h=a.gl;this.texture=r.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new ch(a,t,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),a.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax))}setDependencies(t,r){let a={};for(let h of r)a[h]=!0;this.dependencies[t]=a}hasDependency(t,r){for(let a of t){let h=this.dependencies[a];if(h){for(let p of r)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;let a=xs(qg,this.tileID.canonical,this.tileTransform)[0],h=new it,p=new Re;for(let _=0;_<a.length;_++){let{x:g,y:b}=a[_];h.emplaceBack(g,b),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(h,hh.members),this._tileDebugSegments=xi.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;let a=xs(qg,this.tileID.canonical,this.tileTransform)[0],h,p;if(this.isRaster){let _=function(g,b){let S=ua(g,b),C=Math.pow(2,g.z);for(let q=0;q<Ur;q++)for(let K=0;K<Ur;K++){let lt=er((g.x+(K+Gg(K))/ir)/C),ut=Gi((g.y+(q+Gg(q))/ir)/C),ft=b.project(lt,ut),gt=q*Ur+K;Nr[2*gt+0]=Math.round((ft.x*S.scale-S.x)*we),Nr[2*gt+1]=Math.round((ft.y*S.scale-S.y)*we)}uo.fill(0),yd.fill(0);for(let q=2045;q>=0;q--){let K=4*q,lt=ho[K+0],ut=ho[K+1],ft=ho[K+2],gt=ho[K+3],yt=lt+ft>>1,It=ut+gt>>1,Pt=yt+It-ut,Bt=It+lt-yt,Ot=ut*Ur+lt,At=gt*Ur+ft,Lt=It*Ur+yt,Ut=Math.hypot((Nr[2*Ot+0]+Nr[2*At+0])/2-Nr[2*Lt+0],(Nr[2*Ot+1]+Nr[2*At+1])/2-Nr[2*Lt+1])>=16;if(uo[Lt]=uo[Lt]||(Ut?1:0),q<1022){let Xt=(ut+Bt>>1)*Ur+(lt+Pt>>1),Gt=(gt+Bt>>1)*Ur+(ft+Pt>>1);uo[Lt]=uo[Lt]||uo[Xt]||uo[Gt]}}let I=new at,P=new ee,R=0;function V(q,K){let lt=K*Ur+q;return yd[lt]===0&&(I.emplaceBack(Nr[2*lt+0],Nr[2*lt+1],q*we/ir,K*we/ir),yd[lt]=++R),yd[lt]-1}function N(q,K,lt,ut,ft,gt){let yt=q+lt>>1,It=K+ut>>1;if(Math.abs(q-ft)+Math.abs(K-gt)>1&&uo[It*Ur+yt])N(ft,gt,q,K,yt,It),N(lt,ut,ft,gt,yt,It);else{let Pt=V(q,K),Bt=V(lt,ut),Ot=V(ft,gt);P.emplaceBack(Pt,Bt,Ot)}}return N(0,0,ir,ir,ir,0),N(ir,ir,0,0,0,ir),{vertices:I,indices:P}}(this.tileID.canonical,r);h=_.vertices,p=_.indices}else{h=new at,p=new ee;for(let{x:g,y:b}of a)h.emplaceBack(g,b,0,0);let _=td(h.int16,void 0,4);for(let g=0;g<_.length;g+=3)p.emplaceBack(_[g],_[g+1],_[g+2])}this._tileBoundsBuffer=t.createVertexBuffer(h,$g.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(p),this._tileBoundsSegments=xi.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(t,r){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!r||r.name!=="globe")return;let a=this.tileID.canonical,h=Bg(uh(a));this._makeGlobeTileDebugBorderBuffer(t,a,h),this._makeGlobeTileDebugTextBuffer(t,a,h)}_makeGlobeTileDebugBorderBuffer(t,r,a){let h=new it,p=new Re,_=new nt,g=(S,C,I,P,R)=>{let V=(I-S)/(R-1),N=(P-C)/(R-1),q=h.length;for(let K=0;K<R;K++){let lt=S+K*V,ut=C+K*N;h.emplaceBack(lt,ut);let ft=Rg(lt,ut,r),gt=ca(ft,ft,a);_.emplaceBack(gt[0],gt[1],gt[2]),p.emplaceBack(q+K)}},b=we;g(0,0,b,0,16),g(b,0,b,b,16),g(b,b,0,b,16),g(0,b,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(h,hh.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(_,Dg.members),this._tileDebugSegments=xi.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugTextBuffer(t,r,a){let h=new it,p=new ee,_=new nt,g=25;p.reserve(32),h.reserve(g),_.reserve(g);let b=(S,C)=>g*S+C;for(let S=0;S<g;S++){let C=2048*S;for(let I=0;I<g;I++){let P=2048*I;h.emplaceBack(P,C);let R=Rg(P,C,r),V=ca(R,R,a);_.emplaceBack(V[0],V[1],V[2])}}for(let S=0;S<4;S++)for(let C=0;C<4;C++){let I=b(S,C),P=b(S,C+1),R=b(S+1,C),V=b(S+1,C+1);p.emplaceBack(I,P,R),p.emplaceBack(R,P,V)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(p),this._tileDebugTextBuffer=t.createVertexBuffer(h,hh.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(_,Dg.members),this._tileDebugTextSegments=xi.simpleSegment(0,0,g,32)}}class $v{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,a){let h=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},jt(this.stateChanges[t][h],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(let p in this.state[t])p!==h&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(let p in this.state[t][h])a[p]||(this.deletedStates[t][h][p]=null)}else for(let p in a)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][p]===null&&delete this.deletedStates[t][h][p]}removeFeatureState(t,r,a){if(this.deletedStates[t]===null)return;let h=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&r!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][a]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(a in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][a]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,r){let a=String(r),h=jt({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){let p=this.deletedStates[t][r];if(p===null)return{};for(let _ in p)delete h[_]}return h}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){let a={};for(let h in this.stateChanges){this.state[h]=this.state[h]||{};let p={};for(let _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),jt(this.state[h][_],this.stateChanges[h][_]),p[_]=this.state[h][_];a[h]=p}for(let h in this.deletedStates){this.state[h]=this.state[h]||{};let p={};if(this.deletedStates[h]===null)for(let _ in this.state[h])p[_]={},this.state[h][_]={};else for(let _ in this.deletedStates[h]){if(this.deletedStates[h][_]===null)this.state[h][_]={};else for(let g of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][g];p[_]=this.state[h][_]}a[h]=a[h]||{},jt(a[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let h in t)t[h].setFeatureState(a,r)}}class Wg{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){let a=this.toIdx(t,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function Xg(i,t,r,a){let h=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(a[_])<1e-15){if(r[_]<i[_]||r[_]>t[_])return null}else{let g=1/a[_],b=(i[_]-r[_])*g,S=(t[_]-r[_])*g;if(b>S){let C=b;b=S,S=C}if(b>h&&(h=b),S<p&&(p=S),h>p)return null}return h}function Hg(i,t,r,a,h,p,_,g,b,S,C){let I=a-i,P=h-t,R=p-r,V=_-i,N=g-t,q=b-r,K=C[1]*q-C[2]*N,lt=C[2]*V-C[0]*q,ut=C[0]*N-C[1]*V,ft=I*K+P*lt+R*ut;if(Math.abs(ft)<1e-15)return null;let gt=1/ft,yt=S[0]-i,It=S[1]-t,Pt=S[2]-r,Bt=(yt*K+It*lt+Pt*ut)*gt;if(Bt<0||Bt>1)return null;let Ot=It*R-Pt*P,At=Pt*I-yt*R,Lt=yt*P-It*I,Ut=(C[0]*Ot+C[1]*At+C[2]*Lt)*gt;return Ut<0||Bt+Ut>1?null:(V*Ot+N*At+q*Lt)*gt}function Yg(i,t,r){return(i-t)/(r-t)}function Kg(i,t,r,a,h,p,_,g,b){let S=1<<r,C=p-a,I=_-h,P=(i+1)/S*C+a,R=(t+0)/S*I+h,V=(t+1)/S*I+h;g[0]=(i+0)/S*C+a,g[1]=R,b[0]=P,b[1]=V}class Jg{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let r=function(p){let _=Math.ceil(Math.log2(p.dim/8)),g=[],b=Math.ceil(Math.pow(2,_)),S=1/b,C=(R,V,N,q,K)=>{let lt=q?1:0,ut=(R+1)*N-lt,ft=V*N,gt=(V+1)*N-lt;K[0]=R*N,K[1]=ft,K[2]=ut,K[3]=gt},I=new Wg(b),P=[];for(let R=0;R<b*b;R++){C(R%b,Math.floor(R/b),S,!1,P);let V=po(P[0],P[1],p),N=po(P[2],P[1],p),q=po(P[2],P[3],p),K=po(P[0],P[3],p);I.minimums.push(Math.min(V,N,q,K)),I.maximums.push(Math.max(V,N,q,K)),I.leaves.push(1)}for(g.push(I),b/=2;b>=1;b/=2){let R=g[g.length-1];I=new Wg(b);for(let V=0;V<b*b;V++){C(V%b,Math.floor(V/b),2,!0,P);let N=R.getElevation(P[0],P[1]),q=R.getElevation(P[2],P[1]),K=R.getElevation(P[2],P[3]),lt=R.getElevation(P[0],P[3]),ut=R.isLeaf(P[0],P[1]),ft=R.isLeaf(P[2],P[1]),gt=R.isLeaf(P[2],P[3]),yt=R.isLeaf(P[0],P[3]),It=Math.min(N.min,q.min,K.min,lt.min),Pt=Math.max(N.max,q.max,K.max,lt.max),Bt=ut&&ft&&gt&&yt;I.maximums.push(Pt),I.minimums.push(It),I.leaves.push(Pt-It<=5&&Bt?1:0)}g.push(I)}return g}(this.dem),a=r.length-1,h=r[a];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(t,r,a,h,p,_,g=1){return Xg([t,r,-100],[a,h,this.maximums[0]*g],p,_)}raycast(t,r,a,h,p,_,g=1){if(!this.nodeCount)return null;let b=this.raycastRoot(t,r,a,h,p,_,g);if(b==null)return null;let S=[],C=[],I=[],P=[],R=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;R.length>0;){let{idx:V,t:N,nodex:q,nodey:K,depth:lt}=R.pop();if(this.leaves[V]){Kg(q,K,lt,t,r,a,h,I,P);let ft=1<<lt,gt=(q+0)/ft,yt=(q+1)/ft,It=(K+0)/ft,Pt=(K+1)/ft,Bt=po(gt,It,this.dem)*g,Ot=po(yt,It,this.dem)*g,At=po(yt,Pt,this.dem)*g,Lt=po(gt,Pt,this.dem)*g,Ut=Hg(I[0],I[1],Bt,P[0],I[1],Ot,P[0],P[1],At,p,_),Xt=Hg(P[0],P[1],At,I[0],P[1],Lt,I[0],I[1],Bt,p,_),Gt=Math.min(Ut!==null?Ut:Number.MAX_VALUE,Xt!==null?Xt:Number.MAX_VALUE);if(Gt!==Number.MAX_VALUE)return Gt;{let Wt=sf([],p,_,N);if(Qg(Bt,Ot,Lt,At,Yg(Wt[0],I[0],P[0]),Yg(Wt[1],I[1],P[1]))>=Wt[2])return N}continue}let ut=0;for(let ft=0;ft<this._siblingOffset.length;ft++){Kg((q<<1)+this._siblingOffset[ft][0],(K<<1)+this._siblingOffset[ft][1],lt+1,t,r,a,h,I,P),I[2]=-100,P[2]=this.maximums[this.childOffsets[V]+ft]*g;let gt=Xg(I,P,p,_);if(gt!=null){let yt=gt;S[ft]=yt;let It=!1;for(let Pt=0;Pt<ut&&!It;Pt++)yt>=S[C[Pt]]&&(C.splice(Pt,0,ft),It=!0);It||(C[ut]=ft),ut++}}for(let ft=0;ft<ut;ft++){let gt=C[ft];R.push({idx:this.childOffsets[V]+gt,t:S[gt],nodex:(q<<1)+this._siblingOffset[gt][0],nodey:(K<<1)+this._siblingOffset[gt][1],depth:lt+1})}}return null}_addNode(t,r,a){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,a,h,p){if(t[h].isLeaf(r,a)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);let _=h-1,g=t[_],b=0,S=0;for(let C=0;C<this._siblingOffset.length;C++){let I=2*r+this._siblingOffset[C][0],P=2*a+this._siblingOffset[C][1],R=g.getElevation(I,P),V=g.isLeaf(I,P),N=this._addNode(R.min,R.max,V);V&&(b|=1<<C),S||(S=N)}for(let C=0;C<this._siblingOffset.length;C++)b&1<<C||this._construct(t,2*r+this._siblingOffset[C][0],2*a+this._siblingOffset[C][1],_,S+C)}}function Qg(i,t,r,a,h,p){return de(de(i,r,p),de(t,a,p),h)}function po(i,t,r){let a=r.dim,h=_t(i*a-.5,0,a-1),p=_t(t*a-.5,0,a-1),_=Math.floor(h),g=Math.floor(p),b=Math.min(_+1,a-1),S=Math.min(g+1,a-1);return Qg(r.get(_,g),r.get(b,g),r.get(_,S),r.get(b,S),h-_,p-g)}let t0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class xd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,a,h=!1,p=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return qe(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;let _=this.dim=r.height-2,g=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=h,!h){for(let b=0;b<_;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(_,b)]=g[this._idx(_-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,_)]=g[this._idx(b,_-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(_,-1)]=g[this._idx(_-1,0)],g[this._idx(-1,_)]=g[this._idx(0,_-1)],g[this._idx(_,_)]=g[this._idx(_-1,_-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Jg(this)}get(t,r,a=!1){a&&(t=_t(t,-1,this.dim),r=_t(r,-1,this.dim));let h=4*this._idx(t,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(t){return t0[t]}get unpackVector(){return t0[this.encoding]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}_unpackMapbox(t,r,a){return(256*t*256+256*r+a)/10-1e4}_unpackTerrarium(t,r,a){return 256*t+r+a/256-32768}static pack(t,r){let a=[0,0,0,0],h=xd.getUnpackVector(r),p=Math.floor((t+h[3])/h[2]);return a[2]=p%256,p=Math.floor(p/256),a[1]=p%256,p=Math.floor(p/256),a[0]=p,a}getPixels(){return new An({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,p=r*this.dim+this.dim,_=a*this.dim,g=a*this.dim+this.dim;switch(r){case-1:h=p-1;break;case 1:p=h+1}switch(a){case-1:_=g-1;break;case 1:g=_+1}let b=-r*this.dim,S=-a*this.dim;for(let C=_;C<g;C++)for(let I=h;I<p;I++){let P=4*this._idx(I,C),R=4*this._idx(I+b,C+S);this.pixels[P+0]=t.pixels[R+0],this.pixels[P+1]=t.pixels[R+1],this.pixels[P+2]=t.pixels[R+2],this.pixels[P+3]=t.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}te(xd,"DEMData"),te(Jg,"DemMinMaxQuadTree",{omit:["dem"]});class qv{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(let t in this.data)for(let r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,a){let h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);let p={value:r,timeout:void 0};if(a!==void 0&&(p.timeout=setTimeout(()=>{this.remove(t,p)},a)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){let _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){let r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;let a=t.wrapped().key,h=r===void 0?0:this.data[a].indexOf(r),p=this.data[a][h];return this.data[a].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(p.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){let r=[];for(let a in this.data)for(let h of this.data[a])t(h.value)||r.push(h);for(let a of r)this.remove(a.value.tileID,a)}}class kl{constructor(t,r,a){this.func=t,this.mask=r,this.range=a}}kl.ReadOnly=!1,kl.ReadWrite=!0,kl.disabled=new kl(519,kl.ReadOnly,[0,1]);let Bf=7680;class Ff{constructor(t,r,a,h,p,_){this.test=t,this.ref=r,this.mask=a,this.fail=h,this.depthFail=p,this.pass=_}}Ff.disabled=new Ff({func:519,mask:0},0,0,Bf,Bf,Bf);class jr{constructor(t,r,a){this.blendFunction=t,this.blendColor=r,this.mask=a}}jr.Replace=[1,0],jr.disabled=new jr(jr.Replace,Fe.transparent,[!1,!1,!1,!1]),jr.unblended=new jr(jr.Replace,Fe.transparent,[!0,!0,!0,!0]),jr.alphaBlended=new jr([1,771],Fe.transparent,[!0,!0,!0,!0]);let Of=1029,Vf=2305;class gr{constructor(t,r,a){this.enable=t,this.mode=r,this.frontFace=a}}gr.disabled=new gr(!1,Of,Vf),gr.backCCW=new gr(!0,Of,Vf),gr.backCW=new gr(!0,Of,2304),gr.frontCW=new gr(!0,1028,2304),gr.frontCCW=new gr(!0,1028,Vf);class da extends _e{constructor(t,r,a){super(),this.id=t,this._onlySymbols=a,r.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new qv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new $v,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles){let r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(let r in this._tiles){let a=this._tiles[r];this._source.prepareTile(a)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,a.tileID),a.upload(t),a.prepare(this.map.style.imageManager)}else for(let r in this._tiles){let a=this._tiles[r];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Yt(this._tiles).map(t=>t.tileID).sort(e0).map(t=>t.key)}getRenderableIds(t){let r=[];for(let a in this._tiles)this._isIdRenderable(+a,t)&&r.push(this._tiles[a]);return t?r.sort((a,h)=>{let p=a.tileID,_=h.tileID,g=new A(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new A(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||b.y-g.y||b.x-g.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(e0).map(a=>a.key)}hasRenderableParent(t){let r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){let a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,t,r)))}_tileLoaded(t,r,a,h){if(h)if(t.state="errored",h.status!==404)this._source.fire(new he(h,{tile:t}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=Ji.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new ce("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){let r=this.getRenderableIds();for(let h=0;h<r.length;h++){let p=r[h];if(t.neighboringTiles&&t.neighboringTiles[p]){let _=this.getTileByID(p);a(t,_),a(_,t)}}function a(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-h.tileID.canonical.x,g=p.tileID.canonical.y-h.tileID.canonical.y,b=Math.pow(2,h.tileID.canonical.z),S=p.tileID.key;_===0&&g===0||Math.abs(g)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,_,g),h.neighboringTiles&&h.neighboringTiles[S]&&(h.neighboringTiles[S].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,a,h){for(let p in this._tiles){let _=this._tiles[p];if(h[p]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>a)continue;let g=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){let S=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[S.key],_&&_.hasData()&&(g=S)}let b=g;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){h[g.key]=g;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){let a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=t.overscaledZ-1;a>=r;a--){let h=t.scaledTo(a),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(t){let r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;let a=Math.ceil(t.width/r)+1,h=Math.ceil(t.height/r)+1,p=Math.floor(a*h*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(g)}handleWrapJump(t){let r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){let a={};for(let h in this._tiles){let p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),a[p.tileID.key]=p}this._tiles=a;for(let h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(let h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(t,r,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let h;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new en(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(h=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(g=>this._source.hasTile(g)))):h=[];let p=this._updateRetainedTiles(h);if(i0(this._source.type)&&h.length!==0){let g={},b={},S=Object.keys(p);for(let I of S){let P=p[I],R=this._tiles[I];if(!R||R.fadeEndTime&&R.fadeEndTime<=Ji.now())continue;let V=this.findLoadedParent(P,Math.max(P.overscaledZ-da.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),g[V.tileID.key]=V.tileID),b[I]=P}let C=h[h.length-1].overscaledZ;for(let I in this._tiles){let P=this._tiles[I];if(p[I]||!P.hasData())continue;let R=P.tileID;for(;R.overscaledZ>C;){R=R.scaledTo(R.overscaledZ-1);let V=this._tiles[R.key];if(V&&V.hasData()&&b[R.key]){p[I]=P.tileID;break}}}for(let I in g)p[I]||(this._coveredTiles[I]=!0,p[I]=g[I])}for(let g in p)this._tiles[g].clearFadeHold();let _=function(g,b){let S=[];for(let C in g)C in b||S.push(C);return S}(this._tiles,p);for(let g of _){let b=this._tiles[g];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let r={};if(t.length===0)return r;let a={},h=t.reduce((S,C)=>Math.min(S,C.overscaledZ),1/0),p=t[0].overscaledZ,_=Math.max(p-da.maxOverzooming,this._source.minzoom),g=Math.max(p+da.maxUnderzooming,this._source.minzoom),b={};for(let S of t){let C=this._addTile(S);r[S.key]=S,C.hasData()||h<this._source.maxzoom&&(b[S.key]=S)}this._retainLoadedChildren(b,h,g,r);for(let S of t){let C=this._tiles[S.key];if(C.hasData())continue;if(S.canonical.z>=this._source.maxzoom){let P=S.children(this._source.maxzoom)[0],R=this.getTile(P);if(R&&R.hasData()){r[P.key]=P;continue}}else{let P=S.children(this._source.maxzoom);if(r[P[0].key]&&r[P[1].key]&&r[P[2].key]&&r[P[3].key])continue}let I=C.wasRequested();for(let P=S.overscaledZ-1;P>=_;--P){let R=S.scaledTo(P);if(a[R.key]||(a[R.key]=!0,C=this.getTile(R),!C&&I&&(C=this._addTile(R)),C&&(r[R.key]=R,I=C.wasRequested(),C.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let r=[],a,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){a=this._loadedParentTiles[h.key];break}r.push(h.key);let p=h.scaledTo(h.overscaledZ-1);if(a=this._getLoadedTile(p),a)break;h=p}for(let p of r)this._loadedParentTiles[p]=a}}_addTile(t){let r=this._tiles[t.key];if(r)return this._source.prepareTile&&this._source.prepareTile(r),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));let a=Boolean(r);if(!a){let h=this.map?this.map.painter:null;r=new Rf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._source.prepareTile&&this._source.prepareTile(r)||this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,a||this._source.fire(new ce("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let a=r.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){let r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,a){let h=[],p=this.transform;if(!p)return h;for(let _ in this._tiles){let g=this._tiles[_];if(a&&g.clearQueryDebugViz(),g.holdingForFade())continue;let b=t.containsTile(g,p,r);b&&h.push(b)}return h}getVisibleCoordinates(t){let r=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(let a of r)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(i0(this._source.type))for(let t in this._tiles){let r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=Ji.now())return!0}return!1}setFeatureState(t,r,a){this._state.updateState(t=t||"_geojsonTileLayer",r,a)}removeFeatureState(t,r,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,a)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,a){let h=this._tiles[t];h&&h.setDependencies(r,a)}reloadTilesForDependencies(t,r){for(let a in this._tiles)this._tiles[a].hasDependency(t,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(t,r))}_preloadTiles(t,r){let a=new Map,h=Array.isArray(t)?t:[t],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(let g of h){let b=g.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let S of b)a.set(S.key,S);this.usedForTerrain&&g.updateElevation(!1)}Vt(Array.from(a.values()),(g,b)=>{let S=new Rf(g,this._source.tileSize*g.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,C=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),b(C,S)})},r)}}function e0(i,t){let r=Math.abs(2*i.wrap)-+(i.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return i.overscaledZ-t.overscaledZ||a-r||t.canonical.y-i.canonical.y||t.canonical.x-i.canonical.x}function i0(i){return i==="raster"||i==="image"||i==="video"}da.maxOverzooming=10,da.maxUnderzooming=3;class vd{constructor(t,r,a){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(t,r,a){let h=a||t.findDEMTileFor(r);if(!h||!h.dem)return;let p=h.dem,_=h.tileID,g=1<<r.canonical.z-_.canonical.z;return new vd(h,h.tileSize/we/g,[(r.canonical.x/g-_.canonical.x)*p.dim,(r.canonical.y/g-_.canonical.y)*p.dim])}tileCoordToPixel(t,r){let a=r*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),p=Math.floor(a);return new A(h,p)}getElevationAt(t,r,a,h){let p=t*this._scale+this._offset[0],_=r*this._scale+this._offset[1],g=Math.floor(p),b=Math.floor(_),S=this._dem;return h=!!h,a?de(de(S.get(g,b,h),S.get(g,b+1,h),_-b),de(S.get(g+1,b,h),S.get(g+1,b+1,h),_-b),p-g):S.get(g,b,h)}getElevationAtPixel(t,r,a){return this._dem.get(t,r,!!a)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*_l(1,t)*this._dem.stride}}class n0{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Rr(we,16,0),this.featureIndexArray=new ui,this.promoteId=r}insert(t,r,a,h,p,_=0){let g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,p,_);let b=this.grid;for(let S=0;S<r.length;S++){let C=r[S],I=[1/0,1/0,-1/0,-1/0];for(let P=0;P<C.length;P++){let R=C[P];I[0]=Math.min(I[0],R.x),I[1]=Math.min(I[1],R.y),I[2]=Math.max(I[2],R.x),I[3]=Math.max(I[3],R.y)}I[0]<we&&I[1]<we&&I[2]>=0&&I[3]>=0&&b.insert(g,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ha.VectorTile(new oh(this.rawTileData)).layers,this.sourceLayerCoder=new Ng(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r,a,h){this.loadVTLayers();let p=t.params||{},_=zr(p.filter),g=t.tileResult,b=t.transform,S=g.bufferedTilespaceBounds,C=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(V,N,q,K)=>S_(g.bufferedTilespaceGeometry,V,N,q,K));C.sort(Wv);let I=null;b.elevation&&C.length>0&&(I=vd.create(b.elevation,this.tileID));let P={},R;for(let V=0;V<C.length;V++){let N=C[V];if(N===R)continue;R=N;let q=this.featureIndexArray.get(N),K=null;this.loadMatchingFeature(P,q,_,p.layers,p.availableImages,r,a,h,(lt,ut,ft,gt=0)=>(K||(K=xs(lt,this.tileID.canonical,t.tileTransform)),ut.queryIntersectsFeature(g,lt,ft,K,this.z,t.transform,t.pixelPosMatrix,I,gt)))}return P}loadMatchingFeature(t,r,a,h,p,_,g,b,S){let{featureIndex:C,bucketIndex:I,sourceLayerIndex:P,layoutVertexArrayOffset:R}=r,V=this.bucketLayerIDs[I];if(h&&!function(lt,ut){for(let ft=0;ft<lt.length;ft++)if(ut.indexOf(lt[ft])>=0)return!0;return!1}(h,V))return;let N=this.sourceLayerCoder.decode(P),q=this.vtLayers[N].feature(C);if(a.needGeometry){let lt=aa(q,!0);if(!a.filter(new ii(this.tileID.overscaledZ),lt,this.tileID.canonical))return}else if(!a.filter(new ii(this.tileID.overscaledZ),q))return;let K=this.getId(q,N);for(let lt=0;lt<V.length;lt++){let ut=V[lt];if(h&&h.indexOf(ut)<0)continue;let ft=_[ut];if(!ft)continue;let gt={};K!==void 0&&b&&(gt=b.getState(ft.sourceLayer||"_geojsonTileLayer",K));let yt=jt({},g[ut]);yt.paint=r0(yt.paint,ft.paint,q,gt,p),yt.layout=r0(yt.layout,ft.layout,q,gt,p);let It=!S||S(q,ft,gt,R);if(!It)continue;let Pt=new jg(q,this.z,this.x,this.y,K);Pt.layer=yt;let Bt=t[ut];Bt===void 0&&(Bt=t[ut]=[]),Bt.push({featureIndex:C,feature:Pt,intersectionZ:It})}}lookupSymbolFeatures(t,r,a,h,p,_,g,b){let S={};this.loadVTLayers();let C=zr(p);for(let I of t)this.loadMatchingFeature(S,{bucketIndex:a,sourceLayerIndex:h,featureIndex:I,layoutVertexArrayOffset:0},C,_,g,b,r);return S}loadFeature(t){let{featureIndex:r,sourceLayerIndex:a}=t;this.loadVTLayers();let h=this.sourceLayerCoder.decode(a),p=this.vtFeatures[h];if(p[r])return p[r];let _=this.vtLayers[h].feature(r);return p[r]=_,_}hasLayer(t){for(let r of this.bucketLayerIDs)for(let a of r)if(t===a)return!0;return!1}getId(t,r){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function r0(i,t,r,a,h){return Ui(i,(p,_)=>{let g=t instanceof v?t.get(_):null;return g&&g.evaluate?g.evaluate(r,a,h):g})}function Wv(i,t){return t-i}te(n0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class s0{constructor(t){let r={},a=[];for(let g in t){let b=t[g],S=r[g]={};for(let C in b.glyphs){let I=b.glyphs[+C];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;let P=I.metrics.localGlyph?2:1,R={x:0,y:0,w:I.bitmap.width+2*P,h:I.bitmap.height+2*P};a.push(R),S[C]=R}}let{w:h,h:p}=gf(a),_=new vs({width:h||1,height:p||1});for(let g in t){let b=t[g];for(let S in b.glyphs){let C=b.glyphs[+S];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;let I=r[g][S],P=C.metrics.localGlyph?2:1;vs.copy(C.bitmap,_,{x:0,y:0},{x:I.x+P,y:I.y+P},C.bitmap)}}this.image=_,this.positions=r}}te(s0,"GlyphAtlas");class Xv{constructor(t){this.tileID=new en(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=ua(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,r,a,h,p){this.status="parsing",this.data=t,this.collisionBoxArray=new pr;let _=new Ng(Object.keys(t.layers).sort()),g=new n0(this.tileID,this.promoteId);g.bucketLayerIDs=[];let b={},S=new Pf(256,256),C={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:a},I=r.familiesBySource[this.source];for(let gt in I){let yt=t.layers[gt];if(!yt)continue;let It=!1,Pt=!1;for(let At of I[gt])At[0].type==="symbol"?It=!0:Pt=!0;if(this.isSymbolTile===!0&&!It||this.isSymbolTile===!1&&!Pt)continue;yt.version===1&&qe(`Vector tile source "${this.source}" layer "${gt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Bt=_.encode(gt),Ot=[];for(let At=0;At<yt.length;At++){let Lt=yt.feature(At),Ut=g.getId(Lt,gt);Ot.push({feature:Lt,id:Ut,index:At,sourceLayerIndex:Bt})}for(let At of I[gt]){let Lt=At[0];this.isSymbolTile!==void 0&&Lt.type==="symbol"!==this.isSymbolTile||Lt.minzoom&&this.zoom<Math.floor(Lt.minzoom)||Lt.maxzoom&&this.zoom>=Lt.maxzoom||Lt.visibility!=="none"&&(Zf(At,this.zoom,a),(b[Lt.id]=Lt.createBucket({index:g.bucketLayerIDs.length,layers:At,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:a})).populate(Ot,C,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(At.map(Ut=>Ut.id)))}}let P,R,V,N;S.trim();let q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},K=Ui(C.glyphDependencies,gt=>Object.keys(gt).map(Number));Object.keys(K).length?h.send("getGlyphs",{uid:this.uid,stacks:K},(gt,yt)=>{P||(P=gt,R=yt,ft.call(this))},void 0,!1,q):R={};let lt=Object.keys(C.iconDependencies);lt.length?h.send("getImages",{icons:lt,source:this.source,tileID:this.tileID,type:"icons"},(gt,yt)=>{P||(P=gt,V=yt,ft.call(this))},void 0,!1,q):V={};let ut=Object.keys(C.patternDependencies);function ft(){if(P)return p(P);if(R&&V&&N){let gt=new s0(R),yt=new hg(V,N);for(let It in b){let Pt=b[It];Pt instanceof co?(Zf(Pt.layers,this.zoom,a),wv(Pt,R,gt.positions,V,yt.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Pt.hasPattern&&(Pt instanceof ad||Pt instanceof sd||Pt instanceof nh)&&(Zf(Pt.layers,this.zoom,a),Pt.addFeatures(C,this.tileID.canonical,yt.patternPositions,a,this.tileTransform))}this.status="done",p(null,{buckets:Yt(b).filter(It=>!It.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:gt.image,lineAtlas:S,imageAtlas:yt,glyphMap:this.returnDependencies?R:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?gt.positions:null})}}ut.length?h.send("getImages",{icons:ut,source:this.source,tileID:this.tileID,type:"patterns"},(gt,yt)=>{P||(P=gt,N=yt,ft.call(this))},void 0,!1,q):N={},ft.call(this)}}function Zf(i,t,r){let a=new ii(t);for(let h of i)h.recalculate(a,r)}class o0{constructor(t){this.entries={},this.scheduler=t}request(t,r,a,h){let p=this.entries[t]=this.entries[t]||{callbacks:[]};if(p.result){let[_,g]=p.result;return this.scheduler?this.scheduler.add(()=>{h(_,g)},r):h(_,g),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=a((_,g)=>{p.result=[_,g];for(let b of p.callbacks)this.scheduler?this.scheduler.add(()=>{b(_,g)},r):b(_,g);setTimeout(()=>delete this.entries[t],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==h),p.callbacks.length||(p.cancel(),delete this.entries[t]))}}}function a0(i,t,r){let a=JSON.stringify(i.request);return i.data&&(this.deduped.entries[a]={result:[null,i.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{let p=ot(i.request,(_,g,b,S)=>{_?h(_):g&&h(null,{vectorTile:r?void 0:new ha.VectorTile(new oh(g)),rawData:g,cacheControl:b,expires:S})});return()=>{p.cancel(),h()}},t)}let Hv=Vr(new Float32Array(16));class fo{constructor(t){this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new Ke(0,0)}projectTilePoint(t,r,a){return{x:t,y:r,z:0}}locationPoint(t,r){return t._coordinatePoint(t.locationCoordinate(r),!1)}pixelsPerMeter(t,r){return _l(1,t)*r}farthestPixelDistance(t){return function(r,a){let h=r.fovAboveCenter,p=r.elevation?r.elevation.getMinElevationBelowMSL()*a:0,_=(r._camera.position[2]*r.worldSize-p)/Math.cos(r._pitch),g=Math.sin(h)*_/Math.sin(Math.max(Math.PI/2-r._pitch-h,.01)),b=Math.sin(r._pitch)*g+_;return Math.min(1.01*b,_*(1/r._horizonShift))}(t,t.pixelsPerMeter)}pointCoordinate(t,r,a,h){let p=t.horizonLineFromTop(!1),_=new A(r,Math.max(p,a));return t.rayIntersectionCoordinate(t.pointRayIntersection(_,h))}createInversionMatrix(t,r){return Hv}createTileMatrix(t,r,a){let h,p,_,g=a.canonical,b=Vr(new Float64Array(16));if(this.isReprojectedInTileSpace){let S=ua(g,this);h=1,p=S.x+a.wrap*S.scale,_=S.y,oo(b,b,[h/S.scale,h/S.scale,t.pixelsPerMeter/r])}else h=r/t.zoomScale(g.z),p=(g.x+Math.pow(2,g.z)*a.wrap)*h,_=g.y*h;return la(b,b,[p,_,0]),oo(b,b,[h/we,h/we,1]),b}upVector(t,r,a){return[0,0,1]}upVectorScale(t,r,a){return{metersToTile:1,metersToLabelSpace:1}}}class Yv extends fo{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:$c(t),y:ml(r),z:0}}unproject(t,r){let a=er(t),h=Gi(r);return new Ke(a,h)}}class Kv extends fo{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];let[r,a]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(Q(r));this.n=(h+Math.sin(Q(a)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,r){let{n:a,c:h,r0:p}=this,_=Q(t-this.center[0]),g=Q(r),b=Math.sqrt(h-2*a*Math.sin(g))/a;return{x:b*Math.sin(_*a),y:b*Math.cos(_*a)-p,z:0}}unproject(t,r){let{n:a,c:h,r0:p}=this,_=p+r,g=Math.atan2(t,Math.abs(_))*Math.sign(_);_*a<0&&(g-=Math.PI*Math.sign(t)*Math.sign(_));let b=Q(this.center[0])*a;g=Rt(g,-Math.PI-b,Math.PI-b);let S=dt(g/a)+this.center[0],C=Math.asin(_t((h-(t*t+_*_)*a*a)/(2*a),-1,1)),I=_t(dt(C),-85.051129,Or);return new Ke(S,I)}}let ph=1.340264,fh=-.081106,mh=893e-6,_h=.003796,bd=Math.sqrt(3)/2;class Jv extends fo{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;let a=Math.asin(bd*Math.sin(r)),h=a*a,p=h*h*h;return{x:.5*(t*Math.cos(a)/(bd*(ph+3*fh*h+p*(7*mh+9*_h*h)))/Math.PI+.5),y:1-.5*(a*(ph+fh*h+p*(mh+_h*h))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,h=a*a,p=h*h*h;for(let C,I,P,R=0;R<12&&(I=a*(ph+fh*h+p*(mh+_h*h))-r,P=ph+3*fh*h+p*(7*mh+9*_h*h),C=I/P,a=_t(a-C,-Math.PI/3,Math.PI/3),h=a*a,p=h*h*h,!(Math.abs(C)<1e-12));++R);let _=bd*t*(ph+3*fh*h+p*(7*mh+9*_h*h))/Math.cos(a),g=Math.asin(Math.sin(a)/bd),b=_t(180*_/Math.PI,-180,180),S=_t(180*g/Math.PI,-85.051129,Or);return new Ke(b,S)}}class Qv extends fo{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){let a=360*(t-.5),h=_t(360*(.5-r),-85.051129,Or);return new Ke(a,h)}}let Pl=Math.PI/2;function wd(i){return Math.tan((Pl+i)/2)}class t2 extends fo{constructor(t){super(t),this.center=t.center||[0,30];let[r,a]=this.parallels=t.parallels||[30,30],h=Q(r),p=Q(a),_=Math.cos(h);this.n=h===p?Math.sin(h):Math.log(_/Math.cos(p))/Math.log(wd(p)/wd(h)),this.f=_*Math.pow(wd(h),this.n)/this.n}project(t,r){r=Q(r),t=Q(t-this.center[0]);let a=1e-6,{n:h,f:p}=this;p>0?r<-Pl+a&&(r=-Pl+a):r>Pl-a&&(r=Pl-a);let _=p/Math.pow(wd(r),h),g=_*Math.sin(h*t),b=p-_*Math.cos(h*t);return{x:.5*(g/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;let{n:a,f:h}=this,p=h-r,_=Math.sign(p),g=Math.sign(a)*Math.sqrt(t*t+p*p),b=Math.atan2(t,Math.abs(p))*_;p*a<0&&(b-=Math.PI*Math.sign(t)*_);let S=_t(dt(b/a)+this.center[0],-180,180),C=_t(dt(2*Math.atan(Math.pow(h/g,1/a))-Pl),-85.051129,Or);return new Ke(S,C)}}let l0=Q(Or);class e2 extends fo{project(t,r){let a=(r=Q(r))*r,h=a*a;return{x:.5*((t=Q(t))*(.8707-.131979*a+h*(h*(.003971*a-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+h*(.028874*a-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,h=25,p=0,_=a*a;do{_=a*a;let S=_*_;p=(a*(1.007226+_*(.015085+S*(.028874*_-.044475-.005916*S)))-r)/(1.007226+_*(.045255+S*(.259866*_-.311325-.005916*11*S))),a=_t(a-p,-l0,l0)}while(Math.abs(p)>1e-6&&--h>0);_=a*a;let g=_t(dt(t/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),b=dt(a);return new Ke(g,b)}}let c0=Q(Or);class i2 extends fo{project(t,r){r=Q(r),t=Q(t);let a=Math.cos(r),h=2/Math.PI,p=Math.acos(a*Math.cos(t/2)),_=Math.sin(p)/p,g=.5*(t*h+2*a*Math.sin(t/2)/_)||0,b=.5*(r+Math.sin(r)/_)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(t,r){let a=t=(2*t-.5)*Math.PI,h=r=(2*(1-r)-1)*Math.PI,p=25,_=1e-6,g=0,b=0;do{let S=Math.cos(h),C=Math.sin(h),I=2*C*S,P=C*C,R=S*S,V=Math.cos(a/2),N=Math.sin(a/2),q=2*V*N,K=N*N,lt=1-R*V*V,ut=lt?1/lt:0,ft=lt?Math.acos(S*V)*Math.sqrt(1/lt):0,gt=.5*(2*ft*S*N+2*a/Math.PI)-t,yt=.5*(ft*C+h)-r,It=.5*ut*(R*K+ft*S*V*P)+1/Math.PI,Pt=ut*(q*I/4-ft*C*N),Bt=.125*ut*(I*N-ft*C*R*q),Ot=.5*ut*(P*V+ft*K*S)+.5,At=Pt*Bt-Ot*It;g=(yt*Pt-gt*Ot)/At,b=(gt*Bt-yt*It)/At,a=_t(a-g,-Math.PI,Math.PI),h=_t(h-b,-c0,c0)}while((Math.abs(g)>_||Math.abs(b)>_)&&--p>0);return new Ke(dt(a),dt(h))}}class h0 extends fo{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Q(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){let{scale:a,cosPhi:h}=this;return{x:Q(t)*h*a+.5,y:-Math.sin(Q(r))/h*a+.5,z:0}}unproject(t,r){let{scale:a,cosPhi:h}=this,p=-(r-.5)/a,_=_t(dt((t-.5)/a)/h,-180,180),g=Math.asin(_t(p*h,-1,1)),b=_t(dt(g),-85.051129,Or);return new Ke(_,b)}}n.ARRAY_TYPE=Mn,n.AUTH_ERR_MSG=es,n.Aabb=Wn,n.Actor=class{constructor(i,t,r){this.target=i,this.parent=t,this.mapId=r,this.callbacks={},this.cancelCallbacks={},be(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Xi()?i:B,this.scheduler=new Bv}send(i,t,r,a,h=!1,p){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=p,this.callbacks[_]=r);let g=Tr(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!r,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:Jo(t,g)},g),{cancel:()=>{r&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(i){let t=i.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){let a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a.cancel()}else if(t.mustQueue||Xi()){let a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,t),a&&a.metadata||{type:"message"})}else this.processTask(r,t)}processTask(i,t){if(t.type==="<response>"){let r=this.callbacks[i];delete this.callbacks[i],r&&(t.error?r(Js(t.error)):r(null,Js(t.data)))}else{let r=Tr(this.globalScope)?void 0:[],a=t.hasCallback?(p,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:p?Jo(p):null,data:Jo(_,r)},r)}:p=>{},h=Js(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,h,a);else if(this.parent.getWorkerSource){let p=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,p[0],h.source)[p[1]](h,a)}else a(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.CanonicalTileID=gd,n.Color=Fe,n.ColorMode=jr,n.CullFaceMode=gr,n.DEMData=xd,n.DataConstantProperty=T,n.DedupedRequest=o0,n.DepthMode=kl,n.EXTENT=we,n.Elevation=class{isDataAvailableAtPoint(i){let t=this._source();if(!t||i.y<0||i.y>1)return!1;let r=t.getSource().maxzoom,a=1<<r,h=Math.floor(i.x),p=Math.floor((i.x-h)*a),_=Math.floor(i.y*a),g=this.findDEMTileFor(new en(r,h,r,p,_));return!(!g||!g.dem)}getAtPointOrZero(i,t=0){return this.getAtPoint(i,t)||0}getAtPoint(i,t,r=!0){t==null&&(t=null);let a=this._source();if(!a||i.y<0||i.y>1)return t;let h=a.getSource().maxzoom,p=1<<h,_=Math.floor(i.x),g=i.x-_,b=new en(h,_,h,Math.floor(g*p),Math.floor(i.y*p)),S=this.findDEMTileFor(b);if(!S||!S.dem)return t;let C=S.dem,I=1<<S.tileID.canonical.z,P=(g*I-S.tileID.canonical.x)*C.dim,R=(i.y*I-S.tileID.canonical.y)*C.dim,V=Math.floor(P),N=Math.floor(R);return(r?this.exaggeration():1)*de(de(C.get(V,N),C.get(V,N+1),R-N),de(C.get(V+1,N),C.get(V+1,N+1),R-N),P-V)}getAtTileOffset(i,t,r){let a=1<<i.canonical.z;return this.getAtPointOrZero(new Yu(i.wrap+(i.canonical.x+t/we)/a,(i.canonical.y+r/we)/a))}getAtTileOffsetFunc(i,t,r,a){return h=>{let p=this.getAtTileOffset(i,h.x,h.y),_=a.upVector(i.canonical,h.x,h.y);return Wc(_,_,p*a.upVectorScale(i.canonical,t,r).metersToTile),_}}getForTilePoints(i,t,r,a){let h=vd.create(this,i,a);return!!h&&(t.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],r)}),!0)}getMinMaxForTile(i){let t=this.findDEMTileFor(i);if(!t||!t.dem)return null;let r=t.dem.tree,a=t.tileID,h=1<<i.canonical.z-a.canonical.z,p=i.canonical.x/h-a.canonical.x,_=i.canonical.y/h-a.canonical.y,g=0;for(let b=0;b<i.canonical.z-a.canonical.z&&!r.leaves[g];b++){p*=2,_*=2;let S=2*Math.floor(_)+Math.floor(p);g=r.childOffsets[g]+S,p%=1,_%=1}return{min:this.exaggeration()*r.minimums[g],max:this.exaggeration()*r.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},n.ErrorEvent=he,n.EvaluationParameters=ii,n.Event=ce,n.Evented=_e,n.FillExtrusionBucket=nh,n.Frustum=of,n.GLOBE_RADIUS=Il,n.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i),this._createAtmosphere(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let i of this._poleSegments)i.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(i){let t=new it,r=new ee,a=65;for(let h=0;h<a;h++)for(let p=0;p<a;p++)t.emplaceBack(p,h);for(let h=0;h<64;h++)for(let p=0;p<64;p++){let _=h*a+p;r.emplaceBack(_+1,_,_+a),r.emplaceBack(_+a,_+a+1,_+1)}this._gridBuffer=i.createVertexBuffer(t,hh.members),this._gridIndexBuffer=i.createIndexBuffer(r,!0),this._gridSegments=xi.simpleSegment(0,0,4225,8192)}_createPoles(i){let t=new ee;for(let h=0;h<=64;h++)t.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=i.createIndexBuffer(t,!0);let r=new fe,a=new fe;this._poleSegments=[];for(let h=0,p=0;h<5;h++){let _=1<<h,g=512*_/Math.PI/2,b=360/_;r.emplaceBack(0,-g,0,0,0,.5,0),a.emplaceBack(0,-g,0,0,0,.5,1);for(let S=0;S<=64;S++){let C=S/64,I=de(0,b,C),[P,R,V]=Lg(Nv,jv,I,g);r.emplaceBack(P,R,V,0,0,C,0),a.emplaceBack(P,R,V,0,0,C,1)}this._poleSegments.push(xi.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(r,zg,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(a,zg,!1)}_createAtmosphere(i){let t=new Se;t.emplaceBack(-1,1,1,0,0),t.emplaceBack(1,1,1,1,0),t.emplaceBack(1,-1,1,1,1),t.emplaceBack(-1,-1,1,0,1);let r=new ee;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.atmosphereVertexBuffer=i.createVertexBuffer(t,Ov.members),this.atmosphereIndexBuffer=i.createIndexBuffer(r),this.atmosphereSegments=xi.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i){if(!this._wireframeSegments){let t=new ge,r=64,a=r+1;for(let h=0;h<r;h++)for(let p=0;p<r;p++){let _=h*a+p;t.emplaceBack(_,_+1),t.emplaceBack(_,_+a),t.emplaceBack(_,_+a+1)}this._wireframeIndexBuffer=i.createIndexBuffer(t),this._wireframeSegments=xi.simpleSegment(0,0,r*r,t.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},n.GlyphManager=Al,n.ImagePosition=yf,n.LineAtlas=Pf,n.LngLat=Ke,n.LngLatBounds=so,n.LocalGlyphMode=wf,n.MAX_MERCATOR_LATITUDE=Or,n.MercatorCoordinate=Yu,n.ONE_EM=$i,n.OverscaledTileID=en,n.Properties=O,n.RGBAImage=An,n.Ray=class{constructor(i,t){this.pos=i,this.dir=t}intersectsPlane(i,t,r){let a=Hc(t,this.dir);if(Math.abs(a)<1e-6)return!1;let h=((i[0]-this.pos[0])*t[0]+(i[1]-this.pos[1])*t[1]+(i[2]-this.pos[2])*t[2])/a;return r[0]=this.pos[0]+this.dir[0]*h,r[1]=this.pos[1]+this.dir[1]*h,r[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(i,t,r){if(function(P,R){var V=P[0],N=P[1],q=P[2],K=R[0],lt=R[1],ut=R[2];return Math.abs(V-K)<=Kp*Math.max(1,Math.abs(V),Math.abs(K))&&Math.abs(N-lt)<=Kp*Math.max(1,Math.abs(N),Math.abs(lt))&&Math.abs(q-ut)<=Kp*Math.max(1,Math.abs(q),Math.abs(ut))}(this.pos,i)||t===0)return r[0]=r[1]=r[2]=0,!1;let[a,h,p]=this.dir,_=this.pos[0]-i[0],g=this.pos[1]-i[1],b=this.pos[2]-i[2],S=a*a+h*h+p*p,C=2*(_*a+g*h+b*p),I=C*C-4*S*(_*_+g*g+b*b-t*t);if(I<0){let P=Math.max(-C/2,0),R=_+a*P,V=g+h*P,N=b+p*P,q=Math.hypot(R,V,N);return r[0]=R*t/q,r[1]=V*t/q,r[2]=N*t/q,!1}{let P=(-C-Math.sqrt(I))/(2*S);if(P<0){let R=Math.hypot(_,g,b);return r[0]=_*t/R,r[1]=g*t/R,r[2]=b*t/R,!1}return r[0]=_+a*P,r[1]=g+h*P,r[2]=b+p*P,!0}}},n.RequestManager=class{constructor(i,t,r){this._transformRequestFn=i,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){let i=function(){let t="";for(let r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Bs,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,t){return this._transformRequestFn&&this._transformRequestFn(i,t)||{url:i}}normalizeStyleURL(i,t){if(!Vn(i))return i;let r=Un(i);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeGlyphsURL(i,t){if(!Vn(i))return i;let r=Un(i);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeSourceURL(i,t){if(!Vn(i))return i;let r=Un(i);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(i,t,r,a){let h=Un(i);return Vn(i)?(h.path=`/styles/v1${h.path}/sprite${t}${r}`,this._makeAPIURL(h,this._customAccessToken||a)):(h.path+=`${t}${r}`,Er(h))}normalizeTileURL(i,t,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Vn(i))return i;let a=Un(i);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||r&&a.authority!=="raster"&&r===512?"@2x":""}${Sr.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${Oe.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${Oe.TILE_URL_VERSION}${a.path}`);let h=this._customAccessToken||function(p){for(let _ of p){let g=_.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(a.params)||Oe.ACCESS_TOKEN;return Oe.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,h)}canonicalizeTileURL(i,t){let r=Un(i);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return i;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${Oe.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${Oe.TILE_URL_VERSION}/`,"")}`;let h=r.params;return t&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(a+=`?${h.join("&")}`),a}canonicalizeTileset(i,t){let r=!!t&&Vn(t),a=[];for(let h of i.tiles||[])is(h)?a.push(this.canonicalizeTileURL(h,r)):a.push(h);return a}_makeAPIURL(i,t){let r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=Un(Oe.API_URL);if(i.protocol=a.protocol,i.authority=a.authority,i.protocol==="http"){let h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(a.path!=="/"&&(i.path=`${a.path}${i.path}`),!Oe.REQUIRE_ACCESS_TOKEN)return Er(i);if(t=t||Oe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${t||""}`),Er(i)}},n.ResourceType=J,n.SegmentVector=xi,n.SourceCache=da,n.StencilMode=Ff,n.StructArrayLayout1ui2=Re,n.StructArrayLayout2f1f2i16=re,n.StructArrayLayout2i4=it,n.StructArrayLayout2ui4=ge,n.StructArrayLayout3f12=$t,n.StructArrayLayout3ui6=ee,n.StructArrayLayout4i8=at,n.Texture=ch,n.Tile=Rf,n.Transitionable=d,n.Uniform1f=Xu,n.Uniform1i=class extends gs{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},n.Uniform2f=class extends gs{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},n.Uniform3f=class extends gs{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},n.Uniform4f=f_,n.UniformColor=m_,n.UniformMatrix2f=class extends gs{constructor(i,t){super(i,t),this.current=O1}set(i){for(let t=0;t<4;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},n.UniformMatrix3f=class extends gs{constructor(i,t){super(i,t),this.current=F1}set(i){for(let t=0;t<9;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},n.UniformMatrix4f=class extends gs{constructor(i,t){super(i,t),this.current=B1}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},n.UnwrappedTileID=Ug,n.ValidationError=Jt,n.VectorTileWorkerSource=class extends _e{constructor(i,t,r,a,h){super(),this.actor=i,this.layerIndex=t,this.availableImages=r,this.loadVectorData=h||a0,this.loading={},this.loaded={},this.deduped=new o0(i.scheduler),this.isSpriteLoaded=a,this.scheduler=i.scheduler}loadTile(i,t){let r=i.uid,a=i&&i.request,h=a&&a.collectResourceTiming,p=this.loading[r]=new Xv(i);p.abort=this.loadVectorData(i,(_,g)=>{let b=!this.loading[r];if(delete this.loading[r],b||_||!g)return p.status="done",b||(this.loaded[r]=p),t(_);let S=g.rawData,C={};g.expires&&(C.expires=g.expires),g.cacheControl&&(C.cacheControl=g.cacheControl),p.vectorTile=g.vectorTile||new ha.VectorTile(new oh(S));let I=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,R)=>{if(P||!R)return t(P);let V={};if(h){let N=Pg(a);N.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(N)))}t(null,jt({rawTileData:S.slice(0)},R,C,V))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[r]=p})}reloadTile(i,t){let r=this.loaded,a=i.uid,h=this;if(r&&r[a]){let p=r[a];p.showCollisionBoxes=i.showCollisionBoxes,p.enableTerrain=!!i.enableTerrain,p.projection=i.projection,p.tileTransform=ua(i.tileID.canonical,i.projection);let _=(g,b)=>{let S=p.reloadCallback;S&&(delete p.reloadCallback,p.parse(p.vectorTile,h.layerIndex,this.availableImages,h.actor,S)),t(g,b)};p.status==="parsing"?p.reloadCallback=_:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,t){let r=i.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),t()}removeTile(i,t){let r=this.loaded,a=i.uid;r&&r[a]&&delete r[a],t()}},n.WritingMode=Xn,n.ZoomHistory=Pc,n.add=k_,n.addDynamicAttributes=Mf,n.adjoint=function(i,t){var r=t[0],a=t[1],h=t[2],p=t[3],_=t[4],g=t[5],b=t[6],S=t[7],C=t[8];return i[0]=_*C-g*S,i[1]=h*S-a*C,i[2]=a*g-h*_,i[3]=g*b-p*C,i[4]=r*C-h*b,i[5]=h*p-r*g,i[6]=p*S-_*b,i[7]=a*b-r*S,i[8]=r*_-a*p,i},n.asyncAll=Vt,n.bezier=mt,n.bindAll=be,n.boundsAttributes=$g,n.bufferConvexPolygon=function(i,t){let r=[];for(let a=0;a<i.length;a++){let h=Rt(a-1,-1,i.length-1),p=Rt(a+1,-1,i.length-1),_=i[a],g=i[p],b=i[h].sub(_).unit(),S=g.sub(_).unit(),C=S.angleWithSep(b.x,b.y),I=b.add(S).unit().mult(-1*t/Math.sin(C/2));r.push(_.add(I))}return r},n.cacheEntryPossiblyAdded=function(i){Zs++,Zs>os&&(i.getActor().send("enforceCacheSizeLimit",ss),Zs=0)},n.calculateGlobeLabelMatrix=function(i,t){let{lng:r,lat:a}=i._center,h=Fg(0,0,i.worldSize/i._projectionScaler,r,a);return Jp(h,h,function(p){let _=Vr(new Float64Array(16)),g=1/Lf(p);return la(_,_,p.min),oo(_,_,[g,g,g]),_}(uh(t)))},n.calculateGlobeMatrix=Og,n.calculateGlobeMercatorMatrix=function(i){let t=i.worldSize,r=i.point,a=_l(1,i.center.lat)*t,h=i.pixelsPerMeter,p=t/(a/i.pixelsPerMeter),_=Vr(new Float64Array(16));return la(_,_,[r.x,r.y,0]),oo(_,_,[p,p,h]),Float32Array.from(_)},n.circumferenceAtLatitude=$p,n.clamp=_t,n.clearTileCache=function(i){let t=B.caches.delete(La);i&&t.catch(i).then(()=>i())},n.clipLine=wg,n.clone=function(i){var t=new Mn(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},n.clone$1=di,n.collisionCircleLayout=Xx,n.config=Oe,n.conjugate=function(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i},n.create=function(){var i=new Mn(16);return Mn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},n.create$1=A_,n.createExpression=Go,n.createLayout=st,n.createStyleLayer=function(i){return i.type==="custom"?new Pv(i):new Dv[i.type](i)},n.cross=D_,n.degToRad=Q,n.div=function(i,t,r){return i[0]=t[0]/r[0],i[1]=t[1]/r[1],i[2]=t[2]/r[2],i},n.dot=Hc,n.earthRadius=Gp,n.ease=St,n.easeCubicInOut=et,n.emitValidationErrors=Cu,n.endsWith=Me,n.enforceCacheSizeLimit=function(i){Vs(),Nn&&Nn.then(t=>{t.keys().then(r=>{for(let a=0;a<r.length-i;a++)t.delete(r[a])})})},n.evaluateSizeForFeature=ld,n.evaluateSizeForZoom=Tl,n.evaluateVariableOffset=Ag,n.evented=Uc,n.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]},n.exactEquals$1=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]},n.exported=Ji,n.exported$1=Sr,n.extend=jt,n.extend$1=Ve,n.filterObject=Di,n.fromMat4=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],i},n.fromQuat=function(i,t){var r=t[0],a=t[1],h=t[2],p=t[3],_=r+r,g=a+a,b=h+h,S=r*_,C=a*_,I=a*g,P=h*_,R=h*g,V=h*b,N=p*_,q=p*g,K=p*b;return i[0]=1-I-V,i[1]=C+K,i[2]=P-q,i[3]=0,i[4]=C-K,i[5]=1-S-V,i[6]=R+N,i[7]=0,i[8]=P+q,i[9]=R-N,i[10]=1-S-I,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},n.fromRotation=function(i,t){var r=Math.sin(t),a=Math.cos(t);return i[0]=a,i[1]=r,i[2]=0,i[3]=-r,i[4]=a,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},n.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},n.furthestTileCorner=function(i){let t=Math.round((i+45+360)%360/90)%4;return W[t]},n.getAABBPointSquareDist=function(i,t,r){let a=0;for(let h=0;h<2;++h){let p=r?r[h]:0;i[h]>p&&(a+=(i[h]-p)*(i[h]-p)),t[h]<p&&(a+=(p-t[h])*(p-t[h]))}return a},n.getAnchorAlignment=bf,n.getAnchorJustification=Sf,n.getBounds=function(i){let t=1/0,r=1/0,a=-1/0,h=-1/0;for(let p of i)t=Math.min(t,p.x),r=Math.min(r,p.y),a=Math.max(a,p.x),h=Math.max(h,p.y);return{min:new A(t,r),max:new A(a,h)}},n.getColumn=function(i,t){return[i[4*t],i[4*t+1],i[4*t+2],i[4*t+3]]},n.getGridMatrix=function(i,t){let[r,a]=t,h=.015625;return[0,(a[1]-r[1])*h,1<<i.z,(a[0]-r[0])*h,0,i.y,r[0],r[1],h]},n.getImage=Kt,n.getJSON=function(i,t){return H(jt(i,{type:"json"}),t)},n.getMapSessionAPI=Da,n.getPerformanceMeasurement=Pg,n.getProjection=function(i){let t=i.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(i.name){case"mercator":return new Yv(i);case"equirectangular":return new Qv(i);case"naturalEarth":return new e2(i);case"equalEarth":return new Jv(i);case"winkelTripel":return new i2(i);case"albers":return r?new h0(i):new Kv(i);case"lambertConformalConic":return r?new h0(i):new t2(i)}throw new Error(`Invalid projection name: ${i.name}`)},n.getRTLTextPluginStatus=pl,n.getReferrer=Z,n.getTilePoint=function(i,{x:t,y:r},a=0){return new A(((t-a)*i.scale-i.x)*we,(r*i.scale-i.y)*we)},n.getTileVec3=function(i,t,r=0){return qc(((t.x-r)*i.scale-i.x)*we,(t.y*i.scale-i.y)*we,y_(t.z,t.y))},n.getVideo=function(i,t){let r=B.document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let a=0;a<i.length;a++){let h=B.document.createElement("source");xt(i[a])||(r.crossOrigin="Anonymous"),h.src=i[a],r.appendChild(h)}return{cancel:()=>{}}},n.globeECEFOrigin=function(i,t){let r=[0,0,0];return ca(r,r,Bg(uh(t.canonical))),ca(r,r,i),r},n.globePixelsToTileUnits=function(i,t){return we/(512*Math.pow(2,i))*Lf(uh(t))},n.globePoleMatrixForTile=function(i,t,r){let a=Vr(new Float64Array(16)),h=1<<i,p=360*(t/h-.5),_=r.point,g=r.worldSize/(r.tileSize*h);return la(a,a,[_.x,_.y,-r.worldSize/Math.PI/2]),oo(a,a,[g,g,g]),Qp(a,a,Q(-r._center.lat)),tf(a,a,Q(-r._center.lng+p)),Float32Array.from(a)},n.globeTileLatLngCorners=Df,n.globeToMercatorTransition=function(i){return Mt(5,6,i)},n.identity=Vr,n.identity$1=B_,n.invert=function(i,t){var r=t[0],a=t[1],h=t[2],p=t[3],_=t[4],g=t[5],b=t[6],S=t[7],C=t[8],I=t[9],P=t[10],R=t[11],V=t[12],N=t[13],q=t[14],K=t[15],lt=r*g-a*_,ut=r*b-h*_,ft=r*S-p*_,gt=a*b-h*g,yt=a*S-p*g,It=h*S-p*b,Pt=C*N-I*V,Bt=C*q-P*V,Ot=C*K-R*V,At=I*q-P*N,Lt=I*K-R*N,Ut=P*K-R*q,Xt=lt*Ut-ut*Lt+ft*At+gt*Ot-yt*Bt+It*Pt;return Xt?(i[0]=(g*Ut-b*Lt+S*At)*(Xt=1/Xt),i[1]=(h*Lt-a*Ut-p*At)*Xt,i[2]=(N*It-q*yt+K*gt)*Xt,i[3]=(P*yt-I*It-R*gt)*Xt,i[4]=(b*Ot-_*Ut-S*Bt)*Xt,i[5]=(r*Ut-h*Ot+p*Bt)*Xt,i[6]=(q*ft-V*It-K*ut)*Xt,i[7]=(C*It-P*ft+R*ut)*Xt,i[8]=(_*Lt-g*Ot+S*Pt)*Xt,i[9]=(a*Ot-r*Lt-p*Pt)*Xt,i[10]=(V*yt-N*ft+K*lt)*Xt,i[11]=(I*ft-C*yt-R*lt)*Xt,i[12]=(g*Bt-_*At-b*Pt)*Xt,i[13]=(r*At-a*Bt+h*Pt)*Xt,i[14]=(N*ut-V*gt-q*lt)*Xt,i[15]=(C*gt-I*ut+P*lt)*Xt,i):null},n.isMapAuthenticated=function(i){return rs.has(i)},n.isMapboxURL=Vn,n.isSafariWithAntialiasingBug=function(i){let t=i.navigator?i.navigator.userAgent:null;return!!Tr(i)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.latFromMercatorY=Gi,n.len=ex,n.length=I_,n.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},n.loadVectorTile=a0,n.makeRequest=H,n.mercatorXfromLng=$c,n.mercatorYfromLat=ml,n.mercatorZfromAltitude=_l,n.mul=Q1,n.mul$1=tx,n.multiply=function(i,t,r){var a=t[0],h=t[1],p=t[2],_=t[3],g=t[4],b=t[5],S=t[6],C=t[7],I=t[8],P=r[0],R=r[1],V=r[2],N=r[3],q=r[4],K=r[5],lt=r[6],ut=r[7],ft=r[8];return i[0]=P*a+R*_+V*S,i[1]=P*h+R*g+V*C,i[2]=P*p+R*b+V*I,i[3]=N*a+q*_+K*S,i[4]=N*h+q*g+K*C,i[5]=N*p+q*b+K*I,i[6]=lt*a+ut*_+ft*S,i[7]=lt*h+ut*g+ft*C,i[8]=lt*p+ut*b+ft*I,i},n.multiply$1=Jp,n.multiply$2=z_,n.nextPowerOfTwo=He,n.normalize=Xc,n.normalize$1=function(i,t){var r=t[0],a=t[1],h=t[2],p=t[3],_=r*r+a*a+h*h+p*p;return _>0&&(_=1/Math.sqrt(_)),i[0]=r*_,i[1]=a*_,i[2]=h*_,i[3]=p*_,i},n.number=de,n.ortho=function(i,t,r,a,h,p,_){var g=1/(t-r),b=1/(a-h),S=1/(p-_);return i[0]=-2*g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*S,i[11]=0,i[12]=(t+r)*g,i[13]=(h+a)*b,i[14]=(_+p)*S,i[15]=1,i},n.pbf=oh,n.perspective=function(i,t,r,a,h){var p,_=1/Math.tan(t/2);return i[0]=_/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+a)*(p=1/(a-h)),i[14]=2*h*a*p):(i[10]=-1,i[14]=-2*a),i},n.pick=function(i,t){let r={};for(let a=0;a<t.length;a++){let h=t[a];h in i&&(r[h]=i[h])}return r},n.plugin=Sn,n.pointGeometry=A,n.polygonIntersectsBox=S_,n.polygonIntersectsPolygon=v_,n.polygonizeBounds=function(i,t,r=0,a=!0){let h=new A(r,r),p=i.sub(h),_=t.add(h),g=[p,new A(_.x,p.y),_,new A(p.x,_.y)];return a&&g.push(p),g},n.posAttributes=hh,n.postMapLoadEvent=za,n.postTurnstileEvent=ic,n.potpack=gf,n.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},n.radToDeg=dt,n.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.registerForPluginStateChange=function(i){return i({pluginStatus:tn,pluginURL:dn}),Uc.on("pluginStateChange",i),i},n.removeAuthState=function(i){rs.delete(i)},n.renderColorRamp=lf,n.rotateX=Qp,n.rotateX$1=F_,n.rotateY=tf,n.rotateZ=function(i,t,r){var a=Math.sin(r),h=Math.cos(r),p=t[0],_=t[1],g=t[2],b=t[3],S=t[4],C=t[5],I=t[6],P=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*h+S*a,i[1]=_*h+C*a,i[2]=g*h+I*a,i[3]=b*h+P*a,i[4]=S*h-p*a,i[5]=C*h-_*a,i[6]=I*h-g*a,i[7]=P*h-b*a,i},n.rotateZ$1=function(i,t,r){r*=.5;var a=t[0],h=t[1],p=t[2],_=t[3],g=Math.sin(r),b=Math.cos(r);return i[0]=a*b+h*g,i[1]=h*b-a*g,i[2]=p*b+_*g,i[3]=_*b-p*g,i},n.scale=oo,n.scale$1=function(i,t,r){return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i},n.scale$2=Wc,n.scaleAndAdd=sf,n.setCacheLimits=function(i,t){ss=i,os=t},n.setColumn=function(i,t,r){i[4*t+0]=r[0],i[4*t+1]=r[1],i[4*t+2]=r[2],i[4*t+3]=r[3]},n.setRTLTextPlugin=function(i,t,r=!1){if(tn===Oc||tn===ia||tn===Vc)throw new Error("setRTLTextPlugin cannot be called multiple times.");dn=Ji.resolveURL(i),tn=Oc,Zc=t,ms(),r||to()},n.smoothstep=Mt,n.spec=Et,n.storeAuthState=function(i,t){t?rs.add(i):rs.delete(i)},n.sub=xl,n.subtract=P_,n.symbolSize=Hx,n.tileAABB=function(i,t,r,a,h,p,_,g,b){if(b.name==="globe")return Uv(i,t,new gd(r,a,h));let S=ua({z:r,x:a,y:h},b);return new Wn([(p+S.x/S.scale)*t,t*(S.y/S.scale),_],[(p+S.x2/S.scale)*t,t*(S.y2/S.scale),g])},n.tileTransform=ua,n.transformMat3=function(i,t,r){var a=t[0],h=t[1],p=t[2];return i[0]=a*r[0]+h*r[3]+p*r[6],i[1]=a*r[1]+h*r[4]+p*r[7],i[2]=a*r[2]+h*r[5]+p*r[8],i},n.transformMat4=ca,n.transformMat4$1=vl,n.transformQuat=L_,n.translate=la,n.transpose=function(i,t){if(i===t){var r=t[1],a=t[2],h=t[5];i[1]=t[3],i[2]=t[6],i[3]=r,i[5]=t[7],i[6]=a,i[7]=h}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i},n.triggerPluginCompletionEvent=na,n.uniqueId=le,n.validateCustomStyleLayer=function(i){let t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},n.validateFilter=i=>dr(Lr(i)),n.validateFog=i=>dr(Au(i)),n.validateLayer=i=>dr(wu(i)),n.validateLight=i=>dr(Eu(i)),n.validateSource=i=>dr(Su(i)),n.validateStyle=Ko,n.validateTerrain=i=>dr(Mu(i)),n.values=Yt,n.vectorTile=ha,n.version=x,n.warnOnce=qe,n.window=B,n.wrap=Rt}),u(["./shared"],function(n){"use strict";function x(J){if(typeof J=="number"||typeof J=="boolean"||typeof J=="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){let Z="[";for(let H of J)Z+=`${x(H)},`;return`${Z}]`}let F="{";for(let Z of Object.keys(J).sort())F+=`${Z}:${x(J[Z])},`;return`${F}}`}function w(J){let F="";for(let Z of n.refProperties)F+=`/${x(J[Z])}`;return F}class E{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,Z){for(let ot of F)this._layerConfigs[ot.id]=ot,(this._layers[ot.id]=n.createStyleLayer(ot)).compileFilter(),this.keyCache[ot.id]&&delete this.keyCache[ot.id];for(let ot of Z)delete this.keyCache[ot],delete this._layerConfigs[ot],delete this._layers[ot];this.familiesBySource={};let H=function(ot,ht){let vt={};for(let pt=0;pt<ot.length;pt++){let Tt=ht&&ht[ot[pt].id]||w(ot[pt]);ht&&(ht[ot[pt].id]=Tt);let Ft=vt[Tt];Ft||(Ft=vt[Tt]=[]),Ft.push(ot[pt])}let xt=[];for(let pt in vt)xt.push(vt[pt]);return xt}(n.values(this._layerConfigs),this.keyCache);for(let ot of H){let ht=ot.map(Kt=>this._layers[Kt.id]),vt=ht[0];if(vt.visibility==="none")continue;let xt=vt.source||"",pt=this.familiesBySource[xt];pt||(pt=this.familiesBySource[xt]={});let Tt=vt.sourceLayer||"_geojsonTileLayer",Ft=pt[Tt];Ft||(Ft=pt[Tt]=[]),Ft.push(ht)}}}class A{loadTile(F,Z){let{uid:H,encoding:ot,rawImageData:ht,padding:vt,buildQuadTree:xt}=F,pt=n.window.ImageBitmap&&ht instanceof n.window.ImageBitmap?this.getImageData(ht,vt):ht;Z(null,new n.DEMData(H,pt,ot,vt<1,xt))}getImageData(F,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(F.width,F.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=F.width,this.offscreenCanvas.height=F.height,this.offscreenCanvasContext.drawImage(F,0,0,F.width,F.height);let H=this.offscreenCanvasContext.getImageData(-Z,-Z,F.width+2*Z,F.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),H}}var D=function J(F,Z){var H,ot=F&&F.type;if(ot==="FeatureCollection")for(H=0;H<F.features.length;H++)J(F.features[H],Z);else if(ot==="GeometryCollection")for(H=0;H<F.geometries.length;H++)J(F.geometries[H],Z);else if(ot==="Feature")J(F.geometry,Z);else if(ot==="Polygon")B(F.coordinates,Z);else if(ot==="MultiPolygon")for(H=0;H<F.coordinates.length;H++)B(F.coordinates[H],Z);return F};function B(J,F){if(J.length!==0){G(J[0],F);for(var Z=1;Z<J.length;Z++)G(J[Z],!F)}}function G(J,F){for(var Z=0,H=0,ot=0,ht=J.length,vt=ht-1;ot<ht;vt=ot++){var xt=(J[ot][0]-J[vt][0])*(J[vt][1]+J[ot][1]),pt=Z+xt;H+=Math.abs(Z)>=Math.abs(xt)?Z-pt+xt:xt-pt+Z,Z=pt}Z+H>=0!=!!F&&J.reverse()}let rt=n.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Q{constructor(F){this._feature=F,this.extent=n.EXTENT,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(this._feature.type===1){let F=[];for(let Z of this._feature.geometry)F.push([new n.pointGeometry(Z[0],Z[1])]);return F}{let F=[];for(let Z of this._feature.geometry){let H=[];for(let ot of Z)H.push(new n.pointGeometry(ot[0],ot[1]));F.push(H)}return F}}toGeoJSON(F,Z,H){return rt.call(this,F,Z,H)}}class dt{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=F.length,this._features=F}feature(F){return new Q(this._features[F])}}var W=n.vectorTile.VectorTileFeature,et=mt;function mt(J,F){this.options=F||{},this.features=J,this.length=J.length}function St(J,F){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=F||4096}mt.prototype.feature=function(J){return new St(this.features[J],this.options.extent)},St.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var F=0;F<J.length;F++){for(var Z=J[F],H=[],ot=0;ot<Z.length;ot++)H.push(new n.pointGeometry(Z[ot][0],Z[ot][1]));this.geometry.push(H)}return this.geometry},St.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,F=1/0,Z=-1/0,H=1/0,ot=-1/0,ht=0;ht<J.length;ht++)for(var vt=J[ht],xt=0;xt<vt.length;xt++){var pt=vt[xt];F=Math.min(F,pt.x),Z=Math.max(Z,pt.x),H=Math.min(H,pt.y),ot=Math.max(ot,pt.y)}return[F,H,Z,ot]},St.prototype.toGeoJSON=W.prototype.toGeoJSON;var _t=Rt,Mt=et;function Rt(J){var F=new n.pbf;return function(Z,H){for(var ot in Z.layers)H.writeMessage(3,Vt,Z.layers[ot])}(J,F),F.finish()}function Vt(J,F){var Z;F.writeVarintField(15,J.version||1),F.writeStringField(1,J.name||""),F.writeVarintField(5,J.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<J.length;Z++)H.feature=J.feature(Z),F.writeMessage(2,Yt,H);var ot=H.keys;for(Z=0;Z<ot.length;Z++)F.writeStringField(3,ot[Z]);var ht=H.values;for(Z=0;Z<ht.length;Z++)F.writeMessage(4,He,ht[Z])}function Yt(J,F){var Z=J.feature;Z.id!==void 0&&F.writeVarintField(1,Z.id),F.writeMessage(2,jt,J),F.writeVarintField(3,Z.type),F.writeMessage(4,me,Z)}function jt(J,F){var Z=J.feature,H=J.keys,ot=J.values,ht=J.keycache,vt=J.valuecache;for(var xt in Z.properties){var pt=Z.properties[xt],Tt=ht[xt];if(pt!==null){Tt===void 0&&(H.push(xt),ht[xt]=Tt=H.length-1),F.writeVarint(Tt);var Ft=typeof pt;Ft!=="string"&&Ft!=="boolean"&&Ft!=="number"&&(pt=JSON.stringify(pt));var Kt=Ft+":"+pt,Zt=vt[Kt];Zt===void 0&&(ot.push(pt),vt[Kt]=Zt=ot.length-1),F.writeVarint(Zt)}}}function ye(J,F){return(F<<3)+(7&J)}function le(J){return J<<1^J>>31}function me(J,F){for(var Z=J.loadGeometry(),H=J.type,ot=0,ht=0,vt=Z.length,xt=0;xt<vt;xt++){var pt=Z[xt],Tt=1;H===1&&(Tt=pt.length),F.writeVarint(ye(1,Tt));for(var Ft=H===3?pt.length-1:pt.length,Kt=0;Kt<Ft;Kt++){Kt===1&&H!==1&&F.writeVarint(ye(2,Ft-1));var Zt=pt[Kt].x-ot,pe=pt[Kt].y-ht;F.writeVarint(le(Zt)),F.writeVarint(le(pe)),ot+=Zt,ht+=pe}H===3&&F.writeVarint(ye(7,1))}}function He(J,F){var Z=typeof J;Z==="string"?F.writeStringField(1,J):Z==="boolean"?F.writeBooleanField(7,J):Z==="number"&&(J%1!=0?F.writeDoubleField(3,J):J<0?F.writeSVarintField(6,J):F.writeVarintField(5,J))}function Ye(J,F,Z,H,ot,ht){if(ot-H<=Z)return;let vt=H+ot>>1;be(J,F,vt,H,ot,ht%2),Ye(J,F,Z,H,vt-1,ht+1),Ye(J,F,Z,vt+1,ot,ht+1)}function be(J,F,Z,H,ot,ht){for(;ot>H;){if(ot-H>600){let Tt=ot-H+1,Ft=Z-H+1,Kt=Math.log(Tt),Zt=.5*Math.exp(2*Kt/3),pe=.5*Math.sqrt(Kt*Zt*(Tt-Zt)/Tt)*(Ft-Tt/2<0?-1:1);be(J,F,Z,Math.max(H,Math.floor(Z-Ft*Zt/Tt+pe)),Math.min(ot,Math.floor(Z+(Tt-Ft)*Zt/Tt+pe)),ht)}let vt=F[2*Z+ht],xt=H,pt=ot;for(Me(J,F,H,Z),F[2*ot+ht]>vt&&Me(J,F,H,ot);xt<pt;){for(Me(J,F,xt,pt),xt++,pt--;F[2*xt+ht]<vt;)xt++;for(;F[2*pt+ht]>vt;)pt--}F[2*H+ht]===vt?Me(J,F,H,pt):(pt++,Me(J,F,pt,ot)),pt<=Z&&(H=pt+1),Z<=pt&&(ot=pt-1)}}function Me(J,F,Z,H){Ui(J,Z,H),Ui(F,2*Z,2*H),Ui(F,2*Z+1,2*H+1)}function Ui(J,F,Z){let H=J[F];J[F]=J[Z],J[Z]=H}function Di(J,F,Z,H){let ot=J-Z,ht=F-H;return ot*ot+ht*ht}_t.fromVectorTileJs=Rt,_t.fromGeojsonVt=function(J,F){F=F||{};var Z={};for(var H in J)Z[H]=new et(J[H].features,F),Z[H].name=H,Z[H].version=F.version,Z[H].extent=F.extent;return Rt({layers:Z})},_t.GeoJSONWrapper=Mt;let di=J=>J[0],_i=J=>J[1];class qe{constructor(F,Z=di,H=_i,ot=64,ht=Float64Array){this.nodeSize=ot,this.points=F;let vt=F.length<65536?Uint16Array:Uint32Array,xt=this.ids=new vt(F.length),pt=this.coords=new ht(2*F.length);for(let Tt=0;Tt<F.length;Tt++)xt[Tt]=Tt,pt[2*Tt]=Z(F[Tt]),pt[2*Tt+1]=H(F[Tt]);Ye(xt,pt,ot,0,xt.length-1,0)}range(F,Z,H,ot){return function(ht,vt,xt,pt,Tt,Ft,Kt){let Zt=[0,ht.length-1,0],pe=[],ce,he;for(;Zt.length;){let _e=Zt.pop(),Et=Zt.pop(),Ve=Zt.pop();if(Et-Ve<=Kt){for(let Ze=Ve;Ze<=Et;Ze++)ce=vt[2*Ze],he=vt[2*Ze+1],ce>=xt&&ce<=Tt&&he>=pt&&he<=Ft&&pe.push(ht[Ze]);continue}let se=Math.floor((Ve+Et)/2);ce=vt[2*se],he=vt[2*se+1],ce>=xt&&ce<=Tt&&he>=pt&&he<=Ft&&pe.push(ht[se]);let Be=(_e+1)%2;(_e===0?xt<=ce:pt<=he)&&(Zt.push(Ve),Zt.push(se-1),Zt.push(Be)),(_e===0?Tt>=ce:Ft>=he)&&(Zt.push(se+1),Zt.push(Et),Zt.push(Be))}return pe}(this.ids,this.coords,F,Z,H,ot,this.nodeSize)}within(F,Z,H){return function(ot,ht,vt,xt,pt,Tt){let Ft=[0,ot.length-1,0],Kt=[],Zt=pt*pt;for(;Ft.length;){let pe=Ft.pop(),ce=Ft.pop(),he=Ft.pop();if(ce-he<=Tt){for(let Be=he;Be<=ce;Be++)Di(ht[2*Be],ht[2*Be+1],vt,xt)<=Zt&&Kt.push(ot[Be]);continue}let _e=Math.floor((he+ce)/2),Et=ht[2*_e],Ve=ht[2*_e+1];Di(Et,Ve,vt,xt)<=Zt&&Kt.push(ot[_e]);let se=(pe+1)%2;(pe===0?vt-pt<=Et:xt-pt<=Ve)&&(Ft.push(he),Ft.push(_e-1),Ft.push(se)),(pe===0?vt+pt>=Et:xt+pt>=Ve)&&(Ft.push(_e+1),Ft.push(ce),Ft.push(se))}return Kt}(this.ids,this.coords,F,Z,H,this.nodeSize)}}let gi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},Ki=Math.fround||(Xi=new Float32Array(1),J=>(Xi[0]=+J,Xi[0]));var Xi;class Kn{constructor(F){this.options=Ji(Object.create(gi),F),this.trees=new Array(this.options.maxZoom+1)}load(F){let{log:Z,minZoom:H,maxZoom:ot,nodeSize:ht}=this.options;Z&&console.time("total time");let vt=`prepare ${F.length} points`;Z&&console.time(vt),this.points=F;let xt=[];for(let pt=0;pt<F.length;pt++)F[pt].geometry&&xt.push(Io(F[pt],pt));this.trees[ot+1]=new qe(xt,Jr,Oe,ht,Float32Array),Z&&console.timeEnd(vt);for(let pt=ot;pt>=H;pt--){let Tt=+Date.now();xt=this._cluster(xt,pt),this.trees[pt]=new qe(xt,Jr,Oe,ht,Float32Array),Z&&console.log("z%d: %d clusters in %dms",pt,xt.length,+Date.now()-Tt)}return Z&&console.timeEnd("total time"),this}getClusters(F,Z){let H=((F[0]+180)%360+360)%360-180,ot=Math.max(-90,Math.min(90,F[1])),ht=F[2]===180?180:((F[2]+180)%360+360)%360-180,vt=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)H=-180,ht=180;else if(H>ht){let Ft=this.getClusters([H,ot,180,vt],Z),Kt=this.getClusters([-180,ot,ht,vt],Z);return Ft.concat(Kt)}let xt=this.trees[this._limitZoom(Z)],pt=xt.range(Le(H),Tr(vt),Le(ht),Tr(ot)),Tt=[];for(let Ft of pt){let Kt=xt.points[Ft];Tt.push(Kt.numPoints?Kr(Kt):this.points[Kt.index])}return Tt}getChildren(F){let Z=this._getOriginId(F),H=this._getOriginZoom(F),ot="No cluster with the specified id.",ht=this.trees[H];if(!ht)throw new Error(ot);let vt=ht.points[Z];if(!vt)throw new Error(ot);let xt=this.options.radius/(this.options.extent*Math.pow(2,H-1)),pt=ht.within(vt.x,vt.y,xt),Tt=[];for(let Ft of pt){let Kt=ht.points[Ft];Kt.parentId===F&&Tt.push(Kt.numPoints?Kr(Kt):this.points[Kt.index])}if(Tt.length===0)throw new Error(ot);return Tt}getLeaves(F,Z,H){let ot=[];return this._appendLeaves(ot,F,Z=Z||10,H=H||0,0),ot}getTile(F,Z,H){let ot=this.trees[this._limitZoom(F)],ht=Math.pow(2,F),{extent:vt,radius:xt}=this.options,pt=xt/vt,Tt=(H-pt)/ht,Ft=(H+1+pt)/ht,Kt={features:[]};return this._addTileFeatures(ot.range((Z-pt)/ht,Tt,(Z+1+pt)/ht,Ft),ot.points,Z,H,ht,Kt),Z===0&&this._addTileFeatures(ot.range(1-pt/ht,Tt,1,Ft),ot.points,ht,H,ht,Kt),Z===ht-1&&this._addTileFeatures(ot.range(0,Tt,pt/ht,Ft),ot.points,-1,H,ht,Kt),Kt.features.length?Kt:null}getClusterExpansionZoom(F){let Z=this._getOriginZoom(F)-1;for(;Z<=this.options.maxZoom;){let H=this.getChildren(F);if(Z++,H.length!==1)break;F=H[0].properties.cluster_id}return Z}_appendLeaves(F,Z,H,ot,ht){let vt=this.getChildren(Z);for(let xt of vt){let pt=xt.properties;if(pt&&pt.cluster?ht+pt.point_count<=ot?ht+=pt.point_count:ht=this._appendLeaves(F,pt.cluster_id,H,ot,ht):ht<ot?ht++:F.push(xt),F.length===H)break}return ht}_addTileFeatures(F,Z,H,ot,ht,vt){for(let xt of F){let pt=Z[xt],Tt=pt.numPoints,Ft,Kt,Zt;if(Tt)Ft=Jn(pt),Kt=pt.x,Zt=pt.y;else{let he=this.points[pt.index];Ft=he.properties,Kt=Le(he.geometry.coordinates[0]),Zt=Tr(he.geometry.coordinates[1])}let pe={type:1,geometry:[[Math.round(this.options.extent*(Kt*ht-H)),Math.round(this.options.extent*(Zt*ht-ot))]],tags:Ft},ce;Tt?ce=pt.id:this.options.generateId?ce=pt.index:this.points[pt.index].id&&(ce=this.points[pt.index].id),ce!==void 0&&(pe.id=ce),vt.features.push(pe)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(+F,this.options.maxZoom+1))}_cluster(F,Z){let H=[],{radius:ot,extent:ht,reduce:vt,minPoints:xt}=this.options,pt=ot/(ht*Math.pow(2,Z));for(let Tt=0;Tt<F.length;Tt++){let Ft=F[Tt];if(Ft.zoom<=Z)continue;Ft.zoom=Z;let Kt=this.trees[Z+1],Zt=Kt.within(Ft.x,Ft.y,pt),pe=Ft.numPoints||1,ce=pe;for(let he of Zt){let _e=Kt.points[he];_e.zoom>Z&&(ce+=_e.numPoints||1)}if(ce>pe&&ce>=xt){let he=Ft.x*pe,_e=Ft.y*pe,Et=vt&&pe>1?this._map(Ft,!0):null,Ve=(Tt<<5)+(Z+1)+this.points.length;for(let se of Zt){let Be=Kt.points[se];if(Be.zoom<=Z)continue;Be.zoom=Z;let Ze=Be.numPoints||1;he+=Be.x*Ze,_e+=Be.y*Ze,Be.parentId=Ve,vt&&(Et||(Et=this._map(Ft,!0)),vt(Et,this._map(Be)))}Ft.parentId=Ve,H.push(vn(he/ce,_e/ce,Ve,ce,Et))}else if(H.push(Ft),ce>1)for(let he of Zt){let _e=Kt.points[he];_e.zoom<=Z||(_e.zoom=Z,H.push(_e))}}return H}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,Z){if(F.numPoints)return Z?Ji({},F.properties):F.properties;let H=this.points[F.index].properties,ot=this.options.map(H);return Z&&ot===H?Ji({},ot):ot}}function vn(J,F,Z,H,ot){return{x:Ki(J),y:Ki(F),zoom:1/0,id:Z,parentId:-1,numPoints:H,properties:ot}}function Io(J,F){let[Z,H]=J.geometry.coordinates;return{x:Ki(Le(Z)),y:Ki(Tr(H)),zoom:1/0,index:F,parentId:-1}}function Kr(J){return{type:"Feature",id:J.id,properties:Jn(J),geometry:{type:"Point",coordinates:[(F=J.x,360*(F-.5)),ka(J.y)]}};var F}function Jn(J){let F=J.numPoints,Z=F>=1e4?`${Math.round(F/1e3)}k`:F>=1e3?Math.round(F/100)/10+"k":F;return Ji(Ji({},J.properties),{cluster:!0,cluster_id:J.id,point_count:F,point_count_abbreviated:Z})}function Le(J){return J/360+.5}function Tr(J){let F=Math.sin(J*Math.PI/180),Z=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Z<0?0:Z>1?1:Z}function ka(J){let F=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Ji(J,F){for(let Z in F)J[Z]=F[Z];return J}function Jr(J){return J.x}function Oe(J){return J.y}function Sr(J,F,Z,H){for(var ot,ht=H,vt=Z-F>>1,xt=Z-F,pt=J[F],Tt=J[F+1],Ft=J[Z],Kt=J[Z+1],Zt=F+3;Zt<Z;Zt+=3){var pe=Qr(J[Zt],J[Zt+1],pt,Tt,Ft,Kt);if(pe>ht)ot=Zt,ht=pe;else if(pe===ht){var ce=Math.abs(Zt-vt);ce<xt&&(ot=Zt,xt=ce)}}ht>H&&(ot-F>3&&Sr(J,F,ot,H),J[ot+2]=ht,Z-ot>3&&Sr(J,ot,Z,H))}function Qr(J,F,Z,H,ot,ht){var vt=ot-Z,xt=ht-H;if(vt!==0||xt!==0){var pt=((J-Z)*vt+(F-H)*xt)/(vt*vt+xt*xt);pt>1?(Z=ot,H=ht):pt>0&&(Z+=vt*pt,H+=xt*pt)}return(vt=J-Z)*vt+(xt=F-H)*xt}function bn(J,F,Z,H){var ot={id:J===void 0?null:J,type:F,geometry:Z,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ht){var vt=ht.geometry,xt=ht.type;if(xt==="Point"||xt==="MultiPoint"||xt==="LineString")ts(ht,vt);else if(xt==="Polygon"||xt==="MultiLineString")for(var pt=0;pt<vt.length;pt++)ts(ht,vt[pt]);else if(xt==="MultiPolygon")for(pt=0;pt<vt.length;pt++)for(var Tt=0;Tt<vt[pt].length;Tt++)ts(ht,vt[pt][Tt])}(ot),ot}function ts(J,F){for(var Z=0;Z<F.length;Z+=3)J.minX=Math.min(J.minX,F[Z]),J.minY=Math.min(J.minY,F[Z+1]),J.maxX=Math.max(J.maxX,F[Z]),J.maxY=Math.max(J.maxY,F[Z+1])}function Rs(J,F,Z,H){if(F.geometry){var ot=F.geometry.coordinates,ht=F.geometry.type,vt=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),xt=[],pt=F.id;if(Z.promoteId?pt=F.properties[Z.promoteId]:Z.generateId&&(pt=H||0),ht==="Point")ko(ot,xt);else if(ht==="MultiPoint")for(var Tt=0;Tt<ot.length;Tt++)ko(ot[Tt],xt);else if(ht==="LineString")Bs(ot,xt,vt,!1);else if(ht==="MultiLineString"){if(Z.lineMetrics){for(Tt=0;Tt<ot.length;Tt++)Bs(ot[Tt],xt=[],vt,!1),J.push(bn(pt,"LineString",xt,F.properties));return}es(ot,xt,vt,!1)}else if(ht==="Polygon")es(ot,xt,vt,!0);else{if(ht!=="MultiPolygon"){if(ht==="GeometryCollection"){for(Tt=0;Tt<F.geometry.geometries.length;Tt++)Rs(J,{id:pt,geometry:F.geometry.geometries[Tt],properties:F.properties},Z,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Tt=0;Tt<ot.length;Tt++){var Ft=[];es(ot[Tt],Ft,vt,!0),xt.push(Ft)}}J.push(bn(pt,ht,xt,F.properties))}}function ko(J,F){F.push(Vn(J[0])),F.push(is(J[1])),F.push(0)}function Bs(J,F,Z,H){for(var ot,ht,vt=0,xt=0;xt<J.length;xt++){var pt=Vn(J[xt][0]),Tt=is(J[xt][1]);F.push(pt),F.push(Tt),F.push(0),xt>0&&(vt+=H?(ot*Tt-pt*ht)/2:Math.sqrt(Math.pow(pt-ot,2)+Math.pow(Tt-ht,2))),ot=pt,ht=Tt}var Ft=F.length-3;F[2]=1,Sr(F,0,Ft,Z),F[Ft+2]=1,F.size=Math.abs(vt),F.start=0,F.end=F.size}function es(J,F,Z,H){for(var ot=0;ot<J.length;ot++){var ht=[];Bs(J[ot],ht,Z,H),F.push(ht)}}function Vn(J){return J/360+.5}function is(J){var F=Math.sin(J*Math.PI/180),Z=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Z<0?0:Z>1?1:Z}function Zn(J,F,Z,H,ot,ht,vt,xt){if(H/=F,ht>=(Z/=F)&&vt<H)return J;if(vt<Z||ht>=H)return null;for(var pt=[],Tt=0;Tt<J.length;Tt++){var Ft=J[Tt],Kt=Ft.geometry,Zt=Ft.type,pe=ot===0?Ft.minX:Ft.minY,ce=ot===0?Ft.maxX:Ft.maxY;if(pe>=Z&&ce<H)pt.push(Ft);else if(!(ce<Z||pe>=H)){var he=[];if(Zt==="Point"||Zt==="MultiPoint")Un(Kt,he,Z,H,ot);else if(Zt==="LineString")Er(Kt,he,Z,H,ot,!1,xt.lineMetrics);else if(Zt==="MultiLineString")ns(Kt,he,Z,H,ot,!1);else if(Zt==="Polygon")ns(Kt,he,Z,H,ot,!0);else if(Zt==="MultiPolygon")for(var _e=0;_e<Kt.length;_e++){var Et=[];ns(Kt[_e],Et,Z,H,ot,!0),Et.length&&he.push(Et)}if(he.length){if(xt.lineMetrics&&Zt==="LineString"){for(_e=0;_e<he.length;_e++)pt.push(bn(Ft.id,Zt,he[_e],Ft.tags));continue}Zt!=="LineString"&&Zt!=="MultiLineString"||(he.length===1?(Zt="LineString",he=he[0]):Zt="MultiLineString"),Zt!=="Point"&&Zt!=="MultiPoint"||(Zt=he.length===3?"Point":"MultiPoint"),pt.push(bn(Ft.id,Zt,he,Ft.tags))}}}return pt.length?pt:null}function Un(J,F,Z,H,ot){for(var ht=0;ht<J.length;ht+=3){var vt=J[ht+ot];vt>=Z&&vt<=H&&(F.push(J[ht]),F.push(J[ht+1]),F.push(J[ht+2]))}}function Er(J,F,Z,H,ot,ht,vt){for(var xt,pt,Tt=Po(J),Ft=ot===0?ic:Pa,Kt=J.start,Zt=0;Zt<J.length-3;Zt+=3){var pe=J[Zt],ce=J[Zt+1],he=J[Zt+2],_e=J[Zt+3],Et=J[Zt+4],Ve=ot===0?pe:ce,se=ot===0?_e:Et,Be=!1;vt&&(xt=Math.sqrt(Math.pow(pe-_e,2)+Math.pow(ce-Et,2))),Ve<Z?se>Z&&(pt=Ft(Tt,pe,ce,_e,Et,Z),vt&&(Tt.start=Kt+xt*pt)):Ve>H?se<H&&(pt=Ft(Tt,pe,ce,_e,Et,H),vt&&(Tt.start=Kt+xt*pt)):Fs(Tt,pe,ce,he),se<Z&&Ve>=Z&&(pt=Ft(Tt,pe,ce,_e,Et,Z),Be=!0),se>H&&Ve<=H&&(pt=Ft(Tt,pe,ce,_e,Et,H),Be=!0),!ht&&Be&&(vt&&(Tt.end=Kt+xt*pt),F.push(Tt),Tt=Po(J)),vt&&(Kt+=xt)}var Ze=J.length-3;pe=J[Ze],ce=J[Ze+1],he=J[Ze+2],(Ve=ot===0?pe:ce)>=Z&&Ve<=H&&Fs(Tt,pe,ce,he),Ze=Tt.length-3,ht&&Ze>=3&&(Tt[Ze]!==Tt[0]||Tt[Ze+1]!==Tt[1])&&Fs(Tt,Tt[0],Tt[1],Tt[2]),Tt.length&&F.push(Tt)}function Po(J){var F=[];return F.size=J.size,F.start=J.start,F.end=J.end,F}function ns(J,F,Z,H,ot,ht){for(var vt=0;vt<J.length;vt++)Er(J[vt],F,Z,H,ot,ht,!1)}function Fs(J,F,Z,H){J.push(F),J.push(Z),J.push(H)}function ic(J,F,Z,H,ot,ht){var vt=(ht-F)/(H-F);return J.push(ht),J.push(Z+(ot-Z)*vt),J.push(1),vt}function Pa(J,F,Z,H,ot,ht){var vt=(ht-Z)/(ot-Z);return J.push(F+(H-F)*vt),J.push(ht),J.push(1),vt}function za(J,F){for(var Z=[],H=0;H<J.length;H++){var ot,ht=J[H],vt=ht.type;if(vt==="Point"||vt==="MultiPoint"||vt==="LineString")ot=Os(ht.geometry,F);else if(vt==="MultiLineString"||vt==="Polygon"){ot=[];for(var xt=0;xt<ht.geometry.length;xt++)ot.push(Os(ht.geometry[xt],F))}else if(vt==="MultiPolygon")for(ot=[],xt=0;xt<ht.geometry.length;xt++){for(var pt=[],Tt=0;Tt<ht.geometry[xt].length;Tt++)pt.push(Os(ht.geometry[xt][Tt],F));ot.push(pt)}Z.push(bn(ht.id,vt,ot,ht.tags))}return Z}function Os(J,F){var Z=[];Z.size=J.size,J.start!==void 0&&(Z.start=J.start,Z.end=J.end);for(var H=0;H<J.length;H+=3)Z.push(J[H]+F,J[H+1],J[H+2]);return Z}function Da(J,F){if(J.transformed)return J;var Z,H,ot,ht=1<<J.z,vt=J.x,xt=J.y;for(Z=0;Z<J.features.length;Z++){var pt=J.features[Z],Tt=pt.geometry,Ft=pt.type;if(pt.geometry=[],Ft===1)for(H=0;H<Tt.length;H+=2)pt.geometry.push(rs(Tt[H],Tt[H+1],F,ht,vt,xt));else for(H=0;H<Tt.length;H++){var Kt=[];for(ot=0;ot<Tt[H].length;ot+=2)Kt.push(rs(Tt[H][ot],Tt[H][ot+1],F,ht,vt,xt));pt.geometry.push(Kt)}}return J.transformed=!0,J}function rs(J,F,Z,H,ot,ht){return[Math.round(Z*(J*H-ot)),Math.round(Z*(F*H-ht))]}function La(J,F,Z,H,ot){for(var ht=F===ot.maxZoom?0:ot.tolerance/((1<<F)*ot.extent),vt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:H,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xt=0;xt<J.length;xt++){vt.numFeatures++,Nn(vt,J[xt],ht,ot);var pt=J[xt].minX,Tt=J[xt].minY,Ft=J[xt].maxX,Kt=J[xt].maxY;pt<vt.minX&&(vt.minX=pt),Tt<vt.minY&&(vt.minY=Tt),Ft>vt.maxX&&(vt.maxX=Ft),Kt>vt.maxY&&(vt.maxY=Kt)}return vt}function Nn(J,F,Z,H){var ot=F.geometry,ht=F.type,vt=[];if(ht==="Point"||ht==="MultiPoint")for(var xt=0;xt<ot.length;xt+=3)vt.push(ot[xt]),vt.push(ot[xt+1]),J.numPoints++,J.numSimplified++;else if(ht==="LineString")Mr(vt,ot,J,Z,!1,!1);else if(ht==="MultiLineString"||ht==="Polygon")for(xt=0;xt<ot.length;xt++)Mr(vt,ot[xt],J,Z,ht==="Polygon",xt===0);else if(ht==="MultiPolygon")for(var pt=0;pt<ot.length;pt++){var Tt=ot[pt];for(xt=0;xt<Tt.length;xt++)Mr(vt,Tt[xt],J,Z,!0,xt===0)}if(vt.length){var Ft=F.tags||null;if(ht==="LineString"&&H.lineMetrics){for(var Kt in Ft={},F.tags)Ft[Kt]=F.tags[Kt];Ft.mapbox_clip_start=ot.start/ot.size,Ft.mapbox_clip_end=ot.end/ot.size}var Zt={geometry:vt,type:ht==="Polygon"||ht==="MultiPolygon"?3:ht==="LineString"||ht==="MultiLineString"?2:1,tags:Ft};F.id!==null&&(Zt.id=F.id),J.features.push(Zt)}}function Mr(J,F,Z,H,ot,ht){var vt=H*H;if(H>0&&F.size<(ot?vt:H))Z.numPoints+=F.length/3;else{for(var xt=[],pt=0;pt<F.length;pt+=3)(H===0||F[pt+2]>vt)&&(Z.numSimplified++,xt.push(F[pt]),xt.push(F[pt+1])),Z.numPoints++;ot&&function(Tt,Ft){for(var Kt=0,Zt=0,pe=Tt.length,ce=pe-2;Zt<pe;ce=Zt,Zt+=2)Kt+=(Tt[Zt]-Tt[ce])*(Tt[Zt+1]+Tt[ce+1]);if(Kt>0===Ft)for(Zt=0,pe=Tt.length;Zt<pe/2;Zt+=2){var he=Tt[Zt],_e=Tt[Zt+1];Tt[Zt]=Tt[pe-2-Zt],Tt[Zt+1]=Tt[pe-1-Zt],Tt[pe-2-Zt]=he,Tt[pe-1-Zt]=_e}}(xt,ht),J.push(xt)}}function ss(J,F){var Z=(F=this.options=function(ot,ht){for(var vt in ht)ot[vt]=ht[vt];return ot}(Object.create(this.options),F)).debug;if(Z&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(ot,ht){var vt=[];if(ot.type==="FeatureCollection")for(var xt=0;xt<ot.features.length;xt++)Rs(vt,ot.features[xt],ht,xt);else Rs(vt,ot.type==="Feature"?ot:{geometry:ot},ht);return vt}(J,F);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(H=function(ot,ht){var vt=ht.buffer/ht.extent,xt=ot,pt=Zn(ot,1,-1-vt,vt,0,-1,2,ht),Tt=Zn(ot,1,1-vt,2+vt,0,-1,2,ht);return(pt||Tt)&&(xt=Zn(ot,1,-vt,1+vt,0,-1,2,ht)||[],pt&&(xt=za(pt,1).concat(xt)),Tt&&(xt=xt.concat(za(Tt,-1)))),xt}(H,F)).length&&this.splitTile(H,0,0,0),Z&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function os(J,F,Z){return 32*((1<<J)*Z+F)+J}function Vs(J,F){let Z=J.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);let H=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!H)return F(null,null);let ot=new dt(H.features),ht=_t(ot);ht.byteOffset===0&&ht.byteLength===ht.buffer.byteLength||(ht=new Uint8Array(ht)),F(null,{vectorTile:ot,rawData:ht.buffer})}ss.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ss.prototype.splitTile=function(J,F,Z,H,ot,ht,vt){for(var xt=[J,F,Z,H],pt=this.options,Tt=pt.debug;xt.length;){H=xt.pop(),Z=xt.pop(),F=xt.pop(),J=xt.pop();var Ft=1<<F,Kt=os(F,Z,H),Zt=this.tiles[Kt];if(!Zt&&(Tt>1&&console.time("creation"),Zt=this.tiles[Kt]=La(J,F,Z,H,pt),this.tileCoords.push({z:F,x:Z,y:H}),Tt)){Tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,Z,H,Zt.numFeatures,Zt.numPoints,Zt.numSimplified),console.timeEnd("creation"));var pe="z"+F;this.stats[pe]=(this.stats[pe]||0)+1,this.total++}if(Zt.source=J,ot){if(F===pt.maxZoom||F===ot)continue;var ce=1<<ot-F;if(Z!==Math.floor(ht/ce)||H!==Math.floor(vt/ce))continue}else if(F===pt.indexMaxZoom||Zt.numPoints<=pt.indexMaxPoints)continue;if(Zt.source=null,J.length!==0){Tt>1&&console.time("clipping");var he,_e,Et,Ve,se,Be,Ze=.5*pt.buffer/pt.extent,as=.5-Ze,ar=.5+Ze,Ht=1+Ze;he=_e=Et=Ve=null,se=Zn(J,Ft,Z-Ze,Z+ar,0,Zt.minX,Zt.maxX,pt),Be=Zn(J,Ft,Z+as,Z+Ht,0,Zt.minX,Zt.maxX,pt),J=null,se&&(he=Zn(se,Ft,H-Ze,H+ar,1,Zt.minY,Zt.maxY,pt),_e=Zn(se,Ft,H+as,H+Ht,1,Zt.minY,Zt.maxY,pt),se=null),Be&&(Et=Zn(Be,Ft,H-Ze,H+ar,1,Zt.minY,Zt.maxY,pt),Ve=Zn(Be,Ft,H+as,H+Ht,1,Zt.minY,Zt.maxY,pt),Be=null),Tt>1&&console.timeEnd("clipping"),xt.push(he||[],F+1,2*Z,2*H),xt.push(_e||[],F+1,2*Z,2*H+1),xt.push(Et||[],F+1,2*Z+1,2*H),xt.push(Ve||[],F+1,2*Z+1,2*H+1)}}},ss.prototype.getTile=function(J,F,Z){var H=this.options,ot=H.extent,ht=H.debug;if(J<0||J>24)return null;var vt=1<<J,xt=os(J,F=(F%vt+vt)%vt,Z);if(this.tiles[xt])return Da(this.tiles[xt],ot);ht>1&&console.log("drilling down to z%d-%d-%d",J,F,Z);for(var pt,Tt=J,Ft=F,Kt=Z;!pt&&Tt>0;)Tt--,Ft=Math.floor(Ft/2),Kt=Math.floor(Kt/2),pt=this.tiles[os(Tt,Ft,Kt)];return pt&&pt.source?(ht>1&&console.log("found parent tile z%d-%d-%d",Tt,Ft,Kt),ht>1&&console.time("drilling down"),this.splitTile(pt.source,Tt,Ft,Kt,J,F,Z),ht>1&&console.timeEnd("drilling down"),this.tiles[xt]?Da(this.tiles[xt],ot):null):null};class zo extends n.VectorTileWorkerSource{constructor(F,Z,H,ot,ht){super(F,Z,H,ot,Vs),ht&&(this.loadGeoJSON=ht)}loadData(F,Z){let H=F&&F.request,ot=H&&H.collectResourceTiming;this.loadGeoJSON(F,(ht,vt)=>{if(ht||!vt)return Z(ht);if(typeof vt!="object")return Z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{D(vt,!0);try{if(F.filter){let pt=n.createExpression(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pt.result==="error")throw new Error(pt.value.map(Ft=>`${Ft.key}: ${Ft.message}`).join(", "));let Tt=vt.features.filter(Ft=>pt.value.evaluate({zoom:0},Ft));vt={type:"FeatureCollection",features:Tt}}this._geoJSONIndex=F.cluster?new Kn(function({superclusterOptions:pt,clusterProperties:Tt}){if(!Tt||!pt)return pt;let Ft={},Kt={},Zt={accumulated:null,zoom:0},pe={properties:null},ce=Object.keys(Tt);for(let he of ce){let[_e,Et]=Tt[he],Ve=n.createExpression(Et),se=n.createExpression(typeof _e=="string"?[_e,["accumulated"],["get",he]]:_e);Ft[he]=Ve.value,Kt[he]=se.value}return pt.map=he=>{pe.properties=he;let _e={};for(let Et of ce)_e[Et]=Ft[Et].evaluate(Zt,pe);return _e},pt.reduce=(he,_e)=>{pe.properties=_e;for(let Et of ce)Zt.accumulated=he[Et],he[Et]=Kt[Et].evaluate(Zt,pe)},pt}(F)).load(vt.features):function(pt,Tt){return new ss(pt,Tt)}(vt,F.geojsonVtOptions)}catch(pt){return Z(pt)}this.loaded={};let xt={};if(ot){let pt=n.getPerformanceMeasurement(H);pt&&(xt.resourceTiming={},xt.resourceTiming[F.source]=JSON.parse(JSON.stringify(pt)))}Z(null,xt)}})}reloadTile(F,Z){let H=this.loaded;return H&&H[F.uid]?super.reloadTile(F,Z):this.loadTile(F,Z)}loadGeoJSON(F,Z){if(F.request)n.getJSON(F.request,Z);else{if(typeof F.data!="string")return Z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(F.data))}catch{return Z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(F,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(H){Z(H)}}getClusterChildren(F,Z){try{Z(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(H){Z(H)}}getClusterLeaves(F,Z){try{Z(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(H){Z(H)}}}class Zs{constructor(F){this.self=F,this.actor=new n.Actor(F,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.getProjection({name:"mercator"}),this.workerSourceTypes={vector:n.VectorTileWorkerSource,geojson:zo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,H)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=H},this.self.registerRTLTextPlugin=Z=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=Z.applyArabicShaping,n.plugin.processBidirectionalText=Z.processBidirectionalText,n.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(F,Z,H){delete this.layerIndexes[F],delete this.availableImages[F],delete this.workerSources[F],delete this.demWorkerSources[F],H()}checkIfReady(F,Z,H){H()}setReferrer(F,Z){this.referrer=Z}spriteLoaded(F,Z){this.isSpriteLoaded[F]=Z;for(let H in this.workerSources[F]){let ot=this.workerSources[F][H];for(let ht in ot)ot[ht]instanceof n.VectorTileWorkerSource&&(ot[ht].isSpriteLoaded=Z,ot[ht].fire(new n.Event("isSpriteLoaded")))}}setImages(F,Z,H){this.availableImages[F]=Z;for(let ot in this.workerSources[F]){let ht=this.workerSources[F][ot];for(let vt in ht)ht[vt].availableImages=Z}H()}enableTerrain(F,Z,H){this.terrain=Z,H()}setProjection(F,Z){this.projections[F]=n.getProjection(Z)}setLayers(F,Z,H){this.getLayerIndex(F).replace(Z),H()}updateLayers(F,Z,H){this.getLayerIndex(F).update(Z.layers,Z.removedIds),H()}loadTile(F,Z,H){let ot=this.enableTerrain?n.extend({enableTerrain:this.terrain},Z):Z;ot.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,Z.type,Z.source).loadTile(ot,H)}loadDEMTile(F,Z,H){let ot=this.enableTerrain?n.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(F,Z.source).loadTile(ot,H)}reloadTile(F,Z,H){let ot=this.enableTerrain?n.extend({enableTerrain:this.terrain},Z):Z;ot.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,Z.type,Z.source).reloadTile(ot,H)}abortTile(F,Z,H){this.getWorkerSource(F,Z.type,Z.source).abortTile(Z,H)}removeTile(F,Z,H){this.getWorkerSource(F,Z.type,Z.source).removeTile(Z,H)}removeSource(F,Z,H){if(!this.workerSources[F]||!this.workerSources[F][Z.type]||!this.workerSources[F][Z.type][Z.source])return;let ot=this.workerSources[F][Z.type][Z.source];delete this.workerSources[F][Z.type][Z.source],ot.removeSource!==void 0?ot.removeSource(Z,H):H()}loadWorkerSource(F,Z,H){try{this.self.importScripts(Z.url),H()}catch(ot){H(ot.toString())}}syncRTLPluginState(F,Z,H){try{n.plugin.setState(Z);let ot=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&ot!=null){this.self.importScripts(ot);let ht=n.plugin.isParsed();H(ht?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ot}`),ht)}}catch(ot){H(ot.toString())}}getAvailableImages(F){let Z=this.availableImages[F];return Z||(Z=[]),Z}getLayerIndex(F){let Z=this.layerIndexes[F];return Z||(Z=this.layerIndexes[F]=new E),Z}getWorkerSource(F,Z,H){return this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][Z]||(this.workerSources[F][Z]={}),this.workerSources[F][Z][H]||(this.workerSources[F][Z][H]=new this.workerSourceTypes[Z]({send:(ot,ht,vt,xt,pt,Tt)=>{this.actor.send(ot,ht,vt,F,pt,Tt)},scheduler:this.actor.scheduler},this.getLayerIndex(F),this.getAvailableImages(F),this.isSpriteLoaded[F])),this.workerSources[F][Z][H]}getDEMWorkerSource(F,Z){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][Z]||(this.demWorkerSources[F][Z]=new A),this.demWorkerSources[F][Z]}enforceCacheSizeLimit(F,Z){n.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(F,Z,H){H(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Zs(self)),Zs}),u(["./shared"],function(n){"use strict";var x=w;function w(d){return!function(e){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,v=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(v);try{y=new Worker(T),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(T),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var v=y.getImageData(0,0,1,1);return v&&v.width===m.width}()?(E[c=e&&e.failIfMajorPerformanceCaveat]===void 0&&(E[c]=function(m){var y,v=function(T){var M=document.createElement("canvas"),k=Object.create(w.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=T,M.getContext("webgl",k)||M.getContext("experimental-webgl",k)}(m);if(!v)return!1;try{y=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!y||v.isContextLost())&&(v.shaderSource(y,"void main() {}"),v.compileShader(y),v.getShaderParameter(y,v.COMPILE_STATUS)===!0)}(c)),E[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(d)}var E={};function A(d,e){if(Array.isArray(d)){if(!Array.isArray(e)||d.length!==e.length)return!1;for(let c=0;c<d.length;c++)if(!A(d[c],e[c]))return!1;return!0}if(typeof d=="object"&&d!==null&&e!==null){if(typeof e!="object"||Object.keys(d).length!==Object.keys(e).length)return!1;for(let c in d)if(!A(d[c],e[c]))return!1;return!0}return d===e}function D(d,e,c){let m=n.window.document.createElement(d);return e!==void 0&&(m.className=e),c&&c.appendChild(m),m}function B(d,e,c){let m=n.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(let y of Object.keys(e))m.setAttributeNS(null,y,e[y]);return c&&c.appendChild(m),m}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let G=n.window.document&&n.window.document.documentElement.style,rt=G&&G.userSelect!==void 0?"userSelect":"WebkitUserSelect",Q;function dt(){G&&rt&&(Q=G[rt],G[rt]="none")}function W(){G&&rt&&(G[rt]=Q)}function et(d){d.preventDefault(),d.stopPropagation(),n.window.removeEventListener("click",et,!0)}function mt(){n.window.addEventListener("click",et,!0),n.window.setTimeout(()=>{n.window.removeEventListener("click",et,!0)},0)}function St(d,e){let c=d.getBoundingClientRect();return Rt(d,c,e)}function _t(d,e){let c=d.getBoundingClientRect(),m=[];for(let y=0;y<e.length;y++)m.push(Rt(d,c,e[y]));return m}function Mt(d){return n.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&n.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Rt(d,e,c){let m=d.offsetWidth===e.width?1:d.offsetWidth/e.width;return new n.pointGeometry((c.clientX-e.left)*m,(c.clientY-e.top)*m)}function Vt(d,e){var c=e[0],m=e[1],y=e[2],v=e[3],T=c*v-y*m;return T?(d[0]=v*(T=1/T),d[1]=-m*T,d[2]=-y*T,d[3]=c*T,d):null}function Yt(d){let{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class jt extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}hasImage(e){return!!this.getImage(e)}getImage(e){return this.images[e]}addImage(e,c){this._validate(e,c)&&(this.images[e]=c)}_validate(e,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new n.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),m=!1),m}_validateStretch(e,c){if(!e)return!0;let m=0;for(let y of e){if(y[0]<m||y[1]<y[0]||c<y[1])return!1;m=y[1]}return!0}_validateContent(e,c){return!(e&&(e.length!==4||e[0]<0||c.data.width<e[0]||e[1]<0||c.data.height<e[1]||e[2]<0||c.data.width<e[2]||e[3]<0||c.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,c){c.version=this.images[e].version+1,this.images[e]=c,this.updatedImages[e]=!0}removeImage(e){let c=this.images[e];delete this.images[e],delete this.patterns[e],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,c){let m=!0;if(!this.isLoaded())for(let y of e)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(e,c):this.requestors.push({ids:e,callback:c})}_notify(e,c){let m={};for(let y of e){this.images[y]||this.fire(new n.Event("styleimagemissing",{id:y}));let v=this.images[y];v?m[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:n.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){let{width:e,height:c}=this.atlasImage;return{width:e,height:c}}getPattern(e){let c=this.patterns[e],m=this.getImage(e);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{let y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},v=new n.ImagePosition(y,m);this.patterns[e]={bin:y,position:v}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let c=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new n.Texture(e,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let v in this.patterns)e.push(this.patterns[v].bin);let{w:c,h:m}=n.potpack(e),y=this.atlasImage;y.resize({width:c||1,height:m||1});for(let v in this.patterns){let{bin:T}=this.patterns[v],M=T.x+1,k=T.y+1,z=this.images[v].data,L=z.width,O=z.height;n.RGBAImage.copy(z,y,{x:0,y:0},{x:M,y:k},{width:L,height:O}),n.RGBAImage.copy(z,y,{x:0,y:O-1},{x:M,y:k-1},{width:L,height:1}),n.RGBAImage.copy(z,y,{x:0,y:0},{x:M,y:k+O},{width:L,height:1}),n.RGBAImage.copy(z,y,{x:L-1,y:0},{x:M-1,y:k},{width:1,height:O}),n.RGBAImage.copy(z,y,{x:0,y:0},{x:M+L,y:k},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let c of e){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;let m=this.images[c];Yt(m)&&this.updateImage(c,m)}}}let ye=new n.Properties({anchor:new n.DataConstantProperty(n.spec.light.anchor),position:new class{constructor(){this.specification=n.spec.light.position}possiblyEvaluate(d,e){return function([c,m,y]){let v=n.degToRad(m+90),T=n.degToRad(y);return{x:c*Math.cos(v)*Math.sin(T),y:c*Math.sin(v)*Math.sin(T),z:c*Math.cos(T),azimuthal:m,polar:y}}(d.expression.evaluate(e))}interpolate(d,e,c){return{x:n.number(d.x,e.x,c),y:n.number(d.y,e.y,c),z:n.number(d.z,e.z,c),azimuthal:n.number(d.azimuthal,e.azimuthal,c),polar:n.number(d.polar,e.polar,c)}}},color:new n.DataConstantProperty(n.spec.light.color),intensity:new n.DataConstantProperty(n.spec.light.intensity)}),le="-transition";class me extends n.Evented{constructor(e){super(),this._transitionable=new n.Transitionable(ye),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,c={}){if(!this._validate(n.validateLight,e,c))for(let m in e){let y=e[m];n.endsWith(m,le)?this._transitionable.setTransition(m.slice(0,-le.length),y):this._transitionable.setValue(m,y)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,c,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,e.call(n.validateStyle,n.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}let He=new n.Properties({source:new n.DataConstantProperty(n.spec.terrain.source),exaggeration:new n.DataConstantProperty(n.spec.terrain.exaggeration)}),Ye="-transition";class be extends n.Evented{constructor(e,c){super(),this._transitionable=new n.Transitionable(He),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(e){for(let c in e){let m=e[c];n.endsWith(c,Ye)?this._transitionable.setTransition(c.slice(0,-Ye.length),m):this._transitionable.setValue(c,m)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}function Me(d,e,c,m){let y=n.smoothstep(45,65,c),[v,T]=Ui(d,m),M=n.length(e),k=1-Math.min(1,Math.exp((M-v)/(T-v)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*y*d.alpha}function Ui(d,e){let c=.5/Math.tan(.5*e);return[d.range[0]+c,d.range[1]+c]}let Di=new n.Properties({range:new n.DataConstantProperty(n.spec.fog.range),color:new n.DataConstantProperty(n.spec.fog.color),"horizon-blend":new n.DataConstantProperty(n.spec.fog["horizon-blend"])}),di="-transition";class _i extends n.Evented{constructor(e,c){super(),this._transitionable=new n.Transitionable(Di),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,c={}){if(!this._validate(n.validateFog,e,c))for(let m in e){let y=e[m];n.endsWith(m,di)?this._transitionable.setTransition(m.slice(0,-di.length),y):this._transitionable.setValue(m,y)}}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;let c=this.properties&&this.properties.get("color")||1;return n.smoothstep(45,65,e)*c.a}getOpacityAtLatLng(e,c){return this._transform.projection.supportsFog?function(m,y,v){let T=n.MercatorCoordinate.fromLngLat(y),M=v.elevation?v.elevation.getAtPointOrZero(T):0,k=[T.x,T.y,M];return n.transformMat4(k,k,v.mercatorFogMatrix),Me(m,k,v.pitch,v._fov)}(this.state,e,c):0}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Ui(this.state,e):[0,1]}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,c,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,e.call(n.validateStyle,n.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}class qe{constructor(e,c){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n.uniqueId();let m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){let v=new qe.Actor(m[y],c,this.id);v.name=`Worker ${y}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,c,m){n.asyncAll(this.actors,(y,v)=>{y.send(e,c,v)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}function gi(d,e,c){return e*(n.EXTENT/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}qe.Actor=n.Actor;class Ki{constructor(e,c,m,y){this.screenBounds=e,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(v=>y.pointCoordinate3D(v)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(e,c){let m,y;if(e instanceof n.pointGeometry||typeof e[0]=="number"){let v=n.pointGeometry.convert(e);m=[n.pointGeometry.convert(e)],y=c.isPointAboveHorizon(v)}else{let v=n.pointGeometry.convert(e[0]),T=n.pointGeometry.convert(e[1]);m=[v,T],y=n.polygonizeBounds(v,T).every(M=>c.isPointAboveHorizon(M))}return new Ki(m,c.getCameraPoint(),y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(e){return n.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){let c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.pointGeometry(1,1)):this.screenBounds[1],y=n.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),n.bufferConvexPolygon(y,e)}containsTile(e,c,m){let y=e.queryPadding+1,v=e.tileID.wrap,T=m?this._bufferedCameraMercator(y,c).map($=>n.getTilePoint(e.tileTransform,$,v)):this._bufferedScreenMercator(y,c).map($=>n.getTilePoint(e.tileTransform,$,v)),M=this.screenGeometryMercator.map($=>n.getTileVec3(e.tileTransform,$,v)),k=M.map($=>new n.pointGeometry($[0],$[1])),z=c.getFreeCameraOptions().position||new n.MercatorCoordinate(0,0,0),L=n.getTileVec3(e.tileTransform,z,v),O=M.map($=>{let U=n.sub($,$,L);return n.normalize(U,U),new n.Ray(L,U)}),j=gi(e,1,c.zoom);if(n.polygonIntersectsBox(T,0,0,n.EXTENT,n.EXTENT))return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:O,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(X=n.getBounds(T),X.min.x=n.clamp(X.min.x,0,n.EXTENT),X.min.y=n.clamp(X.min.y,0,n.EXTENT),X.max.x=n.clamp(X.max.x,0,n.EXTENT),X.max.y=n.clamp(X.max.y,0,n.EXTENT),X),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:j};var X}_bufferedScreenMercator(e,c){let m=Xi(e);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let y=this.bufferedScreenGeometry(e).map(v=>c.pointCoordinate3D(v));return this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(e,c){let m=Xi(e);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let y=this.bufferedCameraGeometry(e).map(v=>c.pointCoordinate3D(v));return this._cameraRaycastCache[m]=y,y}}}function Xi(d){return 100*d|0}function Kn(d,e,c){let m=function(y,v){if(y)return c(y);if(v){let T=n.pick(n.extend(v,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(T.vectorLayers=v.vector_layers,T.vectorLayerIds=T.vectorLayers.map(M=>M.id)),T.tiles=e.canonicalizeTileset(T,d.url),c(null,T)}};return d.url?n.getJSON(e.transformRequest(e.normalizeSourceURL(d.url),n.ResourceType.Source),m):n.exported.frame(()=>m(null,d))}class vn{constructor(e,c,m){this.bounds=n.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let c=Math.pow(2,e.z),m=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*c),v=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*c),T=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*c);return e.x>=m&&e.x<v&&e.y>=y&&e.y<T}}class Io{constructor(e,c,m){this.context=e;let y=e.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Kr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Jn{constructor(e,c,m,y){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=e;let v=e.gl;this.buffer=v.createBuffer(),e.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){let c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,c){for(let m=0;m<this.attributes.length;m++){let y=c.attributes[this.attributes[m].name];y!==void 0&&e.enableVertexAttribArray(y)}}setVertexAttribPointers(e,c,m){for(let y=0;y<this.attributes.length;y++){let v=this.attributes[y],T=c.attributes[v.name];T!==void 0&&e.vertexAttribPointer(T,v.components,e[Kr[v.type]],!1,this.itemSize,v.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Le{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Tr extends Le{getDefault(){return n.Color.transparent}set(e){let c=this.current;(e.r!==c.r||e.g!==c.g||e.b!==c.b||e.a!==c.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ka extends Le{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ji extends Le{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Jr extends Le{getDefault(){return[!0,!0,!0,!0]}set(e){let c=this.current;(e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||e[3]!==c[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Oe extends Le{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Sr extends Le{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Qr extends Le{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let c=this.current;(e.func!==c.func||e.ref!==c.ref||e.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class bn extends Le{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let c=this.current;(e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ts extends Le{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;e?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=e,this.dirty=!1}}class Rs extends Le{getDefault(){return[0,1]}set(e){let c=this.current;(e[0]!==c[0]||e[1]!==c[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ko extends Le{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;e?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=e,this.dirty=!1}}class Bs extends Le{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class es extends Le{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;e?c.enable(c.BLEND):c.disable(c.BLEND),this.current=e,this.dirty=!1}}class Vn extends Le{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let c=this.current;(e[0]!==c[0]||e[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class is extends Le{getDefault(){return n.Color.transparent}set(e){let c=this.current;(e.r!==c.r||e.g!==c.g||e.b!==c.b||e.a!==c.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Zn extends Le{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Un extends Le{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;e?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=e,this.dirty=!1}}class Er extends Le{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Po extends Le{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ns extends Le{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Fs extends Le{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ic extends Le{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let c=this.current;(e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||e[3]!==c[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Pa extends Le{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class za extends Le{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Os extends Le{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;c.bindTexture(c.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Da extends Le{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class rs extends Le{getDefault(){return null}set(e){let c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class La extends Le{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class Nn extends Le{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Mr extends Le{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ss extends Le{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class os extends Le{constructor(e,c){super(e),this.context=e,this.parent=c}getDefault(){return null}}class Vs extends os{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class zo extends os{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Zs extends zo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class J{constructor(e,c,m,y){this.context=e,this.width=c,this.height=m;let v=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new Vs(e,v),y&&(this.depthAttachment=new zo(e,v))}destroy(){let e=this.context.gl,c=this.colorAttachment.get();if(c&&e.deleteTexture(c),this.depthAttachment){let m=this.depthAttachment.get();m&&e.deleteRenderbuffer(m)}e.deleteFramebuffer(this.framebuffer)}}class F{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Tr(this),this.clearDepth=new ka(this),this.clearStencil=new Ji(this),this.colorMask=new Jr(this),this.depthMask=new Oe(this),this.stencilMask=new Sr(this),this.stencilFunc=new Qr(this),this.stencilOp=new bn(this),this.stencilTest=new ts(this),this.depthRange=new Rs(this),this.depthTest=new ko(this),this.depthFunc=new Bs(this),this.blend=new es(this),this.blendFunc=new Vn(this),this.blendColor=new is(this),this.blendEquation=new Zn(this),this.cullFace=new Un(this),this.cullFaceSide=new Er(this),this.frontFace=new Po(this),this.program=new ns(this),this.activeTexture=new Fs(this),this.viewport=new ic(this),this.bindFramebuffer=new Pa(this),this.bindRenderbuffer=new za(this),this.bindTexture=new Os(this),this.bindVertexBuffer=new Da(this),this.bindElementBuffer=new rs(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new La(this),this.pixelStoreUnpack=new Nn(this),this.pixelStoreUnpackPremultiplyAlpha=new Mr(this),this.pixelStoreUnpackFlipY=new ss(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,c){return new Io(this,e,c)}createVertexBuffer(e,c,m){return new Jn(this,e,c,m)}createRenderbuffer(e,c,m){let y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,e,c,m),this.bindRenderbuffer.set(null),v}createFramebuffer(e,c,m){return new J(this,e,c,m)}clear({color:e,depth:c,stencil:m}){let y=this.gl,v=0;e&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),m!==void 0&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(v)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){A(e.blendFunction,n.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Z extends n.Evented{constructor(e,c,m,y){super(),this.id=e,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},c),n.extend(this,n.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Kn(this._options,this.map._requestManager,(e,c)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new n.ErrorEvent(e)):c&&(n.extend(this,c),c.bounds&&(this.tileBounds=new vn(c.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(c.tiles),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,c){let m=n.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);e.request=n.getImage(this.map._requestManager.transformRequest(y,n.ResourceType.Tile),(v,T,M,k)=>(delete e.request,e.aborted?(e.state="unloaded",c(null)):v?(e.state="errored",c(v)):T?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:M,expires:k}),e.setTexture(T,this.map.painter),e.state="loaded",n.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(e,c,m){e.setTexture(c,m)}static unloadTileData(e,c){e.texture&&c.saveTileTexture(e.texture)}abortTile(e,c){e.request&&(e.request.cancel(),delete e.request),c()}unloadTile(e,c){e.texture&&this.map.painter.saveTileTexture(e.texture),c()}hasTransition(){return!1}}let H;function ot(d,e,c,m,y,v,T,M){let k=[d,c,y,e,m,v,1,1,1],z=[T,M,1],L=n.adjoint([],k),[O,j,X]=n.transformMat3(z,z,n.transpose(L,L));return n.multiply(k,[O,0,0,0,j,0,0,0,X],k)}class ht extends n.Evented{constructor(e,c,m,y){super(),this.id=e,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c}load(e){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,n.getImage(this.map._requestManager.transformRequest(this.url,n.ResourceType.Image),(c,m)=>{if(this._loaded=!0,c)this.fire(new n.ErrorEvent(c));else if(m){let{HTMLImageElement:y}=n.window;this.image=m instanceof y?n.exported.getImageData(m):m,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(e){this.coordinates=e,this._boundsArray=void 0;let c=e.map(n.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,v=1/0,T=-1/0,M=-1/0;for(let O of m)y=Math.min(y,O.x),v=Math.min(v,O.y),T=Math.max(T,O.x),M=Math.max(M,O.y);let k=Math.max(T-y,M-v),z=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),L=Math.pow(2,z);return new n.CanonicalTileID(z,Math.floor((y+T)/2*L),Math.floor((v+M)/2*L))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(let k in this.tiles){let z=this.tiles[k];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray)return;let c=n.tileTransform(this.tileID,this.map.transform.projection),[m,y,v,T]=this.coordinates.map(k=>{let z=c.projection.project(k[0],k[1]);return n.getTilePoint(c,z)._round()});this.perspectiveTransform=function(k,z,L,O,j,X,$,U,st,Y){let it=ot(0,0,k,0,0,z,k,z),nt=ot(L,O,j,X,$,U,st,Y);return n.multiply(nt,n.adjoint(it,it),nt),[nt[6]/nt[8]*k/n.EXTENT,nt[7]/nt[8]*z/n.EXTENT]}(this.width,this.height,m.x,m.y,y.x,y.y,T.x,T.y,v.x,v.y);let M=this._boundsArray=new n.StructArrayLayout4i8;M.emplaceBack(m.x,m.y,0,0),M.emplaceBack(y.x,y.y,n.EXTENT,0),M.emplaceBack(T.x,T.y,0,n.EXTENT),M.emplaceBack(v.x,v.y,n.EXTENT,n.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(M,n.boundsAttributes.members),this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,c=e.gl;this.texture?this.texture.update(this.image):(this.texture=new n.Texture(e,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._prepareData(e)}loadTile(e,c){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},c(null)):(e.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}let vt={vector:class extends n.Evented{constructor(d,e,c,m){if(super(),this.id=d,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(e,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},e),this._collectResourceTiming=e.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new n.DedupedRequest}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Kn(this._options,this.map._requestManager,(d,e)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new n.ErrorEvent(d)):e&&(n.extend(this,e),e.bounds&&(this.tileBounds=new vn(e.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(e.tiles,this.map._requestManager._customAccessToken),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d();let e=this.map.style._getSourceCaches(this.id);for(let c of e)c.clearTiles();this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}loadTile(d,e){let c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,n.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired")d.state==="loading"?d.reloadCallback=e:d.request=d.actor.send("reloadTile",m,y.bind(this));else if(d.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",m,y.bind(this),void 0,!0);else{let v=n.loadVectorTile.call({deduped:this._deduped},m,(T,M)=>{T||!M?y.call(this,T):(m.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},d.actor&&d.actor.send("loadTile",m,y.bind(this),void 0,!0))},!0);d.request={cancel:v}}function y(v,T){return delete d.request,d.aborted?e(null):v&&v.status!==404?e(v):(T&&T.resourceTiming&&(d.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&d.setExpiryData(T),d.loadVectorData(T,this.map.painter),n.cacheEntryPossiblyAdded(this.dispatcher),e(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Z,"raster-dem":class extends Z{constructor(d,e,c,m){super(d,e,c,m),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(d,e){let c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,v){y&&(d.state="errored",e(y)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",e(null))}d.request=n.getImage(this.map._requestManager.transformRequest(c,n.ResourceType.Tile),function(y,v,T,M){if(delete d.request,d.aborted)d.state="unloaded",e(null);else if(y)d.state="errored",e(y);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:T,expires:M});let k=n.window.ImageBitmap&&v instanceof n.window.ImageBitmap&&(H==null&&(H=n.window.OffscreenCanvas&&new n.window.OffscreenCanvas(1,1).getContext("2d")&&typeof n.window.createImageBitmap=="function"),H),z=1-(v.width-n.prevPowerOfTwo(v.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));let L=k?v:n.exported.getImageData(v,z),O={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",O,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){let e=d.canonical,c=Math.pow(2,e.z),m=(e.x-1+c)%c,y=e.x===0?d.wrap-1:d.wrap,v=(e.x+1+c)%c,T=e.x+1===c?d.wrap+1:d.wrap,M={};return M[new n.OverscaledTileID(d.overscaledZ,y,e.z,m,e.y).key]={backfilled:!1},M[new n.OverscaledTileID(d.overscaledZ,T,e.z,v,e.y).key]={backfilled:!1},e.y>0&&(M[new n.OverscaledTileID(d.overscaledZ,y,e.z,m,e.y-1).key]={backfilled:!1},M[new n.OverscaledTileID(d.overscaledZ,d.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},M[new n.OverscaledTileID(d.overscaledZ,T,e.z,v,e.y-1).key]={backfilled:!1}),e.y+1<c&&(M[new n.OverscaledTileID(d.overscaledZ,y,e.z,m,e.y+1).key]={backfilled:!1},M[new n.OverscaledTileID(d.overscaledZ,d.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},M[new n.OverscaledTileID(d.overscaledZ,T,e.z,v,e.y+1).key]={backfilled:!1}),M}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends n.Evented{constructor(d,e,c,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=e.data,this._options=n.extend({},e),this._collectResourceTiming=e.collectResourceTiming,e.maxzoom!==void 0&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;let y=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(e.buffer!==void 0?e.buffer:128)*y,tolerance:(e.tolerance!==void 0?e.tolerance:.375)*y,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:e.clusterMaxZoom!==void 0?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:n.EXTENT,radius:(e.clusterRadius!==void 0?e.clusterRadius:50)*y,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},e),this}getClusterChildren(d,e){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},e),this}getClusterLeaves(d,e,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:e,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.Event("dataloading",{dataType:"source"})),this._loaded=!1;let d=n.extend({},this.workerOptions),e=this._data;typeof e=="string"?(d.request=this.map._requestManager.transformRequest(n.exported.resolveURL(e),n.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new n.ErrorEvent(c));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new n.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,e){let c=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(c,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete d.request,d.unloadVectorData(),d.aborted?e(null):m?e(m):(d.loadVectorData(y,this.map.painter,c==="reloadTile"),e(null))),void 0,c==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ht{constructor(d,e,c,m){super(d,e,c,m),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;let d=this.options;this.urls=[];for(let e of d.urls)this.urls.push(this.map._requestManager.transformRequest(e,n.ResourceType.Source).url);n.getVideo(this.urls,(e,c)=>{this._loaded=!0,e?this.fire(new n.ErrorEvent(e)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){let e=this.video.seekable;d<e.start(0)||d>e.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let d=this.map.painter.context,e=d.gl;this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new n.Texture(d,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ht,canvas:class extends ht{constructor(d,e,c,m){super(d,e,c,m),e.coordinates?Array.isArray(e.coordinates)&&e.coordinates.length===4&&!e.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(v=>typeof v!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),e.animate&&typeof e.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),e.canvas?typeof e.canvas=="string"||e.canvas instanceof n.window.HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=e,this.animate=e.animate===void 0||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof n.window.HTMLCanvasElement?this.options.canvas:n.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let e=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.Texture(e,this.canvas,e.gl.RGBA,{premultiply:!0}),this._prepareData(e)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends n.Evented{constructor(d,e,c,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=e,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new vn(this._implementation.bounds,this.minzoom,this.maxzoom)),e.update=this._update.bind(this),e.coveringTiles=this._coveringTiles.bind(this),n.extend(this,n.pick(e,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){let{x:e,y:c,z:m}=d.canonical;return this._implementation.hasTile({x:e,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,e){let{x:c,y:m,z:y}=d.tileID.canonical,v=new n.window.AbortController,T=this._implementation.loadTile({x:c,y:m,z:y},{signal:v.signal});if(!T)return this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",e(null);T.cancel=()=>v.abort(),d.request=T.then(function(M){return delete d.request,d.aborted?(d.state="unloaded",e(null)):M?function(k){return k instanceof n.window.ImageData||k instanceof n.window.ImageBitmap||k instanceof n.window.HTMLCanvasElement}(M)?(this.loadTileData(d,M),d.state="loaded",void e(null)):(d.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",e(null))}.bind(this)).catch(M=>{M.code!==20&&(d.state="errored",e(M))})}loadTileData(d,e){Z.loadTileData(d,e,this._map.painter)}unloadTileData(d){Z.unloadTileData(d,this._map.painter)}prepareTile(d){if(!this._implementation.prepareTile)return null;let{x:e,y:c,z:m}=d.tileID.canonical,y=this._implementation.prepareTile({x:e,y:c,z:m});return y?(this.loadTileData(d,y),d.state="loaded",y):null}unloadTile(d,e){if(this.unloadTileData(d),this._implementation.unloadTile){let{x:c,y:m,z:y}=d.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:y})}e()}abortTile(d,e){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_update(){this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}}},xt=function(d,e,c,m){let y=new vt[e.type](d,e,c,m);if(y.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${y.id}`);return n.bindAll(["load","abort","unload","serialize","prepare"],y),y};function pt(d,e){let c=n.identity([]);return n.scale(c,c,[.5*d.width,.5*-d.height,1]),n.translate(c,c,[1,-1,0]),n.multiply$1(c,c,d.calculateProjMatrix(e.toUnwrapped())),Float32Array.from(c)}function Tt(d,e,c,m,y,v,T,M=!1){let k=d.tilesIn(m,T,M);k.sort(Kt);let z=[];for(let O of k)z.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(e,c,d._state,O,y,v,pt(d.transform,O.tile.tileID),M)});let L=function(O){let j={},X={};for(let $ of O){let U=$.queryResults,st=$.wrappedTileID,Y=X[st]=X[st]||{};for(let it in U){let nt=U[it],at=Y[it]=Y[it]||{},tt=j[it]=j[it]||[];for(let ct of nt)at[ct.featureIndex]||(at[ct.featureIndex]=!0,tt.push(ct))}}return j}(z);for(let O in L)L[O].forEach(j=>{let X=j.feature,$=X.layer;$&&$.type!=="background"&&$.type!=="sky"&&(X.source=$.source,$["source-layer"]&&(X.sourceLayer=$["source-layer"]),X.state=X.id!==void 0?d.getFeatureState($["source-layer"],X.id):{})});return L}function Ft(d,e){let c=d.getRenderableIds().map(v=>d.getTileByID(v)),m=[],y={};for(let v=0;v<c.length;v++){let T=c[v],M=T.tileID.canonical.key;y[M]||(y[M]=!0,T.querySourceFeatures(m,e))}return m}function Kt(d,e){let c=d.tileID,m=e.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function Zt(){return eo.workerClass!=null?new eo.workerClass:new n.window.Worker(eo.workerUrl)}let pe="mapboxgl_preloaded_worker_pool";class ce{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ce.workerCount;)this.workers.push(new Zt);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pe]}numActive(){return Object.keys(this.active).length}}let he;function _e(){return he||(he=new ce),he}function Et(d,e){let c={};for(let m in d)m!=="ref"&&(c[m]=d[m]);return n.refProperties.forEach(m=>{m in e&&(c[m]=e[m])}),c}function Ve(d){d=d.slice();let e=Object.create(null);for(let c=0;c<d.length;c++)e[d[c].id]=d[c];for(let c=0;c<d.length;c++)"ref"in d[c]&&(d[c]=Et(d[c],e[d[c].ref]));return d}ce.workerCount=2;let se={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Be(d,e,c){c.push({command:se.addSource,args:[d,e[d]]})}function Ze(d,e,c){e.push({command:se.removeSource,args:[d]}),c[d]=!0}function as(d,e,c,m){Ze(d,c,m),Be(d,e,c)}function ar(d,e,c){let m;for(m in d[c])if(d[c].hasOwnProperty(m)&&m!=="data"&&!A(d[c][m],e[c][m]))return!1;for(m in e[c])if(e[c].hasOwnProperty(m)&&m!=="data"&&!A(d[c][m],e[c][m]))return!1;return!0}function Ht(d,e,c,m,y,v){let T;for(T in e=e||{},d=d||{})d.hasOwnProperty(T)&&(A(d[T],e[T])||c.push({command:v,args:[m,T,e[T],y]}));for(T in e)e.hasOwnProperty(T)&&!d.hasOwnProperty(T)&&(A(d[T],e[T])||c.push({command:v,args:[m,T,e[T],y]}))}function ze(d){return d.id}function Ae(d,e){return d[e.id]=e,d}class Qn{constructor(e,c){this.reset(e,c)}reset(e,c){this.points=e||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=n.clamp(e,0,1);let c=1,m=this._distances[c],y=e*this.paddedLength+this.padding;for(;m<y&&c<this._distances.length;)m=this._distances[++c];let v=c-1,T=this._distances[v],M=m-T,k=M>0?(y-T)/M:0;return this.points[v].mult(1-k).add(this.points[c].mult(k))}}class ls{constructor(e,c,m){let y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(e/m),this.yCellCount=Math.ceil(c/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=c,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,c,m,y,v){this._forEachCell(c,m,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(e,c,m,y){this._forEachCell(c-y,m-y,c+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(c),this.circles.push(m),this.circles.push(y)}_insertBoxCell(e,c,m,y,v,T){this.boxCells[v].push(T)}_insertCircleCell(e,c,m,y,v,T){this.circleCells[v].push(T)}_query(e,c,m,y,v,T){if(m<0||e>this.width||y<0||c>this.height)return!v&&[];let M=[];if(e<=0&&c<=0&&this.width<=m&&this.height<=y){if(v)return!0;for(let k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){let z=this.circles[3*k],L=this.circles[3*k+1],O=this.circles[3*k+2];M.push({key:this.circleKeys[k],x1:z-O,y1:L-O,x2:z+O,y2:L+O})}return T?M.filter(T):M}return this._forEachCell(e,c,m,y,this._queryCell,M,{hitTest:v,seenUids:{box:{},circle:{}}},T),v?M.length>0:M}_queryCircle(e,c,m,y,v){let T=e-m,M=e+m,k=c-m,z=c+m;if(M<0||T>this.width||z<0||k>this.height)return!y&&[];let L=[];return this._forEachCell(T,k,M,z,this._queryCellCircle,L,{hitTest:y,circle:{x:e,y:c,radius:m},seenUids:{box:{},circle:{}}},v),y?L.length>0:L}query(e,c,m,y,v){return this._query(e,c,m,y,!1,v)}hitTest(e,c,m,y,v){return this._query(e,c,m,y,!0,v)}hitTestCircle(e,c,m,y){return this._queryCircle(e,c,m,!0,y)}_queryCell(e,c,m,y,v,T,M,k){let z=M.seenUids,L=this.boxCells[v];if(L!==null){let j=this.bboxes;for(let X of L)if(!z.box[X]){z.box[X]=!0;let $=4*X;if(e<=j[$+2]&&c<=j[$+3]&&m>=j[$+0]&&y>=j[$+1]&&(!k||k(this.boxKeys[X]))){if(M.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[X],x1:j[$],y1:j[$+1],x2:j[$+2],y2:j[$+3]})}}}let O=this.circleCells[v];if(O!==null){let j=this.circles;for(let X of O)if(!z.circle[X]){z.circle[X]=!0;let $=3*X;if(this._circleAndRectCollide(j[$],j[$+1],j[$+2],e,c,m,y)&&(!k||k(this.circleKeys[X]))){if(M.hitTest)return T.push(!0),!0;{let U=j[$],st=j[$+1],Y=j[$+2];T.push({key:this.circleKeys[X],x1:U-Y,y1:st-Y,x2:U+Y,y2:st+Y})}}}}}_queryCellCircle(e,c,m,y,v,T,M,k){let z=M.circle,L=M.seenUids,O=this.boxCells[v];if(O!==null){let X=this.bboxes;for(let $ of O)if(!L.box[$]){L.box[$]=!0;let U=4*$;if(this._circleAndRectCollide(z.x,z.y,z.radius,X[U+0],X[U+1],X[U+2],X[U+3])&&(!k||k(this.boxKeys[$])))return T.push(!0),!0}}let j=this.circleCells[v];if(j!==null){let X=this.circles;for(let $ of j)if(!L.circle[$]){L.circle[$]=!0;let U=3*$;if(this._circlesCollide(X[U],X[U+1],X[U+2],z.x,z.y,z.radius)&&(!k||k(this.circleKeys[$])))return T.push(!0),!0}}}_forEachCell(e,c,m,y,v,T,M,k){let z=this._convertToXCellCoord(e),L=this._convertToYCellCoord(c),O=this._convertToXCellCoord(m),j=this._convertToYCellCoord(y);for(let X=z;X<=O;X++)for(let $=L;$<=j;$++)if(v.call(this,e,c,m,y,this.xCellCount*$+X,T,M,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,c,m,y,v,T){let M=y-e,k=v-c,z=m+T;return z*z>M*M+k*k}_circleAndRectCollide(e,c,m,y,v,T,M){let k=(T-y)/2,z=Math.abs(e-(y+k));if(z>k+m)return!1;let L=(M-v)/2,O=Math.abs(c-(v+L));if(O>L+m)return!1;if(z<=k||O<=L)return!0;let j=z-k,X=O-L;return j*j+X*X<=m*m}}let Ie=Math.tan(85*Math.PI/180);function cs(d,e,c,m,y,v){let T=n.create();if(c){if(y.projection.name==="globe")n.multiply$1(T,T,n.calculateGlobeLabelMatrix(y,e));else{let M=Vt([],v);T[0]=M[0],T[1]=M[1],T[4]=M[2],T[5]=M[3]}m||n.rotateZ(T,T,y.angle)}else n.multiply$1(T,y.labelPlaneMatrix,d);return T}function Us(d,e,c,m,y,v){if(c){if(y.projection.name==="globe"){let T=cs(d,e,c,m,y,v);return n.invert(T,T),n.multiply$1(T,d,T),T}{let T=n.clone(d),M=n.identity([]);return M[0]=v[0],M[1]=v[1],M[4]=v[2],M[5]=v[3],n.multiply$1(T,T,M),m||n.rotateZ(T,T,-y.angle),T}}return y.glCoordMatrix}function Hi(d,e,c=0){let m=[d.x,d.y,c,1];c?n.transformMat4$1(m,m,e):ln(m,m,e);let y=m[3];return{point:new n.pointGeometry(m[0]/y,m[1]/y),signedDistanceFromCamera:y}}function wn(d,e){let c=[d[0],d[1],d[2],1];n.transformMat4$1(c,c,e);let m=c[3];return{point:new n.pointGeometry(c[0]/m,c[1]/m),signedDistanceFromCamera:m}}function ci(d,e){return Math.min(.5+d/e*.5,1.5)}function Tp(d,e){let c=d[0]/d[3],m=d[1]/d[3];return c>=-e[0]&&c<=e[0]&&m>=-e[1]&&m<=e[1]}function Do(d,e,c,m,y,v,T,M,k,z){let L=c.transform,O=m?d.textSizeData:d.iconSizeData,j=n.evaluateSizeForZoom(O,c.transform.zoom),X=[256/c.width*2+1,256/c.height*2+1],$=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;$.clear();let U=d.lineVertexArray,st=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,Y=c.transform.width/c.transform.height,it=!1;for(let nt=0;nt<st.length;nt++){let at=st.get(nt);if(at.writingMode!==n.WritingMode.vertical||it||nt!==0&&st.get(nt-1).writingMode===n.WritingMode.horizontal||(it=!0),(at.hidden||at.writingMode===n.WritingMode.vertical)&&!it){Ai(at.numGlyphs,$);continue}it=!1;let tt=new n.pointGeometry(at.tileAnchorX,at.tileAnchorY),ct=k?k(tt):[0,0,0],bt=L.projection.projectTilePoint(tt.x,tt.y,z.canonical),Ct=[bt.x+ct[0],bt.y+ct[1],bt.z+ct[2]],zt=[...Ct,1];if(n.transformMat4$1(zt,zt,e),!Tp(zt,X)){Ai(at.numGlyphs,$);continue}let kt=ci(c.transform.cameraToCenterDistance,zt[3]),$t=n.evaluateSizeForFeature(O,j,at),wt=T?$t/kt:$t*kt,qt=Hi(new n.pointGeometry(Ct[0],Ct[1]),y,Ct[2]);if(qt.signedDistanceFromCamera<=0){Ai(at.numGlyphs,$);continue}let Nt={},re=T?null:k,Dt=Ba(at,wt,!1,M,e,y,v,d.glyphOffsetArray,U,$,qt.point,tt,Nt,Y,re,L.projection,z);it=Dt.useVertical,re&&Dt.needsFlipping&&(Nt={}),(Dt.notEnoughRoom||it||Dt.needsFlipping&&Ba(at,wt,!0,M,e,y,v,d.glyphOffsetArray,U,$,qt.point,tt,Nt,Y,re,L.projection,z).notEnoughRoom)&&Ai(at.numGlyphs,$)}m?d.text.dynamicLayoutVertexBuffer.updateData($):d.icon.dynamicLayoutVertexBuffer.updateData($)}function Ra(d,e,c,m,y,v,T,M,k,z,L,O,j,X,$){let U=M.glyphStartIndex+M.numGlyphs,st=M.lineStartIndex,Y=M.lineStartIndex+M.lineLength,it=e.getoffsetX(M.glyphStartIndex),nt=e.getoffsetX(U-1),at=js(d*it,c,m,y,v,T,M.segment,st,Y,k,z,L,O,j,!0,X,$);if(!at)return null;let tt=js(d*nt,c,m,y,v,T,M.segment,st,Y,k,z,L,O,j,!0,X,$);return tt?{first:at,last:tt}:null}function Ns(d,e,c,m){return d.writingMode===n.WritingMode.horizontal&&Math.abs(c.y-e.y)>Math.abs(c.x-e.x)*m?{useVertical:!0}:d.writingMode===n.WritingMode.vertical?e.y<c.y?{needsFlipping:!0}:null:d.flipState!==0&&function(y,v,T){let M=(v.x-y.x)*T;return M===0||Math.abs((v.y-y.y)/M)>Ie}(e,c,m)?d.flipState===1?{needsFlipping:!0}:null:e.x>c.x?{needsFlipping:!0}:null}function Ba(d,e,c,m,y,v,T,M,k,z,L,O,j,X,$,U,st){let Y=e/24,it=d.lineOffsetX*Y,nt=d.lineOffsetY*Y,at;if(d.numGlyphs>1){let tt=d.glyphStartIndex+d.numGlyphs,ct=d.lineStartIndex,bt=d.lineStartIndex+d.lineLength,Ct=Ra(Y,M,it,nt,c,L,O,d,k,v,j,$,!1,U,st);if(!Ct)return{notEnoughRoom:!0};let zt=Hi(Ct.first.point,T).point,kt=Hi(Ct.last.point,T).point;if(m&&!c){let $t=Ns(d,zt,kt,X);if(d.flipState=$t&&$t.needsFlipping?1:2,$t)return $t}at=[Ct.first];for(let $t=d.glyphStartIndex+1;$t<tt-1;$t++)at.push(js(Y*M.getoffsetX($t),it,nt,c,L,O,d.segment,ct,bt,k,v,j,$,!1,!1,U,st));at.push(Ct.last)}else{if(m&&!c){let ct=Hi(O,y).point,bt=d.lineStartIndex+d.segment+1,Ct=new n.pointGeometry(k.getx(bt),k.gety(bt)),zt=Hi(Ct,y),kt=Ns(d,ct,zt.signedDistanceFromCamera>0?zt.point:Fe(O,Ct,ct,1,y,void 0,U,st.canonical),X);if(d.flipState=kt&&kt.needsFlipping?1:2,kt)return kt}let tt=js(Y*M.getoffsetX(d.glyphStartIndex),it,nt,c,L,O,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,k,v,j,$,!1,!1,U,st);if(!tt)return{notEnoughRoom:!0};at=[tt]}for(let tt of at)n.addDynamicAttributes(z,tt.point,tt.angle);return{}}function nc(d,e,c,m,y){let v=m.projectTilePoint(d.x,d.y,e);if(!y)return Hi(v,c,v.z);let T=y(d);return Hi(new n.pointGeometry(v.x+T[0],v.y+T[1]),c,v.z+T[2])}function Fe(d,e,c,m,y,v,T,M){let k=nc(d.add(d.sub(e)._unit()),M,y,T,v).point,z=c.sub(k);return c.add(z._mult(m/z.mag()))}function js(d,e,c,m,y,v,T,M,k,z,L,O,j,X,$,U,st){let Y=m?d-e:d+e,it=Y>0?1:-1,nt=0;m&&(it*=-1,nt=Math.PI),it<0&&(nt+=Math.PI);let at=it>0?M+T:M+T+1,tt=y,ct=y,bt=0,Ct=0,zt=Math.abs(Y),kt=[],$t=[],wt=v,qt=()=>{let ie=at-it;return bt===0?v:new n.pointGeometry(z.getx(ie),z.gety(ie))},Nt=()=>Fe(qt(),wt,ct,zt-bt+1,L,j,U,st.canonical);for(;bt+Ct<=zt;){if(at+=it,at<M||at>=k)return null;if(ct=tt,kt.push(tt),X&&$t.push(wt||qt()),tt=O[at],tt===void 0){wt=new n.pointGeometry(z.getx(at),z.gety(at));let ie=nc(wt,st.canonical,L,U,j);tt=ie.signedDistanceFromCamera>0?O[at]=ie.point:Nt()}else wt=null;bt+=Ct,Ct=ct.dist(tt)}$&&j&&(wt=wt||new n.pointGeometry(z.getx(at),z.gety(at)),O[at]=tt=O[at]===void 0?tt:Nt(),Ct=ct.dist(tt));let re=(zt-bt)/Ct,Dt=tt.sub(ct),ee=Dt.mult(re)._add(ct);c&&ee._add(Dt._unit()._perp()._mult(c*it));let ue=nt+Math.atan2(tt.y-ct.y,tt.x-ct.x);return kt.push(ee),X&&(wt=wt||new n.pointGeometry(z.getx(at),z.gety(at)),$t.push(function(ie,ne,fe){let Se=1-fe;return new n.pointGeometry(ie.x*Se+ne.x*fe,ie.y*Se+ne.y*fe)}($t.length>0?$t[$t.length-1]:wt,wt,re))),{point:ee,angle:ue,path:kt,tilePath:$t}}let rc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ai(d,e){for(let c=0;c<d;c++){let m=e.length;e.resize(m+4),e.float32.set(rc,3*m)}}function ln(d,e,c){let m=e[0],y=e[1];return d[0]=c[0]*m+c[4]*y+c[12],d[1]=c[1]*m+c[5]*y+c[13],d[3]=c[3]*m+c[7]*y+c[15],d}let jn=100;class Fa{constructor(e,c,m=new ls(e.width+200,e.height+200,25),y=new ls(e.width+200,e.height+200,25)){this.transform=e,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+jn,this.screenBottomBoundary=e.height+jn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=c}placeCollisionBox(e,c,m,y,v,T,M){let k=c.projectedAnchorX,z=c.projectedAnchorY,L=c.projectedAnchorZ,O=c.elevation,j=c.tileID;if(O&&j){let at=this.transform.projection.upVector(j.canonical,c.tileAnchorX,c.tileAnchorY),tt=this.transform.projection.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=at[0]*O*tt,z+=at[1]*O*tt,L+=at[2]*O*tt}let X=this.projectAndGetPerspectiveRatio(T,[k,z,L],c.tileID,this.transform.projection.name==="globe"||!!O||this.transform.pitch>0),$=v*X.perspectiveRatio,U=(c.x1*e+m.x-c.padding)*$+X.point.x,st=(c.y1*e+m.y-c.padding)*$+X.point.y,Y=(c.x2*e+m.x+c.padding)*$+X.point.x,it=(c.y2*e+m.y+c.padding)*$+X.point.y,nt=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(U,st,Y,it)||!y&&this.grid.hitTest(U,st,Y,it,M)||nt?{box:[],offscreen:!1,occluded:X.occluded}:{box:[U,st,Y,it],offscreen:this.isOffscreen(U,st,Y,it),occluded:!1}}placeCollisionCircles(e,c,m,y,v,T,M,k,z,L,O,j,X,$){let U=[],st=this.transform.elevation,Y=st?st.getAtTileOffsetFunc($,this.transform.center.lat,this.transform.worldSize,this.transform.projection):Nt=>[0,0,0],it=new n.pointGeometry(c.tileAnchorX,c.tileAnchorY),nt=this.transform.projection.projectTilePoint(c.tileAnchorX,c.tileAnchorY,$.canonical),at=Y(it),tt=[nt.x+at[0],nt.y+at[1],nt.z+at[2]],ct=this.projectAndGetPerspectiveRatio(T,[tt[0],tt[1],tt[2]],$,this.transform.projection.name==="globe"||!!st||this.transform.pitch>0),{perspectiveRatio:bt}=ct,Ct=(L?v/bt:v*bt)/n.ONE_EM,zt=Hi(new n.pointGeometry(tt[0],tt[1]),M,tt[2]).point,kt=ct.signedDistanceFromCamera>0?Ra(Ct,y,c.lineOffsetX*Ct,c.lineOffsetY*Ct,!1,zt,it,c,m,M,{},st&&!L?Y:null,L&&!!st,this.transform.projection,$):null,$t=!1,wt=!1,qt=!0;if(kt&&!ct.occluded){let Nt=.5*j*bt+X,re=new n.pointGeometry(-100,-100),Dt=new n.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ee=new Qn,ue=kt.first,ie=kt.last,ne=[];for(let ae=ue.path.length-1;ae>=1;ae--)ne.push(ue.path[ae]);for(let ae=1;ae<ie.path.length;ae++)ne.push(ie.path[ae]);let fe=2.5*Nt;if(k){let ae=ne.map(st?(ge,Re)=>{let hi=Y(Re<ue.path.length-1?ue.tilePath[ue.path.length-1-Re]:ie.tilePath[Re-ue.path.length+2]);return Hi(ge,k,hi[2])}:ge=>Hi(ge,k));ne=ae.some(ge=>ge.signedDistanceFromCamera<=0)?[]:ae.map(ge=>ge.point)}let Se=[];if(ne.length>0){let ae=ne[0].clone(),ge=ne[0].clone();for(let Re=1;Re<ne.length;Re++)ae.x=Math.min(ae.x,ne[Re].x),ae.y=Math.min(ae.y,ne[Re].y),ge.x=Math.max(ge.x,ne[Re].x),ge.y=Math.max(ge.y,ne[Re].y);Se=ae.x>=re.x&&ge.x<=Dt.x&&ae.y>=re.y&&ge.y<=Dt.y?[ne]:ge.x<re.x||ae.x>Dt.x||ge.y<re.y||ae.y>Dt.y?[]:n.clipLine([ne],re.x,re.y,Dt.x,Dt.y)}for(let ae of Se){ee.reset(ae,.25*Nt);let ge=0;ge=ee.length<=.5*Nt?1:Math.ceil(ee.paddedLength/fe)+1;for(let Re=0;Re<ge;Re++){let hi=Re/Math.max(ge-1,1),Ni=ee.lerp(hi),ji=Ni.x+jn,pn=Ni.y+jn;U.push(ji,pn,Nt,0);let qn=ji-Nt,pr=pn-Nt,Br=ji+Nt,fr=pn+Nt;if(qt=qt&&this.isOffscreen(qn,pr,Br,fr),wt=wt||this.isInsideGrid(qn,pr,Br,fr),!e&&this.grid.hitTestCircle(ji,pn,Nt,O)&&($t=!0,!z))return{circles:[],offscreen:!1,collisionDetected:$t,occluded:!1}}}}return{circles:!z&&$t||!wt?[]:U,offscreen:qt,collisionDetected:$t,occluded:ct.occluded}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let c=[],m=1/0,y=1/0,v=-1/0,T=-1/0;for(let L of e){let O=new n.pointGeometry(L.x+jn,L.y+jn);m=Math.min(m,O.x),y=Math.min(y,O.y),v=Math.max(v,O.x),T=Math.max(T,O.y),c.push(O)}let M=this.grid.query(m,y,v,T).concat(this.ignoredGrid.query(m,y,v,T)),k={},z={};for(let L of M){let O=L.key;if(k[O.bucketInstanceId]===void 0&&(k[O.bucketInstanceId]={}),k[O.bucketInstanceId][O.featureIndex])continue;let j=[new n.pointGeometry(L.x1,L.y1),new n.pointGeometry(L.x2,L.y1),new n.pointGeometry(L.x2,L.y2),new n.pointGeometry(L.x1,L.y2)];n.polygonIntersectsPolygon(c,j)&&(k[O.bucketInstanceId][O.featureIndex]=!0,z[O.bucketInstanceId]===void 0&&(z[O.bucketInstanceId]=[]),z[O.bucketInstanceId].push(O.featureIndex))}return z}insertCollisionBox(e,c,m,y,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:v},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,c,m,y,v){let T=c?this.ignoredGrid:this.grid,M={bucketInstanceId:m,featureIndex:y,collisionGroupID:v};for(let k=0;k<e.length;k+=4)T.insertCircle(M,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,c,m,y){let v=[c[0],c[1],c[2],1],T=!1;return c[2]||this.transform.pitch>0?(n.transformMat4$1(v,v,e),this.fogState&&m&&(T=function(M,k,z,L,O,j){let X=j.calculateFogTileMatrix(O),$=[k,z,L];return n.transformMat4($,$,X),Me(M,$,j.pitch,j._fov)}(this.fogState,c[0],c[1],c[2],m.toUnwrapped(),this.transform)>.9)):ln(v,v,e),{point:new n.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+jn,(-v[1]/v[3]+1)/2*this.transform.height+jn),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/v[3]*.5,1.5),signedDistanceFromCamera:v[3],occluded:y&&v[2]>v[3]||T}}isOffscreen(e,c,m,y){return m<jn||e>=this.screenRightBoundary||y<jn||c>this.screenBottomBoundary}isInsideGrid(e,c,m,y){return m>=0&&e<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){let e=n.identity([]);return n.translate(e,e,[-100,-100,0]),e}}class wi{constructor(e,c,m,y){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?c:-c))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class lr{constructor(e,c,m,y,v,T=!1){this.text=new wi(e?e.text:null,c,m,v),this.icon=new wi(e?e.icon:null,c,y,v),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class cr{constructor(e,c,m,y=!1){this.text=e,this.icon=c,this.skipFade=m,this.clipped=y}}class Oi{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class sc{constructor(e,c,m,y,v){this.bucketInstanceId=e,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=v}}class Gn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let c=++this.maxGroupID;this.collisionGroups[e]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[e]}}function Gs(d,e,c,m,y){let{horizontalAlign:v,verticalAlign:T}=n.getAnchorAlignment(d),M=-(v-.5)*e,k=-(T-.5)*c,z=n.evaluateVariableOffset(d,m);return new n.pointGeometry(M+z[0]*y,k+z[1]*y)}function $s(d,e,c,m,y){let v=new n.pointGeometry(d,e);return c&&v._rotate(m?y:-y),v}class Sp{constructor(e,c,m,y,v){this.transform=e.clone(),this.collisionIndex=new Fa(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Gn(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,c,m,y){let v=m.getBucket(c),T=m.latestFeatureIndex;if(!v||!T||c.id!==v.layerIds[0])return;let M=v.layers[0].layout,k=m.collisionBoxArray,z=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),L=m.tileSize/n.EXTENT,O=m.tileID.toUnwrapped(),j=this.transform.calculateProjMatrix(O),X=M.get("text-pitch-alignment")==="map",$=M.get("text-rotation-alignment")==="map";c.compileFilter();let U=c.dynamicFilter(),st=c.dynamicFilterNeedsFeature(),Y=this.transform.calculatePixelsToTileUnitsMatrix(m),it=cs(j,m.tileID.canonical,X,$,this.transform,Y),nt=null;if(X){let ct=Us(j,m.tileID.canonical,X,$,this.transform,Y);nt=n.multiply$1([],this.transform.labelPlaneMatrix,ct)}let at=null;U&&m.latestFeatureIndex&&(at={unwrappedTileID:O,dynamicFilter:U,dynamicFilterNeedsFeature:st,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new sc(v.bucketInstanceId,T,v.sourceLayerIndex,v.index,m.tileID);let tt={bucket:v,layout:M,posMatrix:j,textLabelPlaneMatrix:it,labelToScreenMatrix:nt,clippingData:at,scale:z,textPixelRatio:L,holdingForFade:m.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:n.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(y)for(let ct of v.sortKeyRanges){let{sortKey:bt,symbolInstanceStart:Ct,symbolInstanceEnd:zt}=ct;e.push({sortKey:bt,symbolInstanceStart:Ct,symbolInstanceEnd:zt,parameters:tt})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:tt})}attemptAnchorPlacement(e,c,m,y,v,T,M,k,z,L,O,j,X,$,U,st,Y,it){let nt=[j.textOffset0,j.textOffset1],at=Gs(e,m,y,nt,v),tt=this.collisionIndex.placeCollisionBox(v,c,$s(at.x,at.y,T,M,this.transform.angle),O,k,z,L.predicate);if((!st||this.collisionIndex.placeCollisionBox($.getSymbolInstanceIconSize(it,this.transform.zoom,X),st,$s(at.x,at.y,T,M,this.transform.angle),O,k,z,L.predicate).box.length!==0)&&tt.box.length>0){let ct;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(ct=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:nt,width:m,height:y,anchor:e,textScale:v,prevAnchor:ct},this.markUsedJustification($,e,j,U),$.allowVerticalPlacement&&(this.markUsedOrientation($,U,j),this.placedOrientations[j.crossTileID]=U),{shift:at,placedGlyphBoxes:tt}}}placeLayerBucketPart(e,c,m,y){let{bucket:v,layout:T,posMatrix:M,textLabelPlaneMatrix:k,labelToScreenMatrix:z,clippingData:L,textPixelRatio:O,holdingForFade:j,collisionBoxArray:X,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:U,collisionGroup:st}=e.parameters,Y=T.get("text-optional"),it=T.get("icon-optional"),nt=T.get("text-allow-overlap"),at=T.get("icon-allow-overlap"),tt=T.get("text-rotation-alignment")==="map",ct=T.get("text-pitch-alignment")==="map",bt=T.get("icon-text-fit")!=="none",Ct=T.get("symbol-z-order")==="viewport-y",zt=nt&&(at||!v.hasIconData()||it),kt=at&&(nt||!v.hasTextData()||Y);!v.collisionArrays&&X&&v.deserializeCollisionBoxes(X),m&&y&&v.updateCollisionDebugBuffers(this.transform.zoom,X);let $t=(wt,qt,Nt)=>{if(L){let pi={zoom:this.transform.zoom,pitch:this.transform.pitch},yi=null;if(L.dynamicFilterNeedsFeature){let Ue=this.retainedQueryData[v.bucketInstanceId];yi=L.featureIndex.loadFeature({featureIndex:wt.featureIndex,bucketIndex:Ue.bucketIndex,sourceLayerIndex:Ue.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(pi,yi,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new n.pointGeometry(wt.tileAnchorX,wt.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[wt.crossTileID]=new cr(!1,!1,!1,!0),void(c[wt.crossTileID]=!0)}if(c[wt.crossTileID])return;if(j)return void(this.placements[wt.crossTileID]=new cr(!1,!1,!1));let re=!1,Dt=!1,ee=!0,ue=!1,ie=!1,ne=null,fe={box:null,offscreen:null,occluded:null},Se={box:null,offscreen:null,occluded:null},ae=null,ge=null,Re=null,hi=0,Ni=0,ji=0;Nt.textFeatureIndex?hi=Nt.textFeatureIndex:wt.useRuntimeCollisionCircles&&(hi=wt.featureIndex),Nt.verticalTextFeatureIndex&&(Ni=Nt.verticalTextFeatureIndex);let pn=pi=>{pi.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||pi.elevation)&&(pi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,pi.tileAnchorX,pi.tileAnchorY):0)},qn=Nt.textBox;if(qn){pn(qn);let pi=Ue=>{let Ti=n.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Ue&&this.prevPlacement){let fn=this.prevPlacement.placedOrientations[wt.crossTileID];fn&&(this.placedOrientations[wt.crossTileID]=fn,Ti=fn,this.markUsedOrientation(v,Ti,wt))}return Ti},yi=(Ue,Ti)=>{if(v.allowVerticalPlacement&&wt.numVerticalGlyphVertices>0&&Nt.verticalTextBox){for(let fn of v.writingModes)if(fn===n.WritingMode.vertical?(fe=Ti(),Se=fe):fe=Ue(),fe&&fe.box&&fe.box.length)break}else fe=Ue()};if(T.get("text-variable-anchor")){let Ue=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[wt.crossTileID]){let ui=this.prevPlacement.variableOffsets[wt.crossTileID];Ue.indexOf(ui.anchor)>0&&(Ue=Ue.filter(En=>En!==ui.anchor),Ue.unshift(ui.anchor))}let Ti=(ui,En,sa)=>{let mn=v.getSymbolInstanceTextSize($,wt,this.transform.zoom,qt),_s=(ui.x2-ui.x1)*mn+2*ui.padding,$u=(ui.y2-ui.y1)*mn+2*ui.padding,Nc=bt&&!at?En:null;Nc&&pn(Nc);let io={box:[],offscreen:!1,occluded:!1},Up=nt?2*Ue.length:Ue.length;for(let Fr=0;Fr<Up;++Fr){let jc=this.attemptAnchorPlacement(Ue[Fr%Ue.length],ui,_s,$u,mn,tt,ct,O,M,st,Fr>=Ue.length,wt,qt,v,sa,Nc,$,U);if(jc&&(io=jc.placedGlyphBoxes,io&&io.box&&io.box.length)){re=!0,ne=jc.shift;break}}return io};yi(()=>Ti(qn,Nt.iconBox,n.WritingMode.horizontal),()=>{let ui=Nt.verticalTextBox;return ui&&pn(ui),v.allowVerticalPlacement&&!(fe&&fe.box&&fe.box.length)&&wt.numVerticalGlyphVertices>0&&ui?Ti(ui,Nt.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),fe&&(re=fe.box,ee=fe.offscreen,ue=fe.occluded);let fn=pi(fe&&fe.box);if(!re&&this.prevPlacement){let ui=this.prevPlacement.variableOffsets[wt.crossTileID];ui&&(this.variableOffsets[wt.crossTileID]=ui,this.markUsedJustification(v,ui.anchor,wt,fn))}}else{let Ue=(Ti,fn)=>{let ui=v.getSymbolInstanceTextSize($,wt,this.transform.zoom,qt),En=this.collisionIndex.placeCollisionBox(ui,Ti,new n.pointGeometry(0,0),nt,O,M,st.predicate);return En&&En.box&&En.box.length&&(this.markUsedOrientation(v,fn,wt),this.placedOrientations[wt.crossTileID]=fn),En};yi(()=>Ue(qn,n.WritingMode.horizontal),()=>{let Ti=Nt.verticalTextBox;return v.allowVerticalPlacement&&wt.numVerticalGlyphVertices>0&&Ti?(pn(Ti),Ue(Ti,n.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),pi(fe&&fe.box&&fe.box.length)}}if(ae=fe,re=ae&&ae.box&&ae.box.length>0,ee=ae&&ae.offscreen,ue=ae&&ae.occluded,wt.useRuntimeCollisionCircles){let pi=v.text.placedSymbolArray.get(wt.centerJustifiedTextSymbolIndex>=0?wt.centerJustifiedTextSymbolIndex:wt.verticalPlacedTextSymbolIndex),yi=n.evaluateSizeForFeature(v.textSizeData,$,pi),Ue=T.get("text-padding");ge=this.collisionIndex.placeCollisionCircles(nt,pi,v.lineVertexArray,v.glyphOffsetArray,yi,M,k,z,m,ct,st.predicate,wt.collisionCircleDiameter*yi/n.ONE_EM,Ue,this.retainedQueryData[v.bucketInstanceId].tileID),re=nt||ge.circles.length>0&&!ge.collisionDetected,ee=ee&&ge.offscreen,ue=ge.occluded}if(Nt.iconFeatureIndex&&(ji=Nt.iconFeatureIndex),Nt.iconBox){let pi=yi=>{pn(yi);let Ue=bt&&ne?$s(ne.x,ne.y,tt,ct,this.transform.angle):new n.pointGeometry(0,0),Ti=v.getSymbolInstanceIconSize(U,this.transform.zoom,qt);return this.collisionIndex.placeCollisionBox(Ti,yi,Ue,at,O,M,st.predicate)};Se&&Se.box&&Se.box.length&&Nt.verticalIconBox?(Re=pi(Nt.verticalIconBox),Dt=Re.box.length>0):(Re=pi(Nt.iconBox),Dt=Re.box.length>0),ee=ee&&Re.offscreen,ie=Re.occluded}let pr=Y||wt.numHorizontalGlyphVertices===0&&wt.numVerticalGlyphVertices===0,Br=it||wt.numIconVertices===0;if(pr||Br?Br?pr||(Dt=Dt&&re):re=Dt&&re:Dt=re=Dt&&re,re&&ae&&ae.box&&this.collisionIndex.insertCollisionBox(ae.box,T.get("text-ignore-placement"),v.bucketInstanceId,Se&&Se.box&&Ni?Ni:hi,st.ID),Dt&&Re&&this.collisionIndex.insertCollisionBox(Re.box,T.get("icon-ignore-placement"),v.bucketInstanceId,ji,st.ID),ge&&(re&&this.collisionIndex.insertCollisionCircles(ge.circles,T.get("text-ignore-placement"),v.bucketInstanceId,hi,st.ID),m)){let pi=v.bucketInstanceId,yi=this.collisionCircleArrays[pi];yi===void 0&&(yi=this.collisionCircleArrays[pi]=new Oi);for(let Ue=0;Ue<ge.circles.length;Ue+=4)yi.circles.push(ge.circles[Ue+0]),yi.circles.push(ge.circles[Ue+1]),yi.circles.push(ge.circles[Ue+2]),yi.circles.push(ge.collisionDetected?1:0)}let fr=this.transform.projection.name!=="globe";zt=zt&&(fr||!ue),kt=kt&&(fr||!ie),this.placements[wt.crossTileID]=new cr(re||zt,Dt||kt,ee||v.justReloaded),c[wt.crossTileID]=!0};if(Ct){let wt=v.getSortedSymbolIndexes(this.transform.angle);for(let qt=wt.length-1;qt>=0;--qt){let Nt=wt[qt];$t(v.symbolInstances.get(Nt),Nt,v.collisionArrays[Nt])}}else for(let wt=e.symbolInstanceStart;wt<e.symbolInstanceEnd;wt++)$t(v.symbolInstances.get(wt),wt,v.collisionArrays[wt]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){let wt=this.collisionCircleArrays[v.bucketInstanceId];n.invert(wt.invProjMatrix,M),wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(e,c,m,y){let v;v=y===n.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[n.getAnchorJustification(c)];let T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(let M of T)M>=0&&(e.text.placedSymbolArray.get(M).crossTileID=v>=0&&M!==v?0:m.crossTileID)}markUsedOrientation(e,c,m){let y=c===n.WritingMode.horizontal||c===n.WritingMode.horizontalOnly?c:0,v=c===n.WritingMode.vertical?c:0,T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(let M of T)e.text.placedSymbolArray.get(M).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let c=this.prevPlacement,m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;let y=c?c.symbolFadeChange(e):1,v=c?c.opacities:{},T=c?c.variableOffsets:{},M=c?c.placedOrientations:{};for(let k in this.placements){let z=this.placements[k],L=v[k];L?(this.opacities[k]=new lr(L,y,z.text,z.icon,null,z.clipped),m=m||z.text!==L.text.placed||z.icon!==L.icon.placed):(this.opacities[k]=new lr(null,y,z.text,z.icon,z.skipFade,z.clipped),m=m||z.text||z.icon)}for(let k in v){let z=v[k];if(!this.opacities[k]){let L=new lr(z,y,!1,!1);L.isHidden()||(this.opacities[k]=L,m=m||z.text.placed||z.icon.placed)}}for(let k in T)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=T[k]);for(let k in M)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=M[k]);m?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:e)}updateLayerOpacities(e,c){let m={};for(let y of c){let v=y.getBucket(e);v&&y.latestFeatureIndex&&e.id===v.layerIds[0]&&this.updateBucketOpacities(v,m,y.collisionBoxArray)}}updateBucketOpacities(e,c,m){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let y=e.layers[0].layout,v=!!e.layers[0].dynamicFilter(),T=new lr(null,0,!1,!1,!0),M=y.get("text-allow-overlap"),k=y.get("icon-allow-overlap"),z=y.get("text-variable-anchor"),L=y.get("text-rotation-alignment")==="map",O=y.get("text-pitch-alignment")==="map",j=y.get("icon-text-fit")!=="none",X=new lr(null,0,M&&(k||!e.hasIconData()||y.get("icon-optional")),k&&(M||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&m&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(m);let $=(st,Y,it)=>{for(let nt=0;nt<Y/4;nt++)st.opacityVertexArray.emplaceBack(it)},U=0;for(let st=0;st<e.symbolInstances.length;st++){let Y=e.symbolInstances.get(st),{numHorizontalGlyphVertices:it,numVerticalGlyphVertices:nt,crossTileID:at}=Y,tt=this.opacities[at];c[at]?tt=T:tt||(tt=X,this.opacities[at]=tt),c[at]=!0;let ct=it>0||nt>0,bt=Y.numIconVertices>0,Ct=this.placedOrientations[Y.crossTileID],zt=Ct===n.WritingMode.vertical,kt=Ct===n.WritingMode.horizontal||Ct===n.WritingMode.horizontalOnly;if(!ct&&!bt||tt.isHidden()||U++,ct){let $t=tu(tt.text);$(e.text,it,zt?Za:$t),$(e.text,nt,kt?Za:$t);let wt=tt.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(re=>{re>=0&&(e.text.placedSymbolArray.get(re).hidden=wt||zt?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=wt||kt?1:0);let qt=this.variableOffsets[Y.crossTileID];qt&&this.markUsedJustification(e,qt.anchor,Y,Ct);let Nt=this.placedOrientations[Y.crossTileID];Nt&&(this.markUsedJustification(e,"left",Y,Nt),this.markUsedOrientation(e,Nt,Y))}if(bt){let $t=tu(tt.icon);Y.placedIconSymbolIndex>=0&&($(e.icon,Y.numIconVertices,zt?Za:$t),e.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=tt.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&($(e.icon,Y.numVerticalIconVertices,kt?Za:$t),e.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=tt.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let $t=e.collisionArrays[st];if($t){let wt=new n.pointGeometry(0,0),qt=!0;if($t.textBox||$t.verticalTextBox){if(z){let re=this.variableOffsets[at];re?(wt=Gs(re.anchor,re.width,re.height,re.textOffset,re.textScale),L&&wt._rotate(O?this.transform.angle:-this.transform.angle)):qt=!1}v&&(qt=!tt.clipped),$t.textBox&&$n(e.textCollisionBox.collisionVertexArray,tt.text.placed,!qt||zt,wt.x,wt.y),$t.verticalTextBox&&$n(e.textCollisionBox.collisionVertexArray,tt.text.placed,!qt||kt,wt.x,wt.y)}let Nt=qt&&Boolean(!kt&&$t.verticalIconBox);$t.iconBox&&$n(e.iconCollisionBox.collisionVertexArray,tt.icon.placed,Nt,j?wt.x:0,j?wt.y:0),$t.verticalIconBox&&$n(e.iconCollisionBox.collisionVertexArray,tt.icon.placed,!Nt,j?wt.x:0,j?wt.y:0)}}}if(e.fullyClipped=U===0,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){let st=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=st.invProjMatrix,e.placementViewportMatrix=st.viewportMatrix,e.collisionCircleArray=st.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,c){let m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>e}setStale(){this.stale=!0}}function $n(d,e,c,m,y){d.emplaceBack(e?1:0,c?1:0,m||0,y||0),d.emplaceBack(e?1:0,c?1:0,m||0,y||0),d.emplaceBack(e?1:0,c?1:0,m||0,y||0),d.emplaceBack(e?1:0,c?1:0,m||0,y||0)}let Ep=Math.pow(2,25),Qh=Math.pow(2,24),cn=Math.pow(2,17),Oa=Math.pow(2,16),Ar=Math.pow(2,9),oc=Math.pow(2,8),Va=Math.pow(2,1);function tu(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let e=d.placed?1:0,c=Math.floor(127*d.opacity);return c*Ep+e*Qh+c*cn+e*Oa+c*Ar+e*oc+c*Va+e}let Za=0;class ac{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&e.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,c,m,y,v){let T=this._bucketParts;for(;this._currentTileIndex<e.length;)if(c.getBucketParts(T,y,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((M,k)=>M.sortKey-k.sortKey));this._currentPartIndex<T.length;){let M=T[this._currentPartIndex];if(c.placeLayerBucketPart(M,this._seenCrossTileIDs,m,M.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class Mp{constructor(e,c,m,y,v,T,M,k){this.placement=new Sp(e,v,T,M,k),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(e,c,m){let y=n.exported.now(),v=()=>{let T=n.exported.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){let T=c[e[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=M)&&(!T.maxzoom||T.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new ac(T)),this._inProgressLayer.continuePlacement(m[T.source],this.placement,this._showCollisionBoxes,T,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let eu=512/n.EXTENT/2;class Ap{constructor(e,c,m){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let y=0;y<c.length;y++){let v=c.get(y),T=v.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,e)})}}getScaledCoordinates(e,c){let m=eu/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*n.EXTENT+e.tileAnchorX)*m),y:Math.floor((c.canonical.y*n.EXTENT+e.tileAnchorY)*m)}}findMatches(e,c,m){let y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let v=0;v<e.length;v++){let T=e.get(v);if(T.crossTileID)continue;let M=this.indexedSymbolInstances[T.key];if(!M)continue;let k=this.getScaledCoordinates(T,c);for(let z of M)if(Math.abs(z.coord.x-k.x)<=y&&Math.abs(z.coord.y-k.y)<=y&&!m[z.crossTileID]){m[z.crossTileID]=!0,T.crossTileID=z.crossTileID;break}}}}class iu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let c=Math.round((e-this.lng)/360);if(c!==0)for(let m in this.indexes){let y=this.indexes[m],v={};for(let T in y){let M=y[T];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+c),v[M.tileID.key]=M}this.indexes[m]=v}this.lng=e}addBucket(e,c,m){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let v=0;v<c.symbolInstances.length;v++)c.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let y=this.usedCrossTileIDs[e.overscaledZ];for(let v in this.indexes){let T=this.indexes[v];if(Number(v)>e.overscaledZ)for(let M in T){let k=T[M];k.tileID.isChildOf(e)&&k.findMatches(c.symbolInstances,e,y)}else{let M=T[e.scaledTo(Number(v)).key];M&&M.findMatches(c.symbolInstances,e,y)}}for(let v=0;v<c.symbolInstances.length;v++){let T=c.symbolInstances.get(v);T.crossTileID||(T.crossTileID=m.generate(),y[T.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ap(e,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(e,c){for(let m in c.indexedSymbolInstances)for(let y of c.indexedSymbolInstances[m])delete this.usedCrossTileIDs[e][y.crossTileID]}removeStaleBuckets(e){let c=!1;for(let m in this.indexes){let y=this.indexes[m];for(let v in y)e[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[v]),delete y[v],c=!0)}return c}}class Ua{constructor(){this.layerIndexes={},this.crossTileIDs=new iu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,c,m,y){let v=this.layerIndexes[e.id];v===void 0&&(v=this.layerIndexes[e.id]=new Cp);let T=!1,M={};y.name!=="globe"&&v.handleWrapJump(m);for(let k of c){let z=k.getBucket(e);z&&e.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(k.tileID,z,this.crossTileIDs)&&(T=!0),M[z.bucketInstanceId]=!0)}return v.removeStaleBuckets(M)&&(T=!0),T}pruneUnusedLayers(e){let c={};e.forEach(m=>{c[m]=!0});for(let m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}let Lo=(d,e)=>n.emitValidationErrors(d,e&&e.filter(c=>c.identifier!=="source.canvas")),nu=n.pick(se,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ru=n.pick(se,["setCenter","setZoom","setBearing","setPitch"]),su={version:8,layers:[],sources:{}},hs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Qi extends n.Evented{constructor(e,c={}){super(),this.map=e,this.dispatcher=new qe(_e(),this),this.imageManager=new jt,this.imageManager.setEventedParent(this),this.glyphManager=new n.GlyphManager(e._requestManager,c.localFontFamily?n.LocalGlyphMode.all:c.localIdeographFontFamily?n.LocalGlyphMode.ideographs:n.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new n.LineAtlas(256,512),this.crossTileSymbolIndex=new Ua,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new n.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());let m=this;this._rtlTextPluginCallback=Qi.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,T)=>{if(n.triggerPluginCompletionEvent(v),T&&T.every(M=>M))for(let M in m._sourceCaches){let k=m._sourceCaches[M],z=k.getSource().type;z!=="vector"&&z!=="geojson"||k.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;let v=this.getSource(y.sourceId);if(v&&v.vectorLayerIds)for(let T in this._layers){let M=this._layers[T];M.source===v.id&&this._validateLayer(M)}})}loadURL(e,c={}){this.fire(new n.Event("dataloading",{dataType:"style"}));let m=typeof c.validate=="boolean"?c.validate:!n.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,c.accessToken);let y=this.map._requestManager.transformRequest(e,n.ResourceType.Style);this._request=n.getJSON(y,(v,T)=>{this._request=null,v?this.fire(new n.ErrorEvent(v)):T&&this._load(T,m)})}loadJSON(e,c={}){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.exported.frame(()=>{this._request=null,this._load(e,c.validate!==!1)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(su,!1)}_updateLayerCount(e,c){let m=c?1:-1;e.is3D()&&(this._num3DLayers+=m),e.type==="circle"&&(this._numCircleLayers+=m),e.type==="symbol"&&(this._numSymbolLayers+=m)}_load(e,c){if(c&&Lo(this,n.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e,this._updateMapProjection();for(let y in e.sources)this.addSource(y,e.sources[y],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(e.glyphs);let m=Ve(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of m)y=n.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new me(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(e){this._spriteRequest=function(c,m,y){let v,T,M,k=n.exported.devicePixelRatio>1?"@2x":"",z=n.getJSON(m.transformRequest(m.normalizeSpriteURL(c,k,".json"),n.ResourceType.SpriteJSON),(j,X)=>{z=null,M||(M=j,v=X,O())}),L=n.getImage(m.transformRequest(m.normalizeSpriteURL(c,k,".png"),n.ResourceType.SpriteImage),(j,X)=>{L=null,M||(M=j,T=X,O())});function O(){if(M)y(M);else if(v&&T){let j=n.exported.getImageData(T),X={};for(let $ in v){let{width:U,height:st,x:Y,y:it,sdf:nt,pixelRatio:at,stretchX:tt,stretchY:ct,content:bt}=v[$],Ct=new n.RGBAImage({width:U,height:st});n.RGBAImage.copy(j,Ct,{x:Y,y:it},{x:0,y:0},{width:U,height:st}),X[$]={data:Ct,pixelRatio:at,sdf:nt,stretchX:tt,stretchY:ct,content:bt}}y(null,X)}}return{cancel(){z&&(z.cancel(),z=null),L&&(L.cancel(),L=null)}}}(e,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new n.ErrorEvent(c));else if(m)for(let y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new n.Event("data",{dataType:"style"}))})}_validateLayer(e){let c=this.getSource(e.source);if(!c)return;let m=e.sourceLayer;m&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(m)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){let c=[];for(let m of e){let y=this._layers[m];y.type!=="custom"&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(let e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&hs[e.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(!this._loaded)return;let c=this._changed;if(this._changed){let y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(let T in this._updatedSources){let M=this._updatedSources[T];M==="reload"?this._reloadSource(T):M==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(let T in this._updatedPaintProps)this._layers[T].updateTransitions(e);this.light.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._resetUpdates()}let m={};for(let y in this._sourceCaches){let v=this._sourceCaches[y];m[y]=v.used,v.used=!1}for(let y of this._order){let v=this._layers[y];if(v.recalculate(e,this._availableImages),!v.isHidden(e.zoom)){let M=this._getLayerSourceCache(v);M&&(M.used=!0)}let T=this.map.painter;if(T){let M=v.getProgramIds();if(!M)continue;let k=v.getProgramConfiguration(e.zoom);for(let z of M)T.useProgram(z,k)}}for(let y in m){let v=this._sourceCaches[y];m[y]!==v.used&&v.getSource().fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(e){if(this._checkLoaded(),Lo(this,n.validateStyle(e)))return!1;(e=n.clone$1(e)).layers=Ve(e.layers);let c=function(y,v){if(!y)return[{command:se.setStyle,args:[v]}];let T=[];try{if(!A(y.version,v.version))return[{command:se.setStyle,args:[v]}];A(y.center,v.center)||T.push({command:se.setCenter,args:[v.center]}),A(y.zoom,v.zoom)||T.push({command:se.setZoom,args:[v.zoom]}),A(y.bearing,v.bearing)||T.push({command:se.setBearing,args:[v.bearing]}),A(y.pitch,v.pitch)||T.push({command:se.setPitch,args:[v.pitch]}),A(y.sprite,v.sprite)||T.push({command:se.setSprite,args:[v.sprite]}),A(y.glyphs,v.glyphs)||T.push({command:se.setGlyphs,args:[v.glyphs]}),A(y.transition,v.transition)||T.push({command:se.setTransition,args:[v.transition]}),A(y.light,v.light)||T.push({command:se.setLight,args:[v.light]}),A(y.fog,v.fog)||T.push({command:se.setFog,args:[v.fog]}),A(y.projection,v.projection)||T.push({command:se.setProjection,args:[v.projection]});let M={},k=[];(function(O,j,X,$){let U;for(U in j=j||{},O=O||{})O.hasOwnProperty(U)&&(j.hasOwnProperty(U)||Ze(U,X,$));for(U in j)j.hasOwnProperty(U)&&(O.hasOwnProperty(U)?A(O[U],j[U])||(O[U].type==="geojson"&&j[U].type==="geojson"&&ar(O,j,U)?X.push({command:se.setGeoJSONSourceData,args:[U,j[U].data]}):as(U,j,X,$)):Be(U,j,X))})(y.sources,v.sources,k,M);let z=[];y.layers&&y.layers.forEach(O=>{O.source&&M[O.source]?T.push({command:se.removeLayer,args:[O.id]}):z.push(O)});let L=y.terrain;L&&M[L.source]&&(T.push({command:se.setTerrain,args:[void 0]}),L=void 0),T=T.concat(k),A(L,v.terrain)||T.push({command:se.setTerrain,args:[v.terrain]}),function(O,j,X){j=j||[];let $=(O=O||[]).map(ze),U=j.map(ze),st=O.reduce(Ae,{}),Y=j.reduce(Ae,{}),it=$.slice(),nt=Object.create(null),at,tt,ct,bt,Ct,zt,kt;for(at=0,tt=0;at<$.length;at++)ct=$[at],Y.hasOwnProperty(ct)?tt++:(X.push({command:se.removeLayer,args:[ct]}),it.splice(it.indexOf(ct,tt),1));for(at=0,tt=0;at<U.length;at++)ct=U[U.length-1-at],it[it.length-1-at]!==ct&&(st.hasOwnProperty(ct)?(X.push({command:se.removeLayer,args:[ct]}),it.splice(it.lastIndexOf(ct,it.length-tt),1)):tt++,zt=it[it.length-at],X.push({command:se.addLayer,args:[Y[ct],zt]}),it.splice(it.length-at,0,ct),nt[ct]=!0);for(at=0;at<U.length;at++)if(ct=U[at],bt=st[ct],Ct=Y[ct],!nt[ct]&&!A(bt,Ct))if(A(bt.source,Ct.source)&&A(bt["source-layer"],Ct["source-layer"])&&A(bt.type,Ct.type)){for(kt in Ht(bt.layout,Ct.layout,X,ct,null,se.setLayoutProperty),Ht(bt.paint,Ct.paint,X,ct,null,se.setPaintProperty),A(bt.filter,Ct.filter)||X.push({command:se.setFilter,args:[ct,Ct.filter]}),A(bt.minzoom,Ct.minzoom)&&A(bt.maxzoom,Ct.maxzoom)||X.push({command:se.setLayerZoomRange,args:[ct,Ct.minzoom,Ct.maxzoom]}),bt)bt.hasOwnProperty(kt)&&kt!=="layout"&&kt!=="paint"&&kt!=="filter"&&kt!=="metadata"&&kt!=="minzoom"&&kt!=="maxzoom"&&(kt.indexOf("paint.")===0?Ht(bt[kt],Ct[kt],X,ct,kt.slice(6),se.setPaintProperty):A(bt[kt],Ct[kt])||X.push({command:se.setLayerProperty,args:[ct,kt,Ct[kt]]}));for(kt in Ct)Ct.hasOwnProperty(kt)&&!bt.hasOwnProperty(kt)&&kt!=="layout"&&kt!=="paint"&&kt!=="filter"&&kt!=="metadata"&&kt!=="minzoom"&&kt!=="maxzoom"&&(kt.indexOf("paint.")===0?Ht(bt[kt],Ct[kt],X,ct,kt.slice(6),se.setPaintProperty):A(bt[kt],Ct[kt])||X.push({command:se.setLayerProperty,args:[ct,kt,Ct[kt]]}))}else X.push({command:se.removeLayer,args:[ct]}),zt=it[it.lastIndexOf(ct)+1],X.push({command:se.addLayer,args:[Ct,zt]})}(z,v.layers,T)}catch(M){console.warn("Unable to compute style diff:",M),T=[{command:se.setStyle,args:[v]}]}return T}(this.serialize(),e).filter(y=>!(y.command in ru));if(c.length===0)return!1;let m=c.filter(y=>!(y.command in nu));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{y.command!=="setTransition"&&this[y.command].apply(this,y.args)}),this.stylesheet=e,this._updateMapProjection(),!0}addImage(e,c){return this.getImage(e)?this.fire(new n.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,c),this._afterImageUpdated(e),this)}updateImage(e,c){this.imageManager.updateImage(e,c)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e),this._afterImageUpdated(e),this):this.fire(new n.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(e,c,m={}){if(this._checkLoaded(),this.getSource(e)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(n.validateSource,`sources.${e}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);let y=xt(e,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(e),source:y.serialize(),sourceId:e}));let v=T=>{let M=(T?"symbol:":"other:")+e,k=this._sourceCaches[M]=new n.SourceCache(M,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[e]=k,k.style=this,k.onAdd(this.map)};v(!1),c.type!=="vector"&&c.type!=="geojson"||v(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(e){this._checkLoaded();let c=this.getSource(e);if(!c)throw new Error("There is no source with this ID");for(let y in this._layers)if(this._layers[y].source===e)return this.fire(new n.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new n.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));let m=this._getSourceCaches(e);for(let y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(e,c){this._checkLoaded(),this.getSource(e).setData(c),this._changed=!0}getSource(e){let c=this._getSourceCache(e);return c&&c.getSource()}addLayer(e,c,m={}){this._checkLoaded();let y=e.id;if(this.getLayer(y))return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let v;if(e.type==="custom"){if(Lo(this,n.validateCustomStyleLayer(e)))return;v=n.createStyleLayer(e)}else{if(typeof e.source=="object"&&(this.addSource(y,e.source),e=n.clone$1(e),e=n.extend(e,{source:y})),this._validate(n.validateLayer,`layers.${y}`,e,{arrayIndex:-1},m))return;v=n.createStyleLayer(e),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}let T=c?this._order.indexOf(c):this._order.length;if(c&&T===-1)return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=v;let M=this._getLayerSourceCache(v);if(this._removedLayers[y]&&v.source&&M&&v.type!=="custom"){let k=this._removedLayers[y];delete this._removedLayers[y],k.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",M.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(e,c){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new n.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===c)return;let m=this._order.indexOf(e);this._order.splice(m,1);let y=c?this._order.indexOf(c):this._order.length;c&&y===-1?this.fire(new n.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,e),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(e){this._checkLoaded();let c=this._layers[e];if(!c)return void this.fire(new n.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);let m=this._order.indexOf(e);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=c,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(let c in this._layers)if(this._layers[c].type===e)return!0;return!1}setLayerZoomRange(e,c,m){this._checkLoaded();let y=this.getLayer(e);y?y.minzoom===c&&y.maxzoom===m||(c!=null&&(y.minzoom=c),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new n.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(e,c,m={}){this._checkLoaded();let y=this.getLayer(e);if(y){if(!A(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(n.validateFilter,`layers.${y.id}.filter`,c,{layerType:y.type},m)||(y.filter=n.clone$1(c),this._updateLayer(y)))}else this.fire(new n.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){let c=this.getLayer(e);return c&&n.clone$1(c.filter)}setLayoutProperty(e,c,m,y={}){this._checkLoaded();let v=this.getLayer(e);v?A(v.getLayoutProperty(c),m)||(v.setLayoutProperty(c,m,y),this._updateLayer(v)):this.fire(new n.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,c){let m=this.getLayer(e);if(m)return m.getLayoutProperty(c);this.fire(new n.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(e,c,m,y={}){this._checkLoaded();let v=this.getLayer(e);v?A(v.getPaintProperty(c),m)||(v.setPaintProperty(c,m,y)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new n.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,c){let m=this.getLayer(e);return m&&m.getPaintProperty(c)}setFeatureState(e,c){this._checkLoaded();let m=e.source,y=e.sourceLayer,v=this.getSource(m);if(!v)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));let T=v.type;if(T==="geojson"&&y)return void this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));e.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided.")));let M=this._getSourceCaches(m);for(let k of M)k.setFeatureState(y,e.id,c)}removeFeatureState(e,c){this._checkLoaded();let m=e.source,y=this.getSource(m);if(!y)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));let v=y.type,T=v==="vector"?e.sourceLayer:void 0;if(v==="vector"&&!T)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof e.id!="string"&&typeof e.id!="number")return void this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));let M=this._getSourceCaches(m);for(let k of M)k.removeFeatureState(T,e.id,c)}getFeatureState(e){this._checkLoaded();let c=e.source,m=e.sourceLayer,y=this.getSource(c);if(y){if(y.type!=="vector"||m)return e.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,e.id);this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new n.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){let e={};for(let c in this._sourceCaches){let m=this._sourceCaches[c].getSource();e[m.id]||(e[m.id]=m.serialize())}return n.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:e,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0;let c=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",c.pause()),this._changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){let c=T=>this._layers[T].type==="fill-extrusion",m={},y=[];for(let T=this._order.length-1;T>=0;T--){let M=this._order[T];if(c(M)){m[M]=T;for(let k of e){let z=k[M];if(z)for(let L of z)y.push(L)}}}y.sort((T,M)=>M.intersectionZ-T.intersectionZ);let v=[];for(let T=this._order.length-1;T>=0;T--){let M=this._order[T];if(c(M))for(let k=y.length-1;k>=0;k--){let z=y[k].feature;if(m[z.layer.id]<T)break;v.push(z),y.pop()}else for(let k of e){let z=k[M];if(z)for(let L of z)v.push(L.feature)}}return v}queryRenderedFeatures(e,c,m){c&&c.filter&&this._validate(n.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);let y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let k of c.layers){let z=this._layers[k];if(!z)return this.fire(new n.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}let v=[];c.availableImages=this._availableImages;let T=c&&c.layers?c.layers.some(k=>{let z=this.getLayer(k);return z&&z.is3D()}):this.has3DLayers(),M=Ki.createFromScreenPoints(e,m);for(let k in this._sourceCaches){let z=this._sourceCaches[k].getSource().id;c.layers&&!y[z]||v.push(Tt(this._sourceCaches[k],this._layers,this._serializedLayers,M,c,m,T,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(k,z,L,O,j,X,$){let U={},st=X.queryRenderedSymbols(O),Y=[];for(let it of Object.keys(st).map(Number))Y.push($[it]);Y.sort(Kt);for(let it of Y){let nt=it.featureIndex.lookupSymbolFeatures(st[it.bucketInstanceId],z,it.bucketIndex,it.sourceLayerIndex,j.filter,j.layers,j.availableImages,k);for(let at in nt){let tt=U[at]=U[at]||[],ct=nt[at];ct.sort((bt,Ct)=>{let zt=it.featureSortOrder;if(zt){let kt=zt.indexOf(bt.featureIndex);return zt.indexOf(Ct.featureIndex)-kt}return Ct.featureIndex-bt.featureIndex});for(let bt of ct)tt.push(bt)}}for(let it in U)U[it].forEach(nt=>{let at=nt.feature,tt=L(k[it]).getFeatureState(at.layer["source-layer"],at.id);at.source=at.layer.source,at.layer["source-layer"]&&(at.sourceLayer=at.layer["source-layer"]),at.state=tt});return U}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(e,c){c&&c.filter&&this._validate(n.validateFilter,"querySourceFeatures.filter",c.filter,null,c);let m=this._getSourceCaches(e),y=[];for(let v of m)y=y.concat(Ft(v,c));return y}addSourceType(e,c,m){return Qi.getSourceType(e)?m(new Error(`A source type called "${e}" already exists.`)):(Qi.setSourceType(e,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(e,c={}){this._checkLoaded();let m=this.light.getLight(),y=!1;for(let T in e)if(!A(e[T],m[T])){y=!0;break}if(!y)return;let v={now:n.exported.now(),transition:n.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,c),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,c=1){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(c===1){if(typeof e.source=="object"){let m="terrain-dem-src";this.addSource(m,e.source),e=n.clone$1(e),e=n.extend(e,{source:m})}if(this._validate(n.validateTerrain,"terrain",e))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(e,c);else{let m=this.terrain,y=m.get();for(let v in e)if(!A(e[v],y[v])){m.set(e),this.stylesheet.terrain=e;let T={now:n.exported.now(),transition:n.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){let c=this.fog=new _i(e,this.map.transform);this.stylesheet.fog=e;let m={now:n.exported.now(),transition:n.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let c=this.fog,m=c.get();for(let y in e)if(!A(e[y],m[y])){c.set(e),this.stylesheet.fog=e;let v={now:n.exported.now(),transition:n.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(v);break}}else this._createFog(e);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;let e=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...c)}_createTerrain(e,c){let m=this.terrain=new be(e,c);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();let y={now:n.exported.now(),transition:n.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(y)}_force3DLayerUpdate(){for(let e in this._layers){let c=this._layers[e];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(let e in this._layers){let c=this._layers[e];c.type==="symbol"&&this._updateLayer(c)}}_validate(e,c,m,y,v={}){return(!v||v.validate!==!1)&&Lo(this,e.call(n.validateStyle,n.extend({key:c,style:this.serialize(),value:m,styleSpec:n.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let e in this._layers)this._layers[e].setEventedParent(null);for(let e in this._sourceCaches)this._sourceCaches[e].clearTiles(),this._sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){let c=this._getSourceCaches(e);for(let m of c)m.clearTiles()}_reloadSource(e){let c=this._getSourceCaches(e);for(let m of c)m.resume(),m.reload()}_updateSources(e){for(let c in this._sourceCaches)this._sourceCaches[c].update(e)}_generateCollisionBoxes(){for(let e in this._sourceCaches){let c=this._sourceCaches[e];c.resume(),c.reload()}}_updatePlacement(e,c,m,y,v=!1){let T=!1,M=!1,k={};for(let z of this._order){let L=this._layers[z];if(L.type!=="symbol")continue;if(!k[L.source]){let j=this._getLayerSourceCache(L);if(!j)continue;k[L.source]=j.getRenderableIds(!0).map(X=>j.getTileByID(X)).sort((X,$)=>$.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan($.tileID)?-1:1))}let O=this.crossTileSymbolIndex.addLayer(L,k[L.source],e.center.lng,e.projection);T=T||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new n.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.exported.now(),e.zoom))&&(this.pauseablePlacement=new Mp(e,this._order,v,c,m,y,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.exported.now()),M=!0),T&&this.pauseablePlacement.placement.setStale()),M||T)for(let z of this._order){let L=this._layers[z];L.type==="symbol"&&this.placement.updateLayerOpacities(L,k[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.exported.now())}_releaseSymbolFadeTiles(){for(let e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();let y=v=>{v&&v.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(e,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(e,c,m){return n.makeRequest(c,m)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return e.type==="symbol"?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}_getSourceCaches(e){let c=[];return this._otherSourceCaches[e]&&c.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&c.push(this._symbolSourceCaches[e]),c}_isSourceCacheLoaded(e){let c=this._getSourceCaches(e);return c.length===0?(this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${e}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qi.getSourceType=function(d){return vt[d]},Qi.setSourceType=function(d,e){vt[d]=e},Qi.registerForPluginStateChange=n.registerForPluginStateChange;var Ro=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Bo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let us={},Cr={};us=de("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Cr=de(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);let Na=de(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Fo=Ro;var Oo={background:de(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:de(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:de(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:de("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:de(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:de(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:de("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:de("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:de("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:de(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:de(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:de(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:de(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:de(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:de(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:de(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:de(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:de(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:de(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:de(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:de(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:de(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:de(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:de(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:de(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:de(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Bo),skyboxGradient:de(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Bo),skyboxCapture:de(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:de(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:de(`uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)
discard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function de(d,e,c){let m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,v=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=d.match(y),M=e.match(y),k=Ro.match(y),z=M?M.concat(T):T;c||(us.staticUniforms&&(z=us.staticUniforms.concat(z)),Cr.staticUniforms&&(z=Cr.staticUniforms.concat(z))),z&&(z=z.concat(k));let L={};return{fragmentSource:d=d.replace(m,(O,j,X,$,U)=>(L[U]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${X} ${$} ${U};
#else
uniform ${X} ${$} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${X} ${$} ${U} = u_${U};
#endif
`)),vertexSource:e=e.replace(m,(O,j,X,$,U)=>{let st=$==="float"?"vec2":"vec4",Y=U.match(/color/)?"color":st;return L[U]?j==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${X} ${st} a_${U};
varying ${X} ${$} ${U};
#else
uniform ${X} ${$} u_${U};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${X} ${$} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${Y}(a_${U}, u_${U}_t);
#else
    ${X} ${$} ${U} = u_${U};
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${X} ${st} a_${U};
#else
uniform ${X} ${$} u_${U};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${X} ${$} ${U} = a_${U};
#else
    ${X} ${$} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${X} ${$} ${U} = unpack_mix_${Y}(a_${U}, u_${U}_t);
#else
    ${X} ${$} ${U} = u_${U};
#endif
`}),staticAttributes:v,staticUniforms:z}}class ja{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,c,m,y,v,T,M,k){this.context=e;let z=this.boundPaintVertexBuffers.length!==y.length;for(let L=0;!z&&L<y.length;L++)this.boundPaintVertexBuffers[L]!==y[L]&&(z=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===m&&!z&&this.boundIndexBuffer===v&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===k?(e.bindVertexArrayOES.set(this.vao),M&&M.bind(),v&&v.dynamicDraw&&v.bind(),k&&k.bind()):this.freshBind(c,m,y,v,T,M,k)}freshBind(e,c,m,y,v,T,M){let k,z=e.numAttributes,L=this.context,O=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=e,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=M;else{k=L.currentNumAttributes||0;for(let j=z;j<k;j++)O.disableVertexAttribArray(j)}c.enableAttributes(O,e);for(let j of m)j.enableAttributes(O,e);T&&T.enableAttributes(O,e),M&&M.enableAttributes(O,e),c.bind(),c.setVertexAttribPointers(O,e,v);for(let j of m)j.bind(),j.setVertexAttribPointers(O,e,v);T&&(T.bind(),T.setVertexAttribPointers(O,e,v)),y&&y.bind(),M&&(M.bind(),M.setVertexAttribPointers(O,e,v)),L.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ou(d,e){let c=Math.pow(2,e.canonical.z),m=e.canonical.y;return[new n.MercatorCoordinate(0,m/c).toLngLat().lat,new n.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function au(d,e,c,m,y,v,T){let M=d.context,k=M.gl,z=c.fbo;if(!z)return;d.prepareDrawTile();let L=d.useProgram("hillshade");M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,z.colorAttachment.get());let O=((U,st,Y,it)=>{let nt=Y.paint.get("hillshade-shadow-color"),at=Y.paint.get("hillshade-highlight-color"),tt=Y.paint.get("hillshade-accent-color"),ct=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);Y.paint.get("hillshade-illumination-anchor")==="viewport"&&(ct-=U.transform.angle);let bt=!U.options.moving;return{u_matrix:it||U.transform.calculateProjMatrix(st.tileID.toUnwrapped(),bt),u_image:0,u_latrange:ou(0,st.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),ct],u_shadow:nt,u_highlight:at,u_accent:tt}})(d,c,m,d.terrain?e.projMatrix:null);d.prepareDrawProgram(M,L,e.toUnwrapped());let{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:$}=d.getTileBoundsBuffers(c);L.draw(M,k.TRIANGLES,y,v,T,n.CullFaceMode.disabled,O,m.id,j,X,$)}function lc(d,e,c){if(!e.needsDEMTextureUpload)return;let m=d.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||d.getTileTexture(c.stride);let v=c.getPixels();e.demTexture?e.demTexture.update(v,{premultiply:!1}):e.demTexture=new n.Texture(m,v,y.RGBA,{premultiply:!1}),e.needsDEMTextureUpload=!1}function cc(d,e,c,m,y,v){let T=d.context,M=T.gl;if(!e.dem)return;let k=e.dem;if(T.activeTexture.set(M.TEXTURE1),lc(d,e,k),!e.demTexture)return;e.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);let z=k.dim;T.activeTexture.set(M.TEXTURE0);let L=e.fbo;if(!L){let $=new n.Texture(T,{width:z,height:z,data:null},M.RGBA);$.bind(M.LINEAR,M.CLAMP_TO_EDGE),L=e.fbo=T.createFramebuffer(z,z,!0),L.colorAttachment.set($.texture)}T.bindFramebuffer.set(L.framebuffer),T.viewport.set([0,0,z,z]);let{tileBoundsBuffer:O,tileBoundsIndexBuffer:j,tileBoundsSegments:X}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(T,M.TRIANGLES,m,y,v,n.CullFaceMode.disabled,(($,U)=>{let st=U.stride,Y=n.create();return n.ortho(Y,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(Y,Y,[0,-n.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[st,st],u_zoom:$.overscaledZ,u_unpack:U.unpackVector}})(e.tileID,k),c.id,O,j,X),e.needsHillshadePrepare=!1}let hc=(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_image0:new n.Uniform1i(d,e.u_image0),u_skirt_height:new n.Uniform1f(d,e.u_skirt_height)}),lu=(d,e)=>({u_matrix:d,u_image0:0,u_skirt_height:e}),cu=(d,e,c,m,y,v)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:e,u_merc_matrix:c,u_zoom_transition:m,u_merc_center:y,u_image0:0,u_grid_matrix:v?Float32Array.from(v):new Float32Array(9)});function Ga(d,e){return d!=null&&e!=null&&!(!d.hasData()||!e.hasData())&&d.demTexture!=null&&e.demTexture!=null&&d.tileID.key!==e.tileID.key}let Ir=new class{constructor(){this.operations={}}newMorphing(d,e,c,m,y){if(d in this.operations){let v=this.operations[d];v.to.tileID.key!==c.tileID.key&&(v.queued=c)}else this.operations[d]={startTime:m,phase:0,duration:y,from:e,to:c,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;let e=this.operations[d];return{from:e.from,to:e.to,phase:e.phase}}update(d){for(let e in this.operations){let c=this.operations[e];for(c.phase=(d-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,d)){delete this.operations[e];break}}}_nextOp(d,e){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=e,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},qs={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function uc(d,e){let c=1<<d.z;return!e&&(d.x===0||d.x===c-1)||d.y===0||d.y===c-1}let $a=d=>({u_matrix:d});function dc(d,e,c,m,y){if(y>0){let v=n.exported.now(),T=(v-d.timeAdded)/y,M=e?(v-e.timeAdded)/y:-1,k=c.getSource(),z=m.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),L=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),O=L&&d.refreshedUponExpiration?1:n.clamp(L?T:1-M,0,1);return d.refreshedUponExpiration&&T>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}let Ip=2*n.mercatorZfromAltitude(1,0)*n.GLOBE_RADIUS*Math.PI;class Vo extends n.SourceCache{constructor(e){let c={type:"raster-dem",maxzoom:e.transform.maxZoom},m=new qe(_e(),null),y=xt("mock-dem",c,m,e.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,c){e.state="loaded",c(null)}}class Zo extends n.SourceCache{constructor(e){let c=xt("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new qe(_e(),null),e.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,c,m){if(e.freezeTileCoverage)return;this.transform=e;let y=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,T)=>{if(v[T.key]="",!this._tiles[T.key]){let M=new n.Tile(T,this._source.tileSize*T.overscaleFactor(),e.tileZoom);M.state="loaded",this._tiles[T.key]=M}return v},{});for(let v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(e){let c=this.proxyCachedFBO[e];if(c!==void 0){let m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pc extends n.OverscaledTileID{constructor(e,c,m){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class hn extends n.Elevation{constructor(e,c){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[m,y,v]=function(k){let z=new n.StructArrayLayout4i8,L=new n.StructArrayLayout3ui6,O=131;z.reserve(17161),L.reserve(33800);let j=n.EXTENT/128,X=n.EXTENT+j/2,$=X+j;for(let st=-j;st<$;st+=j)for(let Y=-j;Y<$;Y+=j){let it=Y<0||Y>X||st<0||st>X?24575:0,nt=n.clamp(Math.round(Y),0,n.EXTENT),at=n.clamp(Math.round(st),0,n.EXTENT);z.emplaceBack(nt+it,at,nt,at)}let U=(st,Y)=>{let it=Y*O+st;L.emplaceBack(it+1,it,it+O),L.emplaceBack(it+O,it+O+1,it+1)};for(let st=1;st<129;st++)for(let Y=1;Y<129;Y++)U(Y,st);return[0,129].forEach(st=>{for(let Y=0;Y<130;Y++)U(Y,st),U(st,Y)}),[z,L,32768]}(),T=e.context;this.gridBuffer=T.createVertexBuffer(m,n.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=n.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=n.SegmentVector.simpleSegment(0,0,m.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Zo(c.map),this.orthoMatrix=n.create(),n.ortho(this.orthoMatrix,0,n.EXTENT,0,n.EXTENT,0,1);let M=T.gl;this._overlapStencilMode=new n.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Vo(c.map)}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency()}update(e,c,m){if(e&&e.terrain){this._style!==e&&(this.style=e),this.enabled=!0;let y=e.terrain.properties;this.sourceCache=e.terrain.drapeRenderMode===0?this._mockSourceCache:e._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");let v=()=>{this.sourceCache.used&&n.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let T=this.getScaledDemTileSize();this.sourceCache.update(c,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),c.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){let e=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||e.efficiency!==100&&n.warnOnce(`Terrain render cache efficiency is not optimal (${e.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${e.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&e.dataType==="source"?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):e.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let y=this.proxyCoords=c.getIds().map(k=>{let z=c.getTileByID(k).tileID;return z.projMatrix=m.calculateProjMatrix(z.toUnwrapped()),z});(function(k,z){let L=z.transform.pointCoordinate(z.transform.getCameraPoint()),O=new n.pointGeometry(L.x,L.y);k.sort((j,X)=>{if(X.overscaledZ-j.overscaledZ)return X.overscaledZ-j.overscaledZ;let $=new n.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),U=new n.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),st=O.mult(1<<j.canonical.z);return st.x-=.5,st.y-=.5,st.distSqr($)-st.distSqr(U)})})(y,this.painter),this._previousZoom=m.zoom;let v=this.proxyToSource||{};this.proxyToSource={},y.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};let T=this._style._sourceCaches;for(let k in T){let z=T[k];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,e[k],v),z.usedForTerrain))continue;let L=e[k];z.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[c.id]=y.map(k=>new pc(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=n.exported.now();let M={};this._visibleDemTiles=[];for(let k of this.proxyCoords){let z=this.terrainTileForTile[k.key];if(!z)continue;let L=z.tileID.key;L in M||(this._visibleDemTiles.push(z),M[L]=L)}}_assignTerrainTiles(e){this._initializing||e.forEach(c=>{if(this.terrainTileForTile[c.key])return;let m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){let e=this.painter.context,c=e.gl;for(let m in this.terrainTileForTile){let y=this.terrainTileForTile[m],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(e.activeTexture.set(c.TEXTURE1),lc(this.painter,y,v))}}_prepareDemTileUniforms(e,c,m,y){if(!c||c.demTexture==null)return!1;let v=e.tileID.canonical,T=Math.pow(2,c.tileID.canonical.z-v.z),M=y||"";return m[`u_dem_tl${M}`]=[v.x*T%1,v.y*T%1],m[`u_dem_scale${M}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let e=this.painter.context,c=e.gl;if(!this._emptyDepthBufferTexture){let m=new n.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new n.Texture(e,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0,c=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;let v=y.dem.tree.minimums[0];return v>0&&e++,m+v},0);return e?c/e:0}_updateEmptyDEMTexture(){let e=this.painter.context,c=e.gl;e.activeTexture.set(c.TEXTURE2);let m=this._getLoadedAreaMinimum(),y=new n.RGBAImage({width:1,height:1},new Uint8Array(n.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new n.Texture(e,y,c.RGBA,{premultiply:!1}),v}setupElevationDraw(e,c,m){let y=this.painter.context,v=y.gl,T=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:n.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var M;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let k=this.painter.transform,z=k.projection,L=e.tileID.canonical;T.u_tile_tl_up=z.upVector(L,0,0),T.u_tile_tr_up=z.upVector(L,n.EXTENT,0),T.u_tile_br_up=z.upVector(L,n.EXTENT,n.EXTENT),T.u_tile_bl_up=z.upVector(L,0,n.EXTENT),T.u_tile_up_scale=m&&m.useDenormalizedUpVectorScale?Ip:z.upVectorScale(L,k.center.lat,k.worldSize).metersToTile;let O=null,j=null,X=1;if(m&&m.morphing&&this._useVertexMorphing){let $=m.morphing.srcDemTile,U=m.morphing.dstDemTile;X=m.morphing.phase,$&&U&&(this._prepareDemTileUniforms(e,$,T,"_prev")&&(j=$),this._prepareDemTileUniforms(e,U,T)&&(O=U))}if(j&&O?(y.activeTexture.set(v.TEXTURE2),O.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),y.activeTexture.set(v.TEXTURE4),j.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),T.u_dem_lerp=X):(O=this.terrainTileForTile[e.tileID.key],y.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(e,O,T)?O.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),y.activeTexture.set(v.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&O){let $=(1<<O.tileID.canonical.z)*n.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=$}m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(y,T)}renderToBackBuffer(e){let c=this.painter,m=this.painter.context;e.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(y,v,T,M,k){if(y.transform.projection.name==="globe")(function(z,L,O,j,X){let $=z.context,U=$.gl,st,Y,it=z.options.showTerrainWireframe?2:0,nt=(kt,$t)=>{if(Y===kt)return;let wt=[qs[kt],"PROJECTION_GLOBE_VIEW"];$t&&wt.push(qs[it]),st=z.useProgram("globeRaster",null,wt),Y=kt},at=z.colorModeForRenderPass(),tt=new n.DepthMode(U.LEQUAL,n.DepthMode.ReadWrite,z.depthRangeFor3D);Ir.update(X);let ct=z.transform,bt=n.calculateGlobeMercatorMatrix(ct),Ct=[n.mercatorXfromLng(ct.center.lng),n.mercatorYfromLat(ct.center.lat)],zt=z.globeSharedBuffers;if((it?[!1,!0]:[!1]).forEach(kt=>{Y=-1;let $t=kt?U.LINES:U.TRIANGLES;for(let wt of j){let qt=O.getTile(wt),Nt=n.StencilMode.disabled,re=L.prevTerrainTileForTile[wt.key],Dt=L.terrainTileForTile[wt.key];Ga(re,Dt)&&Ir.newMorphing(wt.key,re,Dt,X,250),$.activeTexture.set(U.TEXTURE0),qt.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let ee=Ir.getMorphValuesForProxy(wt.key),ue=ee?1:0,ie={useDenormalizedUpVectorScale:!0};ee&&n.extend$1(ie,{morphing:{srcDemTile:ee.from,dstDemTile:ee.to,phase:n.easeCubicInOut(ee.phase)}});let ne=Float32Array.from(ct.globeMatrix),fe=n.globeTileLatLngCorners(wt.canonical),Se=n.getGridMatrix(wt.canonical,fe),ae=cu(ct.projMatrix,ne,bt,n.globeToMercatorTransition(ct.zoom),Ct,Se);if(nt(ue,kt),L.setupElevationDraw(qt,st,ie),z.prepareDrawProgram($,st,wt.toUnwrapped()),zt){let[ge,Re,hi]=kt?zt.getWirefameBuffers(z.context):zt.getGridBuffers();st.draw($,$t,tt,Nt,at,n.CullFaceMode.backCCW,ae,"globe_raster",ge,Re,hi)}}}),zt){st=z.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(let kt of j){let{x:$t,y:wt,z:qt}=kt.canonical,Nt=wt===0,re=wt===(1<<qt)-1,[Dt,ee,ue,ie]=zt.getPoleBuffers(qt);if(ie&&(Nt||re)){let ne=O.getTile(kt);$.activeTexture.set(U.TEXTURE0),ne.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let fe=n.globePoleMatrixForTile(qt,$t,ct),Se=(ae,ge)=>ae.draw($,U.TRIANGLES,tt,n.StencilMode.disabled,at,n.CullFaceMode.disabled,cu(ct.projMatrix,fe,fe,0,Ct),"globe_pole_raster",ge,ue,ie);L.setupElevationDraw(ne,st,{}),z.prepareDrawProgram($,st,kt.toUnwrapped()),Nt&&Se(st,Dt),re&&(fe=n.scale(n.create(),fe,[1,-1,1]),Se(st,ee))}}}})(y,v,T,M,k);else{let z=y.context,L=z.gl,O,j,X=y.options.showTerrainWireframe?2:0,$=(nt,at)=>{if(j===nt)return;let tt=[qs[nt]];at&&tt.push(qs[X]),O=y.useProgram("terrainRaster",null,tt),j=nt},U=y.colorModeForRenderPass(),st=new n.DepthMode(L.LEQUAL,n.DepthMode.ReadWrite,y.depthRangeFor3D);Ir.update(k);let Y=y.transform,it=6*Math.pow(1.5,22-Y.zoom)*v.exaggeration();(X?[!1,!0]:[!1]).forEach(nt=>{j=-1;let at=nt?L.LINES:L.TRIANGLES,[tt,ct]=nt?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(let bt of M){let Ct=T.getTile(bt),zt=n.StencilMode.disabled,kt=v.prevTerrainTileForTile[bt.key],$t=v.terrainTileForTile[bt.key];Ga(kt,$t)&&Ir.newMorphing(bt.key,kt,$t,k,250),z.activeTexture.set(L.TEXTURE0),Ct.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);let wt=Ir.getMorphValuesForProxy(bt.key),qt=wt?1:0,Nt;wt&&(Nt={morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:n.easeCubicInOut(wt.phase)}});let re=lu(bt.projMatrix,uc(bt.canonical,Y.renderWorldCopies)?it/10:it);$(qt,nt),v.setupElevationDraw(Ct,O,Nt),y.prepareDrawProgram(z,O,bt.toUnwrapped()),O.draw(z,at,st,zt,U,n.CullFaceMode.backCCW,re,"terrain_raster",v.gridBuffer,tt,ct)}})}}(c,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,e.splice(0,e.length))}renderBatch(e){if(this._drapedRenderBatches.length===0)return e+1;this.renderingToTexture=!0;let c=this.painter,m=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),M=[],k=c.style.order,z=0;for(let L of v){let O=y.getTileByID(L.proxyTileKey),j=y.proxyCachedFBO[L.key]?y.proxyCachedFBO[L.key][e]:void 0,X=j!==void 0?y.renderCache[j]:this.pool[z++],$=j!==void 0;if(O.texture=X.tex,$&&!X.dirty){M.push(O.tileID);continue}let U;m.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(m.clear({color:n.Color.transparent,stencil:0}),X.dirty=!1);for(let st=T.start;st<=T.end;++st){let Y=c.style._layers[k[st]];if(Y.isHidden(c.transform.zoom))continue;let it=c.style._getLayerSourceCache(Y),nt=it?this.proxyToSource[L.key][it.id]:[L];if(!nt)continue;let at=nt;m.viewport.set([0,0,X.fb.width,X.fb.height]),U!==(it?it.id:null)&&(this._setupStencil(X,nt,Y,it),U=it?it.id:null),c.renderLayer(c,it,Y,at)}this.renderedToTile?(X.dirty=!0,M.push(O.tileID)):$||--z,z===5&&(z=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),T.end+1}postRender(){}renderCacheEfficiency(e){let c=e.order.length;if(c===0)return{efficiency:100};let m,y=0,v=0,T=!1;for(let M=0;M<c;++M){let k=e._layers[e.order[M]];this._style.isLayerDraped(k)?(T&&++y,++v):T||(T=!0,m=k.id)}return v===0?{efficiency:100}:{efficiency:100*(1-y/v),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{e=Math.min(e,c.dem.tree.minimums[0])}),e===0?e:(e-30)*this._exaggeration}raycast(e,c,m){if(!this._visibleDemTiles)return null;let y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let T=v.tileID,M=Math.pow(2,T.overscaledZ),{x:k,y:z}=T.canonical,L=k/M,O=(k+1)/M,j=z/M,X=(z+1)/M;return{minx:L,miny:j,maxx:O,maxy:X,t:v.dem.tree.raycastRoot(L,j,O,X,e,c,m),tile:v}});y.sort((v,T)=>(v.t!==null?v.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(let v of y){if(v.t==null)return null;let T=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,e,c,m);if(T!=null)return T}return null}_createFBO(){let e=this.painter.context,c=e.gl,m=this.drapeBufferSize;e.activeTexture.set(c.TEXTURE0);let y=new n.Texture(e,{width:m[0],height:m[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);let v=e.createFramebuffer(m[0],m[1],!1);return v.colorAttachment.set(y.texture),v.depthAttachment=new Zs(e,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(let e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{let c=this._style._layers[e],m=c.isHidden(this.painter.transform.zoom),y=c.getCrossfadeParameters(),v=!!y&&y.t!==1,T=c.hasTransition();return c.type!=="custom"&&!m&&(v||T)})}_clearRasterFadeFromRenderCache(){let e=!1;for(let c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof Z){e=!0;break}if(e)for(let c=0;c<this._style.order.length;++c){let m=this._style._layers[this._style.order[c]],y=m.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(m);if(m.type!=="raster"||y||!v)continue;let T=m.paint.get("raster-fade-duration");for(let M of this.proxyCoords){let k=this.proxyToSource[M.key][v.id];if(k)for(let z of k){let L=dc(v.getTile(z),v.findLoadedParent(z,0),v,this.painter.transform,T);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(v.id,z)}}}}_setupDrapedRenderBatches(){let e=this._style.order,c=e.length;if(c===0)return;let m=[],y,v=0,T=this._style._layers[e[v]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++v<c;)T=this._style._layers[e[v]];for(;v<c;++v){let M=this._style._layers[e[v]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?y===void 0&&(y=v):y!==void 0&&(m.push({start:y,end:v-1}),y=void 0))}y!==void 0&&m.push({start:y,end:v-1}),this._drapedRenderBatches=m}_setupRenderCache(e){let c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){let T=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let M=0;M<T.length;++M){let k=Object.values(T[M]);c.renderCachePool.push(...k)}}return}this._clearRasterFadeFromRenderCache();let m=this.proxyCoords,y=this._tilesDirty;for(let T=m.length-1;T>=0;T--){let M=m[T];if(c.getTileByID(M.key),c.proxyCachedFBO[M.key]!==void 0){let k=e[M.key],z=this.proxyToSource[M.key],L=0;for(let O in z){let j=z[O],X=k[O];if(!X||X.length!==j.length||j.some(($,U)=>$!==X[U]||y[O]&&y[O].hasOwnProperty($.key))){L=-1;break}++L}for(let O in c.proxyCachedFBO[M.key])c.renderCache[c.proxyCachedFBO[M.key][O]].dirty=L<0||L!==Object.values(k).length}}let v=[...this._drapedRenderBatches];v.sort((T,M)=>M.end-M.start-(T.end-T.start));for(let T of v)for(let M of m){if(c.proxyCachedFBO[M.key])continue;let k=c.renderCachePool.pop();k===void 0&&c.renderCache.length<50&&(k=c.renderCache.length,c.renderCache.push(this._createFBO())),k!==void 0&&(c.proxyCachedFBO[M.key]={},c.proxyCachedFBO[M.key][T.start]=k,c.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(e,c,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,T=v.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let M;if(m.isTileClipped())M=c.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(e.key)||0),this._overlapStencilMode):n.StencilMode.disabled}_renderTileClippingMasks(e,c){let m=this.painter,y=this.painter.context,v=y.gl;m._tileClippingMaskIDs.clear(),y.setColorMode(n.ColorMode.disabled),y.setDepthMode(n.DepthMode.disabled);let T=m.useProgram("clippingMask");for(let M of e){let k=--c;m._tileClippingMaskIDs.set(M.key,k),T.draw(y,v.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,$a(M.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(e){let c=this.painter.transform;if(e.x<0||e.x>c.width||e.y<0||e.y>c.height)return null;let m=[e.x,e.y,1,1];n.transformMat4$1(m,m,c.pixelMatrixInverse),n.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;let y=c._camera.position,v=n.mercatorZfromAltitude(1,c.center.lat),T=[y[0],y[1],y[2]/v,0],M=n.subtract([],m.slice(0,3),T);n.normalize(M,M);let k=this.raycast(T,M,this._exaggeration);return k!==null&&k?(n.scaleAndAdd(T,T,M,k),T[3]=T[2],T[2]*=v,T):null}drawDepth(){let e=this.painter,c=e.context,m=this.proxySourceCache,y=Math.ceil(e.width),v=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let T=c.gl,M=c.createFramebuffer(y,v,!0);c.activeTexture.set(T.TEXTURE0);let k=new n.Texture(c,{width:y,height:v,data:null},T.RGBA);k.bind(T.NEAREST,T.CLAMP_TO_EDGE),M.colorAttachment.set(k.texture);let z=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,v);M.depthAttachment.set(z),this._depthFBO=M,this._depthTexture=k}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,v]),function(T,M,k,z){if(T.transform.projection.name==="globe")return;let L=T.context,O=L.gl;L.clear({depth:1});let j=T.useProgram("terrainDepth"),X=new n.DepthMode(O.LESS,n.DepthMode.ReadWrite,T.depthRangeFor3D);for(let $ of z){let U=k.getTile($),st=lu($.projMatrix,0);M.setupElevationDraw(U,j),j.draw(L,O.TRIANGLES,X,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.backCCW,st,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(e,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,c,m){if(e.getSource()instanceof ht)return this._setupProxiedCoordsForImageSource(e,c,m);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};let y=this.proxiedCoords[e.id]=[],v=this.proxyCoords;for(let M=0;M<v.length;M++){let k=v[M],z=this._findTileCoveringTileID(k,e);if(z){let L=this._createProxiedId(k,z,m[k.key]&&m[k.key][e.id]);y.push(L),this.proxyToSource[k.key][e.id]=[L]}}let T=!1;for(let M=0;M<c.length;M++){let k=e.getTile(c[M]);if(!k||!k.hasData())continue;let z=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==k.tileID.canonical.z){let L=this.proxyToSource[z.tileID.key][e.id],O=this._createProxiedId(z.tileID,k,m[z.tileID.key]&&m[z.tileID.key][e.id]);L?L.splice(L.length-1,0,O):this.proxyToSource[z.tileID.key][e.id]=[O],y.push(O),T=!0}}this._sourceTilesOverlap[e.id]=T}_setupProxiedCoordsForImageSource(e,c,m){if(!e.getSource().loaded())return;let y=this.proxiedCoords[e.id]=[],v=this.proxyCoords,T=e.getSource(),M=new n.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),k=T.coordinates.map(n.MercatorCoordinate.fromLngLat).reduce((L,O)=>(L.min.x=Math.min(L.min.x,O.x-M.x),L.min.y=Math.min(L.min.y,O.y-M.y),L.max.x=Math.max(L.max.x,O.x-M.x),L.max.y=Math.max(L.max.y,O.y-M.y),L),{min:new n.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(L,O)=>{let j=L.wrap+L.canonical.x/(1<<L.canonical.z),X=L.canonical.y/(1<<L.canonical.z),$=n.EXTENT/(1<<L.canonical.z),U=O.wrap+O.canonical.x/(1<<O.canonical.z),st=O.canonical.y/(1<<O.canonical.z);return j+$<U+k.min.x||j>U+k.max.x||X+$<st+k.min.y||X>st+k.max.y};for(let L=0;L<v.length;L++){let O=v[L];for(let j=0;j<c.length;j++){let X=e.getTile(c[j]);if(!X||!X.hasData()||z(O,X.tileID))continue;let $=this._createProxiedId(O,X,m[O.key]&&m[O.key][e.id]),U=this.proxyToSource[O.key][e.id];U?U.push($):this.proxyToSource[O.key][e.id]=[$],y.push($)}}}_createProxiedId(e,c,m){let y=this.orthoMatrix;if(m){let v=m.find(T=>T.key===c.tileID.key);if(v)return v}if(c.tileID.key!==e.key){let v=e.canonical.z-c.tileID.canonical.z,T,M,k;y=n.create();let z=c.tileID.wrap-e.wrap<<e.overscaledZ;v>0?(T=n.EXTENT>>v,M=T*((c.tileID.canonical.x<<v)-e.canonical.x+z),k=T*((c.tileID.canonical.y<<v)-e.canonical.y)):(T=n.EXTENT<<-v,M=n.EXTENT*(c.tileID.canonical.x-(e.canonical.x+z<<-v)),k=n.EXTENT*(c.tileID.canonical.y-(e.canonical.y<<-v))),n.ortho(y,0,T,0,T,0,1),n.translate(y,y,[M,k,0])}return new pc(c.tileID,e.key,y)}_findTileCoveringTileID(e,c){let m=c.getTile(e);if(m&&m.hasData())return m;let y=this._findCoveringTileCache[c.id],v=y[e.key];if(m=v?c.getTileByID(v):null,m&&m.hasData()||v===null)return m;let T=m?m.tileID:e,M=T.overscaledZ,k=c.getSource().minzoom,z=[];if(!v){let O=c.getSource().maxzoom;if(e.canonical.z>=O){let j=e.canonical.z-O;c.getSource().reparseOverscaled?(M=Math.max(e.canonical.z+2,c.transform.tileZoom),T=new n.OverscaledTileID(M,e.wrap,O,e.canonical.x>>j,e.canonical.y>>j)):j!==0&&(M=O,T=new n.OverscaledTileID(M,e.wrap,O,e.canonical.x>>j,e.canonical.y>>j))}T.key!==e.key&&(z.push(T.key),m=c.getTile(T))}let L=O=>{z.forEach(j=>{y[j]=O}),z.length=0};for(M-=1;M>=k&&(!m||!m.hasData());M--){m&&L(m.tileID.key);let O=T.calculateScaledKey(M);if(m=c.getTileByID(O),m&&m.hasData())break;let j=y[O];if(j===null)break;j===void 0?z.push(O):m=c.getTileByID(j)}return L(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,c){let m=this._tilesDirty[e];m||(m=this._tilesDirty[e]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){let e=function(c){let m=0,y=new n.StructArrayLayout2ui4,v=131;for(let T=1;T<129;T++){for(let M=1;M<129;M++)m=T*v+M,y.emplaceBack(m,m+1),y.emplaceBack(m,m+v),y.emplaceBack(m+1,m+v),T===128&&y.emplaceBack(m+v,m+v+1);y.emplaceBack(m+1,m+1+v)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(e),this.wireframeSegments=n.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,e.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function qa(d){let e=[];for(let c=0;c<d.length;c++){if(d[c]===null)continue;let m=d[c].split(" ");e.push(m.pop())}return e}class Uo{static cacheKey(e,c,m){let y=`${e}${m?m.cacheKey:""}`;for(let v of c)y+=`/${v}`;return y}constructor(e,c,m,y,v,T){let M=e.gl;this.program=M.createProgram();let k=qa(m.staticAttributes),z=y?y.getBinderAttributes():[],L=k.concat(z),O=m.staticUniforms?qa(m.staticUniforms):[],j=y?y.getBinderUniforms():[],X=O.concat(j),$=[];for(let tt of X)$.indexOf(tt)<0&&$.push(tt);let U=y?y.defines():[];U=U.concat(T.map(tt=>`#define ${tt}`));let st=U.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Fo,Na.fragmentSource,Cr.fragmentSource,m.fragmentSource).join(`
`),Y=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Fo,Na.vertexSource,Cr.vertexSource,us.vertexSource,m.vertexSource).join(`
`),it=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(it,st),M.compileShader(it),M.attachShader(this.program,it);let nt=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(nt,Y),M.compileShader(nt),M.attachShader(this.program,nt),this.attributes={};let at={};this.numAttributes=L.length;for(let tt=0;tt<this.numAttributes;tt++)L[tt]&&(M.bindAttribLocation(this.program,tt,L[tt]),this.attributes[L[tt]]=tt);M.linkProgram(this.program),M.deleteShader(nt),M.deleteShader(it);for(let tt=0;tt<$.length;tt++){let ct=$[tt];if(ct&&!at[ct]){let bt=M.getUniformLocation(this.program,ct);bt&&(at[ct]=bt)}}this.fixedUniforms=v(e,at),this.binderUniforms=y?y.getUniforms(e,at):[],T.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((tt,ct)=>({u_dem:new n.Uniform1i(tt,ct.u_dem),u_dem_prev:new n.Uniform1i(tt,ct.u_dem_prev),u_dem_unpack:new n.Uniform4f(tt,ct.u_dem_unpack),u_dem_tl:new n.Uniform2f(tt,ct.u_dem_tl),u_dem_scale:new n.Uniform1f(tt,ct.u_dem_scale),u_dem_tl_prev:new n.Uniform2f(tt,ct.u_dem_tl_prev),u_dem_scale_prev:new n.Uniform1f(tt,ct.u_dem_scale_prev),u_dem_size:new n.Uniform1f(tt,ct.u_dem_size),u_dem_lerp:new n.Uniform1f(tt,ct.u_dem_lerp),u_exaggeration:new n.Uniform1f(tt,ct.u_exaggeration),u_depth:new n.Uniform1i(tt,ct.u_depth),u_depth_size_inv:new n.Uniform2f(tt,ct.u_depth_size_inv),u_meter_to_dem:new n.Uniform1f(tt,ct.u_meter_to_dem),u_label_plane_matrix_inv:new n.UniformMatrix4f(tt,ct.u_label_plane_matrix_inv),u_tile_tl_up:new n.Uniform3f(tt,ct.u_tile_tl_up),u_tile_tr_up:new n.Uniform3f(tt,ct.u_tile_tr_up),u_tile_br_up:new n.Uniform3f(tt,ct.u_tile_br_up),u_tile_bl_up:new n.Uniform3f(tt,ct.u_tile_bl_up),u_tile_up_scale:new n.Uniform1f(tt,ct.u_tile_up_scale)}))(e,at)),T.indexOf("FOG")!==-1&&(this.fogUniforms=((tt,ct)=>({u_fog_matrix:new n.UniformMatrix4f(tt,ct.u_fog_matrix),u_fog_range:new n.Uniform2f(tt,ct.u_fog_range),u_fog_color:new n.Uniform4f(tt,ct.u_fog_color),u_fog_horizon_blend:new n.Uniform1f(tt,ct.u_fog_horizon_blend),u_fog_temporal_offset:new n.Uniform1f(tt,ct.u_fog_temporal_offset)}))(e,at))}setTerrainUniformValues(e,c){if(!this.terrainUniforms)return;let m=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let y in c)m[y].set(c[y])}}setFogUniformValues(e,c){if(!this.fogUniforms)return;let m=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let y in c)m[y].location&&m[y].set(c[y])}}draw(e,c,m,y,v,T,M,k,z,L,O,j,X,$,U,st){let Y=e.gl;if(this.failedToCreate)return;e.program.set(this.program),e.setDepthMode(m),e.setStencilMode(y),e.setColorMode(v),e.setCullFace(T);for(let nt of Object.keys(this.fixedUniforms))this.fixedUniforms[nt].set(M[nt]);$&&$.setUniforms(e,this.binderUniforms,j,{zoom:X});let it={[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[c];for(let nt of O.get()){let at=nt.vaos||(nt.vaos={});(at[k]||(at[k]=new ja)).bind(e,this,z,$?$.getPaintVertexBuffers():[],L,nt.vertexOffset,U,st),Y.drawElements(c,nt.primitiveLength*it,Y.UNSIGNED_SHORT,nt.primitiveOffset*it*2)}}}function No(d,e,c){let m=1/gi(c,1,e.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,e.transform.tileZoom)/y,T=v*(c.tileID.canonical.x+c.tileID.wrap*y),M=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[m,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[T>>16,M>>16],u_pixel_coord_lower:[65535&T,65535&M]}}let fc=n.create(),Wa=(d,e,c,m,y,v,T,M,k)=>{let z=e.style.light,L=z.properties.get("position"),O=[L.x,L.y,L.z],j=n.create$1();z.properties.get("anchor")==="viewport"&&(n.fromRotation(j,-e.transform.angle),n.transformMat3(O,O,j));let X=z.properties.get("color"),$=e.transform,U={u_matrix:d,u_lightpos:O,u_lightintensity:z.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return $.projection.name==="globe"&&(U.u_tile_id=[y.canonical.x,y.canonical.y,1<<y.canonical.z],U.u_zoom_transition=T,U.u_inv_rot_matrix=k,U.u_merc_center=M,U.u_up_dir=$.projection.upVector(new n.CanonicalTileID(0,0,0),M[0]*n.EXTENT,M[1]*n.EXTENT),U.u_height_lift=v),U},Xa=(d,e,c,m,y,v,T,M,k,z,L)=>{let O=Wa(d,e,c,m,y,M,k,z,L),j={u_height_factor:-Math.pow(2,y.overscaledZ)/T.tileSize/8};return n.extend(O,No(v,e,T),j)},Ha=d=>({u_matrix:d}),Ya=(d,e,c,m)=>n.extend(Ha(d),No(c,e,m)),Ka=(d,e)=>({u_matrix:d,u_world:e}),hu=(d,e,c,m,y)=>n.extend(Ya(d,e,c,m),{u_world:y}),uu=n.create(),Ws=(d,e,c,m,y,v)=>{let T=d.transform,M=T.projection.name==="globe",k;if(v.paint.get("circle-pitch-alignment")==="map")if(M){let L=n.globePixelsToTileUnits(T.zoom,e.canonical);k=Float32Array.from([L,0,0,L])}else k=T.calculatePixelsToTileUnitsMatrix(c);else k=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);let z={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:d.translatePosMatrix(e.projMatrix,c,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:n.exported.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:uu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return M&&(z.u_inv_rot_matrix=m,z.u_merc_center=y,z.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],z.u_zoom_transition=n.globeToMercatorTransition(T.zoom),z.u_up_dir=T.projection.upVector(e.canonical,y[0],y[1])),z},kp=d=>{let e=[];return d.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e},Pp=(d,e,c)=>{let m=n.EXTENT/c.tileSize;return{u_matrix:d,u_camera_to_center_distance:e.cameraToCenterDistance,u_extrude_scale:[e.pixelsToGLUnits[0]/m,e.pixelsToGLUnits[1]/m]}},du=(d,e,c=1)=>({u_matrix:d,u_color:e,u_overlay:0,u_overlay_scale:c}),zp=n.create(),Dp=(d,e,c,m,y,v,T)=>{let M=d.transform,k=M.projection.name==="globe",z=k?n.globePixelsToTileUnits(M.zoom,e.canonical):gi(c,1,v),L={u_matrix:e.projMatrix,u_extrude_scale:z,u_intensity:T,u_inv_rot_matrix:zp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return k&&(L.u_inv_rot_matrix=m,L.u_merc_center=y,L.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],L.u_zoom_transition=n.globeToMercatorTransition(M.zoom),L.u_up_dir=M.projection.upVector(e.canonical,y[0],y[1])),L},Lp=(d,e,c,m,y,v,T)=>{let M=d.transform,k=M.calculatePixelsToTileUnitsMatrix(e),z={u_matrix:ds(d,e,c,y),u_pixels_to_tile_units:k,u_device_pixel_ratio:T,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(_c(c)){let L=Ja(e,d.transform);z.u_texsize=e.lineAtlasTexture.size,z.u_scale=[L,m.fromScale,m.toScale],z.u_mix=m.t}return z},mc=(d,e,c,m,y,v)=>{let T=d.transform,M=Ja(e,T);return{u_matrix:ds(d,e,c,y),u_texsize:e.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:v,u_image:0,u_scale:[M,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ja(d,e){return 1/gi(d,1,e.tileZoom)}function ds(d,e,c,m){return d.translatePosMatrix(m||e.tileID.projMatrix,e,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function _c(d){let e=d.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let pu=(d,e,c,m,y,v)=>{return{u_matrix:d,u_tl_parent:e,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(M=y.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(T=y.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:gc(y.paint.get("raster-hue-rotate")),u_perspective_transform:v};var T,M};function gc(d){d*=Math.PI/180;let e=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*e-c+1)/3,(Math.sqrt(3)*e-c+1)/3]}let kr=n.create(),yc=(d,e,c,m,y,v,T,M,k,z,L,O,j,X)=>{let $=y.transform,U={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:$.width/$.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:T,u_coord_matrix:M,u_is_text:+k,u_pitch_with_map:+m,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:kr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:kr};return $.projection.name==="globe"&&(U.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],U.u_zoom_transition=O,U.u_inv_rot_matrix=X,U.u_merc_center=j,U.u_camera_forward=$._camera.forward(),U.u_ecef_origin=n.globeECEFOrigin($.globeMatrix,L.toUnwrapped()),U.u_tile_matrix=Float32Array.from($.globeMatrix)),U},ps=(d,e,c,m,y,v,T,M,k,z,L,O,j,X,$)=>{let{cameraToCenterDistance:U,_pitch:st}=y.transform;return n.extend(yc(d,e,c,m,y,v,T,M,k,z,O,j,X,$),{u_gamma_scale:m?U*Math.cos(y.terrain?0:st):1,u_device_pixel_ratio:n.exported.devicePixelRatio,u_is_halo:+L})},Xs=(d,e,c,m,y,v,T,M,k,z,L,O,j,X)=>n.extend(ps(d,e,c,m,y,v,T,M,!0,k,!0,L,O,j,X),{u_texsize_icon:z,u_texture_icon:1}),fu=(d,e,c)=>({u_matrix:d,u_opacity:e,u_color:c}),xc=(d,e,c,m,y,v)=>n.extend(function(T,M,k,z){let L=k.imageManager.getPattern(T.from.toString()),O=k.imageManager.getPattern(T.to.toString()),{width:j,height:X}=k.imageManager.getPixelSize(),$=Math.pow(2,z.tileID.overscaledZ),U=z.tileSize*Math.pow(2,k.transform.tileZoom)/$,st=U*(z.tileID.canonical.x+z.tileID.wrap*$),Y=U*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[j,X],u_mix:M.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/gi(z,1,k.transform.tileZoom),u_pixel_coord_upper:[st>>16,Y>>16],u_pixel_coord_lower:[65535&st,65535&Y]}}(m,v,c,y),{u_matrix:d,u_opacity:e}),We={fillExtrusion:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_lightpos:new n.Uniform3f(d,e.u_lightpos),u_lightintensity:new n.Uniform1f(d,e.u_lightintensity),u_lightcolor:new n.Uniform3f(d,e.u_lightcolor),u_vertical_gradient:new n.Uniform1f(d,e.u_vertical_gradient),u_opacity:new n.Uniform1f(d,e.u_opacity),u_tile_id:new n.Uniform3f(d,e.u_tile_id),u_zoom_transition:new n.Uniform1f(d,e.u_zoom_transition),u_inv_rot_matrix:new n.UniformMatrix4f(d,e.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(d,e.u_merc_center),u_up_dir:new n.Uniform3f(d,e.u_up_dir),u_height_lift:new n.Uniform1f(d,e.u_height_lift)}),fillExtrusionPattern:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_lightpos:new n.Uniform3f(d,e.u_lightpos),u_lightintensity:new n.Uniform1f(d,e.u_lightintensity),u_lightcolor:new n.Uniform3f(d,e.u_lightcolor),u_vertical_gradient:new n.Uniform1f(d,e.u_vertical_gradient),u_height_factor:new n.Uniform1f(d,e.u_height_factor),u_tile_id:new n.Uniform3f(d,e.u_tile_id),u_zoom_transition:new n.Uniform1f(d,e.u_zoom_transition),u_inv_rot_matrix:new n.UniformMatrix4f(d,e.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(d,e.u_merc_center),u_up_dir:new n.Uniform3f(d,e.u_up_dir),u_height_lift:new n.Uniform1f(d,e.u_height_lift),u_image:new n.Uniform1i(d,e.u_image),u_texsize:new n.Uniform2f(d,e.u_texsize),u_pixel_coord_upper:new n.Uniform2f(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,e.u_pixel_coord_lower),u_scale:new n.Uniform3f(d,e.u_scale),u_fade:new n.Uniform1f(d,e.u_fade),u_opacity:new n.Uniform1f(d,e.u_opacity)}),fill:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix)}),fillPattern:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_image:new n.Uniform1i(d,e.u_image),u_texsize:new n.Uniform2f(d,e.u_texsize),u_pixel_coord_upper:new n.Uniform2f(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,e.u_pixel_coord_lower),u_scale:new n.Uniform3f(d,e.u_scale),u_fade:new n.Uniform1f(d,e.u_fade)}),fillOutline:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_world:new n.Uniform2f(d,e.u_world)}),fillOutlinePattern:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_world:new n.Uniform2f(d,e.u_world),u_image:new n.Uniform1i(d,e.u_image),u_texsize:new n.Uniform2f(d,e.u_texsize),u_pixel_coord_upper:new n.Uniform2f(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,e.u_pixel_coord_lower),u_scale:new n.Uniform3f(d,e.u_scale),u_fade:new n.Uniform1f(d,e.u_fade)}),circle:(d,e)=>({u_camera_to_center_distance:new n.Uniform1f(d,e.u_camera_to_center_distance),u_extrude_scale:new n.UniformMatrix2f(d,e.u_extrude_scale),u_device_pixel_ratio:new n.Uniform1f(d,e.u_device_pixel_ratio),u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_inv_rot_matrix:new n.UniformMatrix4f(d,e.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(d,e.u_merc_center),u_tile_id:new n.Uniform3f(d,e.u_tile_id),u_zoom_transition:new n.Uniform1f(d,e.u_zoom_transition),u_up_dir:new n.Uniform3f(d,e.u_up_dir)}),collisionBox:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_camera_to_center_distance:new n.Uniform1f(d,e.u_camera_to_center_distance),u_extrude_scale:new n.Uniform2f(d,e.u_extrude_scale)}),collisionCircle:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_inv_matrix:new n.UniformMatrix4f(d,e.u_inv_matrix),u_camera_to_center_distance:new n.Uniform1f(d,e.u_camera_to_center_distance),u_viewport_size:new n.Uniform2f(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new n.UniformColor(d,e.u_color),u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_overlay:new n.Uniform1i(d,e.u_overlay),u_overlay_scale:new n.Uniform1f(d,e.u_overlay_scale)}),clippingMask:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix)}),heatmap:(d,e)=>({u_extrude_scale:new n.Uniform1f(d,e.u_extrude_scale),u_intensity:new n.Uniform1f(d,e.u_intensity),u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_inv_rot_matrix:new n.UniformMatrix4f(d,e.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(d,e.u_merc_center),u_tile_id:new n.Uniform3f(d,e.u_tile_id),u_zoom_transition:new n.Uniform1f(d,e.u_zoom_transition),u_up_dir:new n.Uniform3f(d,e.u_up_dir)}),heatmapTexture:(d,e)=>({u_image:new n.Uniform1i(d,e.u_image),u_color_ramp:new n.Uniform1i(d,e.u_color_ramp),u_opacity:new n.Uniform1f(d,e.u_opacity)}),hillshade:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_image:new n.Uniform1i(d,e.u_image),u_latrange:new n.Uniform2f(d,e.u_latrange),u_light:new n.Uniform2f(d,e.u_light),u_shadow:new n.UniformColor(d,e.u_shadow),u_highlight:new n.UniformColor(d,e.u_highlight),u_accent:new n.UniformColor(d,e.u_accent)}),hillshadePrepare:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_image:new n.Uniform1i(d,e.u_image),u_dimension:new n.Uniform2f(d,e.u_dimension),u_zoom:new n.Uniform1f(d,e.u_zoom),u_unpack:new n.Uniform4f(d,e.u_unpack)}),line:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_pixels_to_tile_units:new n.UniformMatrix2f(d,e.u_pixels_to_tile_units),u_device_pixel_ratio:new n.Uniform1f(d,e.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(d,e.u_units_to_pixels),u_dash_image:new n.Uniform1i(d,e.u_dash_image),u_gradient_image:new n.Uniform1i(d,e.u_gradient_image),u_image_height:new n.Uniform1f(d,e.u_image_height),u_texsize:new n.Uniform2f(d,e.u_texsize),u_scale:new n.Uniform3f(d,e.u_scale),u_mix:new n.Uniform1f(d,e.u_mix),u_alpha_discard_threshold:new n.Uniform1f(d,e.u_alpha_discard_threshold)}),linePattern:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_texsize:new n.Uniform2f(d,e.u_texsize),u_pixels_to_tile_units:new n.UniformMatrix2f(d,e.u_pixels_to_tile_units),u_device_pixel_ratio:new n.Uniform1f(d,e.u_device_pixel_ratio),u_image:new n.Uniform1i(d,e.u_image),u_units_to_pixels:new n.Uniform2f(d,e.u_units_to_pixels),u_scale:new n.Uniform3f(d,e.u_scale),u_fade:new n.Uniform1f(d,e.u_fade),u_alpha_discard_threshold:new n.Uniform1f(d,e.u_alpha_discard_threshold)}),raster:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_tl_parent:new n.Uniform2f(d,e.u_tl_parent),u_scale_parent:new n.Uniform1f(d,e.u_scale_parent),u_fade_t:new n.Uniform1f(d,e.u_fade_t),u_opacity:new n.Uniform1f(d,e.u_opacity),u_image0:new n.Uniform1i(d,e.u_image0),u_image1:new n.Uniform1i(d,e.u_image1),u_brightness_low:new n.Uniform1f(d,e.u_brightness_low),u_brightness_high:new n.Uniform1f(d,e.u_brightness_high),u_saturation_factor:new n.Uniform1f(d,e.u_saturation_factor),u_contrast_factor:new n.Uniform1f(d,e.u_contrast_factor),u_spin_weights:new n.Uniform3f(d,e.u_spin_weights),u_perspective_transform:new n.Uniform2f(d,e.u_perspective_transform)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new n.Uniform1i(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(d,e.u_is_size_feature_constant),u_size_t:new n.Uniform1f(d,e.u_size_t),u_size:new n.Uniform1f(d,e.u_size),u_camera_to_center_distance:new n.Uniform1f(d,e.u_camera_to_center_distance),u_rotate_symbol:new n.Uniform1i(d,e.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(d,e.u_aspect_ratio),u_fade_change:new n.Uniform1f(d,e.u_fade_change),u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(d,e.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(d,e.u_coord_matrix),u_is_text:new n.Uniform1i(d,e.u_is_text),u_pitch_with_map:new n.Uniform1i(d,e.u_pitch_with_map),u_texsize:new n.Uniform2f(d,e.u_texsize),u_tile_id:new n.Uniform3f(d,e.u_tile_id),u_zoom_transition:new n.Uniform1f(d,e.u_zoom_transition),u_inv_rot_matrix:new n.UniformMatrix4f(d,e.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(d,e.u_merc_center),u_camera_forward:new n.Uniform3f(d,e.u_camera_forward),u_tile_matrix:new n.UniformMatrix4f(d,e.u_tile_matrix),u_ecef_origin:new n.Uniform3f(d,e.u_ecef_origin),u_texture:new n.Uniform1i(d,e.u_texture)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new n.Uniform1i(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(d,e.u_is_size_feature_constant),u_size_t:new n.Uniform1f(d,e.u_size_t),u_size:new n.Uniform1f(d,e.u_size),u_camera_to_center_distance:new n.Uniform1f(d,e.u_camera_to_center_distance),u_rotate_symbol:new n.Uniform1i(d,e.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(d,e.u_aspect_ratio),u_fade_change:new n.Uniform1f(d,e.u_fade_change),u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(d,e.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(d,e.u_coord_matrix),u_is_text:new n.Uniform1i(d,e.u_is_text),u_pitch_with_map:new n.Uniform1i(d,e.u_pitch_with_map),u_texsize:new n.Uniform2f(d,e.u_texsize),u_texture:new n.Uniform1i(d,e.u_texture),u_gamma_scale:new n.Uniform1f(d,e.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(d,e.u_device_pixel_ratio),u_tile_id:new n.Uniform3f(d,e.u_tile_id),u_zoom_transition:new n.Uniform1f(d,e.u_zoom_transition),u_inv_rot_matrix:new n.UniformMatrix4f(d,e.u_inv_rot_matrix),u_merc_center:new n.Uniform2f(d,e.u_merc_center),u_camera_forward:new n.Uniform3f(d,e.u_camera_forward),u_tile_matrix:new n.UniformMatrix4f(d,e.u_tile_matrix),u_ecef_origin:new n.Uniform3f(d,e.u_ecef_origin),u_is_halo:new n.Uniform1i(d,e.u_is_halo)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new n.Uniform1i(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(d,e.u_is_size_feature_constant),u_size_t:new n.Uniform1f(d,e.u_size_t),u_size:new n.Uniform1f(d,e.u_size),u_camera_to_center_distance:new n.Uniform1f(d,e.u_camera_to_center_distance),u_rotate_symbol:new n.Uniform1i(d,e.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(d,e.u_aspect_ratio),u_fade_change:new n.Uniform1f(d,e.u_fade_change),u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(d,e.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(d,e.u_coord_matrix),u_is_text:new n.Uniform1i(d,e.u_is_text),u_pitch_with_map:new n.Uniform1i(d,e.u_pitch_with_map),u_texsize:new n.Uniform2f(d,e.u_texsize),u_texsize_icon:new n.Uniform2f(d,e.u_texsize_icon),u_texture:new n.Uniform1i(d,e.u_texture),u_texture_icon:new n.Uniform1i(d,e.u_texture_icon),u_gamma_scale:new n.Uniform1f(d,e.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(d,e.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(d,e.u_is_halo)}),background:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_opacity:new n.Uniform1f(d,e.u_opacity),u_color:new n.UniformColor(d,e.u_color)}),backgroundPattern:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_opacity:new n.Uniform1f(d,e.u_opacity),u_image:new n.Uniform1i(d,e.u_image),u_pattern_tl_a:new n.Uniform2f(d,e.u_pattern_tl_a),u_pattern_br_a:new n.Uniform2f(d,e.u_pattern_br_a),u_pattern_tl_b:new n.Uniform2f(d,e.u_pattern_tl_b),u_pattern_br_b:new n.Uniform2f(d,e.u_pattern_br_b),u_texsize:new n.Uniform2f(d,e.u_texsize),u_mix:new n.Uniform1f(d,e.u_mix),u_pattern_size_a:new n.Uniform2f(d,e.u_pattern_size_a),u_pattern_size_b:new n.Uniform2f(d,e.u_pattern_size_b),u_scale_a:new n.Uniform1f(d,e.u_scale_a),u_scale_b:new n.Uniform1f(d,e.u_scale_b),u_pixel_coord_upper:new n.Uniform2f(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new n.Uniform1f(d,e.u_tile_units_to_pixels)}),terrainRaster:hc,terrainDepth:hc,skybox:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_sun_direction:new n.Uniform3f(d,e.u_sun_direction),u_cubemap:new n.Uniform1i(d,e.u_cubemap),u_opacity:new n.Uniform1f(d,e.u_opacity),u_temporal_offset:new n.Uniform1f(d,e.u_temporal_offset)}),skyboxGradient:(d,e)=>({u_matrix:new n.UniformMatrix4f(d,e.u_matrix),u_color_ramp:new n.Uniform1i(d,e.u_color_ramp),u_center_direction:new n.Uniform3f(d,e.u_center_direction),u_radius:new n.Uniform1f(d,e.u_radius),u_opacity:new n.Uniform1f(d,e.u_opacity),u_temporal_offset:new n.Uniform1f(d,e.u_temporal_offset)}),skyboxCapture:(d,e)=>({u_matrix_3f:new n.UniformMatrix3f(d,e.u_matrix_3f),u_sun_direction:new n.Uniform3f(d,e.u_sun_direction),u_sun_intensity:new n.Uniform1f(d,e.u_sun_intensity),u_color_tint_r:new n.Uniform4f(d,e.u_color_tint_r),u_color_tint_m:new n.Uniform4f(d,e.u_color_tint_m),u_luminance:new n.Uniform1f(d,e.u_luminance)}),globeRaster:(d,e)=>({u_proj_matrix:new n.UniformMatrix4f(d,e.u_proj_matrix),u_globe_matrix:new n.UniformMatrix4f(d,e.u_globe_matrix),u_merc_matrix:new n.UniformMatrix4f(d,e.u_merc_matrix),u_zoom_transition:new n.Uniform1f(d,e.u_zoom_transition),u_merc_center:new n.Uniform2f(d,e.u_merc_center),u_image0:new n.Uniform1i(d,e.u_image0),u_grid_matrix:new n.UniformMatrix3f(d,e.u_grid_matrix)}),globeAtmosphere:(d,e)=>({u_frustum_tl:new n.Uniform3f(d,e.u_frustum_tl),u_frustum_tr:new n.Uniform3f(d,e.u_frustum_tr),u_frustum_br:new n.Uniform3f(d,e.u_frustum_br),u_frustum_bl:new n.Uniform3f(d,e.u_frustum_bl),u_globe_pos:new n.Uniform3f(d,e.u_globe_pos),u_globe_radius:new n.Uniform1f(d,e.u_globe_radius),u_opacity:new n.Uniform1f(d,e.u_opacity),u_fadeout_range:new n.Uniform1f(d,e.u_fadeout_range),u_start_color:new n.Uniform3f(d,e.u_start_color),u_end_color:new n.Uniform3f(d,e.u_end_color)})},fs;function mu(d,e,c,m,y,v,T){let M=d.context,k=M.gl,z=d.useProgram("collisionBox"),L=[],O=0,j=0;for(let nt=0;nt<m.length;nt++){let at=m[nt],tt=e.getTile(at),ct=tt.getBucket(c);if(!ct)continue;let bt=at.projMatrix;y[0]===0&&y[1]===0||(bt=d.translatePosMatrix(at.projMatrix,tt,y,v));let Ct=T?ct.textCollisionBox:ct.iconCollisionBox,zt=ct.collisionCircleArray;if(zt.length>0){let kt=n.create(),$t=bt;n.mul(kt,ct.placementInvProjMatrix,d.transform.glCoordMatrix),n.mul(kt,kt,ct.placementViewportMatrix),L.push({circleArray:zt,circleOffset:j,transform:$t,invTransform:kt}),O+=zt.length/4,j=O}Ct&&(d.terrain&&d.terrain.setupElevationDraw(tt,z),z.draw(M,k.LINES,n.DepthMode.disabled,n.StencilMode.disabled,d.colorModeForRenderPass(),n.CullFaceMode.disabled,Pp(bt,d.transform,tt),c.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,null,d.transform.zoom,null,Ct.collisionVertexBuffer,Ct.collisionVertexBufferExt))}if(!T||!L.length)return;let X=d.useProgram("collisionCircle"),$=new n.StructArrayLayout2f1f2i16;$.resize(4*O),$._trim();let U=0;for(let nt of L)for(let at=0;at<nt.circleArray.length/4;at++){let tt=4*at,ct=nt.circleArray[tt+0],bt=nt.circleArray[tt+1],Ct=nt.circleArray[tt+2],zt=nt.circleArray[tt+3];$.emplace(U++,ct,bt,Ct,zt,0),$.emplace(U++,ct,bt,Ct,zt,1),$.emplace(U++,ct,bt,Ct,zt,2),$.emplace(U++,ct,bt,Ct,zt,3)}(!fs||fs.length<2*O)&&(fs=function(nt){let at=2*nt,tt=new n.StructArrayLayout3ui6;tt.resize(at),tt._trim();for(let ct=0;ct<at;ct++){let bt=6*ct;tt.uint16[bt+0]=4*ct+0,tt.uint16[bt+1]=4*ct+1,tt.uint16[bt+2]=4*ct+2,tt.uint16[bt+3]=4*ct+2,tt.uint16[bt+4]=4*ct+3,tt.uint16[bt+5]=4*ct+0}return tt}(O));let st=M.createIndexBuffer(fs,!0),Y=M.createVertexBuffer($,n.collisionCircleLayout.members,!0);for(let nt of L){let at={u_matrix:nt.transform,u_inv_matrix:nt.invTransform,u_camera_to_center_distance:(it=d.transform).cameraToCenterDistance,u_viewport_size:[it.width,it.height]};X.draw(M,k.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,d.colorModeForRenderPass(),n.CullFaceMode.disabled,at,c.id,Y,st,n.SegmentVector.simpleSegment(0,2*nt.circleOffset,nt.circleArray.length,nt.circleArray.length/2),null,d.transform.zoom,null,null,null)}var it;Y.destroy(),st.destroy()}let vc=n.create();function jo(d,e,c,m,y,v){let{horizontalAlign:T,verticalAlign:M}=n.getAnchorAlignment(d),k=-(T-.5)*e,z=-(M-.5)*c,L=n.evaluateVariableOffset(d,m);return new n.pointGeometry((k/y+L[0])*v,(z/y+L[1])*v)}function Rp(d,e,c,m,y,v,T,M,k,z,L,O){let j=d.text.placedSymbolArray,X=d.text.dynamicLayoutVertexArray,$=d.icon.dynamicLayoutVertexArray,U={},st=M.projMatrix,Y=v.elevation,it=O.upVectorScale(M.canonical,v.center.lat,v.worldSize);X.clear();for(let nt=0;nt<j.length;nt++){let at=j.get(nt),tt=d.allowVerticalPlacement&&!at.placedOrientation,ct=at.hidden||!at.crossTileID||tt?null:m[at.crossTileID];if(ct){let bt=new n.pointGeometry(at.tileAnchorX,at.tileAnchorY),Ct=O.upVector(M.canonical,bt.x,bt.y),zt=Y?Y.getAtTileOffset(M,bt.x,bt.y):0,kt=wn([at.projectedAnchorX+zt*Ct[0]*it.metersToTile,at.projectedAnchorY+zt*Ct[1]*it.metersToTile,at.projectedAnchorZ+zt*Ct[2]*it.metersToTile],c?st:T),$t=ci(v.cameraToCenterDistance,kt.signedDistanceFromCamera),wt=y.evaluateSizeForFeature(d.textSizeData,z,at)*$t/n.ONE_EM;c&&(wt*=d.tilePixelRatio/k);let{width:qt,height:Nt,anchor:re,textOffset:Dt,textScale:ee}=ct,ue=jo(re,qt,Nt,Dt,ee,wt),ie=c?Hi(bt.add(ue),T,zt*it.metersToLabelSpace).point:kt.point.add(e?ue.rotate(-v.angle):ue),ne=d.allowVerticalPlacement&&at.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let fe=0;fe<at.numGlyphs;fe++)n.addDynamicAttributes(X,ie,ne);L&&at.associatedIconIndex>=0&&(U[at.associatedIconIndex]={shiftedAnchor:ie,angle:ne})}else Ai(at.numGlyphs,X)}if(L){$.clear();let nt=d.icon.placedSymbolArray;for(let at=0;at<nt.length;at++){let tt=nt.get(at);if(tt.hidden)Ai(tt.numGlyphs,$);else{let ct=U[at];if(ct)for(let bt=0;bt<tt.numGlyphs;bt++)n.addDynamicAttributes($,ct.shiftedAnchor,ct.angle);else Ai(tt.numGlyphs,$)}}d.icon.dynamicLayoutVertexBuffer.updateData($)}d.text.dynamicLayoutVertexBuffer.updateData(X)}function Bp(d,e,c){return c.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function bc(d,e,c,m,y,v,T,M,k,z,L,O){let j=d.context,X=j.gl,$=d.transform,U=M==="map",st=k==="map",Y=U&&c.layout.get("symbol-placement")!=="point",it=U&&!st&&!Y,nt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,at=!1,tt=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),ct=[n.mercatorXfromLng($.center.lng),n.mercatorYfromLat($.center.lat)],bt=c.layout.get("text-variable-anchor"),Ct=$.projection.name==="globe",zt=Ct?n.globeToMercatorTransition($.zoom):0,kt=[],$t=[];d.terrain&&st&&$t.push("PITCH_WITH_MAP_TERRAIN"),Ct&&$t.push("PROJECTION_GLOBE_VIEW");for(let wt of m){let qt=e.getTile(wt),Nt=qt.getBucket(c);if(!Nt||Nt.projection!==$.projection.name)continue;let re=y?Nt.text:Nt.icon;if(!re||Nt.fullyClipped||!re.segments.get().length)continue;let Dt=re.programConfigurations.get(c.id),ee=y||Nt.sdfIcons,ue=y?Nt.textSizeData:Nt.iconSizeData,ie=st||$.pitch!==0,ne=n.evaluateSizeForZoom(ue,$.zoom),fe,Se,ae,ge,Re=[0,0],hi=null;if(y){if(Se=qt.glyphAtlasTexture,ae=X.LINEAR,fe=qt.glyphAtlasTexture.size,Nt.iconsInText){Re=qt.imageAtlasTexture.size,hi=qt.imageAtlasTexture;let mn=ue.kind==="composite"||ue.kind==="camera";ge=ie||d.options.rotating||d.options.zooming||mn?X.LINEAR:X.NEAREST}}else{let mn=c.layout.get("icon-size").constantOr(0)!==1||Nt.iconsNeedLinear;Se=qt.imageAtlasTexture,ae=ee||d.options.rotating||d.options.zooming||mn||ie?X.LINEAR:X.NEAREST,fe=qt.imageAtlasTexture.size}let Ni=d.transform.calculatePixelsToTileUnitsMatrix(qt),ji=cs(wt.projMatrix,qt.tileID.canonical,st,U,d.transform,Ni),pn=d.terrain&&st&&Y?n.invert(n.create(),ji):vc,qn=Us(wt.projMatrix,qt.tileID.canonical,st,U,d.transform,Ni),pr=bt&&Nt.hasTextData(),Br=c.layout.get("icon-text-fit")!=="none"&&pr&&Nt.hasIconData();if(Y){let mn=$.elevation,_s=mn?mn.getAtTileOffsetFunc(wt,$.center.lat,$.worldSize,$.projection):$u=>[0,0,0];Do(Nt,wt.projMatrix,d,y,ji,qn,st,z,_s,wt)}let fr=Y||y&&bt||Br,pi=d.translatePosMatrix(wt.projMatrix,qt,v,T),yi=fr?vc:ji,Ue=d.translatePosMatrix(qn,qt,v,T,!0),Ti=$.projection.createInversionMatrix($,wt.canonical),fn=fr?$t.concat(["PROJECTED_POS_ON_VIEWPORT"]):$t,ui=ee&&c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0,En;En=ee?Nt.iconsInText?Xs(ue.kind,ne,it,st,d,pi,yi,Ue,fe,Re,wt,zt,ct,Ti):ps(ue.kind,ne,it,st,d,pi,yi,Ue,y,fe,!0,wt,zt,ct,Ti):yc(ue.kind,ne,it,st,d,pi,yi,Ue,y,fe,wt,zt,ct,Ti);let sa={program:d.useProgram(Bp(ee,y,Nt),Dt,fn),buffers:re,uniformValues:En,atlasTexture:Se,atlasTextureIcon:hi,atlasInterpolation:ae,atlasInterpolationIcon:ge,isSDF:ee,hasHalo:ui,tile:qt,labelPlaneMatrixInv:pn};if(nt&&Nt.canOverlap){at=!0;let mn=re.segments.get();for(let _s of mn)kt.push({segments:new n.SegmentVector([_s]),sortKey:_s.sortKey,state:sa})}else kt.push({segments:re.segments,sortKey:0,state:sa})}at&&kt.sort((wt,qt)=>wt.sortKey-qt.sortKey);for(let wt of kt){let qt=wt.state;if(d.terrain&&d.terrain.setupElevationDraw(qt.tile,qt.program,{useDepthForOcclusion:!Ct,labelPlaneMatrixInv:qt.labelPlaneMatrixInv}),j.activeTexture.set(X.TEXTURE0),qt.atlasTexture.bind(qt.atlasInterpolation,X.CLAMP_TO_EDGE),qt.atlasTextureIcon&&(j.activeTexture.set(X.TEXTURE1),qt.atlasTextureIcon&&qt.atlasTextureIcon.bind(qt.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),qt.isSDF){let Nt=qt.uniformValues;qt.hasHalo&&(Nt.u_is_halo=1,_u(qt.buffers,wt.segments,c,d,qt.program,tt,L,O,Nt)),Nt.u_is_halo=0}_u(qt.buffers,wt.segments,c,d,qt.program,tt,L,O,qt.uniformValues)}}function _u(d,e,c,m,y,v,T,M,k){let z=m.context;y.draw(z,z.gl.TRIANGLES,v,T,M,n.CullFaceMode.disabled,k,c.id,d.layoutVertexBuffer,d.indexBuffer,e,c.paint,m.transform.zoom,d.programConfigurations.get(c.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Qa(d,e,c,m,y,v,T){let M=d.context.gl,k=c.paint.get("fill-pattern"),z=k&&k.constantOr(1),L=c.getCrossfadeParameters(),O,j,X,$,U;T?(j=z&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=M.LINES):(j=z?"fillPattern":"fill",O=M.TRIANGLES);for(let st of m){let Y=e.getTile(st);if(z&&!Y.patternsLoaded())continue;let it=Y.getBucket(c);if(!it)continue;d.prepareDrawTile();let nt=it.programConfigurations.get(c.id),at=d.useProgram(j,nt);z&&(d.context.activeTexture.set(M.TEXTURE0),Y.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),nt.updatePaintBuffers(L));let tt=k.constantOr(null);if(tt&&Y.imageAtlas){let bt=Y.imageAtlas,Ct=bt.patternPositions[tt.to.toString()],zt=bt.patternPositions[tt.from.toString()];Ct&&zt&&nt.setConstantPatternPositions(Ct,zt)}let ct=d.translatePosMatrix(st.projMatrix,Y,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){$=it.indexBuffer2,U=it.segments2;let bt=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];X=j==="fillOutlinePattern"&&z?hu(ct,d,L,Y,bt):Ka(ct,bt)}else $=it.indexBuffer,U=it.segments,X=z?Ya(ct,d,L,Y):Ha(ct);d.prepareDrawProgram(d.context,at,st.toUnwrapped()),at.draw(d.context,O,y,d.stencilModeForClipping(st),v,n.CullFaceMode.disabled,X,c.id,it.layoutVertexBuffer,$,U,c.paint,d.transform.zoom,nt)}}function Hs(d,e,c,m,y,v,T){let M=d.context,k=M.gl,z=d.transform,L=c.paint.get("fill-extrusion-pattern"),O=L.constantOr(1),j=c.getCrossfadeParameters(),X=c.paint.get("fill-extrusion-opacity"),$=function(nt){if(nt.projection.name!=="globe")return 0;let at=Math.PI/32,tt=Math.tan(at),ct=n.earthRadius;return ct*Math.sqrt(1+2*tt*tt)-ct}(z),U=z.projection.name==="globe",st=U?n.globeToMercatorTransition(z.zoom):0,Y=[n.mercatorXfromLng(z.center.lng),n.mercatorYfromLat(z.center.lat)],it=[];U&&it.push("PROJECTION_GLOBE_VIEW");for(let nt of m){let at=e.getTile(nt),tt=at.getBucket(c);if(!tt||tt.projection!==z.projection.name)continue;let ct=tt.programConfigurations.get(c.id),bt=d.useProgram(O?"fillExtrusionPattern":"fillExtrusion",ct,it);if(d.terrain){let qt=d.terrain;if(d.style.terrainSetForDrapingOnly())qt.setupElevationDraw(at,bt,{useMeterToDem:!0});else{if(!tt.enableTerrain)continue;if(qt.setupElevationDraw(at,bt,{useMeterToDem:!0}),Go(M,e,nt,tt,c,qt),!tt.centroidVertexBuffer){let Nt=bt.attributes.a_centroid_pos;Nt!==void 0&&k.vertexAttrib2f(Nt,0,0)}}}O&&(d.context.activeTexture.set(k.TEXTURE0),at.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ct.updatePaintBuffers(j));let Ct=L.constantOr(null);if(Ct&&at.imageAtlas){let qt=at.imageAtlas,Nt=qt.patternPositions[Ct.to.toString()],re=qt.patternPositions[Ct.from.toString()];Nt&&re&&ct.setConstantPatternPositions(Nt,re)}let zt=d.translatePosMatrix(nt.projMatrix,at,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),kt=z.projection.createInversionMatrix(z,nt.canonical),$t=c.paint.get("fill-extrusion-vertical-gradient"),wt=O?Xa(zt,d,$t,X,nt,j,at,$,st,Y,kt):Wa(zt,d,$t,X,nt,$,st,Y,kt);d.prepareDrawProgram(M,bt,nt.toUnwrapped()),bt.draw(M,M.gl.TRIANGLES,y,v,T,n.CullFaceMode.backCCW,wt,c.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,c.paint,d.transform.zoom,ct,d.terrain?tt.centroidVertexBuffer:null,U?tt.layoutVertexExtBuffer:null)}}function Go(d,e,c,m,y,v){let T=[Y=>{let it=Y.canonical.x-1,nt=Y.wrap;return it<0&&(it=(1<<Y.canonical.z)-1,nt--),new n.OverscaledTileID(Y.overscaledZ,nt,Y.canonical.z,it,Y.canonical.y)},Y=>{let it=Y.canonical.x+1,nt=Y.wrap;return it===1<<Y.canonical.z&&(it=0,nt++),new n.OverscaledTileID(Y.overscaledZ,nt,Y.canonical.z,it,Y.canonical.y)},Y=>new n.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(Y.canonical.y===0?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new n.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],M=Y=>{let it=e.getSource().minzoom,nt=tt=>{let ct=e.getTileByID(tt);if(ct&&ct.hasData())return ct.getBucket(y)},at=[0,-1,1];for(let tt of at){if(Y.overscaledZ+tt<it)continue;let ct=nt(Y.calculateScaledKey(Y.overscaledZ+tt));if(ct)return ct}},k=[0,0,0],z=(Y,it)=>(k[0]=Math.min(Y.min.y,it.min.y),k[1]=Math.max(Y.max.y,it.max.y),k[2]=n.EXTENT-it.min.x>Y.max.x?it.min.x-n.EXTENT:Y.max.x,k),L=(Y,it)=>(k[0]=Math.min(Y.min.x,it.min.x),k[1]=Math.max(Y.max.x,it.max.x),k[2]=n.EXTENT-it.min.y>Y.max.y?it.min.y-n.EXTENT:Y.max.y,k),O=[(Y,it)=>z(Y,it),(Y,it)=>z(it,Y),(Y,it)=>L(Y,it),(Y,it)=>L(it,Y)],j=new n.pointGeometry(0,0),X,$,U,st=(Y,it,nt,at,tt)=>{let ct=[[at?nt:Y,at?Y:nt,0],[at?nt:it,at?it:nt,0]],bt=tt<0?n.EXTENT+tt:tt,Ct=[at?bt:(Y+it)/2,at?(Y+it)/2:bt,0];return nt===0&&tt<0||nt!==0&&tt>0?v.getForTilePoints(U,[Ct],!0,$):ct.push(Ct),v.getForTilePoints(c,ct,!0,X),Math.max(ct[0][2],ct[1][2],Ct[2])/v.exaggeration()};for(let Y=0;Y<4;Y++){let it=(Y<2?1:5)-Y,nt=m.borders[Y];if(nt.length===0)continue;let at=U=T[Y](c),tt=M(at);if(!(tt&&tt instanceof n.FillExtrusionBucket&&tt.enableTerrain)||m.borderDoneWithNeighborZ[Y]===tt.canonical.z&&tt.borderDoneWithNeighborZ[it]===m.canonical.z||($=v.findDEMTileFor(at),!$||!$.dem))continue;if(!X){let zt=v.findDEMTileFor(c);if(!zt||!zt.dem)return;X=zt}let ct=tt.borders[it],bt=0,Ct=tt.borderDoneWithNeighborZ[it]!==m.canonical.z;if(m.canonical.z===tt.canonical.z){for(let zt=0;zt<nt.length;zt++){let kt=m.featuresOnBorder[nt[zt]],$t=kt.borders[Y],wt;for(;bt<ct.length&&(wt=tt.featuresOnBorder[ct[bt]],!(wt.borders[it][1]>$t[0]+3));)Ct&&tt.encodeCentroid(void 0,wt,!1),bt++;if(wt&&bt<ct.length){let qt=bt,Nt=0;for(;!(wt.borders[it][0]>$t[1]-3)&&(Nt++,++bt!==ct.length);)wt=tt.featuresOnBorder[ct[bt]];if(wt=tt.featuresOnBorder[ct[qt]],kt.intersectsCount()>1||wt.intersectsCount()>1||Nt!==1){Nt!==1&&(bt=qt),m.encodeCentroid(void 0,kt,!1),Ct&&tt.encodeCentroid(void 0,wt,!1);continue}let re=O[Y](kt,wt),Dt=Y%2?n.EXTENT-1:0;j.x=st(re[0],Math.min(n.EXTENT-1,re[1]),Dt,Y<2,re[2]),j.y=0,m.encodeCentroid(j,kt,!1),Ct&&tt.encodeCentroid(j,wt,!1)}else m.encodeCentroid(void 0,kt,!1)}m.borderDoneWithNeighborZ[Y]=tt.canonical.z,m.needsCentroidUpdate=!0,Ct&&(tt.borderDoneWithNeighborZ[it]=m.canonical.z,tt.needsCentroidUpdate=!0)}else{for(let zt of nt)m.encodeCentroid(void 0,m.featuresOnBorder[zt],!1);if(Ct){for(let zt of ct)tt.encodeCentroid(void 0,tt.featuresOnBorder[zt],!1);tt.borderDoneWithNeighborZ[it]=m.canonical.z,tt.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[Y]=tt.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(d)}let wc=new n.Color(1,0,0,1),Tc=new n.Color(0,1,0,1),gu=new n.Color(0,0,1,1),tl=new n.Color(1,0,1,1),el=new n.Color(0,1,1,1);function Jt(d,e,c,m){$o(d,0,e+c/2,d.transform.width,c,m)}function Tn(d,e,c,m){$o(d,e-c/2,0,c,d.transform.height,m)}function $o(d,e,c,m,y,v){let T=d.context,M=T.gl;M.enable(M.SCISSOR_TEST),M.scissor(e*n.exported.devicePixelRatio,c*n.exported.devicePixelRatio,m*n.exported.devicePixelRatio,y*n.exported.devicePixelRatio),T.clear({color:v}),M.disable(M.SCISSOR_TEST)}function yu(d,e,c){let m=d.context,y=m.gl,v=d.transform.projection.name==="globe",T=c.projMatrix,M=d.useProgram("debug",null,v?["PROJECTION_GLOBE_VIEW"]:null),k=e.getTileByID(c.key);d.terrain&&d.terrain.setupElevationDraw(k,M);let z=n.DepthMode.disabled,L=n.StencilMode.disabled,O=d.colorModeForRenderPass(),j="$debug";m.activeTexture.set(y.TEXTURE0),d.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),v?k._makeGlobeTileDebugBuffers(d.context,d.transform.projection):k._makeDebugTileBoundsBuffers(d.context,d.transform.projection);let X=k._tileDebugBuffer||d.debugBuffer,$=k._tileDebugIndexBuffer||d.debugIndexBuffer,U=k._tileDebugSegments||d.debugSegments;M.draw(m,y.LINE_STRIP,z,L,O,n.CullFaceMode.disabled,du(T,n.Color.red),j,X,$,U,null,null,null,k._globeTileDebugBorderBuffer);let st=k.latestRawTileData,Y=Math.floor((st&&st.byteLength||0)/1024),it=e.getTile(c).tileSize,nt=512/Math.min(it,512)*(c.overscaledZ/d.transform.zoom)*.5,at=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(at+=` => ${c.overscaledZ}`),function(Ct,zt){Ct.initDebugOverlayCanvas();let kt=Ct.debugOverlayCanvas,$t=Ct.context.gl,wt=Ct.debugOverlayCanvas.getContext("2d");wt.clearRect(0,0,kt.width,kt.height),wt.shadowColor="white",wt.shadowBlur=2,wt.lineWidth=1.5,wt.strokeStyle="white",wt.textBaseline="top",wt.font="bold 36px Open Sans, sans-serif",wt.fillText(zt,5,5),wt.strokeText(zt,5,5),Ct.debugOverlayTexture.update(kt),Ct.debugOverlayTexture.bind($t.LINEAR,$t.CLAMP_TO_EDGE)}(d,`${at} ${Y}kb`);let tt=k._tileDebugTextBuffer||d.debugBuffer,ct=k._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,bt=k._tileDebugTextSegments||d.debugSegments;M.draw(m,y.TRIANGLES,z,L,n.ColorMode.alphaBlended,n.CullFaceMode.disabled,du(T,n.Color.transparent,nt),j,tt,ct,bt,null,null,null,k._globeTileDebugTextBuffer)}let xu=n.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ys}=xu;function hr(d,e,c,m){d.emplaceBack(e,c,m)}class qo{constructor(e){this.vertexArray=new n.StructArrayLayout3f12,this.indices=new n.StructArrayLayout3ui6,hr(this.vertexArray,-1,-1,1),hr(this.vertexArray,1,-1,1),hr(this.vertexArray,-1,1,1),hr(this.vertexArray,1,1,1),hr(this.vertexArray,-1,-1,-1),hr(this.vertexArray,1,-1,-1),hr(this.vertexArray,-1,1,-1),hr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Ys),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=n.SegmentVector.simpleSegment(0,0,36,12)}}function Pr(d,e,c,m,y,v){let T=d.gl,M=e.paint.get("sky-atmosphere-color"),k=e.paint.get("sky-atmosphere-halo-color"),z=e.paint.get("sky-atmosphere-sun-intensity"),L=((O,j,X,$,U)=>({u_matrix_3f:O,u_sun_direction:j,u_sun_intensity:X,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(n.fromMat4(n.create$1(),m),y,z,M,k);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+v,e.skyboxTexture,0),c.draw(d,T.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.frontCW,L,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}function zr(d,e){return n.transformMat4(d,d,e)}let Sc={symbol:function(d,e,c,m,y){if(d.renderPass!=="translucent")return;let v=n.StencilMode.disabled,T=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(M,k,z,L,O,j,X){let $=k.transform,U=O==="map",st=j==="map";for(let Y of M){let it=L.getTile(Y),nt=it.getBucket(z);if(!nt||nt.projection!==$.projection.name||!nt.text||!nt.text.segments.get().length)continue;let at=n.evaluateSizeForZoom(nt.textSizeData,$.zoom),tt=k.transform.calculatePixelsToTileUnitsMatrix(it),ct=cs(Y.projMatrix,it.tileID.canonical,st,U,k.transform,tt),bt=z.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(at){let Ct=Math.pow(2,$.zoom-it.tileID.overscaledZ);Rp(nt,U,st,X,n.symbolSize,$,ct,Y,Ct,at,bt,$.projection)}}}(m,d,c,e,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),c.paint.get("icon-opacity").constantOr(1)!==0&&bc(d,e,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),v,T),c.paint.get("text-opacity").constantOr(1)!==0&&bc(d,e,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),v,T),e.map.showCollisionBoxes&&(mu(d,e,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),mu(d,e,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,e,c,m){if(d.renderPass!=="translucent")return;let y=c.paint.get("circle-opacity"),v=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),M=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(v.constantOr(1)===0||T.constantOr(1)===0))return;let k=d.context,z=k.gl,L=d.transform,O=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),j=n.StencilMode.disabled,X=d.colorModeForRenderPass(),$=L.projection.name==="globe",U=[n.mercatorXfromLng(L.center.lng),n.mercatorYfromLat(L.center.lat)],st=[];for(let it=0;it<m.length;it++){let nt=m[it],at=e.getTile(nt),tt=at.getBucket(c);if(!tt)continue;let ct=tt.programConfigurations.get(c.id),bt=kp(c);$&&bt.push("PROJECTION_GLOBE_VIEW");let Ct=d.useProgram("circle",ct,bt),zt=tt.layoutVertexBuffer,kt=tt.globeExtVertexBuffer,$t=tt.indexBuffer,wt=L.projection.createInversionMatrix(L,nt.canonical),qt={programConfiguration:ct,program:Ct,layoutVertexBuffer:zt,globeExtVertexBuffer:kt,indexBuffer:$t,uniformValues:Ws(d,nt,at,wt,U,c),tile:at};if(M){let Nt=tt.segments.get();for(let re of Nt)st.push({segments:new n.SegmentVector([re]),sortKey:re.sortKey,state:qt})}else st.push({segments:tt.segments,sortKey:0,state:qt})}M&&st.sort((it,nt)=>it.sortKey-nt.sortKey);let Y={useDepthForOcclusion:!$};for(let it of st){let{programConfiguration:nt,program:at,layoutVertexBuffer:tt,globeExtVertexBuffer:ct,indexBuffer:bt,uniformValues:Ct,tile:zt}=it.state,kt=it.segments;d.terrain&&d.terrain.setupElevationDraw(zt,at,Y),d.prepareDrawProgram(k,at,zt.tileID.toUnwrapped()),at.draw(k,z.TRIANGLES,O,j,X,n.CullFaceMode.disabled,Ct,c.id,tt,bt,kt,c.paint,L.zoom,nt,$?ct:null)}},heatmap:function(d,e,c,m){if(c.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){let y=d.context,v=y.gl,T=n.StencilMode.disabled,M=new n.ColorMode([v.ONE,v.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(j,X,$){let U=j.gl;j.activeTexture.set(U.TEXTURE1),j.viewport.set([0,0,X.width/4,X.height/4]);let st=$.heatmapFbo;if(st)U.bindTexture(U.TEXTURE_2D,st.colorAttachment.get()),j.bindFramebuffer.set(st.framebuffer);else{let Y=U.createTexture();U.bindTexture(U.TEXTURE_2D,Y),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),st=$.heatmapFbo=j.createFramebuffer(X.width/4,X.height/4,!1),function(it,nt,at,tt){let ct=it.gl;ct.texImage2D(ct.TEXTURE_2D,0,ct.RGBA,nt.width/4,nt.height/4,0,ct.RGBA,it.extRenderToTextureHalfFloat?it.extTextureHalfFloat.HALF_FLOAT_OES:ct.UNSIGNED_BYTE,null),tt.colorAttachment.set(at)}(j,X,Y,st)}})(y,d,c),y.clear({color:n.Color.transparent});let k=d.transform,z=k.projection.name==="globe",L=z?["PROJECTION_GLOBE_VIEW"]:null,O=[n.mercatorXfromLng(k.center.lng),n.mercatorYfromLat(k.center.lat)];for(let j=0;j<m.length;j++){let X=m[j];if(e.hasRenderableParent(X))continue;let $=e.getTile(X),U=$.getBucket(c);if(!U)continue;let st=U.programConfigurations.get(c.id),Y=d.useProgram("heatmap",st,L),{zoom:it}=d.transform;d.terrain&&d.terrain.setupElevationDraw($,Y),d.prepareDrawProgram(y,Y,X.toUnwrapped());let nt=k.projection.createInversionMatrix(k,X.canonical);Y.draw(y,v.TRIANGLES,n.DepthMode.disabled,T,M,n.CullFaceMode.disabled,Dp(d,X,$,nt,O,it,c.paint.get("heatmap-intensity")),c.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,c.paint,d.transform.zoom,st,z?U.globeExtVertexBuffer:null)}y.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(y,v){let T=y.context,M=T.gl,k=v.heatmapFbo;if(!k)return;T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,k.colorAttachment.get()),T.activeTexture.set(M.TEXTURE1);let z=v.colorRampTexture;z||(z=v.colorRampTexture=new n.Texture(T,v.colorRamp,M.RGBA)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(T,M.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,y.colorModeForRenderPass(),n.CullFaceMode.disabled,((L,O,j,X)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,v),v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(d,c))},line:function(d,e,c,m){if(d.renderPass!=="translucent")return;let y=c.paint.get("line-opacity"),v=c.paint.get("line-width");if(y.constantOr(1)===0||v.constantOr(1)===0)return;let T=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),M=d.colorModeForRenderPass(),k=d.terrain&&d.terrain.renderingToTexture?1:n.exported.devicePixelRatio,z=c.paint.get("line-dasharray"),L=z.constantOr(1),O=c.layout.get("line-cap"),j=c.paint.get("line-pattern"),X=j.constantOr(1),$=c.paint.get("line-gradient"),U=c.getCrossfadeParameters(),st=X?"linePattern":"line",Y=d.context,it=Y.gl,nt=(tt=>{let ct=[];_c(tt)&&ct.push("RENDER_LINE_DASH"),tt.paint.get("line-gradient")&&ct.push("RENDER_LINE_GRADIENT");let bt=tt.paint.get("line-pattern").constantOr(1),Ct=tt.paint.get("line-opacity").constantOr(1)!==1;return!bt&&Ct&&ct.push("RENDER_LINE_ALPHA_DISCARD"),ct})(c),at=nt.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(at=!1);for(let tt of m){let ct=e.getTile(tt);if(X&&!ct.patternsLoaded())continue;let bt=ct.getBucket(c);if(!bt)continue;d.prepareDrawTile();let Ct=bt.programConfigurations.get(c.id),zt=d.useProgram(st,Ct,nt),kt=j.constantOr(null);if(kt&&ct.imageAtlas){let Dt=ct.imageAtlas,ee=Dt.patternPositions[kt.to.toString()],ue=Dt.patternPositions[kt.from.toString()];ee&&ue&&Ct.setConstantPatternPositions(ee,ue)}let $t=z.constantOr(null),wt=O.constantOr(null);if(!X&&$t&&wt&&ct.lineAtlas){let Dt=ct.lineAtlas,ee=Dt.getDash($t.to,wt),ue=Dt.getDash($t.from,wt);ee&&ue&&Ct.setConstantPatternPositions(ee,ue)}let qt=d.terrain?tt.projMatrix:null,Nt=X?mc(d,ct,c,U,qt,k):Lp(d,ct,c,U,qt,bt.lineClipsArray.length,k);if($){let Dt=bt.gradients[c.id],ee=Dt.texture;if(c.gradientVersion!==Dt.version){let ue=256;if(c.stepInterpolant){let ie=e.getSource().maxzoom,ne=tt.canonical.z===ie?Math.ceil(1<<d.transform.maxZoom-tt.canonical.z):1;ue=n.clamp(n.nextPowerOfTwo(bt.maxLineLength/n.EXTENT*1024*ne),256,Y.maxTextureSize)}Dt.gradient=n.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ue,image:Dt.gradient||void 0,clips:bt.lineClipsArray}),Dt.texture?Dt.texture.update(Dt.gradient):Dt.texture=new n.Texture(Y,Dt.gradient,it.RGBA),Dt.version=c.gradientVersion,ee=Dt.texture}Y.activeTexture.set(it.TEXTURE1),ee.bind(c.stepInterpolant?it.NEAREST:it.LINEAR,it.CLAMP_TO_EDGE)}L&&(Y.activeTexture.set(it.TEXTURE0),ct.lineAtlasTexture.bind(it.LINEAR,it.REPEAT),Ct.updatePaintBuffers(U)),X&&(Y.activeTexture.set(it.TEXTURE0),ct.imageAtlasTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE),Ct.updatePaintBuffers(U)),d.prepareDrawProgram(Y,zt,tt.toUnwrapped());let re=Dt=>{zt.draw(Y,it.TRIANGLES,T,Dt,M,n.CullFaceMode.disabled,Nt,c.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,c.paint,d.transform.zoom,Ct,bt.layoutVertexBuffer2)};if(at){let Dt=d.stencilModeForClipping(tt).ref;Dt===0&&d.terrain&&Y.clear({stencil:0});let ee={func:it.EQUAL,mask:255};Nt.u_alpha_discard_threshold=.8,re(new n.StencilMode(ee,Dt,255,it.KEEP,it.KEEP,it.INVERT)),Nt.u_alpha_discard_threshold=0,re(new n.StencilMode(ee,Dt,255,it.KEEP,it.KEEP,it.KEEP))}else re(d.stencilModeForClipping(tt))}at&&(d.resetStencilClippingMasks(),d.terrain&&Y.clear({stencil:0}))},fill:function(d,e,c,m){let y=c.paint.get("fill-color"),v=c.paint.get("fill-opacity");if(v.constantOr(1)===0)return;let T=d.colorModeForRenderPass(),M=c.paint.get("fill-pattern"),k=d.opaquePassEnabledForLayer()&&!M.constantOr(1)&&y.constantOr(n.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===k){let z=d.depthModeForSublayer(1,d.renderPass==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly);Qa(d,e,c,m,z,T,!1)}if(d.renderPass==="translucent"&&c.paint.get("fill-antialias")){let z=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,n.DepthMode.ReadOnly);Qa(d,e,c,m,z,T,!0)}},"fill-extrusion":function(d,e,c,m){let y=c.paint.get("fill-extrusion-opacity");if(y!==0&&d.renderPass==="translucent"){let v=new n.DepthMode(d.context.gl.LEQUAL,n.DepthMode.ReadWrite,d.depthRangeFor3D);if(y!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))Hs(d,e,c,m,v,n.StencilMode.disabled,n.ColorMode.disabled),Hs(d,e,c,m,v,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{let T=d.colorModeForRenderPass();Hs(d,e,c,m,v,n.StencilMode.disabled,T)}}},hillshade:function(d,e,c,m){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;let y=d.context,v=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),T=d.colorModeForRenderPass(),M=d.terrain&&d.terrain.renderingToTexture,[k,z]=d.renderPass!=="translucent"||M?[{},m]:d.stencilConfigForOverlap(m);for(let L of z){let O=e.getTile(L);if(O.needsHillshadePrepare&&d.renderPass==="offscreen")cc(d,O,c,v,n.StencilMode.disabled,T);else if(d.renderPass==="translucent"){let j=M&&d.terrain?d.terrain.stencilModeForRTTOverlap(L):k[L.overscaledZ];au(d,L,O,c,v,j,T)}}y.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,e,c,m,y,v){if(d.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!m.length)return;let T=d.context,M=T.gl,k=e.getSource(),z=d.useProgram("raster"),L=d.colorModeForRenderPass(),O=d.terrain&&d.terrain.renderingToTexture,[j,X]=k instanceof ht||O?[{},m]:d.stencilConfigForOverlap(m),$=X[X.length-1].overscaledZ,U=!d.options.moving;for(let st of X){let Y=O?n.DepthMode.disabled:d.depthModeForSublayer(st.overscaledZ-$,c.paint.get("raster-opacity")===1?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly,M.LESS),it=st.toUnwrapped(),nt=e.getTile(st);if(O&&(!nt||!nt.hasData()))continue;let at=O?st.projMatrix:d.transform.calculateProjMatrix(it,U),tt=d.terrain&&O?d.terrain.stencilModeForRTTOverlap(st):j[st.overscaledZ],ct=v?0:c.paint.get("raster-fade-duration");nt.registerFadeDuration(ct);let bt=e.findLoadedParent(st,0),Ct=dc(nt,bt,e,d.transform,ct),zt,kt;d.terrain&&d.terrain.prepareDrawTile();let $t=c.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;T.activeTexture.set(M.TEXTURE0),nt.texture.bind($t,M.CLAMP_TO_EDGE),T.activeTexture.set(M.TEXTURE1),bt?(bt.texture.bind($t,M.CLAMP_TO_EDGE),zt=Math.pow(2,bt.tileID.overscaledZ-nt.tileID.overscaledZ),kt=[nt.tileID.canonical.x*zt%1,nt.tileID.canonical.y*zt%1]):nt.texture.bind($t,M.CLAMP_TO_EDGE);let wt=pu(at,kt||[0,0],zt||1,Ct,c,k instanceof ht?k.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(T,z,it),k instanceof ht)k.boundsBuffer&&k.boundsSegments&&z.draw(T,M.TRIANGLES,Y,n.StencilMode.disabled,L,n.CullFaceMode.disabled,wt,c.id,k.boundsBuffer,d.quadTriangleIndexBuffer,k.boundsSegments);else{let{tileBoundsBuffer:qt,tileBoundsIndexBuffer:Nt,tileBoundsSegments:re}=d.getTileBoundsBuffers(nt);z.draw(T,M.TRIANGLES,Y,tt,L,n.CullFaceMode.disabled,wt,c.id,qt,Nt,re)}}d.resetStencilClippingMasks()},background:function(d,e,c,m){let y=c.paint.get("background-color"),v=c.paint.get("background-opacity");if(v===0)return;let T=d.context,M=T.gl,k=d.transform,z=k.tileSize,L=c.paint.get("background-pattern");if(d.isPatternMissing(L))return;let O=!L&&y.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==O)return;let j=n.StencilMode.disabled,X=d.depthModeForSublayer(0,O==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly),$=d.colorModeForRenderPass(),U=d.useProgram(L?"backgroundPattern":"background"),st,Y=m;Y||(st=d.getBackgroundTiles(),Y=Object.values(st).map(nt=>nt.tileID)),L&&(T.activeTexture.set(M.TEXTURE0),d.imageManager.bind(d.context));let it=c.getCrossfadeParameters();for(let nt of Y){let at=nt.toUnwrapped(),tt=m?nt.projMatrix:d.transform.calculateProjMatrix(at);d.prepareDrawTile();let ct=e?e.getTile(nt):st?st[nt.key]:new n.Tile(nt,z,k.zoom,d),bt=L?xc(tt,v,d,L,{tileID:nt,tileSize:z},it):fu(tt,v,y);d.prepareDrawProgram(T,U,at);let{tileBoundsBuffer:Ct,tileBoundsIndexBuffer:zt,tileBoundsSegments:kt}=d.getTileBoundsBuffers(ct);U.draw(T,M.TRIANGLES,X,j,$,n.CullFaceMode.disabled,bt,c.id,Ct,zt,kt)}},sky:function(d,e,c){let m=d.transform,y=m.projection.name==="mercator"||m.projection.name==="globe"?1:n.smoothstep(7,8,m.zoom),v=c.paint.get("sky-opacity")*y;if(v===0)return;let T=d.context,M=c.paint.get("sky-type"),k=new n.DepthMode(T.gl.LEQUAL,n.DepthMode.ReadOnly,[0,1]),z=d.frameCounter/1e3%1;M==="atmosphere"?d.renderPass==="offscreen"?c.needsSkyboxCapture(d)&&(function(L,O,j,X){let $=L.context,U=$.gl,st=O.skyboxFbo;if(!st){st=O.skyboxFbo=$.createFramebuffer(32,32,!1),O.skyboxGeometry=new qo($),O.skyboxTexture=$.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,O.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let at=0;at<6;++at)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(st.framebuffer),$.viewport.set([0,0,32,32]);let Y=O.getCenter(L,!0),it=L.useProgram("skyboxCapture"),nt=new Float64Array(16);n.identity(nt),n.rotateY(nt,nt,.5*-Math.PI),Pr($,O,it,nt,Y,0),n.identity(nt),n.rotateY(nt,nt,.5*Math.PI),Pr($,O,it,nt,Y,1),n.identity(nt),n.rotateX(nt,nt,.5*-Math.PI),Pr($,O,it,nt,Y,2),n.identity(nt),n.rotateX(nt,nt,.5*Math.PI),Pr($,O,it,nt,Y,3),n.identity(nt),Pr($,O,it,nt,Y,4),n.identity(nt),n.rotateY(nt,nt,Math.PI),Pr($,O,it,nt,Y,5),$.viewport.set([0,0,L.width,L.height])}(d,c),c.markSkyboxValid(d)):d.renderPass==="sky"&&function(L,O,j,X,$){let U=L.context,st=U.gl,Y=L.transform,it=L.useProgram("skybox");U.activeTexture.set(st.TEXTURE0),st.bindTexture(st.TEXTURE_CUBE_MAP,O.skyboxTexture);let nt=((at,tt,ct,bt,Ct)=>({u_matrix:at,u_sun_direction:tt,u_cubemap:0,u_opacity:bt,u_temporal_offset:Ct}))(Y.skyboxMatrix,O.getCenter(L,!1),0,X,$);L.prepareDrawProgram(U,it),it.draw(U,st.TRIANGLES,j,n.StencilMode.disabled,L.colorModeForRenderPass(),n.CullFaceMode.backCW,nt,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,c,k,v,z):M==="gradient"&&d.renderPass==="sky"&&function(L,O,j,X,$){let U=L.context,st=U.gl,Y=L.transform,it=L.useProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new qo(U)),U.activeTexture.set(st.TEXTURE0);let nt=O.colorRampTexture;nt||(nt=O.colorRampTexture=new n.Texture(U,O.colorRamp,st.RGBA)),nt.bind(st.LINEAR,st.CLAMP_TO_EDGE);let at=((tt,ct,bt,Ct,zt)=>({u_matrix:tt,u_color_ramp:0,u_center_direction:ct,u_radius:n.degToRad(bt),u_opacity:Ct,u_temporal_offset:zt}))(Y.skyboxMatrix,O.getCenter(L,!1),O.paint.get("sky-gradient-radius"),X,$);L.prepareDrawProgram(U,it),it.draw(U,st.TRIANGLES,j,n.StencilMode.disabled,L.colorModeForRenderPass(),n.CullFaceMode.backCW,at,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,c,k,v,z)},debug:function(d,e,c){for(let m=0;m<c.length;m++)yu(d,e,c[m])},custom:function(d,e,c){let m=d.context,y=c.implementation;if(d.transform.projection.unsupportedLayers&&d.transform.projection.unsupportedLayers.includes("custom"))n.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(d.renderPass==="offscreen"){let v=y.prerender;v&&(d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),v.call(y,m.gl,d.transform.customLayerMatrix()),m.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),m.setStencilMode(n.StencilMode.disabled);let v=y.renderingMode==="3d"?new n.DepthMode(d.context.gl.LEQUAL,n.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,n.DepthMode.ReadOnly);m.setDepthMode(v),y.render(m.gl,d.transform.customLayerMatrix()),m.setDirty(),d.setBaseState(),m.bindFramebuffer.set(null)}}};class vu{constructor(e,c){this.context=new F(e),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=n.SourceCache.maxUnderzooming+n.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ua,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(e,c){let m=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hn(this,e));let y=this._terrain;this.transform.elevation=m?y:null,y.update(e,this.transform,c)}_updateFog(e){let c=e.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[m,y]=c.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);let v=m+.78*(y-m);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,c){if(this.width=e*n.exported.devicePixelRatio,this.height=c*n.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let m of this.style.order)this.style._layers[m].resize()}setup(){let e=this.context,c=new n.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(n.EXTENT,0),c.emplaceBack(0,n.EXTENT),c.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(c,n.posAttributes.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);let m=new n.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(n.EXTENT,0),m.emplaceBack(0,n.EXTENT),m.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=e.createVertexBuffer(m,n.posAttributes.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);let y=new n.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,n.posAttributes.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);let v=new n.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(n.EXTENT,0,n.EXTENT,0),v.emplaceBack(0,n.EXTENT,0,n.EXTENT),v.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.mercatorBoundsBuffer=e.createVertexBuffer(v,n.boundsAttributes.members),this.mercatorBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);let T=new n.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);let M=new n.StructArrayLayout1ui2;for(let z of[0,1,3,2,0])M.emplaceBack(z);this.debugIndexBuffer=e.createIndexBuffer(M),this.emptyTexture=new n.Texture(e,new n.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=n.create();let k=this.context.gl;this.stencilClearMode=new n.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(n.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let e=this.context,c=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(e,c.TRIANGLES,n.DepthMode.disabled,this.stencilClearMode,n.ColorMode.disabled,n.CullFaceMode.disabled,$a(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(e,c,m){if(!c||this.currentStencilSource===c.id||!e.isTileClipped()||!m||m.length===0)return;let y=[],v=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(let L of m)if(this._tileClippingMaskIDs.has(L.key)||(v=!0),this._skippedStencilTileIDs.has(L.key)){if(!c.getTile(L).getBucket(e))continue;this._skippedStencilTileIDs.delete(L.key),y.push(L)}if(!v&&y.length===0)return}let T=this.context,M=T.gl;T.setColorMode(n.ColorMode.disabled),T.setDepthMode(n.DepthMode.disabled);let k=this.useProgram("clippingMask"),z=L=>{let O=c.getTile(L),{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:$}=this.getTileBoundsBuffers(O);k.draw(T,M.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:M.GREATER,mask:255},this._tileClippingMaskIDs.get(L.key)||0,255,M.KEEP,M.KEEP,M.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,$a(L.projMatrix),"$clipping",j,X,$)};if(!v&&y.length>0)for(let L of y)z(L);else{(this._tileClippingMaskIDs.size===0||this.nextStencilID+m.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(let L of m)this._tileClippingMaskIDs.set(L.key,this.nextStencilID++),c.getTile(L).getBucket(e)?z(L):this._skippedStencilTileIDs.add(L.key)}this._skippedStencilTileIDs.size===0&&(this.currentStencilSource=c.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,c=this.context.gl;return new n.StencilMode({func:c.NOTEQUAL,mask:255},e,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);let c=this.context.gl;return new n.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs.get(e.key)||0,0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(e){let c=this.context.gl,m=e.sort((T,M)=>M.overscaledZ-T.overscaledZ),y=m[m.length-1].overscaledZ,v=m[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let T={};for(let M=0;M<v;M++)T[M+y]=new n.StencilMode({func:c.GEQUAL,mask:255},M+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=v,[T,m]}return[{[y]:n.StencilMode.disabled},m]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new n.ColorMode([e.CONSTANT_COLOR,e.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?n.ColorMode.unblended:n.ColorMode.alphaBlended}depthModeForSublayer(e,c,m){if(!this.opaquePassEnabledForLayer())return n.DepthMode.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new n.DepthMode(m||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,c){this.style=e,this.options=c,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(n.exported.now()),this.imageManager.beginFrame();let m=this.style.order,y=this.style._sourceCaches;for(let z in y){let L=y[z];L.used&&L.prepare(this.context)}let v={},T={},M={};for(let z in y){let L=y[z];v[z]=L.getVisibleCoordinates(),T[z]=v[z].slice().reverse(),M[z]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<m.length;z++)if(this.style._layers[m[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.GlobeSharedBuffers(this.context)),!n.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(let z of m){let L=this.style._layers[z],O=e._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;let j=O?T[O.id]:void 0;(L.type==="custom"||L.isSky()||j&&j.length)&&this.renderLayer(this,O,L,j)}this.depthRangeFor3D=[0,1-(e.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let k=n.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(k=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?n.Color.black:k,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){let z=this.style._layers[m[this.currentLayer]],L=e._getLayerSourceCache(z);if(z.isSky())continue;let O=L?T[L.id]:void 0;this._renderTileClippingMasks(z,L,O),this.renderLayer(this,L,z,O)}if(this.renderPass="sky",(n.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){let z=this.style._layers[m[this.currentLayer]],L=e._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,L,z,L?T[L.id]:void 0)}for(this.transform.projection.name==="globe"&&function(z){let L=z.context,O=L.gl,j=z.transform,X=new n.DepthMode(O.LEQUAL,n.DepthMode.ReadOnly,[0,1]),$=z.useProgram("globeAtmosphere"),U=j.centerOffset,st=j._camera.getCameraToClipPerspective(j._fov,j.width/j.height,j._nearZ,j._farZ);st[8]=2*-U.x/j.width,st[9]=2*U.y/j.height;let Y=n.invert([],st),it=n.mul([],Y,j.projMatrix),nt={u_frustum_tl:zr([-1,1,1],Y),u_frustum_tr:zr([1,1,1],Y),u_frustum_br:zr([1,-1,1],Y),u_frustum_bl:zr([-1,-1,1],Y),u_globe_pos:zr([j.globeMatrix[12],j.globeMatrix[13],j.globeMatrix[14]],it),u_globe_radius:j.worldSize/2/Math.PI-1,u_opacity:1-n.globeToMercatorTransition(j.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};z.prepareDrawProgram(L,$);let at=z.globeSharedBuffers;at&&$.draw(L,O.TRIANGLES,X,n.StencilMode.disabled,n.ColorMode.alphaBlended,n.CullFaceMode.backCW,nt,"skybox",at.atmosphereVertexBuffer,at.atmosphereIndexBuffer,at.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){let z=this.style._layers[m[this.currentLayer]],L=e._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}let O=L?(z.type==="symbol"?M:T)[L.id]:void 0;this._renderTileClippingMasks(z,L,L?v[L.id]:void 0),this.renderLayer(this,L,z,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let z=null;n.values(this.style._layers).forEach(L=>{let O=e._getLayerSourceCache(L);O&&!L.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<O.getSource().maxzoom)&&(z=O)}),z&&this.options.showTileBoundaries&&Sc.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){let L=z.transform.padding;Jt(z,z.transform.height-(L.top||0),3,wc),Jt(z,L.bottom||0,3,Tc),Tn(z,L.left||0,3,gu),Tn(z,z.transform.width-(L.right||0),3,tl);let O=z.transform.centerPoint;(function(j,X,$,U){$o(j,X-1,$-10,2,20,U),$o(j,X-10,$-1,20,2,U)})(z,O.x,z.transform.height-O.y,el)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(n.window.performance.now()),this.saveCanvasCopy())}renderLayer(e,c,m,y){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(m.type)||Sc[m.type](e,c,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;let c=this.context.extTimerQuery,m=this.gpuTimers[e.id];m||(m=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){let e=this.gpuTimers;return this.gpuTimers={},e}queryGpuTimers(e){let c={};for(let m in e){let y=e[m],v=this.context.extTimerQuery,T=v.getQueryObjectEXT(y.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(y.query),c[m]=T}return c}translatePosMatrix(e,c,m,y,v){if(!m[0]&&!m[1])return e;let T=v?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){let z=Math.sin(T),L=Math.cos(T);m=[m[0]*L-m[1]*z,m[0]*z+m[1]*L]}let M=[v?m[0]:gi(c,m[0],this.transform.zoom),v?m[1]:gi(c,m[1],this.transform.zoom),0],k=new Float32Array(16);return n.translate(k,e,M),k}saveTileTexture(e){let c=this._tileTextures[e.size[0]];c?c.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let c=this._tileTextures[e];return c&&c.length>0?c.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let c=this.imageManager.getPattern(e.from.toString()),m=this.imageManager.getPattern(e.to.toString());return!c||!m}currentGlobalDefines(){let e=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),c&&!e&&c.getOpacity(this.transform.pitch)!==0&&m.push("FOG"),e&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(e,c,m){this.cache=this.cache||{};let y=m||[],v=this.currentGlobalDefines().concat(y),T=Uo.cacheKey(e,v,c);return this.cache[T]||(this.cache[T]=new Uo(this.context,e,Oo[e],c,We[e],v)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=n.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(e,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;let y=this.style.fog;if(y){let v=y.getOpacity(this.transform.pitch);v!==0&&c.setFogUniformValues(e,((T,M,k,z)=>{let L=M.properties.get("color"),O=T.frameCounter/1e3%1,j=[L.r/L.a,L.g/L.a,L.b/L.a,z];return{u_fog_matrix:k?T.transform.calculateFogTileMatrix(k):T.identityMat,u_fog_range:M.getFovAdjustedRange(T.transform._fov),u_fog_color:j,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:O}})(this,y,m,v))}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){let e=this.context.gl,c=e.createTexture();return e.bindTexture(e.TEXTURE_2D,c),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let e=this.style&&this.style.fog;return!!e&&e.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let e=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(let y of m)c[y.key]=e[y.key]||new n.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class Dr{constructor(e=0,c=0,m=0,y=0){if(isNaN(e)||e<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=c,this.left=m,this.right=y}interpolate(e,c,m){return c.top!=null&&e.top!=null&&(this.top=n.number(e.top,c.top,m)),c.bottom!=null&&e.bottom!=null&&(this.bottom=n.number(e.bottom,c.bottom,m)),c.left!=null&&e.left!=null&&(this.left=n.number(e.left,c.left,m)),c.right!=null&&e.right!=null&&(this.right=n.number(e.right,c.right,m)),this}getCenter(e,c){let m=n.clamp((this.left+e-this.right)/2,0,e),y=n.clamp((this.top+c-this.bottom)/2,0,c);return new n.pointGeometry(m,y)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Dr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function bu(d,e){let c=n.getColumn(d,3);n.fromQuat(d,e),n.setColumn(d,3,c)}function Ec(d,e){let c=n.identity$1([]);return n.rotateZ$1(c,c,-e),n.rotateX$1(c,c,-d),c}function il(d,e){let c=[d[0],d[1],0],m=[e[0],e[1],0];if(n.length(c)>=1e-15){let T=n.normalize([],c);n.scale$2(m,T,n.dot(m,T)),e[0]=m[0],e[1]=m[1]}let y=n.cross([],e,d);if(n.len(y)<1e-15)return null;let v=Math.atan2(-y[1],y[0]);return Ec(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}class Wo{constructor(e,c){this.position=e,this.orientation=c}get position(){return this._position}set position(e){if(e){let c=e instanceof n.MercatorCoordinate?e:new n.MercatorCoordinate(e[0],e[1],e[2]);this._renderWorldCopies&&(c.x=n.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(e,c){if(this.orientation=null,!this.position)return;let m=this._elevation?this._elevation.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(e)):0,y=this.position,v=n.MercatorCoordinate.fromLngLat(e,m),T=[v.x-y.x,v.y-y.y,v.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=il(T,c)}setPitchBearing(e,c){this.orientation=Ec(n.degToRad(e),n.degToRad(-c))}}class Xo{constructor(e,c){this._transform=n.identity([]),this.orientation=c,this.position=e}get mercatorPosition(){let e=this.position;return new n.MercatorCoordinate(e[0],e[1],e[2])}get position(){let e=n.getColumn(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var c;e&&n.setColumn(this._transform,3,[(c=e)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||n.identity$1([]),e&&bu(this._transform,this._orientation)}getPitchBearing(){let e=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,c){this._orientation=Ec(e,c),bu(this._transform,this._orientation)}forward(){let e=n.getColumn(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){let e=n.getColumn(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){let e=n.getColumn(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,c){let m=new Float64Array(16);return n.invert(m,this.getWorldToCamera(e,c)),m}getWorldToCameraPosition(e,c,m){let y=this.position;n.scale$2(y,y,-e);let v=new Float64Array(16);return n.fromScaling(v,[m,m,m]),n.translate(v,v,y),v[10]*=c,v}getWorldToCamera(e,c){let m=new Float64Array(16),y=new Float64Array(4),v=this.position;return n.conjugate(y,this._orientation),n.scale$2(v,v,-e),n.fromQuat(m,y),n.translate(m,m,v),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(e,c,m,y){let v=new Float64Array(16);return n.perspective(v,e,c,m,y),v}getDistanceToElevation(e){let c=e===0?0:n.mercatorZfromAltitude(e,this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new Xo([...this.position],[...this.orientation])}}function Mc(d,e){let c=Ho(d),m=function(v,T,M,k,z){let L=new n.LngLat(M.lng-180*Lr,M.lat),O=new n.LngLat(M.lng+180*Lr,M.lat),j=v.project(L.lng,L.lat),X=v.project(O.lng,O.lat),$=-Math.atan2(X.y-j.y,X.x-j.x),U=n.MercatorCoordinate.fromLngLat(M);U.y=n.clamp(U.y,-.999975,.999975);let st=U.toLngLat(),Y=v.project(st.lng,st.lat),it=n.MercatorCoordinate.fromLngLat(st);it.x+=Lr;let nt=it.toLngLat(),at=v.project(nt.lng,nt.lat),tt=Ic(at.x-Y.x,at.y-Y.y,$),ct=n.MercatorCoordinate.fromLngLat(st);ct.y+=Lr;let bt=ct.toLngLat(),Ct=v.project(bt.lng,bt.lat),zt=Ic(Ct.x-Y.x,Ct.y-Y.y,$),kt=Math.abs(tt.x)/Math.abs(zt.y),$t=n.identity([]);n.rotateZ($t,$t,-$*(1-(z?0:k)));let wt=n.identity([]);return n.scale(wt,wt,[1,1-(1-kt)*k,1]),wt[4]=-zt.x/zt.y*k,n.rotateZ(wt,wt,$),n.multiply$1(wt,$t,wt),wt}(d.projection,0,d.center,c,e),y=Ac(d);return n.scale(m,m,[y,y,1]),m}function Ac(d){let e=d.projection,c=Ho(d),m=Cc(e,d.center),y=Cc(e,n.LngLat.convert(e.center));return Math.pow(2,m*c+(1-c)*y)}function Ho(d){let e=d.projection.range;if(!e)return 0;let c=Math.max(d.width,d.height),m=Math.log(c/1024)/Math.LN2;return n.smoothstep(e[0]+m,e[1]+m,d.zoom)}let Lr=1/4e4;function Cc(d,e){let c=n.clamp(e.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=new n.LngLat(e.lng-180*Lr,c),y=new n.LngLat(e.lng+180*Lr,c),v=d.project(m.lng,c),T=d.project(y.lng,c),M=n.MercatorCoordinate.fromLngLat(m),k=n.MercatorCoordinate.fromLngLat(y),z=T.x-v.x,L=T.y-v.y,O=k.x-M.x,j=k.y-M.y,X=Math.sqrt((O*O+j*j)/(z*z+L*L));return Math.log(X)/Math.LN2}function Ic(d,e,c){let m=Math.cos(c),y=Math.sin(c);return{x:d*m-e*y,y:d*y+e*m}}class nl{constructor(e,c,m,y,v,T,M){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=e||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Dr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Xo,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){let e=new nl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(e){let c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(e||c)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return n.pick(this.projection,["name","center","parallels"])}setProjection(e){e==null&&(e={name:"mercator"}),this.projectionOptions=e;let c=this.projection?this.getProjection():void 0;this.projection=n.getProjection(e);let m=this.getProjection();return A(c,m)?null:(this._calcMatrices(),m)}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){let e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.pointGeometry(this.width,this.height)}get bearing(){return n.wrap(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){let c=-e*Math.PI/180;var m;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new n.ARRAY_TYPE(4),n.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(y,v,T){var M=v[0],k=v[1],z=v[2],L=v[3],O=Math.sin(T),j=Math.cos(T);y[0]=M*j+z*O,y[1]=k*j+L*O,y[2]=M*-O+z*j,y[3]=k*-O+L*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let c=n.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){let c=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);let e=this._elevation;this._centerAltitude=e.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=e.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let e=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop(),y=0,v=0;for(let T=0;T<c.length;T++){let M=new n.pointGeometry(c[T][0]*this.width,m+c[T][1]*(this.height-m)),k=e.pointCoordinate(M);if(!k)continue;let z=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);y+=k[3]*z,v+=z}return v===0?NaN:y/v}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let e=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(e),v=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-m,v);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){let c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude())),m;m=e.z<this._camera.position[2]?[c.x,c.y,c.z]:[e.x,e.y,e.z];let y=n.length(n.sub([],this._camera.position,m));return n.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height||!e.position&&!e.orientation)return;this._updateCameraState();let c=!1;if(e.orientation&&!n.exactEquals(e.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(e.orientation)),e.position){let m=[e.position.x,e.position.y,e.position.z];n.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let e=this._camera.position,c=new Wo;return c.position=new n.MercatorCoordinate(e[0],e[1],e[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(e){if(!n.length$1(e))return!1;n.normalize$1(e,e);let c=n.transformQuat([],[0,0,-1],e),m=n.transformQuat([],[0,-1,0],e);if(m[2]<0)return!1;let y=il(c,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(e){let c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;e[2]=n.clamp(e[2],y/m,y/c),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,c,m){this._unmodified=!1,this._edgeInsets.interpolate(e,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let c=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(e){let c=[new n.UnwrappedTileID(0,e)];if(this.renderWorldCopies){let m=this.pointCoordinate(new n.pointGeometry(0,0)),y=this.pointCoordinate(new n.pointGeometry(this.width,0)),v=this.pointCoordinate(new n.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new n.pointGeometry(0,this.height)),M=Math.floor(Math.min(m.x,y.x,v.x,T.x)),k=Math.floor(Math.max(m.x,y.x,v.x,T.x)),z=1;for(let L=M-z;L<=k+z;L++)L!==0&&c.push(new n.UnwrappedTileID(L,e))}return c}coveringTiles(e){let c=this.coveringZoomLevel(e),m=c,y=this.elevation&&!e.isTerrainDEM,v=this.projection.name==="mercator";if(e.minzoom!==void 0&&c<e.minzoom)return[];e.maxzoom!==void 0&&c>e.maxzoom&&(c=e.maxzoom);let T=this.locationCoordinate(this.center),M=this.center.lat,k=1<<c,z=[k*T.x,k*T.y,0],L=this.projection.name==="globe",O=!L,j=n.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,O),X=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=k*n.mercatorZfromAltitude(1,this.center.lat),U=this._camera.position[2]/n.mercatorZfromAltitude(1,this.center.lat),st=[k*X.x,k*X.y,U*(O?1:$)],Y=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),it=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,nt=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,at=e.isTerrainDEM?-nt:this._elevation?this._elevation.getMinElevationBelowMSL():0,tt=this.projection.isReprojectedInTileSpace?Ac(this):1,ct=Dt=>{let ue=new n.MercatorCoordinate(Dt.x+25e-6,Dt.y,Dt.z),ie=new n.MercatorCoordinate(Dt.x,Dt.y+25e-6,Dt.z),ne=Dt.toLngLat(),fe=ue.toLngLat(),Se=ie.toLngLat(),ae=this.locationCoordinate(ne),ge=this.locationCoordinate(fe),Re=this.locationCoordinate(Se),hi=Math.hypot(ge.x-ae.x,ge.y-ae.y),Ni=Math.hypot(Re.x-ae.x,Re.y-ae.y);return Math.sqrt(hi*Ni)*tt/25e-6},bt=Dt=>{let ee=nt,ue=at;return{aabb:n.tileAABB(this,k,0,0,0,Dt,ue,ee,this.projection),zoom:0,x:0,y:0,minZ:ue,maxZ:ee,wrap:Dt,fullyVisible:!1}},Ct=[],zt=[],kt=c,$t=e.reparseOverscaled?m:c,wt=Dt=>Dt*Dt,qt=wt((U-this._centerAltitude)*$),Nt=Dt=>{if(!this._elevation||!Dt.tileID||!v)return;let ee=this._elevation.getMinMaxForTile(Dt.tileID),ue=Dt.aabb;ee?(ue.min[2]=ee.min,ue.max[2]=ee.max,ue.center[2]=(ue.min[2]+ue.max[2])/2):(Dt.shouldSplit=re(Dt),Dt.shouldSplit||(ue.min[2]=ue.max[2]=ue.center[2]=this._centerAltitude))},re=Dt=>{if(Dt.zoom<it)return!0;if(Dt.zoom===kt)return!1;if(Dt.shouldSplit!=null)return Dt.shouldSplit;let ee=Dt.aabb.distanceX(st),ue=Dt.aabb.distanceY(st),ie=qt,ne=1;if(L){ie=wt(Dt.aabb.distanceZ(st));let Se=Math.pow(2,Dt.zoom),ae=n.latFromMercatorY((Dt.y+1)/Se),ge=n.latFromMercatorY(Dt.y/Se),Re=Math.min(Math.max(M,ae),ge),hi=n.circumferenceAtLatitude(Re)/n.circumferenceAtLatitude(M);ne=Math.min(hi,1)}else if(y&&(ie=wt(Dt.aabb.distanceZ(st)*$)),this.projection.isReprojectedInTileSpace&&m<=5){let Se=Math.pow(2,Dt.zoom),ae=ct(new n.MercatorCoordinate((Dt.x+.5)/Se,(Dt.y+.5)/Se));ne=ae>.85?1:ae}let fe=ee*ee+ue*ue+ie;return fe<wt((1<<kt-Dt.zoom)*Y*ne*((Se,ae)=>{if(ae*wt(.707)<Se)return 1;let ge=Math.sqrt(ae/Se);return ge/(1.4144271570014144+(Math.pow(1.1,ge-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ie,qt),fe))};if(this.renderWorldCopies)for(let Dt=1;Dt<=3;Dt++)Ct.push(bt(-Dt)),Ct.push(bt(Dt));for(Ct.push(bt(0));Ct.length>0;){let Dt=Ct.pop(),ee=Dt.x,ue=Dt.y,ie=Dt.fullyVisible;if(!ie){let ne=Dt.aabb.intersects(j);if(ne===0)continue;ie=ne===2}if(Dt.zoom!==kt&&re(Dt))for(let ne=0;ne<4;ne++){let fe=(ee<<1)+ne%2,Se=(ue<<1)+(ne>>1),ae={aabb:v?Dt.aabb.quadrant(ne):n.tileAABB(this,k,Dt.zoom+1,fe,Se,Dt.wrap,Dt.minZ,Dt.maxZ,this.projection),zoom:Dt.zoom+1,x:fe,y:Se,wrap:Dt.wrap,fullyVisible:ie,tileID:void 0,shouldSplit:void 0,minZ:Dt.minZ,maxZ:Dt.maxZ};y&&!L&&(ae.tileID=new n.OverscaledTileID(Dt.zoom+1===kt?$t:Dt.zoom+1,Dt.wrap,Dt.zoom+1,fe,Se),Nt(ae)),Ct.push(ae)}else{let ne=Dt.zoom===kt?$t:Dt.zoom;if(e.minzoom&&e.minzoom>ne)continue;let fe=z[0]-(.5+ee+(Dt.wrap<<Dt.zoom))*(1<<c-Dt.zoom),Se=z[1]-.5-ue,ae=Dt.tileID?Dt.tileID:new n.OverscaledTileID(ne,Dt.wrap,Dt.zoom,ee,ue);zt.push({tileID:ae,distanceSq:fe*fe+Se*Se})}}if(this.fogCullDistSq){let Dt=this.fogCullDistSq,ee=this.horizonLineFromTop();zt=zt.filter(ue=>{let ie=[0,0,0,1],ne=[n.EXTENT,n.EXTENT,0,1],fe=this.calculateFogTileMatrix(ue.tileID.toUnwrapped());n.transformMat4$1(ie,ie,fe),n.transformMat4$1(ne,ne,fe);let Se=n.getAABBPointSquareDist(ie,ne);if(Se===0)return!0;let ae=!1,ge=this._elevation;if(ge&&Se>Dt&&ee!==0){let Re=this.calculateProjMatrix(ue.tileID.toUnwrapped()),hi;e.isTerrainDEM||(hi=ge.getMinMaxForTile(ue.tileID)),hi||(hi={min:at,max:nt});let Ni=n.furthestTileCorner(this.rotation),ji=[Ni[0]*n.EXTENT,Ni[1]*n.EXTENT,hi.max];n.transformMat4(ji,ji,Re),ae=(1-ji[1])*this.height*.5<ee}return Se<Dt||ae})}return zt.sort((Dt,ee)=>Dt.distanceSq-ee.distanceSq).map(Dt=>Dt.tileID)}resize(e,c){this.width=e,this.height=c,this.pixelsToGLUnits=[2/e,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let c=n.clamp(e.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=this.projection.project(e.lng,c);return new n.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(e,c){let m,y,v=this.centerPoint;if(this.projection.name==="globe"){let M=this.worldSize;m=(c.x-v.x)/M,y=(c.y-v.y)/M}else{let M=this.pointCoordinate(c),k=this.pointCoordinate(v);m=M.x-k.x,y=M.y-k.y}let T=this.locationCoordinate(e);this.setLocation(new n.MercatorCoordinate(T.x-m,T.y-y))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this._coordinatePoint(this.locationCoordinate(e),!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,c){let m=c?n.mercatorZfromAltitude(c,e.lat):void 0,y=this.projection.project(e.lng,e.lat);return new n.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,c){let m=c??this._centerAltitude,y=[e.x,e.y,0,1],v=[e.x,e.y,1,1];n.transformMat4$1(y,y,this.pixelMatrixInverse),n.transformMat4$1(v,v,this.pixelMatrixInverse);let T=v[3];n.scale$1(y,y,1/y[3]),n.scale$1(v,v,1/T);let M=y[2],k=v[2];return{p0:y,p1:v,t:M===k?0:(m-M)/(k-M)}}screenPointToMercatorRay(e){let c=[e.x,e.y,0,1],m=[e.x,e.y,1,1];return n.transformMat4$1(c,c,this.pixelMatrixInverse),n.transformMat4$1(m,m,this.pixelMatrixInverse),n.scale$1(c,c,1/c[3]),n.scale$1(m,m,1/m[3]),c[2]=n.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=n.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,n.scale$1(c,c,1/this.worldSize),n.scale$1(m,m,1/this.worldSize),new n.Ray([c[0],c[1],c[2]],n.normalize([],n.sub([],m,c)))}rayIntersectionCoordinate(e){let{p0:c,p1:m,t:y}=e,v=n.mercatorZfromAltitude(c[2],this._center.lat),T=n.mercatorZfromAltitude(m[2],this._center.lat);return new n.MercatorCoordinate(n.number(c[0],m[0],y)/this.worldSize,n.number(c[1],m[1],y)/this.worldSize,n.number(v,T,y))}pointCoordinate(e,c=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,c)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let c=this.elevation,m=this.elevation.pointCoordinate(e);if(m)return new n.MercatorCoordinate(m[0],m[1],m[2]);let y=0,v=this.horizonLineFromTop();if(e.y>v)return this.pointCoordinate(e);let T=.02*v,M=e.clone();for(let k=0;k<10&&v-y>T;k++){M.y=n.number(y,v,.66);let z=c.pointCoordinate(M);z?(v=M.y,m=z):y=M.y}return m?new n.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){if(this.elevation)return!this.elevation.pointCoordinate(e);{let c=this.horizonLineFromTop();return e.y<c}}_coordinatePoint(e,c){let m=c&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,y=[e.x*this.worldSize,e.y*this.worldSize,m+e.toAltitude(),1];return n.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new n.pointGeometry(y[0]/y[3],y[1]/y[3]):new n.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(e,c){let m=new n.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new n.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new n.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new n.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom),M=this.pointCoordinate(m,e),k=this.pointCoordinate(y,e),z=this.pointCoordinate(v,c),L=this.pointCoordinate(T,c),O=(j,X)=>(X.y-j.y)/(X.x-j.x);return M.y>1&&k.y>=0?M=new n.MercatorCoordinate((1-L.y)/O(L,M)+L.x,1):M.y<0&&k.y<=1&&(M=new n.MercatorCoordinate(-L.y/O(L,M)+L.x,0)),k.y>1&&M.y>=0?k=new n.MercatorCoordinate((1-z.y)/O(z,k)+z.x,1):k.y<0&&M.y<=1&&(k=new n.MercatorCoordinate(-z.y/O(z,k)+z.x,0)),new n.LngLatBounds().extend(this.coordinateLocation(M)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(z))}_getBounds3D(){let e=this.elevation;if(!e.visibleDemTiles.length)return this._getBounds(0,0);let c=e.visibleDemTiles.reduce((m,y)=>{if(y.dem){let v=y.dem.tree;m.min=Math.min(m.min,v.minimums[0]),m.max=Math.max(m.max,v.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*e.exaggeration(),c.max*e.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(e=!0){let c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return e?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-n.MAX_MERCATOR_LATITUDE,this.maxLat=n.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=n.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=n.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=n.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,c){return this.projection.createTileMatrix(this,c,e)}calculateDistanceTileData(e){let c=e.key,m=this._distanceTileDataCache;if(m[c])return m[c];let y=e.canonical,v=1/this.height,T=this.cameraWorldSize/this.zoomScale(y.z),M=(y.x+Math.pow(2,y.z)*e.wrap)*T,k=y.y*T,z=this.point,L=this.angle,O=Math.sin(-L),j=-Math.cos(-L);return m[c]={bearing:[O,j],center:[(z.x-M)*v,(z.y-k)*v],scale:T/n.EXTENT*v},m[c]}calculateFogTileMatrix(e){let c=e.key,m=this._fogTileMatrixCache;if(m[c])return m[c];let y=this.calculatePosMatrix(e,this.cameraWorldSize);return n.multiply$1(y,this.worldToFogMatrix,y),m[c]=new Float32Array(y),m[c]}calculateProjMatrix(e,c=!1){let m=e.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];let v=this.calculatePosMatrix(e,this.worldSize);return n.multiply$1(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,v),y[m]=new Float32Array(v),y[m]}calculatePixelsToTileUnitsMatrix(e){let c=e.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];let y=function(v,T){let{scale:M}=v.tileTransform,k=M*n.EXTENT/(v.tileSize*Math.pow(2,T.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return z=new Float32Array(4),j=(L=T.inverseAdjustmentMatrix)[1],X=L[2],$=L[3],st=(O=[k,k])[1],z[0]=L[0]*(U=O[0]),z[1]=j*U,z[2]=X*st,z[3]=$*st,z;var z,L,O,j,X,$,U,st}(e,this);return m[c]=y,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;let e=this._elevation;this._updateCameraState();let c=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),y=this._camera.forward(),v=n.mercatorZfromAltitude(1,this._center.lat);m[2]/=v,y[2]/=v,n.normalize(y,y);let T=e.raycast(m,y,e.exaggeration());if(T){let M=n.scaleAndAdd([],m,y,T),k=new n.MercatorCoordinate(M[0],M[1],n.mercatorZfromAltitude(M[2],n.latFromMercatorY(M[1]))),z=(k.z+n.length([k.x-m[0],k.y-m[1],k.z-m[2]*v]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;let e=this._elevation;this._updateCameraState();let c=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),y=e.getAtPointOrZero(new n.MercatorCoordinate(...m)),v=this._minimumHeightOverTerrain()*Math.cos(n.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*y;if(T<v){let M=this.locationCoordinate(this._center,this._centerAltitude),k=[M.x-m[0],M.y-m[1],M.z-m[2]],z=n.length(k);k[2]-=(v-T)/this._projectionScaler;let L=n.length(k);if(L===0)return;n.scale$2(k,k,z/L*this._projectionScaler),this._camera.position=[M.x-k[0],M.y-k[1],M.z*this._projectionScaler-k[2]],this._camera.orientation=il(k,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){let O=this.center;return O.lat=n.clamp(O.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(O.lng=n.clamp(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}let e=this._unmodified,{x:c,y:m}=this.point,y=0,v=c,T=m,M=this.width/2,k=this.height/2,z=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(m-k<z&&(T=z+k),m+k>L&&(T=L-k),L-z<this.height&&(y=Math.max(y,this.height/(L-z)),T=(L+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let O=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,X=this.worldSize/2-(O+j)/2;v=(c+X+this.worldSize)%this.worldSize-X,v-M<O&&(v=O+M),v+M>j&&(v=j-M),j-O<this.width&&(y=Math.max(y,this.width/(j-O)),v=(j+O)/2)}v===c&&T===m||(this.center=this.unproject(new n.pointGeometry(v,T))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=e,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let e=this._fov/2,c=this.centerOffset,m=this.pixelsPerMeter;this._projectionScaler=m/(n.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(e)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?m:1),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-c.x/this.width,v[9]=2*c.y/this.height;let T=n.mul([],v,y);if(this.projection.isReprojectedInTileSpace){let at=this.locationCoordinate(this.center),tt=n.identity([]);n.translate(tt,tt,[at.x*this.worldSize,at.y*this.worldSize,0]),n.multiply$1(tt,tt,Mc(this)),n.translate(tt,tt,[-at.x*this.worldSize,-at.y*this.worldSize,0]),n.multiply$1(T,T,tt),this.inverseAdjustmentMatrix=function(ct){let bt=Mc(ct,!0);return Vt([],[bt[0],bt[1],bt[4],bt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=n.scale([],T,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=T,this.invProjMatrix=n.invert(new Float64Array(16),this.projMatrix);let M=new Float32Array(16);n.identity(M),n.scale(M,M,[1,-1,1]),n.rotateX(M,M,this._pitch),n.rotateZ(M,M,this.angle);let k=n.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-c.x/this.width,k[9]=2*(c.y+z)/this.height,this.skyboxMatrix=n.multiply$1(M,k,M);let L=this.point,O=L.x,j=L.y,X=this.width%2/2,$=this.height%2/2,U=Math.cos(this.angle),st=Math.sin(this.angle),Y=O-Math.round(O)+U*X+st*$,it=j-Math.round(j)+U*$+st*X,nt=new Float64Array(T);if(n.translate(nt,nt,[Y>.5?Y-1:Y,it>.5?it-1:it,0]),this.alignedProjMatrix=nt,T=n.create(),n.scale(T,T,[this.width/2,-this.height/2,1]),n.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=n.create(),n.scale(T,T,[1,-1,1]),n.translate(T,T,[-1,-1,0]),n.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=n.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=n.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");this.pixelMatrixInverse=T,this.globeMatrix=this.projection.name==="globe"?n.calculateGlobeMatrix(this):T,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let e=this.cameraWorldSize,c=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height,v=[e,e,c];n.scale$2(v,v,y),n.scale$2(m,m,-1),n.multiply$2(m,m,v);let T=n.create();n.translate(T,T,m),n.scale(T,T,v),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,c,y)}_computeCameraPosition(e){let c=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-e/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*v,y.y/this.worldSize-m[1]*v,e/this.worldSize*this._centerAltitude-m[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){let c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=e[2],y=1;m>0&&(y=Math.min((c-this._camera.position[2])/m,1)),this._camera.position=n.scaleAndAdd([],this._camera.position,e,y),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){let e=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),v=n.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.degToRad(this._maxPitch)),M=Math.max((e[2]-v)/Math.cos(m),T),k=this._zoomFromMercatorZ(M);n.scaleAndAdd(e,e,c,M),this._pitch=n.clamp(m,n.degToRad(this.minPitch),n.degToRad(this.maxPitch)),this.angle=n.wrap(y,-Math.PI,Math.PI),this._setZoom(n.clamp(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.MercatorCoordinate(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){let e=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(e,c){let m=Math.min(e.x,c.x),y=Math.max(e.x,c.x),v=Math.min(e.y,c.y),T=Math.max(e.y,c.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let M=[new n.pointGeometry(m,v),new n.pointGeometry(y,T),new n.pointGeometry(m,T),new n.pointGeometry(y,v)],k=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(let L of M){let O=this.pointRayIntersection(L);if(O.t<0)return!0;let j=this.rayIntersectionCoordinate(O);if(j.x<k||j.y<0||j.x>z||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.pointGeometry(0,0),new n.pointGeometry(this.width,this.height))}zoomDeltaToMovement(e,c){let m=n.length(n.sub([],this._camera.position,e)),y=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(y)}getCameraPoint(){let e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.pointGeometry(0,e))}}function kc(d,e){let c=!1,m=null,y=()=>{m=null,c&&(d(),m=setTimeout(y,e),c=!1)};return()=>(c=!0,m||y(),m)}class wu{constructor(e){this._hashName=e&&encodeURIComponent(e),n.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kc(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,n.window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),n.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(e){let c=this._map;if(!c)return"";let m=c.getCenter(),y=Math.round(100*c.getZoom())/100,v=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,v),M=Math.round(m.lng*T)/T,k=Math.round(m.lat*T)/T,z=c.getBearing(),L=c.getPitch(),O="";if(O+=e?`/${M}/${k}/${y}`:`${y}/${k}/${M}`,(z||L)&&(O+="/"+Math.round(10*z)/10),L&&(O+=`/${Math.round(L)}`),this._hashName){let j=this._hashName,X=!1,$=n.window.location.hash.slice(1).split("&").map(U=>{let st=U.split("=")[0];return st===j?(X=!0,`${st}=${O}`):U}).filter(U=>U);return X||$.push(`${j}=${O}`),`#${$.join("&")}`}return`#${O}`}_getCurrentHash(){let e=n.window.location.hash.replace("#","");if(this._hashName){let c;return e.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return e.split("/")}_onHashChange(){let e=this._map;if(!e)return!1;let c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(m))){let m=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(c[3]||0):e.getBearing();return e.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){let e=n.window.location.href.replace(/(#.+)?$/,this.getHashString());n.window.history.replaceState(n.window.history.state,null,e)}}let ur={linearity:.3,easing:n.bezier(0,0,.3,1)},Tu=n.extend({deceleration:2500,maxSpeed:1400},ur),Su=n.extend({deceleration:20,maxSpeed:1400},ur),Eu=n.extend({deceleration:1e3,maxSpeed:360},ur),Mu=n.extend({deceleration:1e3,maxSpeed:90},ur);class Au{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.exported.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,c=n.exported.now();for(;e.length>0&&c-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let c={zoom:0,bearing:0,pitch:0,pan:new n.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)c.zoom+=v.zoomDelta||0,c.bearing+=v.bearingDelta||0,c.pitch+=v.pitchDelta||0,v.panDelta&&c.pan._add(v.panDelta),v.around&&(c.around=v.around),v.pinchAround&&(c.pinchAround=v.pinchAround);let m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){let v=Pi(c.pan.mag(),m,n.extend({},Tu,e||{}));y.offset=c.pan.mult(v.amount/c.pan.mag()),y.center=this._map.transform.center,Yo(y,v)}if(c.zoom){let v=Pi(c.zoom,m,Su);y.zoom=this._map.transform.zoom+v.amount,Yo(y,v)}if(c.bearing){let v=Pi(c.bearing,m,Eu);y.bearing=this._map.transform.bearing+n.clamp(v.amount,-179,179),Yo(y,v)}if(c.pitch){let v=Pi(c.pitch,m,Mu);y.pitch=this._map.transform.pitch+v.amount,Yo(y,v)}if(y.zoom||y.bearing){let v=c.pinchAround===void 0?c.around:c.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Yo(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function Pi(d,e,c){let{maxSpeed:m,linearity:y,deceleration:v}=c,T=n.clamp(d*y/(e/1e3),-m,m),M=Math.abs(T)/(v*y);return{easing:c.easing,duration:1e3*M,amount:T*(M/2)}}class un extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,c,m,y={}){let v=St(c.getCanvasContainer(),m),T=c.unproject(v);super(e,n.extend({point:v,lngLat:T,originalEvent:m},y)),this._defaultPrevented=!1,this.target=c}}class Ko extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,c,m){let y=e==="touchend"?m.changedTouches:m.touches,v=_t(c.getCanvasContainer(),y),T=v.map(k=>c.unproject(k)),M=v.reduce((k,z,L,O)=>k.add(z.div(O.length)),new n.pointGeometry(0,0));super(e,{points:v,point:M,lngLats:T,lngLat:c.unproject(M),originalEvent:m}),this._defaultPrevented=!1}}class Fp extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,c,m){super(e,{originalEvent:m}),this._defaultPrevented=!1}}class Op{constructor(e,c){this._map=e,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new Fp(e.type,this._map,e))}mousedown(e,c){return this._mousedownPos=c,this._firePreventable(new un(e.type,this._map,e))}mouseup(e){this._map.fire(new un(e.type,this._map,e))}preclick(e){let c=n.extend({},e);c.type="preclick",this._map.fire(new un(c.type,this._map,c))}click(e,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(e),this._map.fire(new un(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new un(e.type,this._map,e))}mouseover(e){this._map.fire(new un(e.type,this._map,e))}mouseout(e){this._map.fire(new un(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ko(e.type,this._map,e))}touchmove(e){this._map.fire(new Ko(e.type,this._map,e))}touchend(e){this._map.fire(new Ko(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ko(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new un(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new un("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new un(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cu{constructor(e,c){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,c){this.isEnabled()&&e.shiftKey&&e.button===0&&(dt(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(e,c){if(!this._active)return;let m=c;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;let y=this._startPos;this._lastPos=m,this._box||(this._box=D("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));let v=Math.min(y.x,m.x),T=Math.max(y.x,m.x),M=Math.min(y.y,m.y),k=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${M}px)`,this._box.style.width=T-v+"px",this._box.style.height=k-M+"px")})}mouseupWindow(e,c){if(!this._active||e.button!==0)return;let m=this._startPos,y=c;if(this.reset(),mt(),m.x!==y.x||m.y!==y.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:v=>v.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),W(),delete this._startPos,delete this._lastPos}_fireEvent(e,c){return this._map.fire(new n.Event(e,{originalEvent:c}))}}function Rr(d,e){let c={};for(let m=0;m<d.length;m++)c[d[m].identifier]=e[m];return c}class tr{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=e.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){let v=new n.pointGeometry(0,0);for(let T of y)v._add(T);return v.div(y.length)}(c),this.touches=Rr(m,c)))}touchmove(e,c,m){if(this.aborted||!this.centroid)return;let y=Rr(m,c);for(let v in this.touches){let T=this.touches[v],M=y[v];(!M||M.dist(T)>30)&&(this.aborted=!0)}}touchend(e,c,m){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){let y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Ks{constructor(e){this.singleTap=new tr(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,c,m){this.singleTap.touchstart(e,c,m)}touchmove(e,c,m){this.singleTap.touchmove(e,c,m)}touchend(e,c,m){let y=this.singleTap.touchend(e,c,m);if(y){let v=e.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(v&&T||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class te{constructor(){this._zoomIn=new Ks({numTouches:1,numTaps:2}),this._zoomOut=new Ks({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,c,m){this._zoomIn.touchstart(e,c,m),this._zoomOut.touchstart(e,c,m)}touchmove(e,c,m){this._zoomIn.touchmove(e,c,m),this._zoomOut.touchmove(e,c,m)}touchend(e,c,m){let y=this._zoomIn.touchend(e,c,m),v=this._zoomOut.touchend(e,c,m);return y?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:e})}):v?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(v)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Iu={0:1,2:2};class rl{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,c){return!1}_move(e,c){return{}}mousedown(e,c){if(this._lastPoint)return;let m=Mt(e);this._correctButton(e,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(e,c){let m=this._lastPoint;if(m){if(e.preventDefault(),this._eventButton!=null&&function(y,v){let T=Iu[v];return y.buttons===void 0||(y.buttons&T)!==T}(e,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}}mouseupWindow(e){this._lastPoint&&Mt(e)===this._eventButton&&(this._moved&&mt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jo extends rl{mousedown(e,c){super.mousedown(e,c),this._lastPoint&&(this._active=!0)}_correctButton(e,c){return c===0&&!e.ctrlKey}_move(e,c){return{around:c,panDelta:c.sub(e)}}}class Js extends rl{_correctButton(e,c){return c===0&&e.ctrlKey||c===2}_move(e,c){let m=.8*(c.x-e.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(e){e.preventDefault()}}class Pc extends rl{_correctButton(e,c){return c===0&&e.ctrlKey||c===2}_move(e,c){let m=-.5*(c.y-e.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(e){e.preventDefault()}}class ku{constructor(e,c){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),n.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.pointGeometry(0,0)}touchstart(e,c,m){return this._calculateTransform(e,c,m)}touchmove(e,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.preventDefault(),this._calculateTransform(e,c,m)}}touchend(e,c,m){this._calculateTransform(e,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,c,m){m.length>0&&(this._active=!0);let y=Rr(m,c),v=new n.pointGeometry(0,0),T=new n.pointGeometry(0,0),M=0;for(let z in y){let L=y[z],O=this._touches[z];O&&(v._add(L),T._add(L.sub(O)),M++,y[z]=L)}if(this._touches=y,M<this._minTouches||!T.mag())return;let k=T.div(M);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(M),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=D("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class sl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,c,m){return{}}touchstart(e,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(e,c,m){let y=this._firstTwoTouches;if(!y)return;e.preventDefault();let[v,T]=y,M=Qo(m,c,v),k=Qo(m,c,T);if(!M||!k)return;let z=this._aroundCenter?null:M.add(k).div(2);return this._move([M,k],z,e)}touchend(e,c,m){if(!this._firstTwoTouches)return;let[y,v]=this._firstTwoTouches,T=Qo(m,c,y),M=Qo(m,c,v);T&&M||(this._active&&mt(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Qo(d,e,c){for(let m=0;m<d.length;m++)if(d[m].identifier===c)return e[m]}function zc(d,e){return Math.log(d/e)/Math.LN2}class Pu extends sl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,c){let m=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(zc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zc(this._distance,m),pinchAround:c}}}function Dc(d,e){return 180*d.angleWith(e)/Math.PI}class ol extends sl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,c){let m=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Dc(this._vector,m),pinchAround:c}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let c=25/(Math.PI*this._minDiameter)*360,m=Dc(e,this._startVector);return Math.abs(m)<c}}function ta(d){return Math.abs(d.y)>Math.abs(d.x)}class al extends sl{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,ta(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,c,m){let y=this._lastPoints;if(!y)return;let v=e[0].sub(y[0]),T=e[1].sub(y[1]);return this._map._cooperativeGestures&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(v,T,m.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(v.y+T.y)/2*-.5})}gestureBeginsVertically(e,c,m){if(this._valid!==void 0)return this._valid;let y=e.mag()>=2,v=c.mag()>=2;if(!y&&!v)return;if(!y||!v)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;let T=e.y>0==c.y>0;return ta(e)&&ta(c)&&T}}let zu={panStep:100,bearingStep:15,pitchStep:10};class Du{constructor(){let e=zu;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let c=0,m=0,y=0,v=0,T=0;switch(e.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:e.shiftKey?m=-1:(e.preventDefault(),v=-1);break;case 39:e.shiftKey?m=1:(e.preventDefault(),v=1);break;case 38:e.shiftKey?y=1:(e.preventDefault(),T=-1);break;case 40:e.shiftKey?y=-1:(e.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:M=>{let k=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Lu,zoom:c?Math.round(k)+c*(e.shiftKey?2:1):k,bearing:M.getBearing()+m*this._bearingStep,pitch:M.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-T*this._panStep],center:M.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Lu(d){return d*(2-d)}let Lc=4.000244140625;class Ru{constructor(e,c){this._map=e,this._el=e.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,n.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=e.deltaMode===n.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,m=n.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,c!==0&&c%Lc==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),e.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=e,this._delta-=c,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let c=St(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._map.transform,c=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(this._delta!==0){let k=this._type==="wheel"&&Math.abs(this._delta)>Lc?this._wheelZoomRate:this._defaultZoomRate,z=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&z!==0&&(z=1/z);let L=c(),O=Math.pow(2,L),j=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(j*z))),this._type==="wheel"&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}let m=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,v=this._easing,T,M=!1;if(this._type==="wheel"&&y&&v){let k=Math.min((n.exported.now()-this._lastWheelEventTime)/200,1),z=v(k);T=n.number(y,m,z),k<1?this._frameId||(this._frameId=!0):M=!0}else T=m,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:T-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let c=n.ease;if(this._prevEase){let m=this._prevEase,y=(n.exported.now()-m.start)/m.duration,v=m.easing(y+.01)-m.easing(y),T=.27/Math.sqrt(v*v+1e-4)*.01,M=Math.sqrt(.0729-T*T);c=n.bezier(T,M,.25,1)}return this._prevEase={start:n.exported.now(),duration:e,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=D("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(n.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!n.window.document.fullscreenElement||!!n.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Bu{constructor(e,c){this._clickZoom=e,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Fu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,c){return e.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(e.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rc{constructor(){this._tap=new Ks({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,c,m){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(e,c,m))}touchmove(e,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;let y=c[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,e.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(e,c,m)}touchend(e,c,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(e,c,m)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ou{constructor(e,c,m){this._el=e,this._mousePan=c,this._touchPan=m}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vu{constructor(e,c,m){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zu{constructor(e,c,m,y){this._el=e,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let ea=d=>d.zoom||d.drag||d.pitch||d.rotate;class Bc extends n.Event{}class Uu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,c){let m=n.sub([],c,e);this.radius=n.length(m[2]<0?n.div([],m,this.constants):[m[0],m[1],0])}projectRay(e){n.div(e,e,this.constants),n.normalize(e,e),n.mul$1(e,e,this.constants);let c=n.scale$2([],e,this.radius);if(c[2]>0){let m=n.scale$2([],[0,0,1],n.dot(c,[0,0,1])),y=n.scale$2([],n.normalize([],[c[0],c[1],0]),this.radius),v=n.add([],c,n.scale$2([],n.sub([],n.add([],y,m),c),2));c[0]=v[0],c[1]=v[1]}return c}}function Qs(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Nu{constructor(e,c){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Au(e),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Uu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),n.bindAll(["handleEvent","handleWindowEvent"],this);let m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[n.window.document,"mousemove",{capture:!0}],[n.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[n.window,"blur",void 0]];for(let[y,v,T]of this._listeners)y.addEventListener(v,y===n.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(let[e,c,m]of this._listeners)e.removeEventListener(c,e===n.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(e){let c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new Op(c,e));let y=c.boxZoom=new Cu(c,e);this._add("boxZoom",y);let v=new te,T=new Fu;c.doubleClickZoom=new Bu(T,v),this._add("tapZoom",v),this._add("clickZoom",T);let M=new Rc;this._add("tapDragZoom",M);let k=c.touchPitch=new al(c);this._add("touchPitch",k);let z=new Js(e),L=new Pc(e);c.dragRotate=new Vu(e,z,L),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);let O=new Jo(e),j=new ku(c,e);c.dragPan=new Ou(m,O,j),this._add("mousePan",O),this._add("touchPan",j,["touchZoom","touchRotate"]);let X=new ol,$=new Pu;c.touchZoomRotate=new Zu(m,$,X,M),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new dr(c));let U=c.scrollZoom=new Ru(c,this);this._add("scrollZoom",U,["mousePan"]);let st=c.keyboard=new Du;this._add("keyboard",st);for(let Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[Y]&&c[Y].enable(e[Y])}_add(e,c,m){this._handlers.push({handlerName:e,handler:c,allowed:m}),this._handlersById[e]=c}stop(e){if(!this._updatingCamera){for(let{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ea(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,c,m){for(let y in e)if(y!==m&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){let c=[];for(let m of e)this._el.contains(m.target)&&c.push(m);return c}handleEvent(e,c){this._updatingCamera=!0;let m=e.type==="renderFrame",y=m?void 0:e,v={needsRenderFrame:!1},T={},M={},k=e.touches?this._getMapTouches(e.touches):void 0,z=k?_t(this._el,k):m?void 0:St(this._el,e);for(let{handlerName:j,handler:X,allowed:$}of this._handlers){if(!X.isEnabled())continue;let U;this._blockedByActive(M,$,j)?X.reset():X[c||e.type]&&(U=X[c||e.type](e,z,k),this.mergeHandlerResult(v,T,U,j,y),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||X.isActive())&&(M[j]=X)}let L={};for(let j in this._previousActiveHandlers)M[j]||(L[j]=y);this._previousActiveHandlers=M,(Object.keys(L).length||Qs(v))&&(this._changes.push([v,T,L]),this._triggerRenderFrame()),(Object.keys(M).length||Qs(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:O}=v;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(e,c,m,y,v){if(!m)return;n.extend(e,m);let T={handlerName:y,originalEvent:m.originalEvent||v};m.zoomDelta!==void 0&&(c.zoom=T),m.panDelta!==void 0&&(c.drag=T),m.pitchDelta!==void 0&&(c.pitch=T),m.bearingDelta!==void 0&&(c.rotate=T)}_applyChanges(){let e={},c={},m={};for(let[y,v,T]of this._changes)y.panDelta&&(e.panDelta=(e.panDelta||new n.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(e.around=y.around),y.aroundCoord!==void 0&&(e.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(e.pinchAround=y.pinchAround),y.noInertia&&(e.noInertia=y.noInertia),n.extend(c,v),n.extend(m,T);this._updateMapTransform(e,c,m),this._changes=[]}_updateMapTransform(e,c,m){let y=this._map,v=y.transform,T=it=>[it.x,it.y,it.z];if((it=>{let nt=this._eventsInProgress.drag;return nt&&!this._handlersById[nt.handlerName].isActive()})()&&!Qs(e)){let it=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",it!==v.zoom&&this._map._update(!0)}if(!Qs(e))return void this._fireEvents(c,m,!0);let{panDelta:M,zoomDelta:k,bearingDelta:z,pitchDelta:L,around:O,aroundCoord:j,pinchAround:X}=e;X!==void 0&&(O=X),(it=>c.drag&&!this._eventsInProgress.drag)()&&O&&(this._dragOrigin=T(v.pointCoordinate3D(O)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),O=O||y.transform.centerPoint,z&&(v.bearing+=z),L&&(v.pitch+=L),v._updateCameraState();let $=[0,0,0];if(M){let it=v.pointCoordinate(O);if(v.projection.name==="globe"){let nt=n.latFromMercatorY(it.y),at=v.center.lat,tt=Math.min(n.mercatorZfromAltitude(1,nt)/n.mercatorZfromAltitude(1,at),2);M=M.rotate(-v.angle),$[0]=-M.x/v.worldSize*tt,$[1]=-M.y/v.worldSize*tt}else{let nt=v.pointCoordinate(O.sub(M));it&&nt&&($[0]=nt.x-it.x,$[1]=nt.y-it.y)}}let U=v.zoom,st=[0,0,0];if(k){let it=T(j||v.pointCoordinate3D(O)),nt={dir:n.normalize([],n.sub([],it,v._camera.position))};if(nt.dir[2]<0){let at=v.zoomDeltaToMovement(it,k);n.scale$2(st,nt.dir,at)}}let Y=n.add($,$,st);v._translateCameraConstrained(Y),k&&Math.abs(v.zoom-U)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(c,m,!0)}_fireEvents(e,c,m){let y=ea(this._eventsInProgress),v=ea(e),T={};for(let L in e){let{originalEvent:O}=e[L];this._eventsInProgress[L]||(T[`${L}start`]=O),this._eventsInProgress[L]=e[L]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(let L in T)this._fireEvent(L,T[L]);v&&this._fireEvent("move",v.originalEvent);for(let L in e){let{originalEvent:O}=e[L];this._fireEvent(L,O)}let M={},k;for(let L in this._eventsInProgress){let{handlerName:O,originalEvent:j}=this._eventsInProgress[L];this._handlersById[O].isActive()||(delete this._eventsInProgress[L],k=c[O]||j,M[`${L}end`]=k)}for(let L in M)this._fireEvent(L,M[L]);let z=ea(this._eventsInProgress);if(m&&(y||v)&&!z){this._updatingCamera=!0;let L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;L?(O(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:k})):(this._map.fire(new n.Event("moveend",{originalEvent:k})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,c){this._map.fire(new n.Event(e,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new Bc("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let ll="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Fc extends n.Evented{constructor(e,c){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,n.bindAll(["_renderFrameCallback"],this)}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,c){return this.jumpTo({center:e},c)}panBy(e,c,m){return e=n.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,n.extend({offset:e},c),m)}panTo(e,c,m){return this.easeTo(n.extend({center:e},c),m)}getZoom(){return this.transform.zoom}setZoom(e,c){return this.jumpTo({zoom:e},c),this}zoomTo(e,c,m){return this.easeTo(n.extend({zoom:e},c),m)}zoomIn(e,c){return this.zoomTo(this.getZoom()+1,e,c),this}zoomOut(e,c){return this.zoomTo(this.getZoom()-1,e,c),this}getBearing(){return this.transform.bearing}setBearing(e,c){return this.jumpTo({bearing:e},c),this}getPadding(){return this.transform.padding}setPadding(e,c){return this.jumpTo({padding:e},c),this}rotateTo(e,c,m){return this.easeTo(n.extend({bearing:e},c),m)}resetNorth(e,c){return this.rotateTo(0,n.extend({duration:1e3},e),c),this}resetNorthPitch(e,c){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},e),c),this}snapToNorth(e,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,c):this}getPitch(){return this.transform.pitch}setPitch(e,c){return this.jumpTo({pitch:e},c),this}cameraForBounds(e,c){e=n.LngLatBounds.convert(e);let m=c&&c.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),m,c)}_extendCameraOptions(e){let c={top:0,bottom:0,right:0,left:0};if(typeof(e=n.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=="number"){let m=e.padding;e.padding={top:m,bottom:m,right:m,left:m}}return e.padding=n.extend(c,e.padding),e}_cameraForBoxAndBearing(e,c,m,y){let v=this._extendCameraOptions(y),T=this.transform,M=T.padding,k=T.project(n.LngLat.convert(e)),z=T.project(n.LngLat.convert(c)),L=new n.pointGeometry(k.x,z.y),O=new n.pointGeometry(z.x,k.y),j=-n.degToRad(m),X=k.rotate(j),$=z.rotate(j),U=L.rotate(j),st=O.rotate(j),Y=new n.pointGeometry(Math.max(X.x,$.x,U.x,st.x),Math.max(X.y,$.y,U.y,st.y)),it=new n.pointGeometry(Math.min(X.x,$.x,U.x,st.x),Math.min(X.y,$.y,U.y,st.y)),nt=Y.sub(it),at=(T.width-((M.left||0)+(M.right||0)+v.padding.left+v.padding.right))/nt.x,tt=(T.height-((M.top||0)+(M.bottom||0)+v.padding.top+v.padding.bottom))/nt.y;if(tt<0||at<0)return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let ct=Math.min(T.scaleZoom(T.scale*Math.min(at,tt)),v.maxZoom),bt=typeof v.offset.x=="number"&&typeof v.offset.y=="number"?new n.pointGeometry(v.offset.x,v.offset.y):n.pointGeometry.convert(v.offset),Ct=new n.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(m*Math.PI/180),zt=bt.add(Ct).mult(T.scale/T.zoomScale(ct));return{center:T.unproject(k.add(z).div(2).sub(zt)),zoom:ct,bearing:m}}_cameraForBox(e,c,m,y,v){let T=this._extendCameraOptions(v);m=m||0,y=y||0,e=n.LngLat.convert(e),c=n.LngLat.convert(c);let M=this.transform.clone();M.padding=T.padding;let k=this.getFreeCameraOptions(),z=new n.LngLat(.5*(e.lng+c.lng),.5*(e.lat+c.lat)),L=.5*(m+y);if(M._camera.position[2]<n.mercatorZfromAltitude(L,z.lat))return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");k.lookAtPoint(z),M.setFreeCameraOptions(k);let O=n.MercatorCoordinate.fromLngLat(e),j=n.MercatorCoordinate.fromLngLat(c),X=M.pointRayIntersection(M.centerPoint,L),$=[(U=M.rayIntersectionCoordinate(X)).x,U.y,U.z];var U;let st=M.screenPointToMercatorRay(M.centerPoint),Y=M.projection.name!=="globe",it,nt=0;do{let at=Math.floor(M.zoom),tt=1<<at,ct=Math.min(tt*O.x,tt*j.x),bt=Math.min(tt*O.y,tt*j.y),Ct=Math.max(tt*O.x,tt*j.x),zt=Math.max(tt*O.y,tt*j.y),kt=new n.Aabb([ct,bt,m],[Ct,zt,y]),$t=n.Frustum.fromInvProjectionMatrix(M.invProjMatrix,M.worldSize,at,Y);if(kt.intersects($t)!==2){it&&(M._camera.position=n.scaleAndAdd([],M._camera.position,st.dir,-it),M._updateStateFromCamera());break}let wt=n.sub([],M._camera.position,$);it=.5*n.length(wt),M._camera.position=n.scaleAndAdd([],M._camera.position,st.dir,it);try{M._updateStateFromCamera()}catch{return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++nt<10);return{center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch}}fitBounds(e,c,m){return this._fitInternal(this.cameraForBounds(e,c),c,m)}_raycastElevationBox(e,c){let m=this.transform.elevation;if(!m)return;let y=new n.pointGeometry(e.x,c.y),v=new n.pointGeometry(c.x,e.y),T=m.pointCoordinate(e);if(!T)return;let M=m.pointCoordinate(c);if(!M)return;let k=m.pointCoordinate(y);if(!k)return;let z=m.pointCoordinate(v);if(!z)return;let L=new n.MercatorCoordinate(T[0],T[1]).toLngLat(),O=new n.MercatorCoordinate(M[0],M[1]).toLngLat(),j=new n.MercatorCoordinate(k[0],k[1]).toLngLat(),X=new n.MercatorCoordinate(z[0],z[1]).toLngLat(),$=Math.min(L.lng,Math.min(O.lng,Math.min(j.lng,X.lng))),U=Math.min(L.lat,Math.min(O.lat,Math.min(j.lat,X.lat))),st=Math.max(L.lng,Math.max(O.lng,Math.max(j.lng,X.lng))),Y=Math.max(L.lat,Math.max(O.lat,Math.max(j.lat,X.lat))),it=Math.min(T[3],Math.min(M[3],Math.min(k[3],z[3]))),nt=Math.max(T[3],Math.max(M[3],Math.max(k[3],z[3])));return{minLngLat:new n.LngLat($,U),maxLngLat:new n.LngLat(st,Y),minAltitude:it,maxAltitude:nt}}fitScreenCoordinates(e,c,m,y,v){let T,M,k,z,L=n.pointGeometry.convert(e),O=n.pointGeometry.convert(c),j=this._raycastElevationBox(L,O);if(j)T=j.minLngLat,M=j.maxLngLat,k=j.minAltitude,z=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,O))return this;T=this.transform.pointLocation(L),M=this.transform.pointLocation(O)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(n.pointGeometry.convert(e)),this.transform.pointLocation(n.pointGeometry.convert(c)),m,y):this._cameraForBox(T,M,k,z,y),y,v)}_fitInternal(e,c,m){return e?(delete(c=n.extend(e,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(e,c){this.stop();let m=e.preloadOnly?this.transform.clone():this.transform,y=!1,v=!1,T=!1;return"zoom"in e&&m.zoom!==+e.zoom&&(y=!0,m.zoom=+e.zoom),e.center!==void 0&&(m.center=n.LngLat.convert(e.center)),"bearing"in e&&m.bearing!==+e.bearing&&(v=!0,m.bearing=+e.bearing),"pitch"in e&&m.pitch!==+e.pitch&&(T=!0,m.pitch=+e.pitch),e.padding==null||m.isPaddingEqual(e.padding)||(m.padding=e.padding),e.preloadOnly?(this._preloadTiles(m),this):(this.fire(new n.Event("movestart",c)).fire(new n.Event("move",c)),y&&this.fire(new n.Event("zoomstart",c)).fire(new n.Event("zoom",c)).fire(new n.Event("zoomend",c)),v&&this.fire(new n.Event("rotatestart",c)).fire(new n.Event("rotate",c)).fire(new n.Event("rotateend",c)),T&&this.fire(new n.Event("pitchstart",c)).fire(new n.Event("pitch",c)).fire(new n.Event("pitchend",c)),this.fire(new n.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.warnOnce(ll),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,c){let m=this.transform;if(!m.projection.supportsFreeCamera)return n.warnOnce(ll),this;this.stop();let y=m.zoom,v=m.pitch,T=m.bearing;m.setFreeCameraOptions(e);let M=y!==m.zoom,k=v!==m.pitch,z=T!==m.bearing;return this.fire(new n.Event("movestart",c)).fire(new n.Event("move",c)),M&&this.fire(new n.Event("zoomstart",c)).fire(new n.Event("zoom",c)).fire(new n.Event("zoomend",c)),z&&this.fire(new n.Event("rotatestart",c)).fire(new n.Event("rotate",c)).fire(new n.Event("rotateend",c)),k&&this.fire(new n.Event("pitchstart",c)).fire(new n.Event("pitch",c)).fire(new n.Event("pitchend",c)),this.fire(new n.Event("moveend",c)),this}easeTo(e,c){this._stop(!1,e.easeId),((e=n.extend({offset:[0,0],duration:500,easing:n.ease},e)).animate===!1||!e.essential&&n.exported.prefersReducedMotion)&&(e.duration=0);let m=this.transform,y=this.getZoom(),v=this.getBearing(),T=this.getPitch(),M=this.getPadding(),k="zoom"in e?+e.zoom:y,z="bearing"in e?this._normalizeBearing(e.bearing,v):v,L="pitch"in e?+e.pitch:T,O="padding"in e?e.padding:m.padding,j=n.pointGeometry.convert(e.offset),X,$,U;if(m.projection.name==="globe"){let zt=n.MercatorCoordinate.fromLngLat(m.center),kt=j.rotate(-m.angle);zt.x+=kt.x/m.worldSize,zt.y+=kt.y/m.worldSize;let $t=zt.toLngLat(),wt=n.LngLat.convert(e.center||$t);this._normalizeCenter(wt),X=m.centerPoint.add(kt),$=new n.pointGeometry(zt.x,zt.y).mult(m.worldSize),U=new n.pointGeometry(n.mercatorXfromLng(wt.lng),n.mercatorYfromLat(wt.lat)).mult(m.worldSize).sub($)}else{X=m.centerPoint.add(j);let zt=m.pointLocation(X),kt=n.LngLat.convert(e.center||zt);this._normalizeCenter(kt),$=m.project(zt),U=m.project(kt).sub($)}let st=m.zoomScale(k-y),Y,it;e.around&&(Y=n.LngLat.convert(e.around),it=m.locationPoint(Y));let nt=this._zooming||k!==y,at=this._rotating||v!==z,tt=this._pitching||L!==T,ct=!m.isPaddingEqual(O),bt=zt=>kt=>{if(nt&&(zt.zoom=n.number(y,k,kt)),at&&(zt.bearing=n.number(v,z,kt)),tt&&(zt.pitch=n.number(T,L,kt)),ct&&(zt.interpolatePadding(M,O,kt),X=zt.centerPoint.add(j)),Y)zt.setLocationAtPoint(Y,it);else{let $t=zt.zoomScale(zt.zoom-y),wt=k>y?Math.min(2,st):Math.max(.5,st),qt=Math.pow(wt,1-kt),Nt=zt.unproject($.add(U.mult(kt*qt)).mult($t));zt.setLocationAtPoint(zt.renderWorldCopies?Nt.wrap():Nt,X)}return e.preloadOnly||this._fireMoveEvents(c),zt};if(e.preloadOnly){let zt=this._emulate(bt,e.duration,m);return this._preloadTiles(zt),this}let Ct={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=nt,this._rotating=at,this._pitching=tt,this._padding=ct,this._easeId=e.easeId,this._prepareEase(c,e.noMoveStart,Ct),this._ease(bt(m),zt=>{m.recenterOnTerrain(),this._afterEase(c,zt)},e),this}_prepareEase(e,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new n.Event("movestart",e)),this._zooming&&!m.zooming&&this.fire(new n.Event("zoomstart",e)),this._rotating&&!m.rotating&&this.fire(new n.Event("rotatestart",e)),this._pitching&&!m.pitching&&this.fire(new n.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new n.Event("move",e)),this._zooming&&this.fire(new n.Event("zoom",e)),this._rotating&&this.fire(new n.Event("rotate",e)),this._pitching&&this.fire(new n.Event("pitch",e))}_afterEase(e,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let m=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new n.Event("zoomend",e)),y&&this.fire(new n.Event("rotateend",e)),v&&this.fire(new n.Event("pitchend",e)),this.fire(new n.Event("moveend",e))}flyTo(e,c){if(!e.essential&&n.exported.prefersReducedMotion){let ie=n.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ie,c)}this.stop(),e=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},e);let m=this.transform,y=this.getZoom(),v=this.getBearing(),T=this.getPitch(),M=this.getPadding(),k="zoom"in e?n.clamp(+e.zoom,m.minZoom,m.maxZoom):y,z="bearing"in e?this._normalizeBearing(e.bearing,v):v,L="pitch"in e?+e.pitch:T,O="padding"in e?e.padding:m.padding,j=m.zoomScale(k-y),X=n.pointGeometry.convert(e.offset),$=m.centerPoint.add(X),U=m.pointLocation($),st=n.LngLat.convert(e.center||U);this._normalizeCenter(st);let Y=m.project(U),it=m.project(st).sub(Y),nt=e.curve,at=Math.max(m.width,m.height),tt=at/j,ct=it.mag();if("minZoom"in e){let ie=n.clamp(Math.min(e.minZoom,y,k),m.minZoom,m.maxZoom),ne=at/m.zoomScale(ie-y);nt=Math.sqrt(ne/ct*2)}let bt=nt*nt;function Ct(ie){let ne=(tt*tt-at*at+(ie?-1:1)*bt*bt*ct*ct)/(2*(ie?tt:at)*bt*ct);return Math.log(Math.sqrt(ne*ne+1)-ne)}function zt(ie){return(Math.exp(ie)-Math.exp(-ie))/2}function kt(ie){return(Math.exp(ie)+Math.exp(-ie))/2}let $t=Ct(0),wt=function(ie){return kt($t)/kt($t+nt*ie)},qt=function(ie){return at*((kt($t)*(zt(ne=$t+nt*ie)/kt(ne))-zt($t))/bt)/ct;var ne},Nt=(Ct(1)-$t)/nt;if(Math.abs(ct)<1e-6||!isFinite(Nt)){if(Math.abs(at-tt)<1e-6)return this.easeTo(e,c);let ie=tt<at?-1:1;Nt=Math.abs(Math.log(tt/at))/nt,qt=function(){return 0},wt=function(ne){return Math.exp(ie*nt*ne)}}e.duration="duration"in e?+e.duration:1e3*Nt/("screenSpeed"in e?+e.screenSpeed/nt:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);let re=v!==z,Dt=L!==T,ee=!m.isPaddingEqual(O),ue=ie=>ne=>{let fe=ne*Nt,Se=1/wt(fe);ie.zoom=ne===1?k:y+ie.scaleZoom(Se),re&&(ie.bearing=n.number(v,z,ne)),Dt&&(ie.pitch=n.number(T,L,ne)),ee&&(ie.interpolatePadding(M,O,ne),$=ie.centerPoint.add(X));let ae=ne===1?st:ie.unproject(Y.add(it.mult(qt(fe))).mult(Se));return ie.setLocationAtPoint(ie.renderWorldCopies?ae.wrap():ae,$),ie._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(c),ie};if(e.preloadOnly){let ie=this._emulate(ue,e.duration,m);return this._preloadTiles(ie),this}return this._zooming=!0,this._rotating=re,this._pitching=Dt,this._padding=ee,this._prepareEase(c,!1),this._ease(ue(m),()=>this._afterEase(c),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!e){let m=this.handlers;m&&m.stop(!1)}return this}_ease(e,c,m){m.animate===!1||m.duration===0?(e(1),c()):(this._easeStart=n.exported.now(),this._easeOptions=m,this._onEaseFrame=e,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let e=Math.min((n.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,c){e=n.wrap(e,-180,180);let m=Math.abs(e-c);return Math.abs(e-360-c)<m&&(e-=360),Math.abs(e+360-c)<m&&(e+=360),e}_normalizeCenter(e){let c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;let m=e.lng-c.center.lng;e.lng+=m>180?-360:m<-180?360:0}_emulate(e,c,m){let y=Math.ceil(15*c/1e3),v=[],T=e(m.clone());for(let M=0;M<=y;M++){let k=T(M/y);v.push(k.clone())}return v}}class cl{constructor(e={}){this.options=e,n.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){let c=this.options&&this.options.compact;return this._map=e,this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=D("button","mapboxgl-ctrl-attrib-button",this._container),D("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=D("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,c){let m=this._map._getUIString(`AttributionControl.${c}`);e.setAttribute("aria-label",m),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));let c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.config.ACCESS_TOKEN}];if(e){let m=c.reduce((y,v,T)=>(v.value&&(y+=`${v.key}=${v.value}${T<c.length-1?"&":""}`),y),"?");e.href=`${n.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||e.sourceDataType!=="metadata"&&e.sourceDataType!=="visibility"&&e.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){let y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}let c=this._map.style._sourceCaches;for(let y in c){let v=c[y];if(v.used){let T=v.getSource();T.attribution&&e.indexOf(T.attribution)<0&&e.push(T.attribution)}}e.sort((y,v)=>y.length-v.length),e=e.filter((y,v)=>{for(let T=v+1;T<e.length;T++)if(e[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));let m=e.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,e.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ju{constructor(){n.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=D("div","mapboxgl-ctrl");let c=D("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&e.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let e=this._map.style._sourceCaches;if(Object.entries(e).length===0)return!0;for(let c in e){let m=e[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){let e=this._container.children;if(e.length){let c=e[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Gu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let c=++this._id;return this._queue.push({callback:e,id:c,cancelled:!1}),c}remove(e){let c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(let y of m)if(y.id===e)return void(y.cancelled=!0)}run(e=0){let c=this._currentlyRunning=this._queue;this._queue=[];for(let m of c)if(!m.cancelled&&(m.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function hl(d,e,c){if(d=new n.LngLat(d.lng,d.lat),e){let m=new n.LngLat(d.lng-360,d.lat),y=new n.LngLat(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-c.center.lng)/360),T=c.locationPoint(d).distSqr(e),M=e.x<0||e.y<0||e.x>c.width||e.y>c.height;c.locationPoint(m).distSqr(e)<T&&(M||Math.abs(m.lng-c.center.lng)<v)?d=m:c.locationPoint(y).distSqr(e)<T&&(M||Math.abs(y.lng-c.center.lng)<v)&&(d=y)}for(;Math.abs(d.lng-c.center.lng)>180;){let m=c.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}let ul={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class dl extends n.Evented{constructor(e,c){if(super(),(e instanceof n.window.HTMLElement||c)&&(e=n.extend({element:e},c)),n.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),e&&e.element)this._element=e.element,this._offset=n.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=D("div");let y=41,v=27,T=B("svg",{display:"block",height:y*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${y}`},this._element),M=B("radialGradient",{id:"shadowGradient"},B("defs",{},T));B("stop",{offset:"10%","stop-opacity":.4},M),B("stop",{offset:"100%","stop-opacity":.05},M),B("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),B("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),B("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),B("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=n.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});let m=this._element.classList;for(let y in ul)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){let e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=n.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let y=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){let c=e.code,m=e.charCode||e.keyCode;c!=="Space"&&c!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(e){let c=e.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){let e=this._map;if(!e)return;let c=this._pos;if(!c||c.x<0||c.x>e.transform.width||c.y<0||c.y>e.transform.height)return void this._clearFadeTimer();let m=e.unproject(c),y=!1;if(e.transform._terrainEnabled()&&e.getTerrain()){let T=e.getFreeCameraOptions();if(T.position){let M=T.position.toLngLat();y=M.distanceTo(m)<.9*M.distanceTo(this._lngLat)}}let v=(1-e._queryFogOpacity(m))*(y?.2:1);this._element.style.opacity=`${v}`,this._popup&&this._popup._setOpacity(`${v}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let e=this._pos;if(!e)return;let c=this._offset.mult(this._scale),m=this._calculatePitch(),y=this._calculateRotation();this._element.style.transform=`
            translate(${e.x}px, ${e.y}px) ${ul[this._anchor]}
            rotateX(${m}deg) rotateZ(${y}deg)
            translate(${c.x}px, ${c.y}px)
        `}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._map&&this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._map&&this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(e){n.window.cancelAnimationFrame(this._updateFrameId);let c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=hl(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),e===!0?this._updateFrameId=n.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!c.getTerrain()&&!c.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=n.pointGeometry.convert(e),this._update(),this}_onMove(e){let c=this._map;if(c){if(!this._isDragging){let m=this._clickTolerance||c._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"}_addDragHandler(e){let c=this._map;c&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos),this._pointerdownPos=e.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;let c=this._map;return c&&(e?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Vp{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;let c=n.easeCubicInOut((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,c,m){this._start=this.getValue(c),this._end=e,this._startTime=c,this._endTime=c+m}}let Zp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Oc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ia(d){d.parentNode&&d.parentNode.removeChild(d)}let Vc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Zc{constructor(e,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Js({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,m&&(this.mousePitch=new Pc({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),n.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(e,c){this.mouseRotate.mousedown(e,c),this.mousePitch&&this.mousePitch.mousedown(e,c),dt()}move(e,c){let m=this.map,y=this.mouseRotate.mousemoveWindow(e,c),v=y&&y.bearingDelta;if(v&&m.setBearing(m.getBearing()+v),this.mousePitch){let T=this.mousePitch.mousemoveWindow(e,c),M=T&&T.pitchDelta;M&&m.setPitch(m.getPitch()+M)}}off(){let e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){W(),n.window.removeEventListener("mousemove",this.mousemove),n.window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(n.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),St(this.element,e)),n.window.addEventListener("mousemove",this.mousemove),n.window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,St(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){e.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_t(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){e.targetTouches.length!==1?this.reset():(this._lastPos=_t(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let tn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},dn,na=0,ms=!1,Uc={maxWidth:100,unit:"metric"};function pl(d,e,c){let m=c&&c.maxWidth||100,y=d._containerHeight/2,v=d._containerWidth/2-m/2,T=d.unproject([v,y]),M=d.unproject([v+m,y]),k=T.distanceTo(M);if(c&&c.unit==="imperial"){let z=3.2808*k;z>5280?to(e,m,z/5280,d._getUIString("ScaleControl.Miles"),d):to(e,m,z,d._getUIString("ScaleControl.Feet"),d)}else c&&c.unit==="nautical"?to(e,m,k/1852,d._getUIString("ScaleControl.NauticalMiles"),d):k>=1e3?to(e,m,k/1e3,d._getUIString("ScaleControl.Kilometers"),d):to(e,m,k,d._getUIString("ScaleControl.Meters"),d)}function to(d,e,c,m,y){let v=function(M){let k=Math.pow(10,`${Math.floor(M)}`.length-1),z=M/k;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(L){let O=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*O)/O}(z),k*z}(c),T=v/c;y._requestDomTask(()=>{d.style.width=e*T+"px",d.innerHTML=`${v}&nbsp;${m}`})}let Sn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ii=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ra(d=new n.pointGeometry(0,0),e="bottom"){if(typeof d=="number"){let c=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(e){case"top":return new n.pointGeometry(0,d);case"top-left":return new n.pointGeometry(c,c);case"top-right":return new n.pointGeometry(-c,c);case"bottom":return new n.pointGeometry(0,-d);case"bottom-left":return new n.pointGeometry(c,-c);case"bottom-right":return new n.pointGeometry(-c,-c);case"left":return new n.pointGeometry(d,0);case"right":return new n.pointGeometry(-d,0)}return new n.pointGeometry(0,0)}return d instanceof n.pointGeometry||Array.isArray(d)?n.pointGeometry.convert(d):n.pointGeometry.convert(d[e]||[0,0])}let eo={version:n.version,supported:x,setRTLTextPlugin:n.setRTLTextPlugin,getRTLTextPluginStatus:n.getRTLTextPluginStatus,Map:class extends Fc{constructor(d){if((d=n.extend({},Oc,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&n.isSafariWithAntialiasingBug(n.window)&&(d.antialias=!1,n.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new nl(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._renderTaskQueue=new Gu,this._domRenderTaskQueue=new Gu,this._controls=[],this._markers=[],this._mapId=n.uniqueId(),this._locale=n.extend({},Zp,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Vp(0),this._explicitProjection=null,this._requestManager=new n.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=n.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof n.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&n.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),n.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),n.window!==void 0&&(n.window.addEventListener("online",this._onWindowOnline,!1),n.window.addEventListener("resize",this._onWindowResize,!1),n.window.addEventListener("orientationchange",this._onWindowResize,!1),n.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Nu(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new wu(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,n.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new cl({customAttribution:d.customAttribution})),this._logoControl=new ju,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update(e.dataType==="style"),this.fire(new n.Event(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new n.Event(`${e.dataType}dataloading`,e))})}_getMapId(){return this._mapId}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let c=d.onAdd(this);this._controls.push(d);let m=this._controlPositions[e];return e.indexOf("bottom")!==-1?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let e=!this._moving;return e&&this.fire(new n.Event("movestart",d)).fire(new n.Event("move",d)),this.fire(new n.Event("resize",d)),e&&this.fire(new n.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(n.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._updateProjection(d)}_updateProjection(d){d===null&&(this._explicitProjection=null);let e=d||this.getProjection(),c=this.transform.setProjection(e);if(d&&(this._explicitProjection=this.transform.getProjection()),c){this.painter.clearBackgroundTiles();for(let m in this.style._sourceCaches)this.style._sourceCaches[m].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(d){return this.transform.locationPoint3D(n.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(n.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(d,e,c){if(d==="mouseenter"||d==="mouseover"){let m=!1,y=T=>{let M=e.filter(z=>this.getLayer(z)),k=M.length?this.queryRenderedFeatures(T.point,{layers:M}):[];k.length?m||(m=!0,c.call(this,new un(d,this,T.originalEvent,{features:k}))):m=!1},v=()=>{m=!1};return{layers:new Set(e),listener:c,delegates:{mousemove:y,mouseout:v}}}if(d==="mouseleave"||d==="mouseout"){let m=!1,y=T=>{let M=e.filter(k=>this.getLayer(k));(M.length?this.queryRenderedFeatures(T.point,{layers:M}):[]).length?m=!0:m&&(m=!1,c.call(this,new un(d,this,T.originalEvent)))},v=T=>{m&&(m=!1,c.call(this,new un(d,this,T.originalEvent)))};return{layers:new Set(e),listener:c,delegates:{mousemove:y,mouseout:v}}}{let m=y=>{let v=e.filter(M=>this.getLayer(M)),T=v.length?this.queryRenderedFeatures(y.point,{layers:v}):[];T.length&&(y.features=T,c.call(this,y),delete y.features)};return{layers:new Set(e),listener:c,delegates:{[d]:m}}}}on(d,e,c){if(c===void 0)return super.on(d,e);Array.isArray(e)||(e=[e]);let m=this._createDelegatedListener(d,e,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(let y in m.delegates)this.on(y,m.delegates[y]);return this}once(d,e,c){if(c===void 0)return super.once(d,e);Array.isArray(e)||(e=[e]);let m=this._createDelegatedListener(d,e,c);for(let y in m.delegates)this.once(y,m.delegates[y]);return this}off(d,e,c){if(c===void 0)return super.off(d,e);e=new Set(Array.isArray(e)?e:[e]);let m=(v,T)=>{if(v.size!==T.size)return!1;for(let M of v)if(!T.has(M))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[d]:void 0;return y&&(v=>{for(let T=0;T<v.length;T++){let M=v[T];if(M.listener===c&&m(M.layers,e)){for(let k in M.delegates)this.off(k,M.delegates[k]);return v.splice(T,1),this}}})(y),this}queryRenderedFeatures(d,e){return this.style?(e!==void 0||d===void 0||d instanceof n.pointGeometry||Array.isArray(d)||(e=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],e=e||{},this.transform)):[]}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}queryTerrainElevation(d,e){let c=this.transform.elevation;return c?(e=n.extend({},{exaggerated:!0},e),c.getAtPoint(n.MercatorCoordinate.fromLngLat(d),null,e.exaggerated)):null}setStyle(d,e){return(e=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(d,e))}_getUIString(d){let e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Qi(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){let c=this._requestManager.normalizeStyleURL(d),m=this._requestManager.transformRequest(c,n.ResourceType.Style);n.getJSON(m,(y,v)=>{y?this.fire(new n.ErrorEvent(y)):v&&this._updateDiff(v,e)})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d)&&this._update(!0)}catch(c){n.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.warnOnce("There is no style added to the map."),!1)}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){let d=this.style&&this.style._sourceCaches;for(let e in d){let c=d[e]._tiles;for(let m in c){let y=c[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(d,e,c){this._lazyInitEmptyStyle(),this.style.addSourceType(d,e,c)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,e,{pixelRatio:c=1,sdf:m=!1,stretchX:y,stretchY:v,content:T}={}){if(this._lazyInitEmptyStyle(),e instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&e instanceof n.window.ImageBitmap){let{width:M,height:k,data:z}=n.exported.getImageData(e);this.style.addImage(d,{data:new n.RGBAImage({width:M,height:k},z),pixelRatio:c,stretchX:y,stretchY:v,content:T,sdf:m,version:0})}else if(e.width===void 0||e.height===void 0)this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:M,height:k}=e,z=e;this.style.addImage(d,{data:new n.RGBAImage({width:M,height:k},new Uint8Array(z.data)),pixelRatio:c,stretchX:y,stretchY:v,content:T,sdf:m,version:0,userImage:z}),z.onAdd&&z.onAdd(this,d)}}updateImage(d,e){let c=this.style.getImage(d);if(!c)return void this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let m=e instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&e instanceof n.window.ImageBitmap?n.exported.getImageData(e):e,{width:y,height:v}=m;y!==void 0&&v!==void 0?y===c.data.width&&v===c.data.height?(c.data.replace(m.data,!(e instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&e instanceof n.window.ImageBitmap)),this.style.updateImage(d,c)):this.fire(new n.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,e){n.getImage(this._requestManager.transformRequest(d,n.ResourceType.Image),(c,m)=>{e(c,m instanceof n.window.HTMLImageElement?n.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,e,c){return this.style.setLayerZoomRange(d,e,c),this._update(!0)}setFilter(d,e,c={}){return this.style.setFilter(d,e,c),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,c,m={}){return this.style.setPaintProperty(d,e,c,m),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,c,m={}){return this.style.setLayoutProperty(d,e,c,m),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.LngLat.convert(d),this.transform):0}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;let d=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300,c,m,y,v=this._container;for(;v&&(!m||!y);){let T=n.window.getComputedStyle(v).transform;T&&T!=="none"&&(c=T.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(m=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),v=v.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=y?Math.abs(e/y):e}_detectMissingCSS(){n.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=D("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();let e=this._canvasContainer=D("div","mapboxgl-canvas-container",d);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=D("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let c=this._controlContainer=D("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=D("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,e){let c=n.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(d),this._canvas.height=c*Math.ceil(e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){let e=this._markers.indexOf(d);e!==-1&&this._markers.splice(e,1)}_setupPainter(){let d=n.extend({},x.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);e?(n.storeAuthState(e,!0),this.painter=new vu(e,this.transform),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.exported$1.testSupport(e)):this.fire(new n.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let e,c=this.painter.context.extTimerQuery,m=n.exported.now();if(this.listens("gpu-timing-frame")&&(e=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,e)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;let y=!1,v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let k=this.transform.zoom,z=this.transform.pitch,L=n.exported.now();this.style.zoomHistory.update(k,L);let O=new n.EvaluationParameters(k,{now:L,fadeDuration:v,pitch:z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=O.crossFadingFactor();j===1&&j===this._crossFadingFactor||(y=!0,this._crossFadingFactor=j),this.style.update(O)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerUpdate()):T=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new n.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){let k=n.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,e),setTimeout(()=>{let z=c.getQueryObjectEXT(e,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(e),this.fire(new n.Event("gpu-timing-frame",{cpuTime:k,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){let k=this.painter.collectGpuTimers();setTimeout(()=>{let z=this.painter.queryGpuTimers(k);this.fire(new n.Event("gpu-timing-layer",{layerTimes:z}))},50)}let M=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(M||this._repaint)this.triggerRepaint();else{let k=!this.isMoving()&&this.loaded();if(k&&(T=this._updateAverageElevation(m,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new n.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let z=this._calculateSpeedIndex();this.fire(new n.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(let d of this._markers)d._update()}_updateAverageElevation(d,e=!1){let c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((e||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){let m=this.transform.averageElevation,y=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;let T=Math.abs(m-y);if(T>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,d,300)}else if(T>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(d)&&c(this._averageElevation.getValue(d))}_authenticate(){n.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===n.AUTH_ERR_MSG||d.status===401)){let e=this.painter.context.gl;n.storeAuthState(e,!1),this._logoControl instanceof ju&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),n.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){let d=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());let c=this.painter.context.gl,m=c.createFramebuffer();function y(v){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,v,0);let T=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,T),T}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(y(d),e.canvasCopies.map(y),e.timeStamps)}_canvasPixelComparison(d,e,c){let m=c[1]-c[0],y=d.length/4;for(let v=0;v<e.length;v++){let T=e[v],M=0;for(let k=0;k<T.length;k+=4)T[k]===d[k]&&T[k+1]===d[k+1]&&T[k+2]===d[k+2]&&T[k+3]===d[k+3]&&(M+=1);m+=(c[v+2]-c[v+1])*(1-M/y)}return m}remove(){this._hash&&this._hash.remove();for(let e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),n.window!==void 0&&(n.window.removeEventListener("resize",this._onWindowResize,!1),n.window.removeEventListener("orientationchange",this._onWindowResize,!1),n.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.removeEventListener("online",this._onWindowOnline,!1));let d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),ia(this._canvasContainer),ia(this._controlContainer),ia(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),n.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=n.exported.frame(e=>{let c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(e)}))}_preloadTiles(d){let e=this.style?Object.values(this.style._sourceCaches):[];return n.asyncAll(e,(c,m)=>c._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,e){n.setCacheLimits(d,e)}get version(){return n.version}},NavigationControl:class{constructor(d){this.options=n.extend({},Vc,d),this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(n.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),D("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),D("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{let c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:e}):c.resetNorth({},{originalEvent:e}))}),this._compassIcon=D("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let d=this._map;if(!d)return;let e=d.getZoom(),c=e===d.getMaxZoom(),m=e===d.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){let d=this._map;if(!d)return;let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zc(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){let d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,e){let c=D("button",d,this._container);return c.type="button",c.addEventListener("click",e),c}_setButtonTitle(d,e){if(!this._map)return;let c=this._map._getUIString(`NavigationControl.${e}`);d.setAttribute("aria-label",c),d.firstElementChild&&d.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends n.Evented{constructor(d){super(),this.options=n.extend({},tn,d),n.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kc(this._updateMarkerRotation,20)}onAdd(d){var e;return this._map=d,this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-group"),e=this._setupUI,dn!==void 0?e(dn):n.window.navigator.permissions!==void 0?n.window.navigator.permissions.query({name:"geolocation"}).then(c=>{dn=c.state!=="denied",e(dn)}):(dn=!!n.window.navigator.geolocation,e(dn)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(n.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,na=0,ms=!1}_isOutOfMapMaxBounds(d){let e=this._map.getMaxBounds(),c=d.coords;return!!e&&(c.longitude<e.getWest()||c.longitude>e.getEast()||c.latitude<e.getSouth()||c.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("geolocate",d)),this._finish()}}_updateCamera(d){let e=new n.LngLat(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,m=this._map.getBearing(),y=n.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(c),y,{geolocateSource:!0})}_updateMarker(d){if(d){let e=new n.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let d=this._map._containerHeight/2,e=this._map.unproject([0,d]),c=this._map.unproject([100,d]),m=e.distanceTo(c)/100,y=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&ms)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=D("button","mapboxgl-ctrl-geolocate",this._container),D("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{let e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=D("div","mapboxgl-user-location"),this._dotElement.appendChild(D("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(D("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new dl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=D("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||this._watchState!=="ACTIVE_LOCK"||e.originalEvent&&e.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":na--,ms=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),na++,na>1?(d={maximumAge:6e5,timeout:0},ms=!0):(d=this.options.positionOptions,ms=!1),this._geolocationWatchID=n.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else n.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let d=()=>{n.window.addEventListener("ondeviceorientationabsolute"in n.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};n.window.DeviceMotionEvent!==void 0&&typeof n.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(e=>{e==="granted"&&d()}).catch(console.error):d()}_clearWatch(){n.window.navigator.geolocation.clearWatch(this._geolocationWatchID),n.window.removeEventListener("deviceorientation",this._onDeviceOrientation),n.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:cl,ScaleControl:class{constructor(d){this.options=n.extend({},Uc,d),n.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){pl(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,pl(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof n.window.HTMLElement?this._container=d.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),n.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in n.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in n.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=D("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,n.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!n.window.document.fullscreenEnabled&&!n.window.document.webkitFullscreenEnabled)}_setupUI(){let d=this._fullscreenButton=D("button","mapboxgl-ctrl-fullscreen",this._controlContainer);D("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),n.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(n.window.document.fullscreenElement||n.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?n.window.document.exitFullscreen?n.window.document.exitFullscreen():n.window.document.webkitCancelFullScreen&&n.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.Evented{constructor(d){super(),this.options=n.extend(Object.create(Sn),d),n.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new n.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=n.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();let e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(n.window.document.createTextNode(d))}setHTML(d){let e=n.window.document.createDocumentFragment(),c=n.window.document.createElement("body"),m;for(c.innerHTML=d;m=c.firstChild,m;)e.appendChild(m);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=D("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(d),this.options.closeButton){let c=this._closeButton=D("button","mapboxgl-popup-close-button",e);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let e;return this._classList.delete(d)?e=!1:(this._classList.add(d),e=!0),this._updateClassList(),e}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;let e=this._map,c=this._container,m=this._pos;if(!e||!c||!m)return"bottom";let y=c.offsetWidth,v=c.offsetHeight,T=m.x<y/2,M=m.x>e.transform.width-y/2;if(m.y+d<v)return T?"top-left":M?"top-right":"top";if(m.y>e.transform.height-v){if(T)return"bottom-left";if(M)return"bottom-right"}return T?"left":M?"right":"bottom"}_updateClassList(){let d=this._container;if(!d)return;let e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),d.className=e.join(" ")}_update(d){let e=this._map,c=this._content;if(!e||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=D("div","mapboxgl-popup",e.getContainer()),this._tip=D("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hl(this._lngLat,this._pos,e.transform)),!this._trackPointer||d){let y=this._pos=this._trackPointer&&d?d:e.project(this._lngLat),v=ra(this.options.offset),T=this._anchor=this._getAnchor(v.y),M=ra(this.options.offset,T),k=y.add(M).round();e._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${ul[T]} translate(${k.x}px,${k.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(ii);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._content&&(this._content.style.opacity=d),this._tip&&(this._tip.style.opacity=d)}},Marker:dl,Style:Qi,LngLat:n.LngLat,LngLatBounds:n.LngLatBounds,Point:n.pointGeometry,MercatorCoordinate:n.MercatorCoordinate,FreeCameraOptions:Wo,Evented:n.Evented,config:n.config,prewarm:function(){_e().acquire(pe)},clearPrewarmedResources:function(){let d=he;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(pe),he=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return n.config.ACCESS_TOKEN},set accessToken(d){n.config.ACCESS_TOKEN=d},get baseApiUrl(){return n.config.API_URL},set baseApiUrl(d){n.config.API_URL=d},get workerCount(){return ce.workerCount},set workerCount(d){ce.workerCount=d},get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){n.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){n.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:n.exported.setNow,restoreNow:n.exported.restoreNow};return eo});var f=o;return f})});var _1=zl((t_,e_)=>{(function(l,s){typeof t_=="object"&&typeof e_<"u"?e_.exports=s():typeof define=="function"&&define.amd?define(s):(l=l||self).RBush=s()})(t_,function(){"use strict";function l(W,et,mt,St,_t){(function Mt(Rt,Vt,Yt,jt,ye){for(;jt>Yt;){if(jt-Yt>600){var le=jt-Yt+1,me=Vt-Yt+1,He=Math.log(le),Ye=.5*Math.exp(2*He/3),be=.5*Math.sqrt(He*Ye*(le-Ye)/le)*(me-le/2<0?-1:1),Me=Math.max(Yt,Math.floor(Vt-me*Ye/le+be)),Ui=Math.min(jt,Math.floor(Vt+(le-me)*Ye/le+be));Mt(Rt,Vt,Me,Ui,ye)}var Di=Rt[Vt],di=Yt,_i=jt;for(s(Rt,Yt,Vt),ye(Rt[jt],Di)>0&&s(Rt,Yt,jt);di<_i;){for(s(Rt,di,_i),di++,_i--;ye(Rt[di],Di)<0;)di++;for(;ye(Rt[_i],Di)>0;)_i--}ye(Rt[Yt],Di)===0?s(Rt,Yt,_i):s(Rt,++_i,jt),_i<=Vt&&(Yt=_i+1),Vt<=_i&&(jt=_i-1)}})(W,et,mt||0,St||W.length-1,_t||o)}function s(W,et,mt){var St=W[et];W[et]=W[mt],W[mt]=St}function o(W,et){return W<et?-1:W>et?1:0}var u=function(W){W===void 0&&(W=9),this._maxEntries=Math.max(4,W),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function f(W,et,mt){if(!mt)return et.indexOf(W);for(var St=0;St<et.length;St++)if(mt(W,et[St]))return St;return-1}function n(W,et){x(W,0,W.children.length,et,W)}function x(W,et,mt,St,_t){_t||(_t=Q(null)),_t.minX=1/0,_t.minY=1/0,_t.maxX=-1/0,_t.maxY=-1/0;for(var Mt=et;Mt<mt;Mt++){var Rt=W.children[Mt];w(_t,W.leaf?St(Rt):Rt)}return _t}function w(W,et){return W.minX=Math.min(W.minX,et.minX),W.minY=Math.min(W.minY,et.minY),W.maxX=Math.max(W.maxX,et.maxX),W.maxY=Math.max(W.maxY,et.maxY),W}function E(W,et){return W.minX-et.minX}function A(W,et){return W.minY-et.minY}function D(W){return(W.maxX-W.minX)*(W.maxY-W.minY)}function B(W){return W.maxX-W.minX+(W.maxY-W.minY)}function G(W,et){return W.minX<=et.minX&&W.minY<=et.minY&&et.maxX<=W.maxX&&et.maxY<=W.maxY}function rt(W,et){return et.minX<=W.maxX&&et.minY<=W.maxY&&et.maxX>=W.minX&&et.maxY>=W.minY}function Q(W){return{children:W,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function dt(W,et,mt,St,_t){for(var Mt=[et,mt];Mt.length;)if(!((mt=Mt.pop())-(et=Mt.pop())<=St)){var Rt=et+Math.ceil((mt-et)/St/2)*St;l(W,Rt,et,mt,_t),Mt.push(et,Rt,Rt,mt)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(W){var et=this.data,mt=[];if(!rt(W,et))return mt;for(var St=this.toBBox,_t=[];et;){for(var Mt=0;Mt<et.children.length;Mt++){var Rt=et.children[Mt],Vt=et.leaf?St(Rt):Rt;rt(W,Vt)&&(et.leaf?mt.push(Rt):G(W,Vt)?this._all(Rt,mt):_t.push(Rt))}et=_t.pop()}return mt},u.prototype.collides=function(W){var et=this.data;if(!rt(W,et))return!1;for(var mt=[];et;){for(var St=0;St<et.children.length;St++){var _t=et.children[St],Mt=et.leaf?this.toBBox(_t):_t;if(rt(W,Mt)){if(et.leaf||G(W,Mt))return!0;mt.push(_t)}}et=mt.pop()}return!1},u.prototype.load=function(W){if(!W||!W.length)return this;if(W.length<this._minEntries){for(var et=0;et<W.length;et++)this.insert(W[et]);return this}var mt=this._build(W.slice(),0,W.length-1,0);if(this.data.children.length)if(this.data.height===mt.height)this._splitRoot(this.data,mt);else{if(this.data.height<mt.height){var St=this.data;this.data=mt,mt=St}this._insert(mt,this.data.height-mt.height-1,!0)}else this.data=mt;return this},u.prototype.insert=function(W){return W&&this._insert(W,this.data.height-1),this},u.prototype.clear=function(){return this.data=Q([]),this},u.prototype.remove=function(W,et){if(!W)return this;for(var mt,St,_t,Mt=this.data,Rt=this.toBBox(W),Vt=[],Yt=[];Mt||Vt.length;){if(Mt||(Mt=Vt.pop(),St=Vt[Vt.length-1],mt=Yt.pop(),_t=!0),Mt.leaf){var jt=f(W,Mt.children,et);if(jt!==-1)return Mt.children.splice(jt,1),Vt.push(Mt),this._condense(Vt),this}_t||Mt.leaf||!G(Mt,Rt)?St?(mt++,Mt=St.children[mt],_t=!1):Mt=null:(Vt.push(Mt),Yt.push(mt),mt=0,St=Mt,Mt=Mt.children[0])}return this},u.prototype.toBBox=function(W){return W},u.prototype.compareMinX=function(W,et){return W.minX-et.minX},u.prototype.compareMinY=function(W,et){return W.minY-et.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(W){return this.data=W,this},u.prototype._all=function(W,et){for(var mt=[];W;)W.leaf?et.push.apply(et,W.children):mt.push.apply(mt,W.children),W=mt.pop();return et},u.prototype._build=function(W,et,mt,St){var _t,Mt=mt-et+1,Rt=this._maxEntries;if(Mt<=Rt)return n(_t=Q(W.slice(et,mt+1)),this.toBBox),_t;St||(St=Math.ceil(Math.log(Mt)/Math.log(Rt)),Rt=Math.ceil(Mt/Math.pow(Rt,St-1))),(_t=Q([])).leaf=!1,_t.height=St;var Vt=Math.ceil(Mt/Rt),Yt=Vt*Math.ceil(Math.sqrt(Rt));dt(W,et,mt,Yt,this.compareMinX);for(var jt=et;jt<=mt;jt+=Yt){var ye=Math.min(jt+Yt-1,mt);dt(W,jt,ye,Vt,this.compareMinY);for(var le=jt;le<=ye;le+=Vt){var me=Math.min(le+Vt-1,ye);_t.children.push(this._build(W,le,me,St-1))}}return n(_t,this.toBBox),_t},u.prototype._chooseSubtree=function(W,et,mt,St){for(;St.push(et),!et.leaf&&St.length-1!==mt;){for(var _t=1/0,Mt=1/0,Rt=void 0,Vt=0;Vt<et.children.length;Vt++){var Yt=et.children[Vt],jt=D(Yt),ye=(le=W,me=Yt,(Math.max(me.maxX,le.maxX)-Math.min(me.minX,le.minX))*(Math.max(me.maxY,le.maxY)-Math.min(me.minY,le.minY))-jt);ye<Mt?(Mt=ye,_t=jt<_t?jt:_t,Rt=Yt):ye===Mt&&jt<_t&&(_t=jt,Rt=Yt)}et=Rt||et.children[0]}var le,me;return et},u.prototype._insert=function(W,et,mt){var St=mt?W:this.toBBox(W),_t=[],Mt=this._chooseSubtree(St,this.data,et,_t);for(Mt.children.push(W),w(Mt,St);et>=0&&_t[et].children.length>this._maxEntries;)this._split(_t,et),et--;this._adjustParentBBoxes(St,_t,et)},u.prototype._split=function(W,et){var mt=W[et],St=mt.children.length,_t=this._minEntries;this._chooseSplitAxis(mt,_t,St);var Mt=this._chooseSplitIndex(mt,_t,St),Rt=Q(mt.children.splice(Mt,mt.children.length-Mt));Rt.height=mt.height,Rt.leaf=mt.leaf,n(mt,this.toBBox),n(Rt,this.toBBox),et?W[et-1].children.push(Rt):this._splitRoot(mt,Rt)},u.prototype._splitRoot=function(W,et){this.data=Q([W,et]),this.data.height=W.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(W,et,mt){for(var St,_t,Mt,Rt,Vt,Yt,jt,ye=1/0,le=1/0,me=et;me<=mt-et;me++){var He=x(W,0,me,this.toBBox),Ye=x(W,me,mt,this.toBBox),be=(_t=He,Mt=Ye,Rt=void 0,Vt=void 0,Yt=void 0,jt=void 0,Rt=Math.max(_t.minX,Mt.minX),Vt=Math.max(_t.minY,Mt.minY),Yt=Math.min(_t.maxX,Mt.maxX),jt=Math.min(_t.maxY,Mt.maxY),Math.max(0,Yt-Rt)*Math.max(0,jt-Vt)),Me=D(He)+D(Ye);be<ye?(ye=be,St=me,le=Me<le?Me:le):be===ye&&Me<le&&(le=Me,St=me)}return St||mt-et},u.prototype._chooseSplitAxis=function(W,et,mt){var St=W.leaf?this.compareMinX:E,_t=W.leaf?this.compareMinY:A;this._allDistMargin(W,et,mt,St)<this._allDistMargin(W,et,mt,_t)&&W.children.sort(St)},u.prototype._allDistMargin=function(W,et,mt,St){W.children.sort(St);for(var _t=this.toBBox,Mt=x(W,0,et,_t),Rt=x(W,mt-et,mt,_t),Vt=B(Mt)+B(Rt),Yt=et;Yt<mt-et;Yt++){var jt=W.children[Yt];w(Mt,W.leaf?_t(jt):jt),Vt+=B(Mt)}for(var ye=mt-et-1;ye>=et;ye--){var le=W.children[ye];w(Rt,W.leaf?_t(le):le),Vt+=B(Rt)}return Vt},u.prototype._adjustParentBBoxes=function(W,et,mt){for(var St=mt;St>=0;St--)w(et[St],W)},u.prototype._condense=function(W){for(var et=W.length-1,mt=void 0;et>=0;et--)W[et].children.length===0?et>0?(mt=W[et-1].children).splice(mt.indexOf(W[et]),1):this.clear():n(W[et],this.toBBox)},u})});var o_=zl(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.earthRadius=63710088e-1;Te.factors={centimeters:Te.earthRadius*100,centimetres:Te.earthRadius*100,degrees:Te.earthRadius/111325,feet:Te.earthRadius*3.28084,inches:Te.earthRadius*39.37,kilometers:Te.earthRadius/1e3,kilometres:Te.earthRadius/1e3,meters:Te.earthRadius,metres:Te.earthRadius,miles:Te.earthRadius/1609.344,millimeters:Te.earthRadius*1e3,millimetres:Te.earthRadius*1e3,nauticalmiles:Te.earthRadius/1852,radians:1,yards:Te.earthRadius*1.0936};Te.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Te.earthRadius,yards:1.0936133};Te.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Co(l,s,o){o===void 0&&(o={});var u={type:"Feature"};return(o.id===0||o.id)&&(u.id=o.id),o.bbox&&(u.bbox=o.bbox),u.properties=s||{},u.geometry=l,u}Te.feature=Co;function b5(l,s,o){switch(o===void 0&&(o={}),l){case"Point":return i_(s).geometry;case"LineString":return r_(s).geometry;case"Polygon":return n_(s).geometry;case"MultiPoint":return y1(s).geometry;case"MultiLineString":return g1(s).geometry;case"MultiPolygon":return x1(s).geometry;default:throw new Error(l+" is invalid")}}Te.geometry=b5;function i_(l,s,o){if(o===void 0&&(o={}),!l)throw new Error("coordinates is required");if(!Array.isArray(l))throw new Error("coordinates must be an Array");if(l.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!yp(l[0])||!yp(l[1]))throw new Error("coordinates must contain numbers");var u={type:"Point",coordinates:l};return Co(u,s,o)}Te.point=i_;function w5(l,s,o){return o===void 0&&(o={}),xp(l.map(function(u){return i_(u,s)}),o)}Te.points=w5;function n_(l,s,o){o===void 0&&(o={});for(var u=0,f=l;u<f.length;u++){var n=f[u];if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var x=0;x<n[n.length-1].length;x++)if(n[n.length-1][x]!==n[0][x])throw new Error("First and last Position are not equivalent.")}var w={type:"Polygon",coordinates:l};return Co(w,s,o)}Te.polygon=n_;function T5(l,s,o){return o===void 0&&(o={}),xp(l.map(function(u){return n_(u,s)}),o)}Te.polygons=T5;function r_(l,s,o){if(o===void 0&&(o={}),l.length<2)throw new Error("coordinates must be an array of two or more positions");var u={type:"LineString",coordinates:l};return Co(u,s,o)}Te.lineString=r_;function S5(l,s,o){return o===void 0&&(o={}),xp(l.map(function(u){return r_(u,s)}),o)}Te.lineStrings=S5;function xp(l,s){s===void 0&&(s={});var o={type:"FeatureCollection"};return s.id&&(o.id=s.id),s.bbox&&(o.bbox=s.bbox),o.features=l,o}Te.featureCollection=xp;function g1(l,s,o){o===void 0&&(o={});var u={type:"MultiLineString",coordinates:l};return Co(u,s,o)}Te.multiLineString=g1;function y1(l,s,o){o===void 0&&(o={});var u={type:"MultiPoint",coordinates:l};return Co(u,s,o)}Te.multiPoint=y1;function x1(l,s,o){o===void 0&&(o={});var u={type:"MultiPolygon",coordinates:l};return Co(u,s,o)}Te.multiPolygon=x1;function E5(l,s,o){o===void 0&&(o={});var u={type:"GeometryCollection",geometries:l};return Co(u,s,o)}Te.geometryCollection=E5;function M5(l,s){if(s===void 0&&(s=0),s&&!(s>=0))throw new Error("precision must be a positive number");var o=Math.pow(10,s||0);return Math.round(l*o)/o}Te.round=M5;function v1(l,s){s===void 0&&(s="kilometers");var o=Te.factors[s];if(!o)throw new Error(s+" units is invalid");return l*o}Te.radiansToLength=v1;function s_(l,s){s===void 0&&(s="kilometers");var o=Te.factors[s];if(!o)throw new Error(s+" units is invalid");return l/o}Te.lengthToRadians=s_;function A5(l,s){return b1(s_(l,s))}Te.lengthToDegrees=A5;function C5(l){var s=l%360;return s<0&&(s+=360),s}Te.bearingToAzimuth=C5;function b1(l){var s=l%(2*Math.PI);return s*180/Math.PI}Te.radiansToDegrees=b1;function I5(l){var s=l%360;return s*Math.PI/180}Te.degreesToRadians=I5;function k5(l,s,o){if(s===void 0&&(s="kilometers"),o===void 0&&(o="kilometers"),!(l>=0))throw new Error("length must be a positive number");return v1(s_(l,s),o)}Te.convertLength=k5;function P5(l,s,o){if(s===void 0&&(s="meters"),o===void 0&&(o="kilometers"),!(l>=0))throw new Error("area must be a positive number");var u=Te.areaFactors[s];if(!u)throw new Error("invalid original units");var f=Te.areaFactors[o];if(!f)throw new Error("invalid final units");return l/u*f}Te.convertArea=P5;function yp(l){return!isNaN(l)&&l!==null&&!Array.isArray(l)}Te.isNumber=yp;function z5(l){return!!l&&l.constructor===Object}Te.isObject=z5;function D5(l){if(!l)throw new Error("bbox is required");if(!Array.isArray(l))throw new Error("bbox must be an Array");if(l.length!==4&&l.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");l.forEach(function(s){if(!yp(s))throw new Error("bbox must only contain numbers")})}Te.validateBBox=D5;function L5(l){if(!l)throw new Error("id is required");if(["string","number"].indexOf(typeof l)===-1)throw new Error("id must be a number or a string")}Te.validateId=L5});var l_=zl(Zi=>{"use strict";Object.defineProperty(Zi,"__esModule",{value:!0});var an=o_();function Kh(l,s,o){if(l!==null)for(var u,f,n,x,w,E,A,D=0,B=0,G,rt=l.type,Q=rt==="FeatureCollection",dt=rt==="Feature",W=Q?l.features.length:1,et=0;et<W;et++){A=Q?l.features[et].geometry:dt?l.geometry:l,G=A?A.type==="GeometryCollection":!1,w=G?A.geometries.length:1;for(var mt=0;mt<w;mt++){var St=0,_t=0;if(x=G?A.geometries[mt]:A,x!==null){E=x.coordinates;var Mt=x.type;switch(D=o&&(Mt==="Polygon"||Mt==="MultiPolygon")?1:0,Mt){case null:break;case"Point":if(s(E,B,et,St,_t)===!1)return!1;B++,St++;break;case"LineString":case"MultiPoint":for(u=0;u<E.length;u++){if(s(E[u],B,et,St,_t)===!1)return!1;B++,Mt==="MultiPoint"&&St++}Mt==="LineString"&&St++;break;case"Polygon":case"MultiLineString":for(u=0;u<E.length;u++){for(f=0;f<E[u].length-D;f++){if(s(E[u][f],B,et,St,_t)===!1)return!1;B++}Mt==="MultiLineString"&&St++,Mt==="Polygon"&&_t++}Mt==="Polygon"&&St++;break;case"MultiPolygon":for(u=0;u<E.length;u++){for(_t=0,f=0;f<E[u].length;f++){for(n=0;n<E[u][f].length-D;n++){if(s(E[u][f][n],B,et,St,_t)===!1)return!1;B++}_t++}St++}break;case"GeometryCollection":for(u=0;u<x.geometries.length;u++)if(Kh(x.geometries[u],s,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function R5(l,s,o,u){var f=o;return Kh(l,function(n,x,w,E,A){x===0&&o===void 0?f=n:f=s(f,n,x,w,E,A)},u),f}function w1(l,s){var o;switch(l.type){case"FeatureCollection":for(o=0;o<l.features.length&&s(l.features[o].properties,o)!==!1;o++);break;case"Feature":s(l.properties,0);break}}function B5(l,s,o){var u=o;return w1(l,function(f,n){n===0&&o===void 0?u=f:u=s(u,f,n)}),u}function T1(l,s){if(l.type==="Feature")s(l,0);else if(l.type==="FeatureCollection")for(var o=0;o<l.features.length&&s(l.features[o],o)!==!1;o++);}function F5(l,s,o){var u=o;return T1(l,function(f,n){n===0&&o===void 0?u=f:u=s(u,f,n)}),u}function O5(l){var s=[];return Kh(l,function(o){s.push(o)}),s}function a_(l,s){var o,u,f,n,x,w,E,A,D,B,G=0,rt=l.type==="FeatureCollection",Q=l.type==="Feature",dt=rt?l.features.length:1;for(o=0;o<dt;o++){for(w=rt?l.features[o].geometry:Q?l.geometry:l,A=rt?l.features[o].properties:Q?l.properties:{},D=rt?l.features[o].bbox:Q?l.bbox:void 0,B=rt?l.features[o].id:Q?l.id:void 0,E=w?w.type==="GeometryCollection":!1,x=E?w.geometries.length:1,f=0;f<x;f++){if(n=E?w.geometries[f]:w,n===null){if(s(null,G,A,D,B)===!1)return!1;continue}switch(n.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(s(n,G,A,D,B)===!1)return!1;break}case"GeometryCollection":{for(u=0;u<n.geometries.length;u++)if(s(n.geometries[u],G,A,D,B)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}G++}}function V5(l,s,o){var u=o;return a_(l,function(f,n,x,w,E){n===0&&o===void 0?u=f:u=s(u,f,n,x,w,E)}),u}function vp(l,s){a_(l,function(o,u,f,n,x){var w=o===null?null:o.type;switch(w){case null:case"Point":case"LineString":case"Polygon":return s(an.feature(o,f,{bbox:n,id:x}),u,0)===!1?!1:void 0}var E;switch(w){case"MultiPoint":E="Point";break;case"MultiLineString":E="LineString";break;case"MultiPolygon":E="Polygon";break}for(var A=0;A<o.coordinates.length;A++){var D=o.coordinates[A],B={type:E,coordinates:D};if(s(an.feature(B,f),u,A)===!1)return!1}})}function Z5(l,s,o){var u=o;return vp(l,function(f,n,x){n===0&&x===0&&o===void 0?u=f:u=s(u,f,n,x)}),u}function S1(l,s){vp(l,function(o,u,f){var n=0;if(!!o.geometry){var x=o.geometry.type;if(!(x==="Point"||x==="MultiPoint")){var w,E=0,A=0,D=0;if(Kh(o,function(B,G,rt,Q,dt){if(w===void 0||u>E||Q>A||dt>D){w=B,E=u,A=Q,D=dt,n=0;return}var W=an.lineString([w,B],o.properties);if(s(W,u,f,dt,n)===!1)return!1;n++,w=B})===!1)return!1}}})}function U5(l,s,o){var u=o,f=!1;return S1(l,function(n,x,w,E,A){f===!1&&o===void 0?u=n:u=s(u,n,x,w,E,A),f=!0}),u}function E1(l,s){if(!l)throw new Error("geojson is required");vp(l,function(o,u,f){if(o.geometry!==null){var n=o.geometry.type,x=o.geometry.coordinates;switch(n){case"LineString":if(s(o,u,f,0,0)===!1)return!1;break;case"Polygon":for(var w=0;w<x.length;w++)if(s(an.lineString(x[w],o.properties),u,f,w)===!1)return!1;break}}})}function N5(l,s,o){var u=o;return E1(l,function(f,n,x,w){n===0&&o===void 0?u=f:u=s(u,f,n,x,w)}),u}function j5(l,s){if(s=s||{},!an.isObject(s))throw new Error("options is invalid");var o=s.featureIndex||0,u=s.multiFeatureIndex||0,f=s.geometryIndex||0,n=s.segmentIndex||0,x=s.properties,w;switch(l.type){case"FeatureCollection":o<0&&(o=l.features.length+o),x=x||l.features[o].properties,w=l.features[o].geometry;break;case"Feature":x=x||l.properties,w=l.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":w=l;break;default:throw new Error("geojson is invalid")}if(w===null)return null;var E=w.coordinates;switch(w.type){case"Point":case"MultiPoint":return null;case"LineString":return n<0&&(n=E.length+n-1),an.lineString([E[n],E[n+1]],x,s);case"Polygon":return f<0&&(f=E.length+f),n<0&&(n=E[f].length+n-1),an.lineString([E[f][n],E[f][n+1]],x,s);case"MultiLineString":return u<0&&(u=E.length+u),n<0&&(n=E[u].length+n-1),an.lineString([E[u][n],E[u][n+1]],x,s);case"MultiPolygon":return u<0&&(u=E.length+u),f<0&&(f=E[u].length+f),n<0&&(n=E[u][f].length-n-1),an.lineString([E[u][f][n],E[u][f][n+1]],x,s)}throw new Error("geojson is invalid")}function G5(l,s){if(s=s||{},!an.isObject(s))throw new Error("options is invalid");var o=s.featureIndex||0,u=s.multiFeatureIndex||0,f=s.geometryIndex||0,n=s.coordIndex||0,x=s.properties,w;switch(l.type){case"FeatureCollection":o<0&&(o=l.features.length+o),x=x||l.features[o].properties,w=l.features[o].geometry;break;case"Feature":x=x||l.properties,w=l.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":w=l;break;default:throw new Error("geojson is invalid")}if(w===null)return null;var E=w.coordinates;switch(w.type){case"Point":return an.point(E,x,s);case"MultiPoint":return u<0&&(u=E.length+u),an.point(E[u],x,s);case"LineString":return n<0&&(n=E.length+n),an.point(E[n],x,s);case"Polygon":return f<0&&(f=E.length+f),n<0&&(n=E[f].length+n),an.point(E[f][n],x,s);case"MultiLineString":return u<0&&(u=E.length+u),n<0&&(n=E[u].length+n),an.point(E[u][n],x,s);case"MultiPolygon":return u<0&&(u=E.length+u),f<0&&(f=E[u].length+f),n<0&&(n=E[u][f].length-n),an.point(E[u][f][n],x,s)}throw new Error("geojson is invalid")}Zi.coordAll=O5;Zi.coordEach=Kh;Zi.coordReduce=R5;Zi.featureEach=T1;Zi.featureReduce=F5;Zi.findPoint=G5;Zi.findSegment=j5;Zi.flattenEach=vp;Zi.flattenReduce=Z5;Zi.geomEach=a_;Zi.geomReduce=V5;Zi.lineEach=E1;Zi.lineReduce=N5;Zi.propEach=w1;Zi.propReduce=B5;Zi.segmentEach=S1;Zi.segmentReduce=U5});var M1=zl(h_=>{"use strict";Object.defineProperty(h_,"__esModule",{value:!0});var $5=l_();function c_(l){var s=[1/0,1/0,-1/0,-1/0];return $5.coordEach(l,function(o){s[0]>o[0]&&(s[0]=o[0]),s[1]>o[1]&&(s[1]=o[1]),s[2]<o[0]&&(s[2]=o[0]),s[3]<o[1]&&(s[3]=o[1])}),s}c_.default=c_;h_.default=c_});var P1=zl((M6,u_)=>{var Yr=_1(),C1=o_(),I1=l_(),ec=M1().default,q5=I1.featureEach,S6=I1.coordEach,E6=C1.polygon,A1=C1.featureCollection;function k1(l){var s=new Yr(l);return s.insert=function(o){if(o.type!=="Feature")throw new Error("invalid feature");return o.bbox=o.bbox?o.bbox:ec(o),Yr.prototype.insert.call(this,o)},s.load=function(o){var u=[];return Array.isArray(o)?o.forEach(function(f){if(f.type!=="Feature")throw new Error("invalid features");f.bbox=f.bbox?f.bbox:ec(f),u.push(f)}):q5(o,function(f){if(f.type!=="Feature")throw new Error("invalid features");f.bbox=f.bbox?f.bbox:ec(f),u.push(f)}),Yr.prototype.load.call(this,u)},s.remove=function(o,u){if(o.type!=="Feature")throw new Error("invalid feature");return o.bbox=o.bbox?o.bbox:ec(o),Yr.prototype.remove.call(this,o,u)},s.clear=function(){return Yr.prototype.clear.call(this)},s.search=function(o){var u=Yr.prototype.search.call(this,this.toBBox(o));return A1(u)},s.collides=function(o){return Yr.prototype.collides.call(this,this.toBBox(o))},s.all=function(){var o=Yr.prototype.all.call(this);return A1(o)},s.toJSON=function(){return Yr.prototype.toJSON.call(this)},s.fromJSON=function(o){return Yr.prototype.fromJSON.call(this,o)},s.toBBox=function(o){var u;if(o.bbox)u=o.bbox;else if(Array.isArray(o)&&o.length===4)u=o;else if(Array.isArray(o)&&o.length===6)u=[o[0],o[1],o[3],o[4]];else if(o.type==="Feature")u=ec(o);else if(o.type==="FeatureCollection")u=ec(o);else throw new Error("invalid geojson");return{minX:u[0],minY:u[1],maxX:u[2],maxY:u[3]}},s}u_.exports=k1;u_.exports.default=k1});var kd=function(){return typeof window>"u"?function(l){return l()}:window.requestAnimationFrame}();function Pd(l,s,o){let u=o||(x=>Array.prototype.slice.call(x)),f=!1,n=[];return function(...x){n=u(x),f||(f=!0,kd.call(window,()=>{f=!1,l.apply(s,n)}))}}function Qf(l,s){let o;return function(...u){return s?(clearTimeout(o),o=setTimeout(l,s,u)):l.apply(this,u),s}}var Eh=l=>l==="start"?"left":l==="end"?"right":"center",qi=(l,s,o)=>l==="start"?s:l==="end"?o:(s+o)/2,tm=(l,s,o,u)=>l===(u?"left":"right")?o:l==="center"?(s+o)/2:s;function yr(){}var em=function(){let l=0;return function(){return l++}}();function Xe(l){return l===null||typeof l>"u"}function ai(l){if(Array.isArray&&Array.isArray(l))return!0;let s=Object.prototype.toString.call(l);return s.slice(0,7)==="[object"&&s.slice(-6)==="Array]"}function Ge(l){return l!==null&&Object.prototype.toString.call(l)==="[object Object]"}var Mi=l=>(typeof l=="number"||l instanceof Number)&&isFinite(+l);function Rn(l,s){return Mi(l)?l:s}function Pe(l,s){return typeof l>"u"?s:l}var im=(l,s)=>typeof l=="string"&&l.endsWith("%")?parseFloat(l)/100:l/s,zd=(l,s)=>typeof l=="string"&&l.endsWith("%")?parseFloat(l)/100*s:+l;function li(l,s,o){if(l&&typeof l.call=="function")return l.apply(o,s)}function ei(l,s,o,u){let f,n,x;if(ai(l))if(n=l.length,u)for(f=n-1;f>=0;f--)s.call(o,l[f],f);else for(f=0;f<n;f++)s.call(o,l[f],f);else if(Ge(l))for(x=Object.keys(l),n=x.length,f=0;f<n;f++)s.call(o,l[x[f]],x[f])}function Ol(l,s){let o,u,f,n;if(!l||!s||l.length!==s.length)return!1;for(o=0,u=l.length;o<u;++o)if(f=l[o],n=s[o],f.datasetIndex!==n.datasetIndex||f.index!==n.index)return!1;return!0}function wh(l){if(ai(l))return l.map(wh);if(Ge(l)){let s=Object.create(null),o=Object.keys(l),u=o.length,f=0;for(;f<u;++f)s[o[f]]=wh(l[o[f]]);return s}return l}function D0(l){return["__proto__","prototype","constructor"].indexOf(l)===-1}function L0(l,s,o,u){if(!D0(l))return;let f=s[l],n=o[l];Ge(f)&&Ge(n)?_a(f,n,u):s[l]=wh(n)}function _a(l,s,o){let u=ai(s)?s:[s],f=u.length;if(!Ge(l))return l;o=o||{};let n=o.merger||L0;for(let x=0;x<f;++x){if(s=u[x],!Ge(s))continue;let w=Object.keys(s);for(let E=0,A=w.length;E<A;++E)n(w[E],l,s,o)}return l}function ya(l,s){return _a(l,s,{merger:R0})}function R0(l,s,o){if(!D0(l))return;let u=s[l],f=o[l];Ge(u)&&Ge(f)?ya(u,f):Object.prototype.hasOwnProperty.call(s,l)||(s[l]=wh(f))}var h2="",u2=".";function v0(l,s){let o=l.indexOf(u2,s);return o===-1?l.length:o}function qr(l,s){if(s===h2)return l;let o=0,u=v0(s,o);for(;l&&u>o;)l=l[s.slice(o,u)],o=u+1,u=v0(s,o);return l}function Mh(l){return l.charAt(0).toUpperCase()+l.slice(1)}var Ln=l=>typeof l<"u",$r=l=>typeof l=="function",Dd=(l,s)=>{if(l.size!==s.size)return!1;for(let o of l)if(!s.has(o))return!1;return!0};function nm(l){return l.type==="mouseup"||l.type==="click"||l.type==="contextmenu"}var mi=Math.PI,si=2*mi,B0=si+mi,Th=Number.POSITIVE_INFINITY,F0=mi/180,bi=mi/2,Ll=mi/4,Yf=mi*2/3,Bn=Math.log10,sr=Math.sign;function Ld(l){let s=Math.round(l);l=va(l,s,l/1e3)?s:l;let o=Math.pow(10,Math.floor(Bn(l))),u=l/o;return(u<=1?1:u<=2?2:u<=5?5:10)*o}function rm(l){let s=[],o=Math.sqrt(l),u;for(u=1;u<o;u++)l%u===0&&(s.push(u),s.push(l/u));return o===(o|0)&&s.push(o),s.sort((f,n)=>f-n).pop(),s}function xa(l){return!isNaN(parseFloat(l))&&isFinite(l)}function va(l,s,o){return Math.abs(l-s)<o}function sm(l,s){let o=Math.round(l);return o-s<=l&&o+s>=l}function Rd(l,s,o){let u,f,n;for(u=0,f=l.length;u<f;u++)n=l[u][o],isNaN(n)||(s.min=Math.min(s.min,n),s.max=Math.max(s.max,n))}function Hn(l){return l*(mi/180)}function Ah(l){return l*(180/mi)}function Bd(l){if(!Mi(l))return;let s=1,o=0;for(;Math.round(l*s)/s!==l;)s*=10,o++;return o}function Fd(l,s){let o=s.x-l.x,u=s.y-l.y,f=Math.sqrt(o*o+u*u),n=Math.atan2(u,o);return n<-.5*mi&&(n+=si),{angle:n,distance:f}}function Sh(l,s){return Math.sqrt(Math.pow(s.x-l.x,2)+Math.pow(s.y-l.y,2))}function O0(l,s){return(l-s+B0)%si-mi}function yn(l){return(l%si+si)%si}function ba(l,s,o,u){let f=yn(l),n=yn(s),x=yn(o),w=yn(n-f),E=yn(x-f),A=yn(f-n),D=yn(f-x);return f===n||f===x||u&&n===x||w>E&&A<D}function Fi(l,s,o){return Math.max(s,Math.min(o,l))}function om(l){return Fi(l,-32768,32767)}function xr(l,s,o,u=1e-6){return l>=Math.min(s,o)-u&&l<=Math.max(s,o)+u}var Td=l=>l===0||l===1,b0=(l,s,o)=>-(Math.pow(2,10*(l-=1))*Math.sin((l-s)*si/o)),w0=(l,s,o)=>Math.pow(2,-10*l)*Math.sin((l-s)*si/o)+1,fa={linear:l=>l,easeInQuad:l=>l*l,easeOutQuad:l=>-l*(l-2),easeInOutQuad:l=>(l/=.5)<1?.5*l*l:-.5*(--l*(l-2)-1),easeInCubic:l=>l*l*l,easeOutCubic:l=>(l-=1)*l*l+1,easeInOutCubic:l=>(l/=.5)<1?.5*l*l*l:.5*((l-=2)*l*l+2),easeInQuart:l=>l*l*l*l,easeOutQuart:l=>-((l-=1)*l*l*l-1),easeInOutQuart:l=>(l/=.5)<1?.5*l*l*l*l:-.5*((l-=2)*l*l*l-2),easeInQuint:l=>l*l*l*l*l,easeOutQuint:l=>(l-=1)*l*l*l*l+1,easeInOutQuint:l=>(l/=.5)<1?.5*l*l*l*l*l:.5*((l-=2)*l*l*l*l+2),easeInSine:l=>-Math.cos(l*bi)+1,easeOutSine:l=>Math.sin(l*bi),easeInOutSine:l=>-.5*(Math.cos(mi*l)-1),easeInExpo:l=>l===0?0:Math.pow(2,10*(l-1)),easeOutExpo:l=>l===1?1:-Math.pow(2,-10*l)+1,easeInOutExpo:l=>Td(l)?l:l<.5?.5*Math.pow(2,10*(l*2-1)):.5*(-Math.pow(2,-10*(l*2-1))+2),easeInCirc:l=>l>=1?l:-(Math.sqrt(1-l*l)-1),easeOutCirc:l=>Math.sqrt(1-(l-=1)*l),easeInOutCirc:l=>(l/=.5)<1?-.5*(Math.sqrt(1-l*l)-1):.5*(Math.sqrt(1-(l-=2)*l)+1),easeInElastic:l=>Td(l)?l:b0(l,.075,.3),easeOutElastic:l=>Td(l)?l:w0(l,.075,.3),easeInOutElastic(l){return Td(l)?l:l<.5?.5*b0(l*2,.1125,.45):.5+.5*w0(l*2-1,.1125,.45)},easeInBack(l){return l*l*((1.70158+1)*l-1.70158)},easeOutBack(l){return(l-=1)*l*((1.70158+1)*l+1.70158)+1},easeInOutBack(l){let s=1.70158;return(l/=.5)<1?.5*(l*l*(((s*=1.525)+1)*l-s)):.5*((l-=2)*l*(((s*=1.525)+1)*l+s)+2)},easeInBounce:l=>1-fa.easeOutBounce(1-l),easeOutBounce(l){return l<1/2.75?7.5625*l*l:l<2/2.75?7.5625*(l-=1.5/2.75)*l+.75:l<2.5/2.75?7.5625*(l-=2.25/2.75)*l+.9375:7.5625*(l-=2.625/2.75)*l+.984375},easeInOutBounce:l=>l<.5?fa.easeInBounce(l*2)*.5:fa.easeOutBounce(l*2-1)*.5+.5};function Ch(l){return l+.5|0}var go=(l,s,o)=>Math.max(Math.min(l,o),s);function vh(l){return go(Ch(l*2.55),0,255)}function yo(l){return go(Ch(l*255),0,255)}function Ss(l){return go(Ch(l/2.55)/100,0,1)}function T0(l){return go(Ch(l*100),0,100)}var rr={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Kf=[..."0123456789ABCDEF"],d2=l=>Kf[l&15],p2=l=>Kf[(l&240)>>4]+Kf[l&15],Sd=l=>(l&240)>>4===(l&15),f2=l=>Sd(l.r)&&Sd(l.g)&&Sd(l.b)&&Sd(l.a);function m2(l){var s=l.length,o;return l[0]==="#"&&(s===4||s===5?o={r:255&rr[l[1]]*17,g:255&rr[l[2]]*17,b:255&rr[l[3]]*17,a:s===5?rr[l[4]]*17:255}:(s===7||s===9)&&(o={r:rr[l[1]]<<4|rr[l[2]],g:rr[l[3]]<<4|rr[l[4]],b:rr[l[5]]<<4|rr[l[6]],a:s===9?rr[l[7]]<<4|rr[l[8]]:255})),o}var _2=(l,s)=>l<255?s(l):"";function g2(l){var s=f2(l)?d2:p2;return l?"#"+s(l.r)+s(l.g)+s(l.b)+_2(l.a,s):void 0}var y2=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function V0(l,s,o){let u=s*Math.min(o,1-o),f=(n,x=(n+l/30)%12)=>o-u*Math.max(Math.min(x-3,9-x,1),-1);return[f(0),f(8),f(4)]}function x2(l,s,o){let u=(f,n=(f+l/60)%6)=>o-o*s*Math.max(Math.min(n,4-n,1),0);return[u(5),u(3),u(1)]}function v2(l,s,o){let u=V0(l,1,.5),f;for(s+o>1&&(f=1/(s+o),s*=f,o*=f),f=0;f<3;f++)u[f]*=1-s-o,u[f]+=s;return u}function b2(l,s,o,u,f){return l===f?(s-o)/u+(s<o?6:0):s===f?(o-l)/u+2:(l-s)/u+4}function am(l){let o=l.r/255,u=l.g/255,f=l.b/255,n=Math.max(o,u,f),x=Math.min(o,u,f),w=(n+x)/2,E,A,D;return n!==x&&(D=n-x,A=w>.5?D/(2-n-x):D/(n+x),E=b2(o,u,f,D,n),E=E*60+.5),[E|0,A||0,w]}function lm(l,s,o,u){return(Array.isArray(s)?l(s[0],s[1],s[2]):l(s,o,u)).map(yo)}function cm(l,s,o){return lm(V0,l,s,o)}function w2(l,s,o){return lm(v2,l,s,o)}function T2(l,s,o){return lm(x2,l,s,o)}function Z0(l){return(l%360+360)%360}function S2(l){let s=y2.exec(l),o=255,u;if(!s)return;s[5]!==u&&(o=s[6]?vh(+s[5]):yo(+s[5]));let f=Z0(+s[2]),n=+s[3]/100,x=+s[4]/100;return s[1]==="hwb"?u=w2(f,n,x):s[1]==="hsv"?u=T2(f,n,x):u=cm(f,n,x),{r:u[0],g:u[1],b:u[2],a:o}}function E2(l,s){var o=am(l);o[0]=Z0(o[0]+s),o=cm(o),l.r=o[0],l.g=o[1],l.b=o[2]}function M2(l){if(!l)return;let s=am(l),o=s[0],u=T0(s[1]),f=T0(s[2]);return l.a<255?`hsla(${o}, ${u}%, ${f}%, ${Ss(l.a)})`:`hsl(${o}, ${u}%, ${f}%)`}var S0={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},E0={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function A2(){let l={},s=Object.keys(E0),o=Object.keys(S0),u,f,n,x,w;for(u=0;u<s.length;u++){for(x=w=s[u],f=0;f<o.length;f++)n=o[f],w=w.replace(n,S0[n]);n=parseInt(E0[x],16),l[w]=[n>>16&255,n>>8&255,n&255]}return l}var Ed;function C2(l){Ed||(Ed=A2(),Ed.transparent=[0,0,0,0]);let s=Ed[l.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:s.length===4?s[3]:255}}var I2=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function k2(l){let s=I2.exec(l),o=255,u,f,n;if(!!s){if(s[7]!==u){let x=+s[7];o=s[8]?vh(x):go(x*255,0,255)}return u=+s[1],f=+s[3],n=+s[5],u=255&(s[2]?vh(u):go(u,0,255)),f=255&(s[4]?vh(f):go(f,0,255)),n=255&(s[6]?vh(n):go(n,0,255)),{r:u,g:f,b:n,a:o}}}function P2(l){return l&&(l.a<255?`rgba(${l.r}, ${l.g}, ${l.b}, ${Ss(l.a)})`:`rgb(${l.r}, ${l.g}, ${l.b})`)}var Wf=l=>l<=.0031308?l*12.92:Math.pow(l,1/2.4)*1.055-.055,Dl=l=>l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4);function z2(l,s,o){let u=Dl(Ss(l.r)),f=Dl(Ss(l.g)),n=Dl(Ss(l.b));return{r:yo(Wf(u+o*(Dl(Ss(s.r))-u))),g:yo(Wf(f+o*(Dl(Ss(s.g))-f))),b:yo(Wf(n+o*(Dl(Ss(s.b))-n))),a:l.a+o*(s.a-l.a)}}function Md(l,s,o){if(l){let u=am(l);u[s]=Math.max(0,Math.min(u[s]+u[s]*o,s===0?360:1)),u=cm(u),l.r=u[0],l.g=u[1],l.b=u[2]}}function U0(l,s){return l&&Object.assign(s||{},l)}function M0(l){var s={r:0,g:0,b:0,a:255};return Array.isArray(l)?l.length>=3&&(s={r:l[0],g:l[1],b:l[2],a:255},l.length>3&&(s.a=yo(l[3]))):(s=U0(l,{r:0,g:0,b:0,a:1}),s.a=yo(s.a)),s}function D2(l){return l.charAt(0)==="r"?k2(l):S2(l)}var Rl=class{constructor(s){if(s instanceof Rl)return s;let o=typeof s,u;o==="object"?u=M0(s):o==="string"&&(u=m2(s)||C2(s)||D2(s)),this._rgb=u,this._valid=!!u}get valid(){return this._valid}get rgb(){var s=U0(this._rgb);return s&&(s.a=Ss(s.a)),s}set rgb(s){this._rgb=M0(s)}rgbString(){return this._valid?P2(this._rgb):void 0}hexString(){return this._valid?g2(this._rgb):void 0}hslString(){return this._valid?M2(this._rgb):void 0}mix(s,o){if(s){let u=this.rgb,f=s.rgb,n,x=o===n?.5:o,w=2*x-1,E=u.a-f.a,A=((w*E===-1?w:(w+E)/(1+w*E))+1)/2;n=1-A,u.r=255&A*u.r+n*f.r+.5,u.g=255&A*u.g+n*f.g+.5,u.b=255&A*u.b+n*f.b+.5,u.a=x*u.a+(1-x)*f.a,this.rgb=u}return this}interpolate(s,o){return s&&(this._rgb=z2(this._rgb,s._rgb,o)),this}clone(){return new Rl(this.rgb)}alpha(s){return this._rgb.a=yo(s),this}clearer(s){let o=this._rgb;return o.a*=1-s,this}greyscale(){let s=this._rgb,o=Ch(s.r*.3+s.g*.59+s.b*.11);return s.r=s.g=s.b=o,this}opaquer(s){let o=this._rgb;return o.a*=1+s,this}negate(){let s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return Md(this._rgb,2,s),this}darken(s){return Md(this._rgb,2,-s),this}saturate(s){return Md(this._rgb,1,s),this}desaturate(s){return Md(this._rgb,1,-s),this}rotate(s){return E2(this._rgb,s),this}};function N0(l){return new Rl(l)}function hm(l){if(l&&typeof l=="object"){let s=l.toString();return s==="[object CanvasPattern]"||s==="[object CanvasGradient]"}return!1}function Od(l){return hm(l)?l:N0(l)}function Cd(l){return hm(l)?l:N0(l).saturate(.5).darken(.1).hexString()}var vo=Object.create(null),Vd=Object.create(null);function bh(l,s){if(!s)return l;let o=s.split(".");for(let u=0,f=o.length;u<f;++u){let n=o[u];l=l[n]||(l[n]=Object.create(null))}return l}function Xf(l,s,o){return typeof s=="string"?_a(bh(l,s),o):_a(bh(l,""),s)}var Jf=class{constructor(s){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=o=>o.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(o,u)=>Cd(u.backgroundColor),this.hoverBorderColor=(o,u)=>Cd(u.borderColor),this.hoverColor=(o,u)=>Cd(u.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s)}set(s,o){return Xf(this,s,o)}get(s){return bh(this,s)}describe(s,o){return Xf(Vd,s,o)}override(s,o){return Xf(vo,s,o)}route(s,o,u,f){let n=bh(this,s),x=bh(this,u),w="_"+o;Object.defineProperties(n,{[w]:{value:n[o],writable:!0},[o]:{enumerable:!0,get(){let E=this[w],A=x[f];return Ge(E)?Object.assign({},A,E):Pe(E,A)},set(E){this[w]=E}}})}},$e=new Jf({_scriptable:l=>!l.startsWith("on"),_indexable:l=>l!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function j0(l){return!l||Xe(l.size)||Xe(l.family)?null:(l.style?l.style+" ":"")+(l.weight?l.weight+" ":"")+l.size+"px "+l.family}function Bl(l,s,o,u,f){let n=s[f];return n||(n=s[f]=l.measureText(f).width,o.push(f)),n>u&&(u=n),u}function um(l,s,o,u){u=u||{};let f=u.data=u.data||{},n=u.garbageCollect=u.garbageCollect||[];u.font!==s&&(f=u.data={},n=u.garbageCollect=[],u.font=s),l.save(),l.font=s;let x=0,w=o.length,E,A,D,B,G;for(E=0;E<w;E++)if(B=o[E],B!=null&&ai(B)!==!0)x=Bl(l,f,n,x,B);else if(ai(B))for(A=0,D=B.length;A<D;A++)G=B[A],G!=null&&!ai(G)&&(x=Bl(l,f,n,x,G));l.restore();let rt=n.length/2;if(rt>o.length){for(E=0;E<rt;E++)delete f[n[E]];n.splice(0,rt)}return x}function Ms(l,s,o){let u=l.currentDevicePixelRatio,f=o!==0?Math.max(o/2,.5):0;return Math.round((s-f)*u)/u+f}function Zd(l,s){s=s||l.getContext("2d"),s.save(),s.resetTransform(),s.clearRect(0,0,l.width,l.height),s.restore()}function Vl(l,s,o,u){let f,n,x,w,E,A=s.pointStyle,D=s.rotation,B=s.radius,G=(D||0)*F0;if(A&&typeof A=="object"&&(f=A.toString(),f==="[object HTMLImageElement]"||f==="[object HTMLCanvasElement]")){l.save(),l.translate(o,u),l.rotate(G),l.drawImage(A,-A.width/2,-A.height/2,A.width,A.height),l.restore();return}if(!(isNaN(B)||B<=0)){switch(l.beginPath(),A){default:l.arc(o,u,B,0,si),l.closePath();break;case"triangle":l.moveTo(o+Math.sin(G)*B,u-Math.cos(G)*B),G+=Yf,l.lineTo(o+Math.sin(G)*B,u-Math.cos(G)*B),G+=Yf,l.lineTo(o+Math.sin(G)*B,u-Math.cos(G)*B),l.closePath();break;case"rectRounded":E=B*.516,w=B-E,n=Math.cos(G+Ll)*w,x=Math.sin(G+Ll)*w,l.arc(o-n,u-x,E,G-mi,G-bi),l.arc(o+x,u-n,E,G-bi,G),l.arc(o+n,u+x,E,G,G+bi),l.arc(o-x,u+n,E,G+bi,G+mi),l.closePath();break;case"rect":if(!D){w=Math.SQRT1_2*B,l.rect(o-w,u-w,2*w,2*w);break}G+=Ll;case"rectRot":n=Math.cos(G)*B,x=Math.sin(G)*B,l.moveTo(o-n,u-x),l.lineTo(o+x,u-n),l.lineTo(o+n,u+x),l.lineTo(o-x,u+n),l.closePath();break;case"crossRot":G+=Ll;case"cross":n=Math.cos(G)*B,x=Math.sin(G)*B,l.moveTo(o-n,u-x),l.lineTo(o+n,u+x),l.moveTo(o+x,u-n),l.lineTo(o-x,u+n);break;case"star":n=Math.cos(G)*B,x=Math.sin(G)*B,l.moveTo(o-n,u-x),l.lineTo(o+n,u+x),l.moveTo(o+x,u-n),l.lineTo(o-x,u+n),G+=Ll,n=Math.cos(G)*B,x=Math.sin(G)*B,l.moveTo(o-n,u-x),l.lineTo(o+n,u+x),l.moveTo(o+x,u-n),l.lineTo(o-x,u+n);break;case"line":n=Math.cos(G)*B,x=Math.sin(G)*B,l.moveTo(o-n,u-x),l.lineTo(o+n,u+x);break;case"dash":l.moveTo(o,u),l.lineTo(o+Math.cos(G)*B,u+Math.sin(G)*B);break}l.fill(),s.borderWidth>0&&l.stroke()}}function ga(l,s,o){return o=o||.5,!s||l&&l.x>s.left-o&&l.x<s.right+o&&l.y>s.top-o&&l.y<s.bottom+o}function Zl(l,s){l.save(),l.beginPath(),l.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),l.clip()}function Ul(l){l.restore()}function dm(l,s,o,u,f){if(!s)return l.lineTo(o.x,o.y);if(f==="middle"){let n=(s.x+o.x)/2;l.lineTo(n,s.y),l.lineTo(n,o.y)}else f==="after"!=!!u?l.lineTo(s.x,o.y):l.lineTo(o.x,s.y);l.lineTo(o.x,o.y)}function pm(l,s,o,u){if(!s)return l.lineTo(o.x,o.y);l.bezierCurveTo(u?s.cp1x:s.cp2x,u?s.cp1y:s.cp2y,u?o.cp2x:o.cp1x,u?o.cp2y:o.cp1y,o.x,o.y)}function As(l,s,o,u,f,n={}){let x=ai(s)?s:[s],w=n.strokeWidth>0&&n.strokeColor!=="",E,A;for(l.save(),l.font=f.string,L2(l,n),E=0;E<x.length;++E)A=x[E],w&&(n.strokeColor&&(l.strokeStyle=n.strokeColor),Xe(n.strokeWidth)||(l.lineWidth=n.strokeWidth),l.strokeText(A,o,u,n.maxWidth)),l.fillText(A,o,u,n.maxWidth),R2(l,o,u,A,n),u+=f.lineHeight;l.restore()}function L2(l,s){s.translation&&l.translate(s.translation[0],s.translation[1]),Xe(s.rotation)||l.rotate(s.rotation),s.color&&(l.fillStyle=s.color),s.textAlign&&(l.textAlign=s.textAlign),s.textBaseline&&(l.textBaseline=s.textBaseline)}function R2(l,s,o,u,f){if(f.strikethrough||f.underline){let n=l.measureText(u),x=s-n.actualBoundingBoxLeft,w=s+n.actualBoundingBoxRight,E=o-n.actualBoundingBoxAscent,A=o+n.actualBoundingBoxDescent,D=f.strikethrough?(E+A)/2:A;l.strokeStyle=l.fillStyle,l.beginPath(),l.lineWidth=f.decorationWidth||2,l.moveTo(x,D),l.lineTo(w,D),l.stroke()}}function wa(l,s){let{x:o,y:u,w:f,h:n,radius:x}=s;l.arc(o+x.topLeft,u+x.topLeft,x.topLeft,-bi,mi,!0),l.lineTo(o,u+n-x.bottomLeft),l.arc(o+x.bottomLeft,u+n-x.bottomLeft,x.bottomLeft,mi,bi,!0),l.lineTo(o+f-x.bottomRight,u+n),l.arc(o+f-x.bottomRight,u+n-x.bottomRight,x.bottomRight,bi,0,!0),l.lineTo(o+f,u+x.topRight),l.arc(o+f-x.topRight,u+x.topRight,x.topRight,0,-bi,!0),l.lineTo(o+x.topLeft,u)}var B2=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),F2=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function G0(l,s){let o=(""+l).match(B2);if(!o||o[1]==="normal")return s*1.2;switch(l=+o[2],o[3]){case"px":return l;case"%":l/=100;break}return s*l}var O2=l=>+l||0;function Ih(l,s){let o={},u=Ge(s),f=u?Object.keys(s):s,n=Ge(l)?u?x=>Pe(l[x],l[s[x]]):x=>l[x]:()=>l;for(let x of f)o[x]=O2(n(x));return o}function Ud(l){return Ih(l,{top:"y",right:"x",bottom:"y",left:"x"})}function Cs(l){return Ih(l,["topLeft","topRight","bottomLeft","bottomRight"])}function Wi(l){let s=Ud(l);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function zi(l,s){l=l||{},s=s||$e.font;let o=Pe(l.size,s.size);typeof o=="string"&&(o=parseInt(o,10));let u=Pe(l.style,s.style);u&&!(""+u).match(F2)&&(console.warn('Invalid font style specified: "'+u+'"'),u="");let f={family:Pe(l.family,s.family),lineHeight:G0(Pe(l.lineHeight,s.lineHeight),o),size:o,style:u,weight:Pe(l.weight,s.weight),string:""};return f.string=j0(f),f}function Ta(l,s,o,u){let f=!0,n,x,w;for(n=0,x=l.length;n<x;++n)if(w=l[n],w!==void 0&&(s!==void 0&&typeof w=="function"&&(w=w(s),f=!1),o!==void 0&&ai(w)&&(w=w[o%w.length],f=!1),w!==void 0))return u&&!f&&(u.cacheable=!1),w}function fm(l,s,o){let{min:u,max:f}=l,n=zd(s,(f-u)/2),x=(w,E)=>o&&w===0?0:w+E;return{min:x(u,-Math.abs(n)),max:x(f,n)}}function Wr(l,s){return Object.assign(Object.create(l),s)}function kh(l,s,o){o=o||(x=>l[x]<s);let u=l.length-1,f=0,n;for(;u-f>1;)n=f+u>>1,o(n)?f=n:u=n;return{lo:f,hi:u}}var vr=(l,s,o)=>kh(l,o,u=>l[u][s]<o),mm=(l,s,o)=>kh(l,o,u=>l[u][s]>=o);function _m(l,s,o){let u=0,f=l.length;for(;u<f&&l[u]<s;)u++;for(;f>u&&l[f-1]>o;)f--;return u>0||f<l.length?l.slice(u,f):l}var $0=["push","pop","shift","splice","unshift"];function gm(l,s){if(l._chartjs){l._chartjs.listeners.push(s);return}Object.defineProperty(l,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),$0.forEach(o=>{let u="_onData"+Mh(o),f=l[o];Object.defineProperty(l,o,{configurable:!0,enumerable:!1,value(...n){let x=f.apply(this,n);return l._chartjs.listeners.forEach(w=>{typeof w[u]=="function"&&w[u](...n)}),x}})})}function Nd(l,s){let o=l._chartjs;if(!o)return;let u=o.listeners,f=u.indexOf(s);f!==-1&&u.splice(f,1),!(u.length>0)&&($0.forEach(n=>{delete l[n]}),delete l._chartjs)}function jd(l){let s=new Set,o,u;for(o=0,u=l.length;o<u;++o)s.add(l[o]);return s.size===u?l:Array.from(s)}function Ph(l,s=[""],o=l,u,f=()=>l[0]){Ln(u)||(u=X0("_fallback",l));let n={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:l,_rootScopes:o,_fallback:u,_getTarget:f,override:x=>Ph([x,...l],s,o,u)};return new Proxy(n,{deleteProperty(x,w){return delete x[w],delete x._keys,delete l[0][w],!0},get(x,w){return q0(x,w,()=>q2(w,s,l,x))},getOwnPropertyDescriptor(x,w){return Reflect.getOwnPropertyDescriptor(x._scopes[0],w)},getPrototypeOf(){return Reflect.getPrototypeOf(l[0])},has(x,w){return C0(x).includes(w)},ownKeys(x){return C0(x)},set(x,w,E){let A=x._storage||(x._storage=f());return x[w]=A[w]=E,delete x._keys,!0}})}function xo(l,s,o,u){let f={_cacheable:!1,_proxy:l,_context:s,_subProxy:o,_stack:new Set,_descriptors:Gd(l,u),setContext:n=>xo(l,n,o,u),override:n=>xo(l.override(n),s,o,u)};return new Proxy(f,{deleteProperty(n,x){return delete n[x],delete l[x],!0},get(n,x,w){return q0(n,x,()=>Z2(n,x,w))},getOwnPropertyDescriptor(n,x){return n._descriptors.allKeys?Reflect.has(l,x)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(l,x)},getPrototypeOf(){return Reflect.getPrototypeOf(l)},has(n,x){return Reflect.has(l,x)},ownKeys(){return Reflect.ownKeys(l)},set(n,x,w){return l[x]=w,delete n[x],!0}})}function Gd(l,s={scriptable:!0,indexable:!0}){let{_scriptable:o=s.scriptable,_indexable:u=s.indexable,_allKeys:f=s.allKeys}=l;return{allKeys:f,scriptable:o,indexable:u,isScriptable:$r(o)?o:()=>o,isIndexable:$r(u)?u:()=>u}}var V2=(l,s)=>l?l+Mh(s):s,ym=(l,s)=>Ge(s)&&l!=="adapters"&&(Object.getPrototypeOf(s)===null||s.constructor===Object);function q0(l,s,o){if(Object.prototype.hasOwnProperty.call(l,s))return l[s];let u=o();return l[s]=u,u}function Z2(l,s,o){let{_proxy:u,_context:f,_subProxy:n,_descriptors:x}=l,w=u[s];return $r(w)&&x.isScriptable(s)&&(w=U2(s,w,l,o)),ai(w)&&w.length&&(w=N2(s,w,l,x.isIndexable)),ym(s,w)&&(w=xo(w,f,n&&n[s],x)),w}function U2(l,s,o,u){let{_proxy:f,_context:n,_subProxy:x,_stack:w}=o;if(w.has(l))throw new Error("Recursion detected: "+Array.from(w).join("->")+"->"+l);return w.add(l),s=s(n,x||u),w.delete(l),ym(l,s)&&(s=xm(f._scopes,f,l,s)),s}function N2(l,s,o,u){let{_proxy:f,_context:n,_subProxy:x,_descriptors:w}=o;if(Ln(n.index)&&u(l))s=s[n.index%s.length];else if(Ge(s[0])){let E=s,A=f._scopes.filter(D=>D!==E);s=[];for(let D of E){let B=xm(A,f,l,D);s.push(xo(B,n,x&&x[l],w))}}return s}function W0(l,s,o){return $r(l)?l(s,o):l}var j2=(l,s)=>l===!0?s:typeof l=="string"?qr(s,l):void 0;function G2(l,s,o,u,f){for(let n of s){let x=j2(o,n);if(x){l.add(x);let w=W0(x._fallback,o,f);if(Ln(w)&&w!==o&&w!==u)return w}else if(x===!1&&Ln(u)&&o!==u)return null}return!1}function xm(l,s,o,u){let f=s._rootScopes,n=W0(s._fallback,o,u),x=[...l,...f],w=new Set;w.add(u);let E=A0(w,x,o,n||o,u);return E===null||Ln(n)&&n!==o&&(E=A0(w,x,n,E,u),E===null)?!1:Ph(Array.from(w),[""],f,n,()=>$2(s,o,u))}function A0(l,s,o,u,f){for(;o;)o=G2(l,s,o,u,f);return o}function $2(l,s,o){let u=l._getTarget();s in u||(u[s]={});let f=u[s];return ai(f)&&Ge(o)?o:f}function q2(l,s,o,u){let f;for(let n of s)if(f=X0(V2(n,l),o),Ln(f))return ym(l,f)?xm(o,u,l,f):f}function X0(l,s){for(let o of s){if(!o)continue;let u=o[l];if(Ln(u))return u}}function C0(l){let s=l._keys;return s||(s=l._keys=W2(l._scopes)),s}function W2(l){let s=new Set;for(let o of l)for(let u of Object.keys(o).filter(f=>!f.startsWith("_")))s.add(u);return Array.from(s)}function $d(l,s,o,u){let{iScale:f}=l,{key:n="r"}=this._parsing,x=new Array(u),w,E,A,D;for(w=0,E=u;w<E;++w)A=w+o,D=s[A],x[w]={r:f.parse(qr(D,n),A)};return x}var X2=Number.EPSILON||1e-14,Fl=(l,s)=>s<l.length&&!l[s].skip&&l[s],H0=l=>l==="x"?"y":"x";function Y0(l,s,o,u){let f=l.skip?s:l,n=s,x=o.skip?s:o,w=Sh(n,f),E=Sh(x,n),A=w/(w+E),D=E/(w+E);A=isNaN(A)?0:A,D=isNaN(D)?0:D;let B=u*A,G=u*D;return{previous:{x:n.x-B*(x.x-f.x),y:n.y-B*(x.y-f.y)},next:{x:n.x+G*(x.x-f.x),y:n.y+G*(x.y-f.y)}}}function H2(l,s,o){let u=l.length,f,n,x,w,E,A=Fl(l,0);for(let D=0;D<u-1;++D)if(E=A,A=Fl(l,D+1),!(!E||!A)){if(va(s[D],0,X2)){o[D]=o[D+1]=0;continue}f=o[D]/s[D],n=o[D+1]/s[D],w=Math.pow(f,2)+Math.pow(n,2),!(w<=9)&&(x=3/Math.sqrt(w),o[D]=f*x*s[D],o[D+1]=n*x*s[D])}}function Y2(l,s,o="x"){let u=H0(o),f=l.length,n,x,w,E=Fl(l,0);for(let A=0;A<f;++A){if(x=w,w=E,E=Fl(l,A+1),!w)continue;let D=w[o],B=w[u];x&&(n=(D-x[o])/3,w[`cp1${o}`]=D-n,w[`cp1${u}`]=B-n*s[A]),E&&(n=(E[o]-D)/3,w[`cp2${o}`]=D+n,w[`cp2${u}`]=B+n*s[A])}}function K0(l,s="x"){let o=H0(s),u=l.length,f=Array(u).fill(0),n=Array(u),x,w,E,A=Fl(l,0);for(x=0;x<u;++x)if(w=E,E=A,A=Fl(l,x+1),!!E){if(A){let D=A[s]-E[s];f[x]=D!==0?(A[o]-E[o])/D:0}n[x]=w?A?sr(f[x-1])!==sr(f[x])?0:(f[x-1]+f[x])/2:f[x-1]:f[x]}H2(l,f,n),Y2(l,n,s)}function Ad(l,s,o){return Math.max(Math.min(l,o),s)}function K2(l,s){let o,u,f,n,x,w=ga(l[0],s);for(o=0,u=l.length;o<u;++o)x=n,n=w,w=o<u-1&&ga(l[o+1],s),n&&(f=l[o],x&&(f.cp1x=Ad(f.cp1x,s.left,s.right),f.cp1y=Ad(f.cp1y,s.top,s.bottom)),w&&(f.cp2x=Ad(f.cp2x,s.left,s.right),f.cp2y=Ad(f.cp2y,s.top,s.bottom)))}function vm(l,s,o,u,f){let n,x,w,E;if(s.spanGaps&&(l=l.filter(A=>!A.skip)),s.cubicInterpolationMode==="monotone")K0(l,f);else{let A=u?l[l.length-1]:l[0];for(n=0,x=l.length;n<x;++n)w=l[n],E=Y0(A,w,l[Math.min(n+1,x-(u?0:1))%x],s.tension),w.cp1x=E.previous.x,w.cp1y=E.previous.y,w.cp2x=E.next.x,w.cp2y=E.next.y,A=w}s.capBezierPoints&&K2(l,o)}function qd(){return typeof window<"u"&&typeof document<"u"}function zh(l){let s=l.parentNode;return s&&s.toString()==="[object ShadowRoot]"&&(s=s.host),s}function Id(l,s,o){let u;return typeof l=="string"?(u=parseInt(l,10),l.indexOf("%")!==-1&&(u=u/100*s.parentNode[o])):u=l,u}var Wd=l=>window.getComputedStyle(l,null);function J0(l,s){return Wd(l).getPropertyValue(s)}var J2=["top","right","bottom","left"];function ma(l,s,o){let u={};o=o?"-"+o:"";for(let f=0;f<4;f++){let n=J2[f];u[n]=parseFloat(l[s+"-"+n+o])||0}return u.width=u.left+u.right,u.height=u.top+u.bottom,u}var Q2=(l,s,o)=>(l>0||s>0)&&(!o||!o.shadowRoot);function tb(l,s){let o=l.touches,u=o&&o.length?o[0]:l,{offsetX:f,offsetY:n}=u,x=!1,w,E;if(Q2(f,n,l.target))w=f,E=n;else{let A=s.getBoundingClientRect();w=u.clientX-A.left,E=u.clientY-A.top,x=!0}return{x:w,y:E,box:x}}function Is(l,s){if("native"in l)return l;let{canvas:o,currentDevicePixelRatio:u}=s,f=Wd(o),n=f.boxSizing==="border-box",x=ma(f,"padding"),w=ma(f,"border","width"),{x:E,y:A,box:D}=tb(l,o),B=x.left+(D&&w.left),G=x.top+(D&&w.top),{width:rt,height:Q}=s;return n&&(rt-=x.width+w.width,Q-=x.height+w.height),{x:Math.round((E-B)/rt*o.width/u),y:Math.round((A-G)/Q*o.height/u)}}function eb(l,s,o){let u,f;if(s===void 0||o===void 0){let n=zh(l);if(!n)s=l.clientWidth,o=l.clientHeight;else{let x=n.getBoundingClientRect(),w=Wd(n),E=ma(w,"border","width"),A=ma(w,"padding");s=x.width-A.width-E.width,o=x.height-A.height-E.height,u=Id(w.maxWidth,n,"clientWidth"),f=Id(w.maxHeight,n,"clientHeight")}}return{width:s,height:o,maxWidth:u||Th,maxHeight:f||Th}}var Hf=l=>Math.round(l*10)/10;function bm(l,s,o,u){let f=Wd(l),n=ma(f,"margin"),x=Id(f.maxWidth,l,"clientWidth")||Th,w=Id(f.maxHeight,l,"clientHeight")||Th,E=eb(l,s,o),{width:A,height:D}=E;if(f.boxSizing==="content-box"){let B=ma(f,"border","width"),G=ma(f,"padding");A-=G.width+B.width,D-=G.height+B.height}return A=Math.max(0,A-n.width),D=Math.max(0,u?Math.floor(A/u):D-n.height),A=Hf(Math.min(A,x,E.maxWidth)),D=Hf(Math.min(D,w,E.maxHeight)),A&&!D&&(D=Hf(A/2)),{width:A,height:D}}function Xd(l,s,o){let u=s||1,f=Math.floor(l.height*u),n=Math.floor(l.width*u);l.height=f/u,l.width=n/u;let x=l.canvas;return x.style&&(o||!x.style.height&&!x.style.width)&&(x.style.height=`${l.height}px`,x.style.width=`${l.width}px`),l.currentDevicePixelRatio!==u||x.height!==f||x.width!==n?(l.currentDevicePixelRatio=u,x.height=f,x.width=n,l.ctx.setTransform(u,0,0,u,0,0),!0):!1}var wm=function(){let l=!1;try{let s={get passive(){return l=!0,!1}};window.addEventListener("test",null,s),window.removeEventListener("test",null,s)}catch{}return l}();function Hd(l,s){let o=J0(l,s),u=o&&o.match(/^(\d+)(\.\d+)?px$/);return u?+u[1]:void 0}function Es(l,s,o,u){return{x:l.x+o*(s.x-l.x),y:l.y+o*(s.y-l.y)}}function Tm(l,s,o,u){return{x:l.x+o*(s.x-l.x),y:u==="middle"?o<.5?l.y:s.y:u==="after"?o<1?l.y:s.y:o>0?s.y:l.y}}function Sm(l,s,o,u){let f={x:l.cp2x,y:l.cp2y},n={x:s.cp1x,y:s.cp1y},x=Es(l,f,o),w=Es(f,n,o),E=Es(n,s,o),A=Es(x,w,o),D=Es(w,E,o);return Es(A,D,o)}var I0=new Map;function ib(l,s){s=s||{};let o=l+JSON.stringify(s),u=I0.get(o);return u||(u=new Intl.NumberFormat(l,s),I0.set(o,u)),u}function Sa(l,s,o){return ib(s,o).format(l)}var nb=function(l,s){return{x(o){return l+l+s-o},setWidth(o){s=o},textAlign(o){return o==="center"?o:o==="right"?"left":"right"},xPlus(o,u){return o-u},leftForLtr(o,u){return o-u}}},rb=function(){return{x(l){return l},setWidth(l){},textAlign(l){return l},xPlus(l,s){return l+s},leftForLtr(l,s){return l}}};function bo(l,s,o){return l?nb(s,o):rb()}function Yd(l,s){let o,u;(s==="ltr"||s==="rtl")&&(o=l.canvas.style,u=[o.getPropertyValue("direction"),o.getPropertyPriority("direction")],o.setProperty("direction",s,"important"),l.prevTextDirection=u)}function Kd(l,s){s!==void 0&&(delete l.prevTextDirection,l.canvas.style.setProperty("direction",s[0],s[1]))}function Q0(l){return l==="angle"?{between:ba,compare:O0,normalize:yn}:{between:xr,compare:(s,o)=>s-o,normalize:s=>s}}function k0({start:l,end:s,count:o,loop:u,style:f}){return{start:l%o,end:s%o,loop:u&&(s-l+1)%o===0,style:f}}function sb(l,s,o){let{property:u,start:f,end:n}=o,{between:x,normalize:w}=Q0(u),E=s.length,{start:A,end:D,loop:B}=l,G,rt;if(B){for(A+=E,D+=E,G=0,rt=E;G<rt&&x(w(s[A%E][u]),f,n);++G)A--,D--;A%=E,D%=E}return D<A&&(D+=E),{start:A,end:D,loop:B,style:l.style}}function Jd(l,s,o){if(!o)return[l];let{property:u,start:f,end:n}=o,x=s.length,{compare:w,between:E,normalize:A}=Q0(u),{start:D,end:B,loop:G,style:rt}=sb(l,s,o),Q=[],dt=!1,W=null,et,mt,St,_t=()=>E(f,St,et)&&w(f,St)!==0,Mt=()=>w(n,et)===0||E(n,St,et),Rt=()=>dt||_t(),Vt=()=>!dt||Mt();for(let Yt=D,jt=D;Yt<=B;++Yt)mt=s[Yt%x],!mt.skip&&(et=A(mt[u]),et!==St&&(dt=E(et,f,n),W===null&&Rt()&&(W=w(et,f)===0?Yt:jt),W!==null&&Vt()&&(Q.push(k0({start:W,end:Yt,loop:G,count:x,style:rt})),W=null),jt=Yt,St=et));return W!==null&&Q.push(k0({start:W,end:B,loop:G,count:x,style:rt})),Q}function Qd(l,s){let o=[],u=l.segments;for(let f=0;f<u.length;f++){let n=Jd(u[f],l.points,s);n.length&&o.push(...n)}return o}function ob(l,s,o,u){let f=0,n=s-1;if(o&&!u)for(;f<s&&!l[f].skip;)f++;for(;f<s&&l[f].skip;)f++;for(f%=s,o&&(n+=f);n>f&&l[n%s].skip;)n--;return n%=s,{start:f,end:n}}function ab(l,s,o,u){let f=l.length,n=[],x=s,w=l[s],E;for(E=s+1;E<=o;++E){let A=l[E%f];A.skip||A.stop?w.skip||(u=!1,n.push({start:s%f,end:(E-1)%f,loop:u}),s=x=A.stop?E:null):(x=E,w.skip&&(s=E)),w=A}return x!==null&&n.push({start:s%f,end:x%f,loop:u}),n}function Em(l,s){let o=l.points,u=l.options.spanGaps,f=o.length;if(!f)return[];let n=!!l._loop,{start:x,end:w}=ob(o,f,n,u);if(u===!0)return P0(l,[{start:x,end:w,loop:n}],o,s);let E=w<x?w+f:w,A=!!l._fullLoop&&x===0&&w===f-1;return P0(l,ab(o,x,E,A),o,s)}function P0(l,s,o,u){return!u||!u.setContext||!o?s:lb(l,s,o,u)}function lb(l,s,o,u){let f=l._chart.getContext(),n=z0(l.options),{_datasetIndex:x,options:{spanGaps:w}}=l,E=o.length,A=[],D=n,B=s[0].start,G=B;function rt(Q,dt,W,et){let mt=w?-1:1;if(Q!==dt){for(Q+=E;o[Q%E].skip;)Q-=mt;for(;o[dt%E].skip;)dt+=mt;Q%E!==dt%E&&(A.push({start:Q%E,end:dt%E,loop:W,style:et}),D=et,B=dt%E)}}for(let Q of s){B=w?B:Q.start;let dt=o[B%E],W;for(G=B+1;G<=Q.end;G++){let et=o[G%E];W=z0(u.setContext(Wr(f,{type:"segment",p0:dt,p1:et,p0DataIndex:(G-1)%E,p1DataIndex:G%E,datasetIndex:x}))),cb(W,D)&&rt(B,G-1,Q.loop,D),dt=et,D=W}B<G-1&&rt(B,G-1,Q.loop,D)}return A}function z0(l){return{backgroundColor:l.backgroundColor,borderCapStyle:l.borderCapStyle,borderDash:l.borderDash,borderDashOffset:l.borderDashOffset,borderJoinStyle:l.borderJoinStyle,borderWidth:l.borderWidth,borderColor:l.borderColor}}function cb(l,s){return s&&JSON.stringify(l)!==JSON.stringify(s)}var Rm=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,o,u,f){let n=o.listeners[f],x=o.duration;n.forEach(w=>w({chart:s,initial:o.initial,numSteps:x,currentStep:Math.min(u-o.start,x)}))}_refresh(){this._request||(this._running=!0,this._request=kd.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let o=0;this._charts.forEach((u,f)=>{if(!u.running||!u.items.length)return;let n=u.items,x=n.length-1,w=!1,E;for(;x>=0;--x)E=n[x],E._active?(E._total>u.duration&&(u.duration=E._total),E.tick(s),w=!0):(n[x]=n[n.length-1],n.pop());w&&(f.draw(),this._notify(f,u,s,"progress")),n.length||(u.running=!1,this._notify(f,u,s,"complete"),u.initial=!1),o+=n.length}),this._lastDate=s,o===0&&(this._running=!1)}_getAnims(s){let o=this._charts,u=o.get(s);return u||(u={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},o.set(s,u)),u}listen(s,o,u){this._getAnims(s).listeners[o].push(u)}add(s,o){!o||!o.length||this._getAnims(s).items.push(...o)}has(s){return this._getAnims(s).items.length>0}start(s){let o=this._charts.get(s);!o||(o.running=!0,o.start=Date.now(),o.duration=o.items.reduce((u,f)=>Math.max(u,f._duration),0),this._refresh())}running(s){if(!this._running)return!1;let o=this._charts.get(s);return!(!o||!o.running||!o.items.length)}stop(s){let o=this._charts.get(s);if(!o||!o.items.length)return;let u=o.items,f=u.length-1;for(;f>=0;--f)u[f].cancel();o.items=[],this._notify(s,o,Date.now(),"complete")}remove(s){return this._charts.delete(s)}},ks=new Rm,ty="transparent",hb={boolean(l,s,o){return o>.5?s:l},color(l,s,o){let u=Od(l||ty),f=u.valid&&Od(s||ty);return f&&f.valid?f.mix(u,o).hexString():s},number(l,s,o){return l+(s-l)*o}},Bm=class{constructor(s,o,u,f){let n=o[u];f=Ta([s.to,f,n,s.from]);let x=Ta([s.from,n,f]);this._active=!0,this._fn=s.fn||hb[s.type||typeof x],this._easing=fa[s.easing]||fa.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=o,this._prop=u,this._from=x,this._to=f,this._promises=void 0}active(){return this._active}update(s,o,u){if(this._active){this._notify(!1);let f=this._target[this._prop],n=u-this._start,x=this._duration-n;this._start=u,this._duration=Math.floor(Math.max(x,s.duration)),this._total+=n,this._loop=!!s.loop,this._to=Ta([s.to,o,f,s.from]),this._from=Ta([s.from,f,o])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){let o=s-this._start,u=this._duration,f=this._prop,n=this._from,x=this._loop,w=this._to,E;if(this._active=n!==w&&(x||o<u),!this._active){this._target[f]=w,this._notify(!0);return}if(o<0){this._target[f]=n;return}E=o/u%2,E=x&&E>1?2-E:E,E=this._easing(Math.min(1,Math.max(0,E))),this._target[f]=this._fn(n,w,E)}wait(){let s=this._promises||(this._promises=[]);return new Promise((o,u)=>{s.push({res:o,rej:u})})}_notify(s){let o=s?"res":"rej",u=this._promises||[];for(let f=0;f<u.length;f++)u[f][o]()}},ub=["x","y","borderWidth","radius","tension"],db=["color","borderColor","backgroundColor"];$e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});var pb=Object.keys($e.animation);$e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:l=>l!=="onProgress"&&l!=="onComplete"&&l!=="fn"});$e.set("animations",{colors:{type:"color",properties:db},numbers:{type:"number",properties:ub}});$e.describe("animations",{_fallback:"animation"});$e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:l=>l|0}}}});var ap=class{constructor(s,o){this._chart=s,this._properties=new Map,this.configure(o)}configure(s){if(!Ge(s))return;let o=this._properties;Object.getOwnPropertyNames(s).forEach(u=>{let f=s[u];if(!Ge(f))return;let n={};for(let x of pb)n[x]=f[x];(ai(f.properties)&&f.properties||[u]).forEach(x=>{(x===u||!o.has(x))&&o.set(x,n)})})}_animateOptions(s,o){let u=o.options,f=mb(s,u);if(!f)return[];let n=this._createAnimations(f,u);return u.$shared&&fb(s.options.$animations,u).then(()=>{s.options=u},()=>{}),n}_createAnimations(s,o){let u=this._properties,f=[],n=s.$animations||(s.$animations={}),x=Object.keys(o),w=Date.now(),E;for(E=x.length-1;E>=0;--E){let A=x[E];if(A.charAt(0)==="$")continue;if(A==="options"){f.push(...this._animateOptions(s,o));continue}let D=o[A],B=n[A],G=u.get(A);if(B)if(G&&B.active()){B.update(G,D,w);continue}else B.cancel();if(!G||!G.duration){s[A]=D;continue}n[A]=B=new Bm(G,s,A,D),f.push(B)}return f}update(s,o){if(this._properties.size===0){Object.assign(s,o);return}let u=this._createAnimations(s,o);if(u.length)return ks.add(this._chart,u),!0}};function fb(l,s){let o=[],u=Object.keys(s);for(let f=0;f<u.length;f++){let n=l[u[f]];n&&n.active()&&o.push(n.wait())}return Promise.all(o)}function mb(l,s){if(!s)return;let o=l.options;if(!o){l.options=s;return}return o.$shared&&(l.options=o=Object.assign({},o,{$shared:!1,$animations:{}})),o}function ey(l,s){let o=l&&l.options||{},u=o.reverse,f=o.min===void 0?s:0,n=o.max===void 0?s:0;return{start:u?n:f,end:u?f:n}}function _b(l,s,o){if(o===!1)return!1;let u=ey(l,o),f=ey(s,o);return{top:f.end,right:u.end,bottom:f.start,left:u.start}}function gb(l){let s,o,u,f;return Ge(l)?(s=l.top,o=l.right,u=l.bottom,f=l.left):s=o=u=f=l,{top:s,right:o,bottom:u,left:f,disabled:l===!1}}function Gy(l,s){let o=[],u=l._getSortedDatasetMetas(s),f,n;for(f=0,n=u.length;f<n;++f)o.push(u[f].index);return o}function iy(l,s,o,u={}){let f=l.keys,n=u.mode==="single",x,w,E,A;if(s!==null){for(x=0,w=f.length;x<w;++x){if(E=+f[x],E===o){if(u.all)continue;break}A=l.values[E],Mi(A)&&(n||s===0||sr(s)===sr(A))&&(s+=A)}return s}}function yb(l){let s=Object.keys(l),o=new Array(s.length),u,f,n;for(u=0,f=s.length;u<f;++u)n=s[u],o[u]={x:n,y:l[n]};return o}function ny(l,s){let o=l&&l.options.stacked;return o||o===void 0&&s.stack!==void 0}function xb(l,s,o){return`${l.id}.${s.id}.${o.stack||o.type}`}function vb(l){let{min:s,max:o,minDefined:u,maxDefined:f}=l.getUserBounds();return{min:u?s:Number.NEGATIVE_INFINITY,max:f?o:Number.POSITIVE_INFINITY}}function bb(l,s,o){let u=l[s]||(l[s]={});return u[o]||(u[o]={})}function ry(l,s,o,u){for(let f of s.getMatchingVisibleMetas(u).reverse()){let n=l[f.index];if(o&&n>0||!o&&n<0)return f.index}return null}function sy(l,s){let{chart:o,_cachedMeta:u}=l,f=o._stacks||(o._stacks={}),{iScale:n,vScale:x,index:w}=u,E=n.axis,A=x.axis,D=xb(n,x,u),B=s.length,G;for(let rt=0;rt<B;++rt){let Q=s[rt],{[E]:dt,[A]:W}=Q,et=Q._stacks||(Q._stacks={});G=et[A]=bb(f,D,dt),G[w]=W,G._top=ry(G,x,!0,u.type),G._bottom=ry(G,x,!1,u.type)}}function Mm(l,s){let o=l.scales;return Object.keys(o).filter(u=>o[u].axis===s).shift()}function wb(l,s){return Wr(l,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}function Tb(l,s,o){return Wr(l,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:o,index:s,mode:"default",type:"data"})}function Dh(l,s){let o=l.controller.index,u=l.vScale&&l.vScale.axis;if(!!u){s=s||l._parsed;for(let f of s){let n=f._stacks;if(!n||n[u]===void 0||n[u][o]===void 0)return;delete n[u][o]}}}var Am=l=>l==="reset"||l==="none",oy=(l,s)=>s?l:Object.assign({},l),Sb=(l,s,o)=>l&&!s.hidden&&s._stacked&&{keys:Gy(o,!0),values:null},or=class{constructor(s,o){this.chart=s,this._ctx=s.ctx,this.index=o,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){let s=this._cachedMeta;this.configure(),this.linkScales(),s._stacked=ny(s.vScale,s),this.addElements()}updateIndex(s){this.index!==s&&Dh(this._cachedMeta),this.index=s}linkScales(){let s=this.chart,o=this._cachedMeta,u=this.getDataset(),f=(B,G,rt,Q)=>B==="x"?G:B==="r"?Q:rt,n=o.xAxisID=Pe(u.xAxisID,Mm(s,"x")),x=o.yAxisID=Pe(u.yAxisID,Mm(s,"y")),w=o.rAxisID=Pe(u.rAxisID,Mm(s,"r")),E=o.indexAxis,A=o.iAxisID=f(E,n,x,w),D=o.vAxisID=f(E,x,n,w);o.xScale=this.getScaleForId(n),o.yScale=this.getScaleForId(x),o.rScale=this.getScaleForId(w),o.iScale=this.getScaleForId(A),o.vScale=this.getScaleForId(D)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(s){return this.chart.scales[s]}_getOtherScale(s){let o=this._cachedMeta;return s===o.iScale?o.vScale:o.iScale}reset(){this._update("reset")}_destroy(){let s=this._cachedMeta;this._data&&Nd(this._data,this),s._stacked&&Dh(s)}_dataCheck(){let s=this.getDataset(),o=s.data||(s.data=[]),u=this._data;if(Ge(o))this._data=yb(o);else if(u!==o){if(u){Nd(u,this);let f=this._cachedMeta;Dh(f),f._parsed=[]}o&&Object.isExtensible(o)&&gm(o,this),this._syncList=[],this._data=o}}addElements(){let s=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(s.dataset=new this.datasetElementType)}buildOrUpdateElements(s){let o=this._cachedMeta,u=this.getDataset(),f=!1;this._dataCheck();let n=o._stacked;o._stacked=ny(o.vScale,o),o.stack!==u.stack&&(f=!0,Dh(o),o.stack=u.stack),this._resyncElements(s),(f||n!==o._stacked)&&sy(this,o._parsed)}configure(){let s=this.chart.config,o=s.datasetScopeKeys(this._type),u=s.getOptionScopes(this.getDataset(),o,!0);this.options=s.createResolver(u,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(s,o){let{_cachedMeta:u,_data:f}=this,{iScale:n,_stacked:x}=u,w=n.axis,E=s===0&&o===f.length?!0:u._sorted,A=s>0&&u._parsed[s-1],D,B,G;if(this._parsing===!1)u._parsed=f,u._sorted=!0,G=f;else{ai(f[s])?G=this.parseArrayData(u,f,s,o):Ge(f[s])?G=this.parseObjectData(u,f,s,o):G=this.parsePrimitiveData(u,f,s,o);let rt=()=>B[w]===null||A&&B[w]<A[w];for(D=0;D<o;++D)u._parsed[D+s]=B=G[D],E&&(rt()&&(E=!1),A=B);u._sorted=E}x&&sy(this,G)}parsePrimitiveData(s,o,u,f){let{iScale:n,vScale:x}=s,w=n.axis,E=x.axis,A=n.getLabels(),D=n===x,B=new Array(f),G,rt,Q;for(G=0,rt=f;G<rt;++G)Q=G+u,B[G]={[w]:D||n.parse(A[Q],Q),[E]:x.parse(o[Q],Q)};return B}parseArrayData(s,o,u,f){let{xScale:n,yScale:x}=s,w=new Array(f),E,A,D,B;for(E=0,A=f;E<A;++E)D=E+u,B=o[D],w[E]={x:n.parse(B[0],D),y:x.parse(B[1],D)};return w}parseObjectData(s,o,u,f){let{xScale:n,yScale:x}=s,{xAxisKey:w="x",yAxisKey:E="y"}=this._parsing,A=new Array(f),D,B,G,rt;for(D=0,B=f;D<B;++D)G=D+u,rt=o[G],A[D]={x:n.parse(qr(rt,w),G),y:x.parse(qr(rt,E),G)};return A}getParsed(s){return this._cachedMeta._parsed[s]}getDataElement(s){return this._cachedMeta.data[s]}applyStack(s,o,u){let f=this.chart,n=this._cachedMeta,x=o[s.axis],w={keys:Gy(f,!0),values:o._stacks[s.axis]};return iy(w,x,n.index,{mode:u})}updateRangeFromParsed(s,o,u,f){let n=u[o.axis],x=n===null?NaN:n,w=f&&u._stacks[o.axis];f&&w&&(f.values=w,x=iy(f,n,this._cachedMeta.index)),s.min=Math.min(s.min,x),s.max=Math.max(s.max,x)}getMinMax(s,o){let u=this._cachedMeta,f=u._parsed,n=u._sorted&&s===u.iScale,x=f.length,w=this._getOtherScale(s),E=Sb(o,u,this.chart),A={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:D,max:B}=vb(w),G,rt;function Q(){rt=f[G];let dt=rt[w.axis];return!Mi(rt[s.axis])||D>dt||B<dt}for(G=0;G<x&&!(!Q()&&(this.updateRangeFromParsed(A,s,rt,E),n));++G);if(n){for(G=x-1;G>=0;--G)if(!Q()){this.updateRangeFromParsed(A,s,rt,E);break}}return A}getAllParsedValues(s){let o=this._cachedMeta._parsed,u=[],f,n,x;for(f=0,n=o.length;f<n;++f)x=o[f][s.axis],Mi(x)&&u.push(x);return u}getMaxOverflow(){return!1}getLabelAndValue(s){let o=this._cachedMeta,u=o.iScale,f=o.vScale,n=this.getParsed(s);return{label:u?""+u.getLabelForValue(n[u.axis]):"",value:f?""+f.getLabelForValue(n[f.axis]):""}}_update(s){let o=this._cachedMeta;this.update(s||"default"),o._clip=gb(Pe(this.options.clip,_b(o.xScale,o.yScale,this.getMaxOverflow())))}update(s){}draw(){let s=this._ctx,o=this.chart,u=this._cachedMeta,f=u.data||[],n=o.chartArea,x=[],w=this._drawStart||0,E=this._drawCount||f.length-w,A=this.options.drawActiveElementsOnTop,D;for(u.dataset&&u.dataset.draw(s,n,w,E),D=w;D<w+E;++D){let B=f[D];B.hidden||(B.active&&A?x.push(B):B.draw(s,n))}for(D=0;D<x.length;++D)x[D].draw(s,n)}getStyle(s,o){let u=o?"active":"default";return s===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(u):this.resolveDataElementOptions(s||0,u)}getContext(s,o,u){let f=this.getDataset(),n;if(s>=0&&s<this._cachedMeta.data.length){let x=this._cachedMeta.data[s];n=x.$context||(x.$context=Tb(this.getContext(),s,x)),n.parsed=this.getParsed(s),n.raw=f.data[s],n.index=n.dataIndex=s}else n=this.$context||(this.$context=wb(this.chart.getContext(),this.index)),n.dataset=f,n.index=n.datasetIndex=this.index;return n.active=!!o,n.mode=u,n}resolveDatasetElementOptions(s){return this._resolveElementOptions(this.datasetElementType.id,s)}resolveDataElementOptions(s,o){return this._resolveElementOptions(this.dataElementType.id,o,s)}_resolveElementOptions(s,o="default",u){let f=o==="active",n=this._cachedDataOpts,x=s+"-"+o,w=n[x],E=this.enableOptionSharing&&Ln(u);if(w)return oy(w,E);let A=this.chart.config,D=A.datasetElementScopeKeys(this._type,s),B=f?[`${s}Hover`,"hover",s,""]:[s,""],G=A.getOptionScopes(this.getDataset(),D),rt=Object.keys($e.elements[s]),Q=()=>this.getContext(u,f),dt=A.resolveNamedOptions(G,rt,Q,B);return dt.$shared&&(dt.$shared=E,n[x]=Object.freeze(oy(dt,E))),dt}_resolveAnimations(s,o,u){let f=this.chart,n=this._cachedDataOpts,x=`animation-${o}`,w=n[x];if(w)return w;let E;if(f.options.animation!==!1){let D=this.chart.config,B=D.datasetAnimationScopeKeys(this._type,o),G=D.getOptionScopes(this.getDataset(),B);E=D.createResolver(G,this.getContext(s,u,o))}let A=new ap(f,E&&E.animations);return E&&E._cacheable&&(n[x]=Object.freeze(A)),A}getSharedOptions(s){if(!!s.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},s))}includeOptions(s,o){return!o||Am(s)||this.chart._animationsDisabled}updateElement(s,o,u,f){Am(f)?Object.assign(s,u):this._resolveAnimations(o,f).update(s,u)}updateSharedOptions(s,o,u){s&&!Am(o)&&this._resolveAnimations(void 0,o).update(s,u)}_setStyle(s,o,u,f){s.active=f;let n=this.getStyle(o,f);this._resolveAnimations(o,u,f).update(s,{options:!f&&this.getSharedOptions(n)||n})}removeHoverStyle(s,o,u){this._setStyle(s,u,"active",!1)}setHoverStyle(s,o,u){this._setStyle(s,u,"active",!0)}_removeDatasetHoverStyle(){let s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!1)}_setDatasetHoverStyle(){let s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!0)}_resyncElements(s){let o=this._data,u=this._cachedMeta.data;for(let[w,E,A]of this._syncList)this[w](E,A);this._syncList=[];let f=u.length,n=o.length,x=Math.min(n,f);x&&this.parse(0,x),n>f?this._insertElements(f,n-f,s):n<f&&this._removeElements(n,f-n)}_insertElements(s,o,u=!0){let f=this._cachedMeta,n=f.data,x=s+o,w,E=A=>{for(A.length+=o,w=A.length-1;w>=x;w--)A[w]=A[w-o]};for(E(n),w=s;w<x;++w)n[w]=new this.dataElementType;this._parsing&&E(f._parsed),this.parse(s,o),u&&this.updateElements(n,s,o,"reset")}updateElements(s,o,u,f){}_removeElements(s,o){let u=this._cachedMeta;if(this._parsing){let f=u._parsed.splice(s,o);u._stacked&&Dh(u,f)}u.data.splice(s,o)}_sync(s){if(this._parsing)this._syncList.push(s);else{let[o,u,f]=s;this[o](u,f)}this.chart._dataChanges.push([this.index,...s])}_onDataPush(){let s=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-s,s])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(s,o){o&&this._sync(["_removeElements",s,o]);let u=arguments.length-2;u&&this._sync(["_insertElements",s,u])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}};or.defaults={};or.prototype.datasetElementType=null;or.prototype.dataElementType=null;function Eb(l,s){if(!l._cache.$bar){let o=l.getMatchingVisibleMetas(s),u=[];for(let f=0,n=o.length;f<n;f++)u=u.concat(o[f].controller.getAllParsedValues(l));l._cache.$bar=jd(u.sort((f,n)=>f-n))}return l._cache.$bar}function Mb(l){let s=l.iScale,o=Eb(s,l.type),u=s._length,f,n,x,w,E=()=>{x===32767||x===-32768||(Ln(w)&&(u=Math.min(u,Math.abs(x-w)||u)),w=x)};for(f=0,n=o.length;f<n;++f)x=s.getPixelForValue(o[f]),E();for(w=void 0,f=0,n=s.ticks.length;f<n;++f)x=s.getPixelForTick(f),E();return u}function Ab(l,s,o,u){let f=o.barThickness,n,x;return Xe(f)?(n=s.min*o.categoryPercentage,x=o.barPercentage):(n=f*u,x=1),{chunk:n/u,ratio:x,start:s.pixels[l]-n/2}}function Cb(l,s,o,u){let f=s.pixels,n=f[l],x=l>0?f[l-1]:null,w=l<f.length-1?f[l+1]:null,E=o.categoryPercentage;x===null&&(x=n-(w===null?s.end-s.start:w-n)),w===null&&(w=n+n-x);let A=n-(n-Math.min(x,w))/2*E;return{chunk:Math.abs(w-x)/2*E/u,ratio:o.barPercentage,start:A}}function Ib(l,s,o,u){let f=o.parse(l[0],u),n=o.parse(l[1],u),x=Math.min(f,n),w=Math.max(f,n),E=x,A=w;Math.abs(x)>Math.abs(w)&&(E=w,A=x),s[o.axis]=A,s._custom={barStart:E,barEnd:A,start:f,end:n,min:x,max:w}}function $y(l,s,o,u){return ai(l)?Ib(l,s,o,u):s[o.axis]=o.parse(l,u),s}function ay(l,s,o,u){let f=l.iScale,n=l.vScale,x=f.getLabels(),w=f===n,E=[],A,D,B,G;for(A=o,D=o+u;A<D;++A)G=s[A],B={},B[f.axis]=w||f.parse(x[A],A),E.push($y(G,B,n,A));return E}function Cm(l){return l&&l.barStart!==void 0&&l.barEnd!==void 0}function kb(l,s,o){return l!==0?sr(l):(s.isHorizontal()?1:-1)*(s.min>=o?1:-1)}function Pb(l){let s,o,u,f,n;return l.horizontal?(s=l.base>l.x,o="left",u="right"):(s=l.base<l.y,o="bottom",u="top"),s?(f="end",n="start"):(f="start",n="end"),{start:o,end:u,reverse:s,top:f,bottom:n}}function zb(l,s,o,u){let f=s.borderSkipped,n={};if(!f){l.borderSkipped=n;return}let{start:x,end:w,reverse:E,top:A,bottom:D}=Pb(l);f==="middle"&&o&&(l.enableBorderRadius=!0,(o._top||0)===u?f=A:(o._bottom||0)===u?f=D:(n[ly(D,x,w,E)]=!0,f=A)),n[ly(f,x,w,E)]=!0,l.borderSkipped=n}function ly(l,s,o,u){return u?(l=Db(l,s,o),l=cy(l,o,s)):l=cy(l,s,o),l}function Db(l,s,o){return l===s?o:l===o?s:l}function cy(l,s,o){return l==="start"?s:l==="end"?o:l}function Lb(l,{inflateAmount:s},o){l.inflateAmount=s==="auto"?o===1?.33:0:s}var Gl=class extends or{parsePrimitiveData(s,o,u,f){return ay(s,o,u,f)}parseArrayData(s,o,u,f){return ay(s,o,u,f)}parseObjectData(s,o,u,f){let{iScale:n,vScale:x}=s,{xAxisKey:w="x",yAxisKey:E="y"}=this._parsing,A=n.axis==="x"?w:E,D=x.axis==="x"?w:E,B=[],G,rt,Q,dt;for(G=u,rt=u+f;G<rt;++G)dt=o[G],Q={},Q[n.axis]=n.parse(qr(dt,A),G),B.push($y(qr(dt,D),Q,x,G));return B}updateRangeFromParsed(s,o,u,f){super.updateRangeFromParsed(s,o,u,f);let n=u._custom;n&&o===this._cachedMeta.vScale&&(s.min=Math.min(s.min,n.min),s.max=Math.max(s.max,n.max))}getMaxOverflow(){return 0}getLabelAndValue(s){let o=this._cachedMeta,{iScale:u,vScale:f}=o,n=this.getParsed(s),x=n._custom,w=Cm(x)?"["+x.start+", "+x.end+"]":""+f.getLabelForValue(n[f.axis]);return{label:""+u.getLabelForValue(n[u.axis]),value:w}}initialize(){this.enableOptionSharing=!0,super.initialize();let s=this._cachedMeta;s.stack=this.getDataset().stack}update(s){let o=this._cachedMeta;this.updateElements(o.data,0,o.data.length,s)}updateElements(s,o,u,f){let n=f==="reset",{index:x,_cachedMeta:{vScale:w}}=this,E=w.getBasePixel(),A=w.isHorizontal(),D=this._getRuler(),B=this.resolveDataElementOptions(o,f),G=this.getSharedOptions(B),rt=this.includeOptions(f,G);this.updateSharedOptions(G,f,B);for(let Q=o;Q<o+u;Q++){let dt=this.getParsed(Q),W=n||Xe(dt[w.axis])?{base:E,head:E}:this._calculateBarValuePixels(Q),et=this._calculateBarIndexPixels(Q,D),mt=(dt._stacks||{})[w.axis],St={horizontal:A,base:W.base,enableBorderRadius:!mt||Cm(dt._custom)||x===mt._top||x===mt._bottom,x:A?W.head:et.center,y:A?et.center:W.head,height:A?et.size:Math.abs(W.size),width:A?Math.abs(W.size):et.size};rt&&(St.options=G||this.resolveDataElementOptions(Q,s[Q].active?"active":f));let _t=St.options||s[Q].options;zb(St,_t,mt,x),Lb(St,_t,D.ratio),this.updateElement(s[Q],Q,St,f)}}_getStacks(s,o){let f=this._cachedMeta.iScale,n=f.getMatchingVisibleMetas(this._type),x=f.options.stacked,w=n.length,E=[],A,D;for(A=0;A<w;++A)if(D=n[A],!!D.controller.options.grouped){if(typeof o<"u"){let B=D.controller.getParsed(o)[D.controller._cachedMeta.vScale.axis];if(Xe(B)||isNaN(B))continue}if((x===!1||E.indexOf(D.stack)===-1||x===void 0&&D.stack===void 0)&&E.push(D.stack),D.index===s)break}return E.length||E.push(void 0),E}_getStackCount(s){return this._getStacks(void 0,s).length}_getStackIndex(s,o,u){let f=this._getStacks(s,u),n=o!==void 0?f.indexOf(o):-1;return n===-1?f.length-1:n}_getRuler(){let s=this.options,o=this._cachedMeta,u=o.iScale,f=[],n,x;for(n=0,x=o.data.length;n<x;++n)f.push(u.getPixelForValue(this.getParsed(n)[u.axis],n));let w=s.barThickness;return{min:w||Mb(o),pixels:f,start:u._startPixel,end:u._endPixel,stackCount:this._getStackCount(),scale:u,grouped:s.grouped,ratio:w?1:s.categoryPercentage*s.barPercentage}}_calculateBarValuePixels(s){let{_cachedMeta:{vScale:o,_stacked:u},options:{base:f,minBarLength:n}}=this,x=f||0,w=this.getParsed(s),E=w._custom,A=Cm(E),D=w[o.axis],B=0,G=u?this.applyStack(o,w,u):D,rt,Q;G!==D&&(B=G-D,G=D),A&&(D=E.barStart,G=E.barEnd-E.barStart,D!==0&&sr(D)!==sr(E.barEnd)&&(B=0),B+=D);let dt=!Xe(f)&&!A?f:B,W=o.getPixelForValue(dt);if(this.chart.getDataVisibility(s)?rt=o.getPixelForValue(B+G):rt=W,Q=rt-W,Math.abs(Q)<n){Q=kb(Q,o,x)*n,D===x&&(W-=Q/2);let et=o.getPixelForDecimal(0),mt=o.getPixelForDecimal(1),St=Math.min(et,mt),_t=Math.max(et,mt);W=Math.max(Math.min(W,_t),St),rt=W+Q}if(W===o.getPixelForValue(x)){let et=sr(Q)*o.getLineWidthForValue(x)/2;W+=et,Q-=et}return{size:Q,base:W,head:rt,center:rt+Q/2}}_calculateBarIndexPixels(s,o){let u=o.scale,f=this.options,n=f.skipNull,x=Pe(f.maxBarThickness,1/0),w,E;if(o.grouped){let A=n?this._getStackCount(s):o.stackCount,D=f.barThickness==="flex"?Cb(s,o,f,A):Ab(s,o,f,A),B=this._getStackIndex(this.index,this._cachedMeta.stack,n?s:void 0);w=D.start+D.chunk*B+D.chunk/2,E=Math.min(x,D.chunk*D.ratio)}else w=u.getPixelForValue(this.getParsed(s)[u.axis],s),E=Math.min(x,o.min*o.ratio);return{base:w-E/2,head:w+E/2,center:w,size:E}}draw(){let s=this._cachedMeta,o=s.vScale,u=s.data,f=u.length,n=0;for(;n<f;++n)this.getParsed(n)[o.axis]!==null&&u[n].draw(this._ctx)}};Gl.id="bar";Gl.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};Gl.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};var $l=class extends or{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(s,o,u,f){let n=super.parsePrimitiveData(s,o,u,f);for(let x=0;x<n.length;x++)n[x]._custom=this.resolveDataElementOptions(x+u).radius;return n}parseArrayData(s,o,u,f){let n=super.parseArrayData(s,o,u,f);for(let x=0;x<n.length;x++){let w=o[u+x];n[x]._custom=Pe(w[2],this.resolveDataElementOptions(x+u).radius)}return n}parseObjectData(s,o,u,f){let n=super.parseObjectData(s,o,u,f);for(let x=0;x<n.length;x++){let w=o[u+x];n[x]._custom=Pe(w&&w.r&&+w.r,this.resolveDataElementOptions(x+u).radius)}return n}getMaxOverflow(){let s=this._cachedMeta.data,o=0;for(let u=s.length-1;u>=0;--u)o=Math.max(o,s[u].size(this.resolveDataElementOptions(u))/2);return o>0&&o}getLabelAndValue(s){let o=this._cachedMeta,{xScale:u,yScale:f}=o,n=this.getParsed(s),x=u.getLabelForValue(n.x),w=f.getLabelForValue(n.y),E=n._custom;return{label:o.label,value:"("+x+", "+w+(E?", "+E:"")+")"}}update(s){let o=this._cachedMeta.data;this.updateElements(o,0,o.length,s)}updateElements(s,o,u,f){let n=f==="reset",{iScale:x,vScale:w}=this._cachedMeta,E=this.resolveDataElementOptions(o,f),A=this.getSharedOptions(E),D=this.includeOptions(f,A),B=x.axis,G=w.axis;for(let rt=o;rt<o+u;rt++){let Q=s[rt],dt=!n&&this.getParsed(rt),W={},et=W[B]=n?x.getPixelForDecimal(.5):x.getPixelForValue(dt[B]),mt=W[G]=n?w.getBasePixel():w.getPixelForValue(dt[G]);W.skip=isNaN(et)||isNaN(mt),D&&(W.options=this.resolveDataElementOptions(rt,Q.active?"active":f),n&&(W.options.radius=0)),this.updateElement(Q,rt,W,f)}this.updateSharedOptions(A,f,E)}resolveDataElementOptions(s,o){let u=this.getParsed(s),f=super.resolveDataElementOptions(s,o);f.$shared&&(f=Object.assign({},f,{$shared:!1}));let n=f.radius;return o!=="active"&&(f.radius=0),f.radius+=Pe(u&&u._custom,n),f}};$l.id="bubble";$l.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};$l.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title(){return""}}}}};function Rb(l,s,o){let u=1,f=1,n=0,x=0;if(s<si){let w=l,E=w+s,A=Math.cos(w),D=Math.sin(w),B=Math.cos(E),G=Math.sin(E),rt=(St,_t,Mt)=>ba(St,w,E,!0)?1:Math.max(_t,_t*o,Mt,Mt*o),Q=(St,_t,Mt)=>ba(St,w,E,!0)?-1:Math.min(_t,_t*o,Mt,Mt*o),dt=rt(0,A,B),W=rt(bi,D,G),et=Q(mi,A,B),mt=Q(mi+bi,D,G);u=(dt-et)/2,f=(W-mt)/2,n=-(dt+et)/2,x=-(W+mt)/2}return{ratioX:u,ratioY:f,offsetX:n,offsetY:x}}var So=class extends or{constructor(s,o){super(s,o),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(s,o){let u=this.getDataset().data,f=this._cachedMeta;if(this._parsing===!1)f._parsed=u;else{let n=E=>+u[E];if(Ge(u[s])){let{key:E="value"}=this._parsing;n=A=>+qr(u[A],E)}let x,w;for(x=s,w=s+o;x<w;++x)f._parsed[x]=n(x)}}_getRotation(){return Hn(this.options.rotation-90)}_getCircumference(){return Hn(this.options.circumference)}_getRotationExtents(){let s=si,o=-si;for(let u=0;u<this.chart.data.datasets.length;++u)if(this.chart.isDatasetVisible(u)){let f=this.chart.getDatasetMeta(u).controller,n=f._getRotation(),x=f._getCircumference();s=Math.min(s,n),o=Math.max(o,n+x)}return{rotation:s,circumference:o-s}}update(s){let o=this.chart,{chartArea:u}=o,f=this._cachedMeta,n=f.data,x=this.getMaxBorderWidth()+this.getMaxOffset(n)+this.options.spacing,w=Math.max((Math.min(u.width,u.height)-x)/2,0),E=Math.min(im(this.options.cutout,w),1),A=this._getRingWeight(this.index),{circumference:D,rotation:B}=this._getRotationExtents(),{ratioX:G,ratioY:rt,offsetX:Q,offsetY:dt}=Rb(B,D,E),W=(u.width-x)/G,et=(u.height-x)/rt,mt=Math.max(Math.min(W,et)/2,0),St=zd(this.options.radius,mt),_t=Math.max(St*E,0),Mt=(St-_t)/this._getVisibleDatasetWeightTotal();this.offsetX=Q*St,this.offsetY=dt*St,f.total=this.calculateTotal(),this.outerRadius=St-Mt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Mt*A,0),this.updateElements(n,0,n.length,s)}_circumference(s,o){let u=this.options,f=this._cachedMeta,n=this._getCircumference();return o&&u.animation.animateRotate||!this.chart.getDataVisibility(s)||f._parsed[s]===null||f.data[s].hidden?0:this.calculateCircumference(f._parsed[s]*n/si)}updateElements(s,o,u,f){let n=f==="reset",x=this.chart,w=x.chartArea,A=x.options.animation,D=(w.left+w.right)/2,B=(w.top+w.bottom)/2,G=n&&A.animateScale,rt=G?0:this.innerRadius,Q=G?0:this.outerRadius,dt=this.resolveDataElementOptions(o,f),W=this.getSharedOptions(dt),et=this.includeOptions(f,W),mt=this._getRotation(),St;for(St=0;St<o;++St)mt+=this._circumference(St,n);for(St=o;St<o+u;++St){let _t=this._circumference(St,n),Mt=s[St],Rt={x:D+this.offsetX,y:B+this.offsetY,startAngle:mt,endAngle:mt+_t,circumference:_t,outerRadius:Q,innerRadius:rt};et&&(Rt.options=W||this.resolveDataElementOptions(St,Mt.active?"active":f)),mt+=_t,this.updateElement(Mt,St,Rt,f)}this.updateSharedOptions(W,f,dt)}calculateTotal(){let s=this._cachedMeta,o=s.data,u=0,f;for(f=0;f<o.length;f++){let n=s._parsed[f];n!==null&&!isNaN(n)&&this.chart.getDataVisibility(f)&&!o[f].hidden&&(u+=Math.abs(n))}return u}calculateCircumference(s){let o=this._cachedMeta.total;return o>0&&!isNaN(s)?si*(Math.abs(s)/o):0}getLabelAndValue(s){let o=this._cachedMeta,u=this.chart,f=u.data.labels||[],n=Sa(o._parsed[s],u.options.locale);return{label:f[s]||"",value:n}}getMaxBorderWidth(s){let o=0,u=this.chart,f,n,x,w,E;if(!s){for(f=0,n=u.data.datasets.length;f<n;++f)if(u.isDatasetVisible(f)){x=u.getDatasetMeta(f),s=x.data,w=x.controller;break}}if(!s)return 0;for(f=0,n=s.length;f<n;++f)E=w.resolveDataElementOptions(f),E.borderAlign!=="inner"&&(o=Math.max(o,E.borderWidth||0,E.hoverBorderWidth||0));return o}getMaxOffset(s){let o=0;for(let u=0,f=s.length;u<f;++u){let n=this.resolveDataElementOptions(u);o=Math.max(o,n.offset||0,n.hoverOffset||0)}return o}_getRingWeightOffset(s){let o=0;for(let u=0;u<s;++u)this.chart.isDatasetVisible(u)&&(o+=this._getRingWeight(u));return o}_getRingWeight(s){return Math.max(Pe(this.chart.data.datasets[s].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}};So.id="doughnut";So.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};So.descriptors={_scriptable:l=>l!=="spacing",_indexable:l=>l!=="spacing"};So.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(l){let s=l.data;if(s.labels.length&&s.datasets.length){let{labels:{pointStyle:o}}=l.legend.options;return s.labels.map((u,f)=>{let x=l.getDatasetMeta(0).controller.getStyle(f);return{text:u,fillStyle:x.backgroundColor,strokeStyle:x.borderColor,lineWidth:x.borderWidth,pointStyle:o,hidden:!l.getDataVisibility(f),index:f}})}return[]}},onClick(l,s,o){o.chart.toggleDataVisibility(s.index),o.chart.update()}},tooltip:{callbacks:{title(){return""},label(l){let s=l.label,o=": "+l.formattedValue;return ai(s)?(s=s.slice(),s[0]+=o):s+=o,s}}}}};var Ma=class extends or{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(s){let o=this._cachedMeta,{dataset:u,data:f=[],_dataset:n}=o,x=this.chart._animationsDisabled,{start:w,count:E}=Bb(o,f,x);this._drawStart=w,this._drawCount=E,Fb(o)&&(w=0,E=f.length),u._chart=this.chart,u._datasetIndex=this.index,u._decimated=!!n._decimated,u.points=f;let A=this.resolveDatasetElementOptions(s);this.options.showLine||(A.borderWidth=0),A.segment=this.options.segment,this.updateElement(u,void 0,{animated:!x,options:A},s),this.updateElements(f,w,E,s)}updateElements(s,o,u,f){let n=f==="reset",{iScale:x,vScale:w,_stacked:E,_dataset:A}=this._cachedMeta,D=this.resolveDataElementOptions(o,f),B=this.getSharedOptions(D),G=this.includeOptions(f,B),rt=x.axis,Q=w.axis,{spanGaps:dt,segment:W}=this.options,et=xa(dt)?dt:Number.POSITIVE_INFINITY,mt=this.chart._animationsDisabled||n||f==="none",St=o>0&&this.getParsed(o-1);for(let _t=o;_t<o+u;++_t){let Mt=s[_t],Rt=this.getParsed(_t),Vt=mt?Mt:{},Yt=Xe(Rt[Q]),jt=Vt[rt]=x.getPixelForValue(Rt[rt],_t),ye=Vt[Q]=n||Yt?w.getBasePixel():w.getPixelForValue(E?this.applyStack(w,Rt,E):Rt[Q],_t);Vt.skip=isNaN(jt)||isNaN(ye)||Yt,Vt.stop=_t>0&&Math.abs(Rt[rt]-St[rt])>et,W&&(Vt.parsed=Rt,Vt.raw=A.data[_t]),G&&(Vt.options=B||this.resolveDataElementOptions(_t,Mt.active?"active":f)),mt||this.updateElement(Mt,_t,Vt,f),St=Rt}this.updateSharedOptions(B,f,D)}getMaxOverflow(){let s=this._cachedMeta,o=s.dataset,u=o.options&&o.options.borderWidth||0,f=s.data||[];if(!f.length)return u;let n=f[0].size(this.resolveDataElementOptions(0)),x=f[f.length-1].size(this.resolveDataElementOptions(f.length-1));return Math.max(u,n,x)/2}draw(){let s=this._cachedMeta;s.dataset.updateControlPoints(this.chart.chartArea,s.iScale.axis),super.draw()}};Ma.id="line";Ma.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};Ma.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};function Bb(l,s,o){let u=s.length,f=0,n=u;if(l._sorted){let{iScale:x,_parsed:w}=l,E=x.axis,{min:A,max:D,minDefined:B,maxDefined:G}=x.getUserBounds();B&&(f=Fi(Math.min(vr(w,x.axis,A).lo,o?u:vr(s,E,x.getPixelForValue(A)).lo),0,u-1)),G?n=Fi(Math.max(vr(w,x.axis,D).hi+1,o?0:vr(s,E,x.getPixelForValue(D)).hi+1),f,u)-f:n=u-f}return{start:f,count:n}}function Fb(l){let{xScale:s,yScale:o,_scaleRanges:u}=l,f={xmin:s.min,xmax:s.max,ymin:o.min,ymax:o.max};if(!u)return l._scaleRanges=f,!0;let n=u.xmin!==s.min||u.xmax!==s.max||u.ymin!==o.min||u.ymax!==o.max;return Object.assign(u,f),n}var ql=class extends or{constructor(s,o){super(s,o),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(s){let o=this._cachedMeta,u=this.chart,f=u.data.labels||[],n=Sa(o._parsed[s].r,u.options.locale);return{label:f[s]||"",value:n}}parseObjectData(s,o,u,f){return $d.bind(this)(s,o,u,f)}update(s){let o=this._cachedMeta.data;this._updateRadius(),this.updateElements(o,0,o.length,s)}getMinMax(){let s=this._cachedMeta,o={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return s.data.forEach((u,f)=>{let n=this.getParsed(f).r;!isNaN(n)&&this.chart.getDataVisibility(f)&&(n<o.min&&(o.min=n),n>o.max&&(o.max=n))}),o}_updateRadius(){let s=this.chart,o=s.chartArea,u=s.options,f=Math.min(o.right-o.left,o.bottom-o.top),n=Math.max(f/2,0),x=Math.max(u.cutoutPercentage?n/100*u.cutoutPercentage:1,0),w=(n-x)/s.getVisibleDatasetCount();this.outerRadius=n-w*this.index,this.innerRadius=this.outerRadius-w}updateElements(s,o,u,f){let n=f==="reset",x=this.chart,E=x.options.animation,A=this._cachedMeta.rScale,D=A.xCenter,B=A.yCenter,G=A.getIndexAngle(0)-.5*mi,rt=G,Q,dt=360/this.countVisibleElements();for(Q=0;Q<o;++Q)rt+=this._computeAngle(Q,f,dt);for(Q=o;Q<o+u;Q++){let W=s[Q],et=rt,mt=rt+this._computeAngle(Q,f,dt),St=x.getDataVisibility(Q)?A.getDistanceFromCenterForValue(this.getParsed(Q).r):0;rt=mt,n&&(E.animateScale&&(St=0),E.animateRotate&&(et=mt=G));let _t={x:D,y:B,innerRadius:0,outerRadius:St,startAngle:et,endAngle:mt,options:this.resolveDataElementOptions(Q,W.active?"active":f)};this.updateElement(W,Q,_t,f)}}countVisibleElements(){let s=this._cachedMeta,o=0;return s.data.forEach((u,f)=>{!isNaN(this.getParsed(f).r)&&this.chart.getDataVisibility(f)&&o++}),o}_computeAngle(s,o,u){return this.chart.getDataVisibility(s)?Hn(this.resolveDataElementOptions(s,o).angle||u):0}};ql.id="polarArea";ql.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};ql.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(l){let s=l.data;if(s.labels.length&&s.datasets.length){let{labels:{pointStyle:o}}=l.legend.options;return s.labels.map((u,f)=>{let x=l.getDatasetMeta(0).controller.getStyle(f);return{text:u,fillStyle:x.backgroundColor,strokeStyle:x.borderColor,lineWidth:x.borderWidth,pointStyle:o,hidden:!l.getDataVisibility(f),index:f}})}return[]}},onClick(l,s,o){o.chart.toggleDataVisibility(s.index),o.chart.update()}},tooltip:{callbacks:{title(){return""},label(l){return l.chart.data.labels[l.dataIndex]+": "+l.formattedValue}}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};var Zh=class extends So{};Zh.id="pie";Zh.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};var Wl=class extends or{getLabelAndValue(s){let o=this._cachedMeta.vScale,u=this.getParsed(s);return{label:o.getLabels()[s],value:""+o.getLabelForValue(u[o.axis])}}parseObjectData(s,o,u,f){return $d.bind(this)(s,o,u,f)}update(s){let o=this._cachedMeta,u=o.dataset,f=o.data||[],n=o.iScale.getLabels();if(u.points=f,s!=="resize"){let x=this.resolveDatasetElementOptions(s);this.options.showLine||(x.borderWidth=0);let w={_loop:!0,_fullLoop:n.length===f.length,options:x};this.updateElement(u,void 0,w,s)}this.updateElements(f,0,f.length,s)}updateElements(s,o,u,f){let n=this._cachedMeta.rScale,x=f==="reset";for(let w=o;w<o+u;w++){let E=s[w],A=this.resolveDataElementOptions(w,E.active?"active":f),D=n.getPointPositionForValue(w,this.getParsed(w).r),B=x?n.xCenter:D.x,G=x?n.yCenter:D.y,rt={x:B,y:G,angle:D.angle,skip:isNaN(B)||isNaN(G),options:A};this.updateElement(E,w,rt,f)}}};Wl.id="radar";Wl.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};Wl.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};var Xl=class extends Ma{};Xl.id="scatter";Xl.defaults={showLine:!1,fill:!1};Xl.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title(){return""},label(l){return"("+l.label+", "+l.formattedValue+")"}}}},scales:{x:{type:"linear"},y:{type:"linear"}}};var Ob=Object.freeze({__proto__:null,BarController:Gl,BubbleController:$l,DoughnutController:So,LineController:Ma,PolarAreaController:ql,PieController:Zh,RadarController:Wl,ScatterController:Xl});function Ea(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var Uh=class{constructor(s){this.options=s||{}}formats(){return Ea()}parse(s,o){return Ea()}format(s,o){return Ea()}add(s,o,u){return Ea()}diff(s,o,u){return Ea()}startOf(s,o,u){return Ea()}endOf(s,o){return Ea()}};Uh.override=function(l){Object.assign(Uh.prototype,l)};var Vb={_date:Uh};function Zb(l,s,o,u){let{controller:f,data:n,_sorted:x}=l,w=f._cachedMeta.iScale;if(w&&s===w.axis&&s!=="r"&&x&&n.length){let E=w._reversePixels?mm:vr;if(u){if(f._sharedOptions){let A=n[0],D=typeof A.getRange=="function"&&A.getRange(s);if(D){let B=E(n,s,o-D),G=E(n,s,o+D);return{lo:B.lo,hi:G.hi}}}}else return E(n,s,o)}return{lo:0,hi:n.length-1}}function Xh(l,s,o,u,f){let n=l.getSortedVisibleDatasetMetas(),x=o[s];for(let w=0,E=n.length;w<E;++w){let{index:A,data:D}=n[w],{lo:B,hi:G}=Zb(n[w],s,x,f);for(let rt=B;rt<=G;++rt){let Q=D[rt];Q.skip||u(Q,A,rt)}}}function Ub(l){let s=l.indexOf("x")!==-1,o=l.indexOf("y")!==-1;return function(u,f){let n=s?Math.abs(u.x-f.x):0,x=o?Math.abs(u.y-f.y):0;return Math.sqrt(Math.pow(n,2)+Math.pow(x,2))}}function Im(l,s,o,u,f){let n=[];return!f&&!l.isPointInArea(s)||Xh(l,o,s,function(w,E,A){!f&&!ga(w,l.chartArea,0)||w.inRange(s.x,s.y,u)&&n.push({element:w,datasetIndex:E,index:A})},!0),n}function Nb(l,s,o,u){let f=[];function n(x,w,E){let{startAngle:A,endAngle:D}=x.getProps(["startAngle","endAngle"],u),{angle:B}=Fd(x,{x:s.x,y:s.y});ba(B,A,D)&&f.push({element:x,datasetIndex:w,index:E})}return Xh(l,o,s,n),f}function jb(l,s,o,u,f,n){let x=[],w=Ub(o),E=Number.POSITIVE_INFINITY;function A(D,B,G){let rt=D.inRange(s.x,s.y,f);if(u&&!rt)return;let Q=D.getCenterPoint(f);if(!(!!n||l.isPointInArea(Q))&&!rt)return;let W=w(s,Q);W<E?(x=[{element:D,datasetIndex:B,index:G}],E=W):W===E&&x.push({element:D,datasetIndex:B,index:G})}return Xh(l,o,s,A),x}function km(l,s,o,u,f,n){return!n&&!l.isPointInArea(s)?[]:o==="r"&&!u?Nb(l,s,o,f):jb(l,s,o,u,f,n)}function hy(l,s,o,u,f){let n=[],x=o==="x"?"inXRange":"inYRange",w=!1;return Xh(l,o,s,(E,A,D)=>{E[x](s[o],f)&&(n.push({element:E,datasetIndex:A,index:D}),w=w||E.inRange(s.x,s.y,f))}),u&&!w?[]:n}var Gb={evaluateInteractionItems:Xh,modes:{index(l,s,o,u){let f=Is(s,l),n=o.axis||"x",x=o.includeInvisible||!1,w=o.intersect?Im(l,f,n,u,x):km(l,f,n,!1,u,x),E=[];return w.length?(l.getSortedVisibleDatasetMetas().forEach(A=>{let D=w[0].index,B=A.data[D];B&&!B.skip&&E.push({element:B,datasetIndex:A.index,index:D})}),E):[]},dataset(l,s,o,u){let f=Is(s,l),n=o.axis||"xy",x=o.includeInvisible||!1,w=o.intersect?Im(l,f,n,u,x):km(l,f,n,!1,u,x);if(w.length>0){let E=w[0].datasetIndex,A=l.getDatasetMeta(E).data;w=[];for(let D=0;D<A.length;++D)w.push({element:A[D],datasetIndex:E,index:D})}return w},point(l,s,o,u){let f=Is(s,l),n=o.axis||"xy",x=o.includeInvisible||!1;return Im(l,f,n,u,x)},nearest(l,s,o,u){let f=Is(s,l),n=o.axis||"xy",x=o.includeInvisible||!1;return km(l,f,n,o.intersect,u,x)},x(l,s,o,u){let f=Is(s,l);return hy(l,f,"x",o.intersect,u)},y(l,s,o,u){let f=Is(s,l);return hy(l,f,"y",o.intersect,u)}}},qy=["left","top","right","bottom"];function Lh(l,s){return l.filter(o=>o.pos===s)}function uy(l,s){return l.filter(o=>qy.indexOf(o.pos)===-1&&o.box.axis===s)}function Rh(l,s){return l.sort((o,u)=>{let f=s?u:o,n=s?o:u;return f.weight===n.weight?f.index-n.index:f.weight-n.weight})}function $b(l){let s=[],o,u,f,n,x,w;for(o=0,u=(l||[]).length;o<u;++o)f=l[o],{position:n,options:{stack:x,stackWeight:w=1}}=f,s.push({index:o,box:f,pos:n,horizontal:f.isHorizontal(),weight:f.weight,stack:x&&n+x,stackWeight:w});return s}function qb(l){let s={};for(let o of l){let{stack:u,pos:f,stackWeight:n}=o;if(!u||!qy.includes(f))continue;let x=s[u]||(s[u]={count:0,placed:0,weight:0,size:0});x.count++,x.weight+=n}return s}function Wb(l,s){let o=qb(l),{vBoxMaxWidth:u,hBoxMaxHeight:f}=s,n,x,w;for(n=0,x=l.length;n<x;++n){w=l[n];let{fullSize:E}=w.box,A=o[w.stack],D=A&&w.stackWeight/A.weight;w.horizontal?(w.width=D?D*u:E&&s.availableWidth,w.height=f):(w.width=u,w.height=D?D*f:E&&s.availableHeight)}return o}function Xb(l){let s=$b(l),o=Rh(s.filter(A=>A.box.fullSize),!0),u=Rh(Lh(s,"left"),!0),f=Rh(Lh(s,"right")),n=Rh(Lh(s,"top"),!0),x=Rh(Lh(s,"bottom")),w=uy(s,"x"),E=uy(s,"y");return{fullSize:o,leftAndTop:u.concat(n),rightAndBottom:f.concat(E).concat(x).concat(w),chartArea:Lh(s,"chartArea"),vertical:u.concat(f).concat(E),horizontal:n.concat(x).concat(w)}}function dy(l,s,o,u){return Math.max(l[o],s[o])+Math.max(l[u],s[u])}function Wy(l,s){l.top=Math.max(l.top,s.top),l.left=Math.max(l.left,s.left),l.bottom=Math.max(l.bottom,s.bottom),l.right=Math.max(l.right,s.right)}function Hb(l,s,o,u){let{pos:f,box:n}=o,x=l.maxPadding;if(!Ge(f)){o.size&&(l[f]-=o.size);let B=u[o.stack]||{size:0,count:1};B.size=Math.max(B.size,o.horizontal?n.height:n.width),o.size=B.size/B.count,l[f]+=o.size}n.getPadding&&Wy(x,n.getPadding());let w=Math.max(0,s.outerWidth-dy(x,l,"left","right")),E=Math.max(0,s.outerHeight-dy(x,l,"top","bottom")),A=w!==l.w,D=E!==l.h;return l.w=w,l.h=E,o.horizontal?{same:A,other:D}:{same:D,other:A}}function Yb(l){let s=l.maxPadding;function o(u){let f=Math.max(s[u]-l[u],0);return l[u]+=f,f}l.y+=o("top"),l.x+=o("left"),o("right"),o("bottom")}function Kb(l,s){let o=s.maxPadding;function u(f){let n={left:0,top:0,right:0,bottom:0};return f.forEach(x=>{n[x]=Math.max(s[x],o[x])}),n}return u(l?["left","right"]:["top","bottom"])}function Oh(l,s,o,u){let f=[],n,x,w,E,A,D;for(n=0,x=l.length,A=0;n<x;++n){w=l[n],E=w.box,E.update(w.width||s.w,w.height||s.h,Kb(w.horizontal,s));let{same:B,other:G}=Hb(s,o,w,u);A|=B&&f.length,D=D||G,E.fullSize||f.push(w)}return A&&Oh(f,s,o,u)||D}function tp(l,s,o,u,f){l.top=o,l.left=s,l.right=s+u,l.bottom=o+f,l.width=u,l.height=f}function py(l,s,o,u){let f=o.padding,{x:n,y:x}=s;for(let w of l){let E=w.box,A=u[w.stack]||{count:1,placed:0,weight:1},D=w.stackWeight/A.weight||1;if(w.horizontal){let B=s.w*D,G=A.size||E.height;Ln(A.start)&&(x=A.start),E.fullSize?tp(E,f.left,x,o.outerWidth-f.right-f.left,G):tp(E,s.left+A.placed,x,B,G),A.start=x,A.placed+=B,x=E.bottom}else{let B=s.h*D,G=A.size||E.width;Ln(A.start)&&(n=A.start),E.fullSize?tp(E,n,f.top,G,o.outerHeight-f.bottom-f.top):tp(E,n,s.top+A.placed,G,B),A.start=n,A.placed+=B,n=E.right}}s.x=n,s.y=x}$e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var on={addBox(l,s){l.boxes||(l.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(o){s.draw(o)}}]},l.boxes.push(s)},removeBox(l,s){let o=l.boxes?l.boxes.indexOf(s):-1;o!==-1&&l.boxes.splice(o,1)},configure(l,s,o){s.fullSize=o.fullSize,s.position=o.position,s.weight=o.weight},update(l,s,o,u){if(!l)return;let f=Wi(l.options.layout.padding),n=Math.max(s-f.width,0),x=Math.max(o-f.height,0),w=Xb(l.boxes),E=w.vertical,A=w.horizontal;ei(l.boxes,dt=>{typeof dt.beforeLayout=="function"&&dt.beforeLayout()});let D=E.reduce((dt,W)=>W.box.options&&W.box.options.display===!1?dt:dt+1,0)||1,B=Object.freeze({outerWidth:s,outerHeight:o,padding:f,availableWidth:n,availableHeight:x,vBoxMaxWidth:n/2/D,hBoxMaxHeight:x/2}),G=Object.assign({},f);Wy(G,Wi(u));let rt=Object.assign({maxPadding:G,w:n,h:x,x:f.left,y:f.top},f),Q=Wb(E.concat(A),B);Oh(w.fullSize,rt,B,Q),Oh(E,rt,B,Q),Oh(A,rt,B,Q)&&Oh(E,rt,B,Q),Yb(rt),py(w.leftAndTop,rt,B,Q),rt.x+=rt.w,rt.y+=rt.h,py(w.rightAndBottom,rt,B,Q),l.chartArea={left:rt.left,top:rt.top,right:rt.left+rt.w,bottom:rt.top+rt.h,height:rt.h,width:rt.w},ei(w.chartArea,dt=>{let W=dt.box;Object.assign(W,l.chartArea),W.update(rt.w,rt.h,{left:0,top:0,right:0,bottom:0})})}},lp=class{acquireContext(s,o){}releaseContext(s){return!1}addEventListener(s,o,u){}removeEventListener(s,o,u){}getDevicePixelRatio(){return 1}getMaximumSize(s,o,u,f){return o=Math.max(0,o||s.width),u=u||s.height,{width:o,height:Math.max(0,f?Math.floor(o/f):u)}}isAttached(s){return!0}updateConfig(s){}},Fm=class extends lp{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}},op="$chartjs",Jb={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},fy=l=>l===null||l==="";function Qb(l,s){let o=l.style,u=l.getAttribute("height"),f=l.getAttribute("width");if(l[op]={initial:{height:u,width:f,style:{display:o.display,height:o.height,width:o.width}}},o.display=o.display||"block",o.boxSizing=o.boxSizing||"border-box",fy(f)){let n=Hd(l,"width");n!==void 0&&(l.width=n)}if(fy(u))if(l.style.height==="")l.height=l.width/(s||2);else{let n=Hd(l,"height");n!==void 0&&(l.height=n)}return l}var Xy=wm?{passive:!0}:!1;function tw(l,s,o){l.addEventListener(s,o,Xy)}function ew(l,s,o){l.canvas.removeEventListener(s,o,Xy)}function iw(l,s){let o=Jb[l.type]||l.type,{x:u,y:f}=Is(l,s);return{type:o,chart:s,native:l,x:u!==void 0?u:null,y:f!==void 0?f:null}}function cp(l,s){for(let o of l)if(o===s||o.contains(s))return!0}function nw(l,s,o){let u=l.canvas,f=new MutationObserver(n=>{let x=!1;for(let w of n)x=x||cp(w.addedNodes,u),x=x&&!cp(w.removedNodes,u);x&&o()});return f.observe(document,{childList:!0,subtree:!0}),f}function rw(l,s,o){let u=l.canvas,f=new MutationObserver(n=>{let x=!1;for(let w of n)x=x||cp(w.removedNodes,u),x=x&&!cp(w.addedNodes,u);x&&o()});return f.observe(document,{childList:!0,subtree:!0}),f}var Nh=new Map,my=0;function Hy(){let l=window.devicePixelRatio;l!==my&&(my=l,Nh.forEach((s,o)=>{o.currentDevicePixelRatio!==l&&s()}))}function sw(l,s){Nh.size||window.addEventListener("resize",Hy),Nh.set(l,s)}function ow(l){Nh.delete(l),Nh.size||window.removeEventListener("resize",Hy)}function aw(l,s,o){let u=l.canvas,f=u&&zh(u);if(!f)return;let n=Pd((w,E)=>{let A=f.clientWidth;o(w,E),A<f.clientWidth&&o()},window),x=new ResizeObserver(w=>{let E=w[0],A=E.contentRect.width,D=E.contentRect.height;A===0&&D===0||n(A,D)});return x.observe(f),sw(l,n),x}function Pm(l,s,o){o&&o.disconnect(),s==="resize"&&ow(l)}function lw(l,s,o){let u=l.canvas,f=Pd(n=>{l.ctx!==null&&o(iw(n,l))},l,n=>{let x=n[0];return[x,x.offsetX,x.offsetY]});return tw(u,s,f),f}var Om=class extends lp{acquireContext(s,o){let u=s&&s.getContext&&s.getContext("2d");return u&&u.canvas===s?(Qb(s,o),u):null}releaseContext(s){let o=s.canvas;if(!o[op])return!1;let u=o[op].initial;["height","width"].forEach(n=>{let x=u[n];Xe(x)?o.removeAttribute(n):o.setAttribute(n,x)});let f=u.style||{};return Object.keys(f).forEach(n=>{o.style[n]=f[n]}),o.width=o.width,delete o[op],!0}addEventListener(s,o,u){this.removeEventListener(s,o);let f=s.$proxies||(s.$proxies={}),x={attach:nw,detach:rw,resize:aw}[o]||lw;f[o]=x(s,o,u)}removeEventListener(s,o){let u=s.$proxies||(s.$proxies={}),f=u[o];if(!f)return;({attach:Pm,detach:Pm,resize:Pm}[o]||ew)(s,o,f),u[o]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,o,u,f){return bm(s,o,u,f)}isAttached(s){let o=zh(s);return!!(o&&o.isConnected)}};function cw(l){return!qd()||typeof OffscreenCanvas<"u"&&l instanceof OffscreenCanvas?Fm:Om}var Yn=class{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(s){let{x:o,y:u}=this.getProps(["x","y"],s);return{x:o,y:u}}hasValue(){return xa(this.x)&&xa(this.y)}getProps(s,o){let u=this.$animations;if(!o||!u)return this;let f={};return s.forEach(n=>{f[n]=u[n]&&u[n].active()?u[n]._to:this[n]}),f}};Yn.defaults={};Yn.defaultRoutes=void 0;var Yy={values(l){return ai(l)?l:""+l},numeric(l,s,o){if(l===0)return"0";let u=this.chart.options.locale,f,n=l;if(o.length>1){let A=Math.max(Math.abs(o[0].value),Math.abs(o[o.length-1].value));(A<1e-4||A>1e15)&&(f="scientific"),n=hw(l,o)}let x=Bn(Math.abs(n)),w=Math.max(Math.min(-1*Math.floor(x),20),0),E={notation:f,minimumFractionDigits:w,maximumFractionDigits:w};return Object.assign(E,this.options.ticks.format),Sa(l,u,E)},logarithmic(l,s,o){if(l===0)return"0";let u=l/Math.pow(10,Math.floor(Bn(l)));return u===1||u===2||u===5?Yy.numeric.call(this,l,s,o):""}};function hw(l,s){let o=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(o)>=1&&l!==Math.floor(l)&&(o=l-Math.floor(l)),o}var pp={formatters:Yy};$e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(l,s)=>s.lineWidth,tickColor:(l,s)=>s.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:pp.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}});$e.route("scale.ticks","color","","color");$e.route("scale.grid","color","","borderColor");$e.route("scale.grid","borderColor","","borderColor");$e.route("scale.title","color","","color");$e.describe("scale",{_fallback:!1,_scriptable:l=>!l.startsWith("before")&&!l.startsWith("after")&&l!=="callback"&&l!=="parser",_indexable:l=>l!=="borderDash"&&l!=="tickBorderDash"});$e.describe("scales",{_fallback:"scale"});$e.describe("scale.ticks",{_scriptable:l=>l!=="backdropPadding"&&l!=="callback",_indexable:l=>l!=="backdropPadding"});function uw(l,s){let o=l.options.ticks,u=o.maxTicksLimit||dw(l),f=o.major.enabled?fw(s):[],n=f.length,x=f[0],w=f[n-1],E=[];if(n>u)return mw(s,E,f,n/u),E;let A=pw(f,s,u);if(n>0){let D,B,G=n>1?Math.round((w-x)/(n-1)):null;for(ep(s,E,A,Xe(G)?0:x-G,x),D=0,B=n-1;D<B;D++)ep(s,E,A,f[D],f[D+1]);return ep(s,E,A,w,Xe(G)?s.length:w+G),E}return ep(s,E,A),E}function dw(l){let s=l.options.offset,o=l._tickSize(),u=l._length/o+(s?0:1),f=l._maxLength/o;return Math.floor(Math.min(u,f))}function pw(l,s,o){let u=_w(l),f=s.length/o;if(!u)return Math.max(f,1);let n=rm(u);for(let x=0,w=n.length-1;x<w;x++){let E=n[x];if(E>f)return E}return Math.max(f,1)}function fw(l){let s=[],o,u;for(o=0,u=l.length;o<u;o++)l[o].major&&s.push(o);return s}function mw(l,s,o,u){let f=0,n=o[0],x;for(u=Math.ceil(u),x=0;x<l.length;x++)x===n&&(s.push(l[x]),f++,n=o[f*u])}function ep(l,s,o,u,f){let n=Pe(u,0),x=Math.min(Pe(f,l.length),l.length),w=0,E,A,D;for(o=Math.ceil(o),f&&(E=f-u,o=E/Math.floor(E/o)),D=n;D<0;)w++,D=Math.round(n+w*o);for(A=Math.max(n,0);A<x;A++)A===D&&(s.push(l[A]),w++,D=Math.round(n+w*o))}function _w(l){let s=l.length,o,u;if(s<2)return!1;for(u=l[0],o=1;o<s;++o)if(l[o]-l[o-1]!==u)return!1;return u}var gw=l=>l==="left"?"right":l==="right"?"left":l,_y=(l,s,o)=>s==="top"||s==="left"?l[s]+o:l[s]-o;function gy(l,s){let o=[],u=l.length/s,f=l.length,n=0;for(;n<f;n+=u)o.push(l[Math.floor(n)]);return o}function yw(l,s,o){let u=l.ticks.length,f=Math.min(s,u-1),n=l._startPixel,x=l._endPixel,w=1e-6,E=l.getPixelForTick(f),A;if(!(o&&(u===1?A=Math.max(E-n,x-E):s===0?A=(l.getPixelForTick(1)-E)/2:A=(E-l.getPixelForTick(f-1))/2,E+=f<s?A:-A,E<n-w||E>x+w)))return E}function xw(l,s){ei(l,o=>{let u=o.gc,f=u.length/2,n;if(f>s){for(n=0;n<f;++n)delete o.data[u[n]];u.splice(0,f)}})}function Bh(l){return l.drawTicks?l.tickLength:0}function yy(l,s){if(!l.display)return 0;let o=zi(l.font,s),u=Wi(l.padding);return(ai(l.text)?l.text.length:1)*o.lineHeight+u.height}function vw(l,s){return Wr(l,{scale:s,type:"scale"})}function bw(l,s,o){return Wr(l,{tick:o,index:s,type:"tick"})}function ww(l,s,o){let u=Eh(l);return(o&&s!=="right"||!o&&s==="right")&&(u=gw(u)),u}function Tw(l,s,o,u){let{top:f,left:n,bottom:x,right:w,chart:E}=l,{chartArea:A,scales:D}=E,B=0,G,rt,Q,dt=x-f,W=w-n;if(l.isHorizontal()){if(rt=qi(u,n,w),Ge(o)){let et=Object.keys(o)[0],mt=o[et];Q=D[et].getPixelForValue(mt)+dt-s}else o==="center"?Q=(A.bottom+A.top)/2+dt-s:Q=_y(l,o,s);G=w-n}else{if(Ge(o)){let et=Object.keys(o)[0],mt=o[et];rt=D[et].getPixelForValue(mt)-W+s}else o==="center"?rt=(A.left+A.right)/2-W+s:rt=_y(l,o,s);Q=qi(u,x,f),B=o==="left"?-bi:bi}return{titleX:rt,titleY:Q,maxWidth:G,rotation:B}}var Ds=class extends Yn{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,o){return s}getUserBounds(){let{_userMin:s,_userMax:o,_suggestedMin:u,_suggestedMax:f}=this;return s=Rn(s,Number.POSITIVE_INFINITY),o=Rn(o,Number.NEGATIVE_INFINITY),u=Rn(u,Number.POSITIVE_INFINITY),f=Rn(f,Number.NEGATIVE_INFINITY),{min:Rn(s,u),max:Rn(o,f),minDefined:Mi(s),maxDefined:Mi(o)}}getMinMax(s){let{min:o,max:u,minDefined:f,maxDefined:n}=this.getUserBounds(),x;if(f&&n)return{min:o,max:u};let w=this.getMatchingVisibleMetas();for(let E=0,A=w.length;E<A;++E)x=w[E].controller.getMinMax(this,s),f||(o=Math.min(o,x.min)),n||(u=Math.max(u,x.max));return o=n&&o>u?u:o,u=f&&o>u?o:u,{min:Rn(o,Rn(u,o)),max:Rn(u,Rn(o,u))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){li(this.options.beforeUpdate,[this])}update(s,o,u){let{beginAtZero:f,grace:n,ticks:x}=this.options,w=x.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=o,this._margins=u=Object.assign({left:0,right:0,top:0,bottom:0},u),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+u.left+u.right:this.height+u.top+u.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=fm(this,n,f),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let E=w<this.ticks.length;this._convertTicksToLabels(E?gy(this.ticks,w):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),x.display&&(x.autoSkip||x.source==="auto")&&(this.ticks=uw(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),E&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let s=this.options.reverse,o,u;this.isHorizontal()?(o=this.left,u=this.right):(o=this.top,u=this.bottom,s=!s),this._startPixel=o,this._endPixel=u,this._reversePixels=s,this._length=u-o,this._alignToPixels=this.options.alignToPixels}afterUpdate(){li(this.options.afterUpdate,[this])}beforeSetDimensions(){li(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){li(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),li(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){li(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){let o=this.options.ticks,u,f,n;for(u=0,f=s.length;u<f;u++)n=s[u],n.label=li(o.callback,[n.value,u,s],this)}afterTickToLabelConversion(){li(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){li(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let s=this.options,o=s.ticks,u=this.ticks.length,f=o.minRotation||0,n=o.maxRotation,x=f,w,E,A;if(!this._isVisible()||!o.display||f>=n||u<=1||!this.isHorizontal()){this.labelRotation=f;return}let D=this._getLabelSizes(),B=D.widest.width,G=D.highest.height,rt=Fi(this.chart.width-B,0,this.maxWidth);w=s.offset?this.maxWidth/u:rt/(u-1),B+6>w&&(w=rt/(u-(s.offset?.5:1)),E=this.maxHeight-Bh(s.grid)-o.padding-yy(s.title,this.chart.options.font),A=Math.sqrt(B*B+G*G),x=Ah(Math.min(Math.asin(Fi((D.highest.height+6)/w,-1,1)),Math.asin(Fi(E/A,-1,1))-Math.asin(Fi(G/A,-1,1)))),x=Math.max(f,Math.min(n,x))),this.labelRotation=x}afterCalculateLabelRotation(){li(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){li(this.options.beforeFit,[this])}fit(){let s={width:0,height:0},{chart:o,options:{ticks:u,title:f,grid:n}}=this,x=this._isVisible(),w=this.isHorizontal();if(x){let E=yy(f,o.options.font);if(w?(s.width=this.maxWidth,s.height=Bh(n)+E):(s.height=this.maxHeight,s.width=Bh(n)+E),u.display&&this.ticks.length){let{first:A,last:D,widest:B,highest:G}=this._getLabelSizes(),rt=u.padding*2,Q=Hn(this.labelRotation),dt=Math.cos(Q),W=Math.sin(Q);if(w){let et=u.mirror?0:W*B.width+dt*G.height;s.height=Math.min(this.maxHeight,s.height+et+rt)}else{let et=u.mirror?0:dt*B.width+W*G.height;s.width=Math.min(this.maxWidth,s.width+et+rt)}this._calculatePadding(A,D,W,dt)}}this._handleMargins(),w?(this.width=this._length=o.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=o.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,o,u,f){let{ticks:{align:n,padding:x},position:w}=this.options,E=this.labelRotation!==0,A=w!=="top"&&this.axis==="x";if(this.isHorizontal()){let D=this.getPixelForTick(0)-this.left,B=this.right-this.getPixelForTick(this.ticks.length-1),G=0,rt=0;E?A?(G=f*s.width,rt=u*o.height):(G=u*s.height,rt=f*o.width):n==="start"?rt=o.width:n==="end"?G=s.width:n!=="inner"&&(G=s.width/2,rt=o.width/2),this.paddingLeft=Math.max((G-D+x)*this.width/(this.width-D),0),this.paddingRight=Math.max((rt-B+x)*this.width/(this.width-B),0)}else{let D=o.height/2,B=s.height/2;n==="start"?(D=0,B=s.height):n==="end"&&(D=o.height,B=0),this.paddingTop=D+x,this.paddingBottom=B+x}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){li(this.options.afterFit,[this])}isHorizontal(){let{axis:s,position:o}=this.options;return o==="top"||o==="bottom"||s==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){this.beforeTickToLabelConversion(),this.generateTickLabels(s);let o,u;for(o=0,u=s.length;o<u;o++)Xe(s[o].label)&&(s.splice(o,1),u--,o--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){let o=this.options.ticks.sampleSize,u=this.ticks;o<u.length&&(u=gy(u,o)),this._labelSizes=s=this._computeLabelSizes(u,u.length)}return s}_computeLabelSizes(s,o){let{ctx:u,_longestTextCache:f}=this,n=[],x=[],w=0,E=0,A,D,B,G,rt,Q,dt,W,et,mt,St;for(A=0;A<o;++A){if(G=s[A].label,rt=this._resolveTickFontOptions(A),u.font=Q=rt.string,dt=f[Q]=f[Q]||{data:{},gc:[]},W=rt.lineHeight,et=mt=0,!Xe(G)&&!ai(G))et=Bl(u,dt.data,dt.gc,et,G),mt=W;else if(ai(G))for(D=0,B=G.length;D<B;++D)St=G[D],!Xe(St)&&!ai(St)&&(et=Bl(u,dt.data,dt.gc,et,St),mt+=W);n.push(et),x.push(mt),w=Math.max(et,w),E=Math.max(mt,E)}xw(f,o);let _t=n.indexOf(w),Mt=x.indexOf(E),Rt=Vt=>({width:n[Vt]||0,height:x[Vt]||0});return{first:Rt(0),last:Rt(o-1),widest:Rt(_t),highest:Rt(Mt),widths:n,heights:x}}getLabelForValue(s){return s}getPixelForValue(s,o){return NaN}getValueForPixel(s){}getPixelForTick(s){let o=this.ticks;return s<0||s>o.length-1?null:this.getPixelForValue(o[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);let o=this._startPixel+s*this._length;return om(this._alignToPixels?Ms(this.chart,o,0):o)}getDecimalForPixel(s){let o=(s-this._startPixel)/this._length;return this._reversePixels?1-o:o}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:s,max:o}=this;return s<0&&o<0?o:s>0&&o>0?s:0}getContext(s){let o=this.ticks||[];if(s>=0&&s<o.length){let u=o[s];return u.$context||(u.$context=bw(this.getContext(),s,u))}return this.$context||(this.$context=vw(this.chart.getContext(),this))}_tickSize(){let s=this.options.ticks,o=Hn(this.labelRotation),u=Math.abs(Math.cos(o)),f=Math.abs(Math.sin(o)),n=this._getLabelSizes(),x=s.autoSkipPadding||0,w=n?n.widest.width+x:0,E=n?n.highest.height+x:0;return this.isHorizontal()?E*u>w*f?w/u:E/f:E*f<w*u?E/u:w/f}_isVisible(){let s=this.options.display;return s!=="auto"?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){let o=this.axis,u=this.chart,f=this.options,{grid:n,position:x}=f,w=n.offset,E=this.isHorizontal(),D=this.ticks.length+(w?1:0),B=Bh(n),G=[],rt=n.setContext(this.getContext()),Q=rt.drawBorder?rt.borderWidth:0,dt=Q/2,W=function(be){return Ms(u,be,Q)},et,mt,St,_t,Mt,Rt,Vt,Yt,jt,ye,le,me;if(x==="top")et=W(this.bottom),Rt=this.bottom-B,Yt=et-dt,ye=W(s.top)+dt,me=s.bottom;else if(x==="bottom")et=W(this.top),ye=s.top,me=W(s.bottom)-dt,Rt=et+dt,Yt=this.top+B;else if(x==="left")et=W(this.right),Mt=this.right-B,Vt=et-dt,jt=W(s.left)+dt,le=s.right;else if(x==="right")et=W(this.left),jt=s.left,le=W(s.right)-dt,Mt=et+dt,Vt=this.left+B;else if(o==="x"){if(x==="center")et=W((s.top+s.bottom)/2+.5);else if(Ge(x)){let be=Object.keys(x)[0],Me=x[be];et=W(this.chart.scales[be].getPixelForValue(Me))}ye=s.top,me=s.bottom,Rt=et+dt,Yt=Rt+B}else if(o==="y"){if(x==="center")et=W((s.left+s.right)/2);else if(Ge(x)){let be=Object.keys(x)[0],Me=x[be];et=W(this.chart.scales[be].getPixelForValue(Me))}Mt=et-dt,Vt=Mt-B,jt=s.left,le=s.right}let He=Pe(f.ticks.maxTicksLimit,D),Ye=Math.max(1,Math.ceil(D/He));for(mt=0;mt<D;mt+=Ye){let be=n.setContext(this.getContext(mt)),Me=be.lineWidth,Ui=be.color,Di=n.borderDash||[],di=be.borderDashOffset,_i=be.tickWidth,qe=be.tickColor,gi=be.tickBorderDash||[],Ki=be.tickBorderDashOffset;St=yw(this,mt,w),St!==void 0&&(_t=Ms(u,St,Me),E?Mt=Vt=jt=le=_t:Rt=Yt=ye=me=_t,G.push({tx1:Mt,ty1:Rt,tx2:Vt,ty2:Yt,x1:jt,y1:ye,x2:le,y2:me,width:Me,color:Ui,borderDash:Di,borderDashOffset:di,tickWidth:_i,tickColor:qe,tickBorderDash:gi,tickBorderDashOffset:Ki}))}return this._ticksLength=D,this._borderValue=et,G}_computeLabelItems(s){let o=this.axis,u=this.options,{position:f,ticks:n}=u,x=this.isHorizontal(),w=this.ticks,{align:E,crossAlign:A,padding:D,mirror:B}=n,G=Bh(u.grid),rt=G+D,Q=B?-D:rt,dt=-Hn(this.labelRotation),W=[],et,mt,St,_t,Mt,Rt,Vt,Yt,jt,ye,le,me,He="middle";if(f==="top")Rt=this.bottom-Q,Vt=this._getXAxisLabelAlignment();else if(f==="bottom")Rt=this.top+Q,Vt=this._getXAxisLabelAlignment();else if(f==="left"){let be=this._getYAxisLabelAlignment(G);Vt=be.textAlign,Mt=be.x}else if(f==="right"){let be=this._getYAxisLabelAlignment(G);Vt=be.textAlign,Mt=be.x}else if(o==="x"){if(f==="center")Rt=(s.top+s.bottom)/2+rt;else if(Ge(f)){let be=Object.keys(f)[0],Me=f[be];Rt=this.chart.scales[be].getPixelForValue(Me)+rt}Vt=this._getXAxisLabelAlignment()}else if(o==="y"){if(f==="center")Mt=(s.left+s.right)/2-rt;else if(Ge(f)){let be=Object.keys(f)[0],Me=f[be];Mt=this.chart.scales[be].getPixelForValue(Me)}Vt=this._getYAxisLabelAlignment(G).textAlign}o==="y"&&(E==="start"?He="top":E==="end"&&(He="bottom"));let Ye=this._getLabelSizes();for(et=0,mt=w.length;et<mt;++et){St=w[et],_t=St.label;let be=n.setContext(this.getContext(et));Yt=this.getPixelForTick(et)+n.labelOffset,jt=this._resolveTickFontOptions(et),ye=jt.lineHeight,le=ai(_t)?_t.length:1;let Me=le/2,Ui=be.color,Di=be.textStrokeColor,di=be.textStrokeWidth,_i=Vt;x?(Mt=Yt,Vt==="inner"&&(et===mt-1?_i=this.options.reverse?"left":"right":et===0?_i=this.options.reverse?"right":"left":_i="center"),f==="top"?A==="near"||dt!==0?me=-le*ye+ye/2:A==="center"?me=-Ye.highest.height/2-Me*ye+ye:me=-Ye.highest.height+ye/2:A==="near"||dt!==0?me=ye/2:A==="center"?me=Ye.highest.height/2-Me*ye:me=Ye.highest.height-le*ye,B&&(me*=-1)):(Rt=Yt,me=(1-le)*ye/2);let qe;if(be.showLabelBackdrop){let gi=Wi(be.backdropPadding),Ki=Ye.heights[et],Xi=Ye.widths[et],Kn=Rt+me-gi.top,vn=Mt-gi.left;switch(He){case"middle":Kn-=Ki/2;break;case"bottom":Kn-=Ki;break}switch(Vt){case"center":vn-=Xi/2;break;case"right":vn-=Xi;break}qe={left:vn,top:Kn,width:Xi+gi.width,height:Ki+gi.height,color:be.backdropColor}}W.push({rotation:dt,label:_t,font:jt,color:Ui,strokeColor:Di,strokeWidth:di,textOffset:me,textAlign:_i,textBaseline:He,translation:[Mt,Rt],backdrop:qe})}return W}_getXAxisLabelAlignment(){let{position:s,ticks:o}=this.options;if(-Hn(this.labelRotation))return s==="top"?"left":"right";let f="center";return o.align==="start"?f="left":o.align==="end"?f="right":o.align==="inner"&&(f="inner"),f}_getYAxisLabelAlignment(s){let{position:o,ticks:{crossAlign:u,mirror:f,padding:n}}=this.options,x=this._getLabelSizes(),w=s+n,E=x.widest.width,A,D;return o==="left"?f?(D=this.right+n,u==="near"?A="left":u==="center"?(A="center",D+=E/2):(A="right",D+=E)):(D=this.right-w,u==="near"?A="right":u==="center"?(A="center",D-=E/2):(A="left",D=this.left)):o==="right"?f?(D=this.left+n,u==="near"?A="right":u==="center"?(A="center",D-=E/2):(A="left",D-=E)):(D=this.left+w,u==="near"?A="left":u==="center"?(A="center",D+=E/2):(A="right",D=this.right)):A="right",{textAlign:A,x:D}}_computeLabelArea(){if(this.options.ticks.mirror)return;let s=this.chart,o=this.options.position;if(o==="left"||o==="right")return{top:0,left:this.left,bottom:s.height,right:this.right};if(o==="top"||o==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:s.width}}drawBackground(){let{ctx:s,options:{backgroundColor:o},left:u,top:f,width:n,height:x}=this;o&&(s.save(),s.fillStyle=o,s.fillRect(u,f,n,x),s.restore())}getLineWidthForValue(s){let o=this.options.grid;if(!this._isVisible()||!o.display)return 0;let f=this.ticks.findIndex(n=>n.value===s);return f>=0?o.setContext(this.getContext(f)).lineWidth:0}drawGrid(s){let o=this.options.grid,u=this.ctx,f=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s)),n,x,w=(E,A,D)=>{!D.width||!D.color||(u.save(),u.lineWidth=D.width,u.strokeStyle=D.color,u.setLineDash(D.borderDash||[]),u.lineDashOffset=D.borderDashOffset,u.beginPath(),u.moveTo(E.x,E.y),u.lineTo(A.x,A.y),u.stroke(),u.restore())};if(o.display)for(n=0,x=f.length;n<x;++n){let E=f[n];o.drawOnChartArea&&w({x:E.x1,y:E.y1},{x:E.x2,y:E.y2},E),o.drawTicks&&w({x:E.tx1,y:E.ty1},{x:E.tx2,y:E.ty2},{color:E.tickColor,width:E.tickWidth,borderDash:E.tickBorderDash,borderDashOffset:E.tickBorderDashOffset})}}drawBorder(){let{chart:s,ctx:o,options:{grid:u}}=this,f=u.setContext(this.getContext()),n=u.drawBorder?f.borderWidth:0;if(!n)return;let x=u.setContext(this.getContext(0)).lineWidth,w=this._borderValue,E,A,D,B;this.isHorizontal()?(E=Ms(s,this.left,n)-n/2,A=Ms(s,this.right,x)+x/2,D=B=w):(D=Ms(s,this.top,n)-n/2,B=Ms(s,this.bottom,x)+x/2,E=A=w),o.save(),o.lineWidth=f.borderWidth,o.strokeStyle=f.borderColor,o.beginPath(),o.moveTo(E,D),o.lineTo(A,B),o.stroke(),o.restore()}drawLabels(s){if(!this.options.ticks.display)return;let u=this.ctx,f=this._computeLabelArea();f&&Zl(u,f);let n=this._labelItems||(this._labelItems=this._computeLabelItems(s)),x,w;for(x=0,w=n.length;x<w;++x){let E=n[x],A=E.font,D=E.label;E.backdrop&&(u.fillStyle=E.backdrop.color,u.fillRect(E.backdrop.left,E.backdrop.top,E.backdrop.width,E.backdrop.height));let B=E.textOffset;As(u,D,0,B,A,E)}f&&Ul(u)}drawTitle(){let{ctx:s,options:{position:o,title:u,reverse:f}}=this;if(!u.display)return;let n=zi(u.font),x=Wi(u.padding),w=u.align,E=n.lineHeight/2;o==="bottom"||o==="center"||Ge(o)?(E+=x.bottom,ai(u.text)&&(E+=n.lineHeight*(u.text.length-1))):E+=x.top;let{titleX:A,titleY:D,maxWidth:B,rotation:G}=Tw(this,E,o,w);As(s,u.text,0,0,n,{color:u.color,maxWidth:B,rotation:G,textAlign:ww(w,o,f),textBaseline:"middle",translation:[A,D]})}draw(s){!this._isVisible()||(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){let s=this.options,o=s.ticks&&s.ticks.z||0,u=Pe(s.grid&&s.grid.z,-1);return!this._isVisible()||this.draw!==Ds.prototype.draw?[{z:o,draw:f=>{this.draw(f)}}]:[{z:u,draw:f=>{this.drawBackground(),this.drawGrid(f),this.drawTitle()}},{z:u+1,draw:()=>{this.drawBorder()}},{z:o,draw:f=>{this.drawLabels(f)}}]}getMatchingVisibleMetas(s){let o=this.chart.getSortedVisibleDatasetMetas(),u=this.axis+"AxisID",f=[],n,x;for(n=0,x=o.length;n<x;++n){let w=o[n];w[u]===this.id&&(!s||w.type===s)&&f.push(w)}return f}_resolveTickFontOptions(s){let o=this.options.ticks.setContext(this.getContext(s));return zi(o.font)}_maxDigits(){let s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}},jl=class{constructor(s,o,u){this.type=s,this.scope=o,this.override=u,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){let o=Object.getPrototypeOf(s),u;Mw(o)&&(u=this.register(o));let f=this.items,n=s.id,x=this.scope+"."+n;if(!n)throw new Error("class does not have id: "+s);return n in f||(f[n]=s,Sw(s,x,u),this.override&&$e.override(s.id,s.overrides)),x}get(s){return this.items[s]}unregister(s){let o=this.items,u=s.id,f=this.scope;u in o&&delete o[u],f&&u in $e[f]&&(delete $e[f][u],this.override&&delete vo[u])}};function Sw(l,s,o){let u=_a(Object.create(null),[o?$e.get(o):{},$e.get(s),l.defaults]);$e.set(s,u),l.defaultRoutes&&Ew(s,l.defaultRoutes),l.descriptors&&$e.describe(s,l.descriptors)}function Ew(l,s){Object.keys(s).forEach(o=>{let u=o.split("."),f=u.pop(),n=[l].concat(u).join("."),x=s[o].split("."),w=x.pop(),E=x.join(".");$e.route(n,f,E,w)})}function Mw(l){return"id"in l&&"defaults"in l}var Vm=class{constructor(){this.controllers=new jl(or,"datasets",!0),this.elements=new jl(Yn,"elements"),this.plugins=new jl(Object,"plugins"),this.scales=new jl(Ds,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,o,u){[...o].forEach(f=>{let n=u||this._getRegistryForType(f);u||n.isForType(f)||n===this.plugins&&f.id?this._exec(s,n,f):ei(f,x=>{let w=u||this._getRegistryForType(x);this._exec(s,w,x)})})}_exec(s,o,u){let f=Mh(s);li(u["before"+f],[],u),o[s](u),li(u["after"+f],[],u)}_getRegistryForType(s){for(let o=0;o<this._typedRegistries.length;o++){let u=this._typedRegistries[o];if(u.isForType(s))return u}return this.plugins}_get(s,o,u){let f=o.get(s);if(f===void 0)throw new Error('"'+s+'" is not a registered '+u+".");return f}},zs=new Vm,Zm=class{constructor(){this._init=[]}notify(s,o,u,f){o==="beforeInit"&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install"));let n=f?this._descriptors(s).filter(f):this._descriptors(s),x=this._notify(n,s,o,u);return o==="afterDestroy"&&(this._notify(n,s,"stop"),this._notify(this._init,s,"uninstall")),x}_notify(s,o,u,f){f=f||{};for(let n of s){let x=n.plugin,w=x[u],E=[o,f,n.options];if(li(w,E,x)===!1&&f.cancelable)return!1}return!0}invalidate(){Xe(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;let o=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),o}_createDescriptors(s,o){let u=s&&s.config,f=Pe(u.options&&u.options.plugins,{}),n=Aw(u);return f===!1&&!o?[]:Iw(s,n,f,o)}_notifyStateChanges(s){let o=this._oldCache||[],u=this._cache,f=(n,x)=>n.filter(w=>!x.some(E=>w.plugin.id===E.plugin.id));this._notify(f(o,u),s,"stop"),this._notify(f(u,o),s,"start")}};function Aw(l){let s=[],o=Object.keys(zs.plugins.items);for(let f=0;f<o.length;f++)s.push(zs.getPlugin(o[f]));let u=l.plugins||[];for(let f=0;f<u.length;f++){let n=u[f];s.indexOf(n)===-1&&s.push(n)}return s}function Cw(l,s){return!s&&l===!1?null:l===!0?{}:l}function Iw(l,s,o,u){let f=[],n=l.getContext();for(let x=0;x<s.length;x++){let w=s[x],E=w.id,A=Cw(o[E],u);A!==null&&f.push({plugin:w,options:kw(l.config,w,A,n)})}return f}function kw(l,s,o,u){let f=l.pluginScopeKeys(s),n=l.getOptionScopes(o,f);return l.createResolver(n,u,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Um(l,s){let o=$e.datasets[l]||{};return((s.datasets||{})[l]||{}).indexAxis||s.indexAxis||o.indexAxis||"x"}function Pw(l,s){let o=l;return l==="_index_"?o=s:l==="_value_"&&(o=s==="x"?"y":"x"),o}function zw(l,s){return l===s?"_index_":"_value_"}function Dw(l){if(l==="top"||l==="bottom")return"x";if(l==="left"||l==="right")return"y"}function Nm(l,s){return l==="x"||l==="y"?l:s.axis||Dw(s.position)||l.charAt(0).toLowerCase()}function Lw(l,s){let o=vo[l.type]||{scales:{}},u=s.scales||{},f=Um(l.type,s),n=Object.create(null),x=Object.create(null);return Object.keys(u).forEach(w=>{let E=u[w];if(!Ge(E))return console.error(`Invalid scale configuration for scale: ${w}`);if(E._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${w}`);let A=Nm(w,E),D=zw(A,f),B=o.scales||{};n[A]=n[A]||w,x[w]=ya(Object.create(null),[{axis:A},E,B[A],B[D]])}),l.data.datasets.forEach(w=>{let E=w.type||l.type,A=w.indexAxis||Um(E,s),B=(vo[E]||{}).scales||{};Object.keys(B).forEach(G=>{let rt=Pw(G,A),Q=w[rt+"AxisID"]||n[rt]||rt;x[Q]=x[Q]||Object.create(null),ya(x[Q],[{axis:rt},u[Q],B[G]])})}),Object.keys(x).forEach(w=>{let E=x[w];ya(E,[$e.scales[E.type],$e.scale])}),x}function Ky(l){let s=l.options||(l.options={});s.plugins=Pe(s.plugins,{}),s.scales=Lw(l,s)}function Jy(l){return l=l||{},l.datasets=l.datasets||[],l.labels=l.labels||[],l}function Rw(l){return l=l||{},l.data=Jy(l.data),Ky(l),l}var xy=new Map,Qy=new Set;function ip(l,s){let o=xy.get(l);return o||(o=s(),xy.set(l,o),Qy.add(o)),o}var Fh=(l,s,o)=>{let u=qr(s,o);u!==void 0&&l.add(u)},jm=class{constructor(s){this._config=Rw(s),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=Jy(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){let s=this._config;this.clearCache(),Ky(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return ip(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,o){return ip(`${s}.transition.${o}`,()=>[[`datasets.${s}.transitions.${o}`,`transitions.${o}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,o){return ip(`${s}-${o}`,()=>[[`datasets.${s}.elements.${o}`,`datasets.${s}`,`elements.${o}`,""]])}pluginScopeKeys(s){let o=s.id,u=this.type;return ip(`${u}-plugin-${o}`,()=>[[`plugins.${o}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,o){let u=this._scopeCache,f=u.get(s);return(!f||o)&&(f=new Map,u.set(s,f)),f}getOptionScopes(s,o,u){let{options:f,type:n}=this,x=this._cachedScopes(s,u),w=x.get(o);if(w)return w;let E=new Set;o.forEach(D=>{s&&(E.add(s),D.forEach(B=>Fh(E,s,B))),D.forEach(B=>Fh(E,f,B)),D.forEach(B=>Fh(E,vo[n]||{},B)),D.forEach(B=>Fh(E,$e,B)),D.forEach(B=>Fh(E,Vd,B))});let A=Array.from(E);return A.length===0&&A.push(Object.create(null)),Qy.has(o)&&x.set(o,A),A}chartOptionScopes(){let{options:s,type:o}=this;return[s,vo[o]||{},$e.datasets[o]||{},{type:o},$e,Vd]}resolveNamedOptions(s,o,u,f=[""]){let n={$shared:!0},{resolver:x,subPrefixes:w}=vy(this._resolverCache,s,f),E=x;if(Fw(x,o)){n.$shared=!1,u=$r(u)?u():u;let A=this.createResolver(s,u,w);E=xo(x,u,A)}for(let A of o)n[A]=E[A];return n}createResolver(s,o,u=[""],f){let{resolver:n}=vy(this._resolverCache,s,u);return Ge(o)?xo(n,o,void 0,f):n}};function vy(l,s,o){let u=l.get(s);u||(u=new Map,l.set(s,u));let f=o.join(),n=u.get(f);return n||(n={resolver:Ph(s,o),subPrefixes:o.filter(w=>!w.toLowerCase().includes("hover"))},u.set(f,n)),n}var Bw=l=>Ge(l)&&Object.getOwnPropertyNames(l).reduce((s,o)=>s||$r(l[o]),!1);function Fw(l,s){let{isScriptable:o,isIndexable:u}=Gd(l);for(let f of s){let n=o(f),x=u(f),w=(x||n)&&l[f];if(n&&($r(w)||Bw(w))||x&&ai(w))return!0}return!1}var Ow="3.8.0",Vw=["top","bottom","left","right","chartArea"];function by(l,s){return l==="top"||l==="bottom"||Vw.indexOf(l)===-1&&s==="x"}function wy(l,s){return function(o,u){return o[l]===u[l]?o[s]-u[s]:o[l]-u[l]}}function Ty(l){let s=l.chart,o=s.options.animation;s.notifyPlugins("afterRender"),li(o&&o.onComplete,[l],s)}function Zw(l){let s=l.chart,o=s.options.animation;li(o&&o.onProgress,[l],s)}function t1(l){return qd()&&typeof l=="string"?l=document.getElementById(l):l&&l.length&&(l=l[0]),l&&l.canvas&&(l=l.canvas),l}var hp={},e1=l=>{let s=t1(l);return Object.values(hp).filter(o=>o.canvas===s).pop()};function Uw(l,s,o){let u=Object.keys(l);for(let f of u){let n=+f;if(n>=s){let x=l[f];delete l[f],(o>0||n>s)&&(l[n+o]=x)}}}function Nw(l,s,o,u){return!o||l.type==="mouseout"?null:u?s:l}var Aa=class{constructor(s,o){let u=this.config=new jm(o),f=t1(s),n=e1(f);if(n)throw new Error("Canvas is already in use. Chart with ID '"+n.id+"' must be destroyed before the canvas can be reused.");let x=u.createResolver(u.chartOptionScopes(),this.getContext());this.platform=new(u.platform||cw(f)),this.platform.updateConfig(u);let w=this.platform.acquireContext(f,x.aspectRatio),E=w&&w.canvas,A=E&&E.height,D=E&&E.width;if(this.id=em(),this.ctx=w,this.canvas=E,this.width=D,this.height=A,this._options=x,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Zm,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Qf(B=>this.update(B),x.resizeDelay||0),this._dataChanges=[],hp[this.id]=this,!w||!E){console.error("Failed to create chart: can't acquire context from the given item");return}ks.listen(this,"complete",Ty),ks.listen(this,"progress",Zw),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:s,maintainAspectRatio:o},width:u,height:f,_aspectRatio:n}=this;return Xe(s)?o&&n?n:f?u/f:null:s}get data(){return this.config.data}set data(s){this.config.data=s}get options(){return this._options}set options(s){this.config.options=s}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Xd(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Zd(this.canvas,this.ctx),this}stop(){return ks.stop(this),this}resize(s,o){ks.running(this)?this._resizeBeforeDraw={width:s,height:o}:this._resize(s,o)}_resize(s,o){let u=this.options,f=this.canvas,n=u.maintainAspectRatio&&this.aspectRatio,x=this.platform.getMaximumSize(f,s,o,n),w=u.devicePixelRatio||this.platform.getDevicePixelRatio(),E=this.width?"resize":"attach";this.width=x.width,this.height=x.height,this._aspectRatio=this.aspectRatio,Xd(this,w,!0)&&(this.notifyPlugins("resize",{size:x}),li(u.onResize,[this,x],this),this.attached&&this._doResize(E)&&this.render())}ensureScalesHaveIDs(){let o=this.options.scales||{};ei(o,(u,f)=>{u.id=f})}buildOrUpdateScales(){let s=this.options,o=s.scales,u=this.scales,f=Object.keys(u).reduce((x,w)=>(x[w]=!1,x),{}),n=[];o&&(n=n.concat(Object.keys(o).map(x=>{let w=o[x],E=Nm(x,w),A=E==="r",D=E==="x";return{options:w,dposition:A?"chartArea":D?"bottom":"left",dtype:A?"radialLinear":D?"category":"linear"}}))),ei(n,x=>{let w=x.options,E=w.id,A=Nm(E,w),D=Pe(w.type,x.dtype);(w.position===void 0||by(w.position,A)!==by(x.dposition))&&(w.position=x.dposition),f[E]=!0;let B=null;if(E in u&&u[E].type===D)B=u[E];else{let G=zs.getScale(D);B=new G({id:E,type:D,ctx:this.ctx,chart:this}),u[B.id]=B}B.init(w,s)}),ei(f,(x,w)=>{x||delete u[w]}),ei(u,x=>{on.configure(this,x,x.options),on.addBox(this,x)})}_updateMetasets(){let s=this._metasets,o=this.data.datasets.length,u=s.length;if(s.sort((f,n)=>f.index-n.index),u>o){for(let f=o;f<u;++f)this._destroyDatasetMeta(f);s.splice(o,u-o)}this._sortedMetasets=s.slice(0).sort(wy("order","index"))}_removeUnreferencedMetasets(){let{_metasets:s,data:{datasets:o}}=this;s.length>o.length&&delete this._stacks,s.forEach((u,f)=>{o.filter(n=>n===u._dataset).length===0&&this._destroyDatasetMeta(f)})}buildOrUpdateControllers(){let s=[],o=this.data.datasets,u,f;for(this._removeUnreferencedMetasets(),u=0,f=o.length;u<f;u++){let n=o[u],x=this.getDatasetMeta(u),w=n.type||this.config.type;if(x.type&&x.type!==w&&(this._destroyDatasetMeta(u),x=this.getDatasetMeta(u)),x.type=w,x.indexAxis=n.indexAxis||Um(w,this.options),x.order=n.order||0,x.index=u,x.label=""+n.label,x.visible=this.isDatasetVisible(u),x.controller)x.controller.updateIndex(u),x.controller.linkScales();else{let E=zs.getController(w),{datasetElementType:A,dataElementType:D}=$e.datasets[w];Object.assign(E.prototype,{dataElementType:zs.getElement(D),datasetElementType:A&&zs.getElement(A)}),x.controller=new E(this,u),s.push(x.controller)}}return this._updateMetasets(),s}_resetElements(){ei(this.data.datasets,(s,o)=>{this.getDatasetMeta(o).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(s){let o=this.config;o.update();let u=this._options=o.createResolver(o.chartOptionScopes(),this.getContext()),f=this._animationsDisabled=!u.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:s,cancelable:!0})===!1)return;let n=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let x=0;for(let A=0,D=this.data.datasets.length;A<D;A++){let{controller:B}=this.getDatasetMeta(A),G=!f&&n.indexOf(B)===-1;B.buildOrUpdateElements(G),x=Math.max(+B.getMaxOverflow(),x)}x=this._minPadding=u.layout.autoPadding?x:0,this._updateLayout(x),f||ei(n,A=>{A.reset()}),this._updateDatasets(s),this.notifyPlugins("afterUpdate",{mode:s}),this._layers.sort(wy("z","_idx"));let{_active:w,_lastEvent:E}=this;E?this._eventHandler(E,!0):w.length&&this._updateHoverStyles(w,w,!0),this.render()}_updateScales(){ei(this.scales,s=>{on.removeBox(this,s)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let s=this.options,o=new Set(Object.keys(this._listeners)),u=new Set(s.events);(!Dd(o,u)||!!this._responsiveListeners!==s.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:s}=this,o=this._getUniformDataChanges()||[];for(let{method:u,start:f,count:n}of o){let x=u==="_removeElements"?-n:n;Uw(s,f,x)}}_getUniformDataChanges(){let s=this._dataChanges;if(!s||!s.length)return;this._dataChanges=[];let o=this.data.datasets.length,u=n=>new Set(s.filter(x=>x[0]===n).map((x,w)=>w+","+x.splice(1).join(","))),f=u(0);for(let n=1;n<o;n++)if(!Dd(f,u(n)))return;return Array.from(f).map(n=>n.split(",")).map(n=>({method:n[1],start:+n[2],count:+n[3]}))}_updateLayout(s){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;on.update(this,this.width,this.height,s);let o=this.chartArea,u=o.width<=0||o.height<=0;this._layers=[],ei(this.boxes,f=>{u&&f.position==="chartArea"||(f.configure&&f.configure(),this._layers.push(...f._layers()))},this),this._layers.forEach((f,n)=>{f._idx=n}),this.notifyPlugins("afterLayout")}_updateDatasets(s){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:s,cancelable:!0})!==!1){for(let o=0,u=this.data.datasets.length;o<u;++o)this.getDatasetMeta(o).controller.configure();for(let o=0,u=this.data.datasets.length;o<u;++o)this._updateDataset(o,$r(s)?s({datasetIndex:o}):s);this.notifyPlugins("afterDatasetsUpdate",{mode:s})}}_updateDataset(s,o){let u=this.getDatasetMeta(s),f={meta:u,index:s,mode:o,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",f)!==!1&&(u.controller._update(o),f.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",f))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(ks.has(this)?this.attached&&!ks.running(this)&&ks.start(this):(this.draw(),Ty({chart:this})))}draw(){let s;if(this._resizeBeforeDraw){let{width:u,height:f}=this._resizeBeforeDraw;this._resize(u,f),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let o=this._layers;for(s=0;s<o.length&&o[s].z<=0;++s)o[s].draw(this.chartArea);for(this._drawDatasets();s<o.length;++s)o[s].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(s){let o=this._sortedMetasets,u=[],f,n;for(f=0,n=o.length;f<n;++f){let x=o[f];(!s||x.visible)&&u.push(x)}return u}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let s=this.getSortedVisibleDatasetMetas();for(let o=s.length-1;o>=0;--o)this._drawDataset(s[o]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(s){let o=this.ctx,u=s._clip,f=!u.disabled,n=this.chartArea,x={meta:s,index:s.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",x)!==!1&&(f&&Zl(o,{left:u.left===!1?0:n.left-u.left,right:u.right===!1?this.width:n.right+u.right,top:u.top===!1?0:n.top-u.top,bottom:u.bottom===!1?this.height:n.bottom+u.bottom}),s.controller.draw(),f&&Ul(o),x.cancelable=!1,this.notifyPlugins("afterDatasetDraw",x))}isPointInArea(s){return ga(s,this.chartArea,this._minPadding)}getElementsAtEventForMode(s,o,u,f){let n=Gb.modes[o];return typeof n=="function"?n(this,s,u,f):[]}getDatasetMeta(s){let o=this.data.datasets[s],u=this._metasets,f=u.filter(n=>n&&n._dataset===o).pop();return f||(f={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:o&&o.order||0,index:s,_dataset:o,_parsed:[],_sorted:!1},u.push(f)),f}getContext(){return this.$context||(this.$context=Wr(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(s){let o=this.data.datasets[s];if(!o)return!1;let u=this.getDatasetMeta(s);return typeof u.hidden=="boolean"?!u.hidden:!o.hidden}setDatasetVisibility(s,o){let u=this.getDatasetMeta(s);u.hidden=!o}toggleDataVisibility(s){this._hiddenIndices[s]=!this._hiddenIndices[s]}getDataVisibility(s){return!this._hiddenIndices[s]}_updateVisibility(s,o,u){let f=u?"show":"hide",n=this.getDatasetMeta(s),x=n.controller._resolveAnimations(void 0,f);Ln(o)?(n.data[o].hidden=!u,this.update()):(this.setDatasetVisibility(s,u),x.update(n,{visible:u}),this.update(w=>w.datasetIndex===s?f:void 0))}hide(s,o){this._updateVisibility(s,o,!1)}show(s,o){this._updateVisibility(s,o,!0)}_destroyDatasetMeta(s){let o=this._metasets[s];o&&o.controller&&o.controller._destroy(),delete this._metasets[s]}_stop(){let s,o;for(this.stop(),ks.remove(this),s=0,o=this.data.datasets.length;s<o;++s)this._destroyDatasetMeta(s)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:s,ctx:o}=this;this._stop(),this.config.clearCache(),s&&(this.unbindEvents(),Zd(s,o),this.platform.releaseContext(o),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete hp[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...s){return this.canvas.toDataURL(...s)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let s=this._listeners,o=this.platform,u=(n,x)=>{o.addEventListener(this,n,x),s[n]=x},f=(n,x,w)=>{n.offsetX=x,n.offsetY=w,this._eventHandler(n)};ei(this.options.events,n=>u(n,f))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let s=this._responsiveListeners,o=this.platform,u=(E,A)=>{o.addEventListener(this,E,A),s[E]=A},f=(E,A)=>{s[E]&&(o.removeEventListener(this,E,A),delete s[E])},n=(E,A)=>{this.canvas&&this.resize(E,A)},x,w=()=>{f("attach",w),this.attached=!0,this.resize(),u("resize",n),u("detach",x)};x=()=>{this.attached=!1,f("resize",n),this._stop(),this._resize(0,0),u("attach",w)},o.isAttached(this.canvas)?w():x()}unbindEvents(){ei(this._listeners,(s,o)=>{this.platform.removeEventListener(this,o,s)}),this._listeners={},ei(this._responsiveListeners,(s,o)=>{this.platform.removeEventListener(this,o,s)}),this._responsiveListeners=void 0}updateHoverStyle(s,o,u){let f=u?"set":"remove",n,x,w,E;for(o==="dataset"&&(n=this.getDatasetMeta(s[0].datasetIndex),n.controller["_"+f+"DatasetHoverStyle"]()),w=0,E=s.length;w<E;++w){x=s[w];let A=x&&this.getDatasetMeta(x.datasetIndex).controller;A&&A[f+"HoverStyle"](x.element,x.datasetIndex,x.index)}}getActiveElements(){return this._active||[]}setActiveElements(s){let o=this._active||[],u=s.map(({datasetIndex:n,index:x})=>{let w=this.getDatasetMeta(n);if(!w)throw new Error("No dataset found at index "+n);return{datasetIndex:n,element:w.data[x],index:x}});!Ol(u,o)&&(this._active=u,this._lastEvent=null,this._updateHoverStyles(u,o))}notifyPlugins(s,o,u){return this._plugins.notify(this,s,o,u)}_updateHoverStyles(s,o,u){let f=this.options.hover,n=(E,A)=>E.filter(D=>!A.some(B=>D.datasetIndex===B.datasetIndex&&D.index===B.index)),x=n(o,s),w=u?s:n(s,o);x.length&&this.updateHoverStyle(x,f.mode,!1),w.length&&f.mode&&this.updateHoverStyle(w,f.mode,!0)}_eventHandler(s,o){let u={event:s,replay:o,cancelable:!0,inChartArea:this.isPointInArea(s)},f=x=>(x.options.events||this.options.events).includes(s.native.type);if(this.notifyPlugins("beforeEvent",u,f)===!1)return;let n=this._handleEvent(s,o,u.inChartArea);return u.cancelable=!1,this.notifyPlugins("afterEvent",u,f),(n||u.changed)&&this.render(),this}_handleEvent(s,o,u){let{_active:f=[],options:n}=this,x=o,w=this._getActiveElements(s,f,u,x),E=nm(s),A=Nw(s,this._lastEvent,u,E);u&&(this._lastEvent=null,li(n.onHover,[s,w,this],this),E&&li(n.onClick,[s,w,this],this));let D=!Ol(w,f);return(D||o)&&(this._active=w,this._updateHoverStyles(w,f,o)),this._lastEvent=A,D}_getActiveElements(s,o,u,f){if(s.type==="mouseout")return[];if(!u)return o;let n=this.options.hover;return this.getElementsAtEventForMode(s,n.mode,n,f)}},Sy=()=>ei(Aa.instances,l=>l._plugins.invalidate()),wo=!0;Object.defineProperties(Aa,{defaults:{enumerable:wo,value:$e},instances:{enumerable:wo,value:hp},overrides:{enumerable:wo,value:vo},registry:{enumerable:wo,value:zs},version:{enumerable:wo,value:Ow},getChart:{enumerable:wo,value:e1},register:{enumerable:wo,value:(...l)=>{zs.add(...l),Sy()}},unregister:{enumerable:wo,value:(...l)=>{zs.remove(...l),Sy()}}});function i1(l,s,o){let{startAngle:u,pixelMargin:f,x:n,y:x,outerRadius:w,innerRadius:E}=s,A=f/w;l.beginPath(),l.arc(n,x,w,u-A,o+A),E>f?(A=f/E,l.arc(n,x,E,o+A,u-A,!0)):l.arc(n,x,f,o+bi,u-bi),l.closePath(),l.clip()}function jw(l){return Ih(l,["outerStart","outerEnd","innerStart","innerEnd"])}function Gw(l,s,o,u){let f=jw(l.options.borderRadius),n=(o-s)/2,x=Math.min(n,u*s/2),w=E=>{let A=(o-Math.min(n,E))*u/2;return Fi(E,0,Math.min(n,A))};return{outerStart:w(f.outerStart),outerEnd:w(f.outerEnd),innerStart:Fi(f.innerStart,0,x),innerEnd:Fi(f.innerEnd,0,x)}}function Nl(l,s,o,u){return{x:o+l*Math.cos(s),y:u+l*Math.sin(s)}}function Gm(l,s,o,u,f){let{x:n,y:x,startAngle:w,pixelMargin:E,innerRadius:A}=s,D=Math.max(s.outerRadius+u+o-E,0),B=A>0?A+u+o+E:0,G=0,rt=f-w;if(u){let Me=A>0?A-u:0,Ui=D>0?D-u:0,Di=(Me+Ui)/2,di=Di!==0?rt*Di/(Di+u):rt;G=(rt-di)/2}let Q=Math.max(.001,rt*D-o/mi)/D,dt=(rt-Q)/2,W=w+dt+G,et=f-dt-G,{outerStart:mt,outerEnd:St,innerStart:_t,innerEnd:Mt}=Gw(s,B,D,et-W),Rt=D-mt,Vt=D-St,Yt=W+mt/Rt,jt=et-St/Vt,ye=B+_t,le=B+Mt,me=W+_t/ye,He=et-Mt/le;if(l.beginPath(),l.arc(n,x,D,Yt,jt),St>0){let Me=Nl(Vt,jt,n,x);l.arc(Me.x,Me.y,St,jt,et+bi)}let Ye=Nl(le,et,n,x);if(l.lineTo(Ye.x,Ye.y),Mt>0){let Me=Nl(le,He,n,x);l.arc(Me.x,Me.y,Mt,et+bi,He+Math.PI)}if(l.arc(n,x,B,et-Mt/B,W+_t/B,!0),_t>0){let Me=Nl(ye,me,n,x);l.arc(Me.x,Me.y,_t,me+Math.PI,W-bi)}let be=Nl(Rt,W,n,x);if(l.lineTo(be.x,be.y),mt>0){let Me=Nl(Rt,Yt,n,x);l.arc(Me.x,Me.y,mt,W-bi,Yt)}l.closePath()}function $w(l,s,o,u){let{fullCircles:f,startAngle:n,circumference:x}=s,w=s.endAngle;if(f){Gm(l,s,o,u,n+si);for(let E=0;E<f;++E)l.fill();isNaN(x)||(w=n+x%si,x%si===0&&(w+=si))}return Gm(l,s,o,u,w),l.fill(),w}function qw(l,s,o){let{x:u,y:f,startAngle:n,pixelMargin:x,fullCircles:w}=s,E=Math.max(s.outerRadius-x,0),A=s.innerRadius+x,D;for(o&&i1(l,s,n+si),l.beginPath(),l.arc(u,f,A,n+si,n,!0),D=0;D<w;++D)l.stroke();for(l.beginPath(),l.arc(u,f,E,n,n+si),D=0;D<w;++D)l.stroke()}function Ww(l,s,o,u,f){let{options:n}=s,{borderWidth:x,borderJoinStyle:w}=n,E=n.borderAlign==="inner";!x||(E?(l.lineWidth=x*2,l.lineJoin=w||"round"):(l.lineWidth=x,l.lineJoin=w||"bevel"),s.fullCircles&&qw(l,s,E),E&&i1(l,s,f),Gm(l,s,o,u,f),l.stroke())}var Hl=class extends Yn{constructor(s){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,s&&Object.assign(this,s)}inRange(s,o,u){let f=this.getProps(["x","y"],u),{angle:n,distance:x}=Fd(f,{x:s,y:o}),{startAngle:w,endAngle:E,innerRadius:A,outerRadius:D,circumference:B}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],u),G=this.options.spacing/2,Q=Pe(B,E-w)>=si||ba(n,w,E),dt=xr(x,A+G,D+G);return Q&&dt}getCenterPoint(s){let{x:o,y:u,startAngle:f,endAngle:n,innerRadius:x,outerRadius:w}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],s),{offset:E,spacing:A}=this.options,D=(f+n)/2,B=(x+w+A+E)/2;return{x:o+Math.cos(D)*B,y:u+Math.sin(D)*B}}tooltipPosition(s){return this.getCenterPoint(s)}draw(s){let{options:o,circumference:u}=this,f=(o.offset||0)/2,n=(o.spacing||0)/2;if(this.pixelMargin=o.borderAlign==="inner"?.33:0,this.fullCircles=u>si?Math.floor(u/si):0,u===0||this.innerRadius<0||this.outerRadius<0)return;s.save();let x=0;if(f){x=f/2;let E=(this.startAngle+this.endAngle)/2;s.translate(Math.cos(E)*x,Math.sin(E)*x),this.circumference>=mi&&(x=f)}s.fillStyle=o.backgroundColor,s.strokeStyle=o.borderColor;let w=$w(s,this,x,n);Ww(s,this,x,n,w),s.restore()}};Hl.id="arc";Hl.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0};Hl.defaultRoutes={backgroundColor:"backgroundColor"};function n1(l,s,o=s){l.lineCap=Pe(o.borderCapStyle,s.borderCapStyle),l.setLineDash(Pe(o.borderDash,s.borderDash)),l.lineDashOffset=Pe(o.borderDashOffset,s.borderDashOffset),l.lineJoin=Pe(o.borderJoinStyle,s.borderJoinStyle),l.lineWidth=Pe(o.borderWidth,s.borderWidth),l.strokeStyle=Pe(o.borderColor,s.borderColor)}function Xw(l,s,o){l.lineTo(o.x,o.y)}function Hw(l){return l.stepped?dm:l.tension||l.cubicInterpolationMode==="monotone"?pm:Xw}function r1(l,s,o={}){let u=l.length,{start:f=0,end:n=u-1}=o,{start:x,end:w}=s,E=Math.max(f,x),A=Math.min(n,w),D=f<x&&n<x||f>w&&n>w;return{count:u,start:E,loop:s.loop,ilen:A<E&&!D?u+A-E:A-E}}function Yw(l,s,o,u){let{points:f,options:n}=s,{count:x,start:w,loop:E,ilen:A}=r1(f,o,u),D=Hw(n),{move:B=!0,reverse:G}=u||{},rt,Q,dt;for(rt=0;rt<=A;++rt)Q=f[(w+(G?A-rt:rt))%x],!Q.skip&&(B?(l.moveTo(Q.x,Q.y),B=!1):D(l,dt,Q,G,n.stepped),dt=Q);return E&&(Q=f[(w+(G?A:0))%x],D(l,dt,Q,G,n.stepped)),!!E}function Kw(l,s,o,u){let f=s.points,{count:n,start:x,ilen:w}=r1(f,o,u),{move:E=!0,reverse:A}=u||{},D=0,B=0,G,rt,Q,dt,W,et,mt=_t=>(x+(A?w-_t:_t))%n,St=()=>{dt!==W&&(l.lineTo(D,W),l.lineTo(D,dt),l.lineTo(D,et))};for(E&&(rt=f[mt(0)],l.moveTo(rt.x,rt.y)),G=0;G<=w;++G){if(rt=f[mt(G)],rt.skip)continue;let _t=rt.x,Mt=rt.y,Rt=_t|0;Rt===Q?(Mt<dt?dt=Mt:Mt>W&&(W=Mt),D=(B*D+_t)/++B):(St(),l.lineTo(_t,Mt),Q=Rt,B=0,dt=W=Mt),et=Mt}St()}function $m(l){let s=l.options,o=s.borderDash&&s.borderDash.length;return!l._decimated&&!l._loop&&!s.tension&&s.cubicInterpolationMode!=="monotone"&&!s.stepped&&!o?Kw:Yw}function Jw(l){return l.stepped?Tm:l.tension||l.cubicInterpolationMode==="monotone"?Sm:Es}function Qw(l,s,o,u){let f=s._path;f||(f=s._path=new Path2D,s.path(f,o,u)&&f.closePath()),n1(l,s.options),l.stroke(f)}function t3(l,s,o,u){let{segments:f,options:n}=s,x=$m(s);for(let w of f)n1(l,n,w.style),l.beginPath(),x(l,s,w,{start:o,end:o+u-1})&&l.closePath(),l.stroke()}var e3=typeof Path2D=="function";function i3(l,s,o,u){e3&&!s.options.segment?Qw(l,s,o,u):t3(l,s,o,u)}var Hr=class extends Yn{constructor(s){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,s&&Object.assign(this,s)}updateControlPoints(s,o){let u=this.options;if((u.tension||u.cubicInterpolationMode==="monotone")&&!u.stepped&&!this._pointsUpdated){let f=u.spanGaps?this._loop:this._fullLoop;vm(this._points,u,s,f,o),this._pointsUpdated=!0}}set points(s){this._points=s,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Em(this,this.options.segment))}first(){let s=this.segments,o=this.points;return s.length&&o[s[0].start]}last(){let s=this.segments,o=this.points,u=s.length;return u&&o[s[u-1].end]}interpolate(s,o){let u=this.options,f=s[o],n=this.points,x=Qd(this,{property:o,start:f,end:f});if(!x.length)return;let w=[],E=Jw(u),A,D;for(A=0,D=x.length;A<D;++A){let{start:B,end:G}=x[A],rt=n[B],Q=n[G];if(rt===Q){w.push(rt);continue}let dt=Math.abs((f-rt[o])/(Q[o]-rt[o])),W=E(rt,Q,dt,u.stepped);W[o]=s[o],w.push(W)}return w.length===1?w[0]:w}pathSegment(s,o,u){return $m(this)(s,this,o,u)}path(s,o,u){let f=this.segments,n=$m(this),x=this._loop;o=o||0,u=u||this.points.length-o;for(let w of f)x&=n(s,this,w,{start:o,end:o+u-1});return!!x}draw(s,o,u,f){let n=this.options||{};(this.points||[]).length&&n.borderWidth&&(s.save(),i3(s,this,u,f),s.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}};Hr.id="line";Hr.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};Hr.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};Hr.descriptors={_scriptable:!0,_indexable:l=>l!=="borderDash"&&l!=="fill"};function Ey(l,s,o,u){let f=l.options,{[o]:n}=l.getProps([o],u);return Math.abs(s-n)<f.radius+f.hitRadius}var Yl=class extends Yn{constructor(s){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,s&&Object.assign(this,s)}inRange(s,o,u){let f=this.options,{x:n,y:x}=this.getProps(["x","y"],u);return Math.pow(s-n,2)+Math.pow(o-x,2)<Math.pow(f.hitRadius+f.radius,2)}inXRange(s,o){return Ey(this,s,"x",o)}inYRange(s,o){return Ey(this,s,"y",o)}getCenterPoint(s){let{x:o,y:u}=this.getProps(["x","y"],s);return{x:o,y:u}}size(s){s=s||this.options||{};let o=s.radius||0;o=Math.max(o,o&&s.hoverRadius||0);let u=o&&s.borderWidth||0;return(o+u)*2}draw(s,o){let u=this.options;this.skip||u.radius<.1||!ga(this,o,this.size(u)/2)||(s.strokeStyle=u.borderColor,s.lineWidth=u.borderWidth,s.fillStyle=u.backgroundColor,Vl(s,u,this.x,this.y))}getRange(){let s=this.options||{};return s.radius+s.hitRadius}};Yl.id="point";Yl.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};Yl.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};function s1(l,s){let{x:o,y:u,base:f,width:n,height:x}=l.getProps(["x","y","base","width","height"],s),w,E,A,D,B;return l.horizontal?(B=x/2,w=Math.min(o,f),E=Math.max(o,f),A=u-B,D=u+B):(B=n/2,w=o-B,E=o+B,A=Math.min(u,f),D=Math.max(u,f)),{left:w,top:A,right:E,bottom:D}}function To(l,s,o,u){return l?0:Fi(s,o,u)}function n3(l,s,o){let u=l.options.borderWidth,f=l.borderSkipped,n=Ud(u);return{t:To(f.top,n.top,0,o),r:To(f.right,n.right,0,s),b:To(f.bottom,n.bottom,0,o),l:To(f.left,n.left,0,s)}}function r3(l,s,o){let{enableBorderRadius:u}=l.getProps(["enableBorderRadius"]),f=l.options.borderRadius,n=Cs(f),x=Math.min(s,o),w=l.borderSkipped,E=u||Ge(f);return{topLeft:To(!E||w.top||w.left,n.topLeft,0,x),topRight:To(!E||w.top||w.right,n.topRight,0,x),bottomLeft:To(!E||w.bottom||w.left,n.bottomLeft,0,x),bottomRight:To(!E||w.bottom||w.right,n.bottomRight,0,x)}}function s3(l){let s=s1(l),o=s.right-s.left,u=s.bottom-s.top,f=n3(l,o/2,u/2),n=r3(l,o/2,u/2);return{outer:{x:s.left,y:s.top,w:o,h:u,radius:n},inner:{x:s.left+f.l,y:s.top+f.t,w:o-f.l-f.r,h:u-f.t-f.b,radius:{topLeft:Math.max(0,n.topLeft-Math.max(f.t,f.l)),topRight:Math.max(0,n.topRight-Math.max(f.t,f.r)),bottomLeft:Math.max(0,n.bottomLeft-Math.max(f.b,f.l)),bottomRight:Math.max(0,n.bottomRight-Math.max(f.b,f.r))}}}}function zm(l,s,o,u){let f=s===null,n=o===null,w=l&&!(f&&n)&&s1(l,u);return w&&(f||xr(s,w.left,w.right))&&(n||xr(o,w.top,w.bottom))}function o3(l){return l.topLeft||l.topRight||l.bottomLeft||l.bottomRight}function a3(l,s){l.rect(s.x,s.y,s.w,s.h)}function Dm(l,s,o={}){let u=l.x!==o.x?-s:0,f=l.y!==o.y?-s:0,n=(l.x+l.w!==o.x+o.w?s:0)-u,x=(l.y+l.h!==o.y+o.h?s:0)-f;return{x:l.x+u,y:l.y+f,w:l.w+n,h:l.h+x,radius:l.radius}}var Kl=class extends Yn{constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){let{inflateAmount:o,options:{borderColor:u,backgroundColor:f}}=this,{inner:n,outer:x}=s3(this),w=o3(x.radius)?wa:a3;s.save(),(x.w!==n.w||x.h!==n.h)&&(s.beginPath(),w(s,Dm(x,o,n)),s.clip(),w(s,Dm(n,-o,x)),s.fillStyle=u,s.fill("evenodd")),s.beginPath(),w(s,Dm(n,o)),s.fillStyle=f,s.fill(),s.restore()}inRange(s,o,u){return zm(this,s,o,u)}inXRange(s,o){return zm(this,s,null,o)}inYRange(s,o){return zm(this,null,s,o)}getCenterPoint(s){let{x:o,y:u,base:f,horizontal:n}=this.getProps(["x","y","base","horizontal"],s);return{x:n?(o+f)/2:o,y:n?u:(u+f)/2}}getRange(s){return s==="x"?this.width/2:this.height/2}};Kl.id="bar";Kl.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};Kl.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var l3=Object.freeze({__proto__:null,ArcElement:Hl,LineElement:Hr,PointElement:Yl,BarElement:Kl});function c3(l,s,o,u,f){let n=f.samples||u;if(n>=o)return l.slice(s,s+o);let x=[],w=(o-2)/(n-2),E=0,A=s+o-1,D=s,B,G,rt,Q,dt;for(x[E++]=l[D],B=0;B<n-2;B++){let W=0,et=0,mt,St=Math.floor((B+1)*w)+1+s,_t=Math.min(Math.floor((B+2)*w)+1,o)+s,Mt=_t-St;for(mt=St;mt<_t;mt++)W+=l[mt].x,et+=l[mt].y;W/=Mt,et/=Mt;let Rt=Math.floor(B*w)+1+s,Vt=Math.min(Math.floor((B+1)*w)+1,o)+s,{x:Yt,y:jt}=l[D];for(rt=Q=-1,mt=Rt;mt<Vt;mt++)Q=.5*Math.abs((Yt-W)*(l[mt].y-jt)-(Yt-l[mt].x)*(et-jt)),Q>rt&&(rt=Q,G=l[mt],dt=mt);x[E++]=G,D=dt}return x[E++]=l[A],x}function h3(l,s,o,u){let f=0,n=0,x,w,E,A,D,B,G,rt,Q,dt,W=[],et=s+o-1,mt=l[s].x,_t=l[et].x-mt;for(x=s;x<s+o;++x){w=l[x],E=(w.x-mt)/_t*u,A=w.y;let Mt=E|0;if(Mt===D)A<Q?(Q=A,B=x):A>dt&&(dt=A,G=x),f=(n*f+w.x)/++n;else{let Rt=x-1;if(!Xe(B)&&!Xe(G)){let Vt=Math.min(B,G),Yt=Math.max(B,G);Vt!==rt&&Vt!==Rt&&W.push({...l[Vt],x:f}),Yt!==rt&&Yt!==Rt&&W.push({...l[Yt],x:f})}x>0&&Rt!==rt&&W.push(l[Rt]),W.push(w),D=Mt,n=0,Q=dt=A,B=G=rt=x}}return W}function o1(l){if(l._decimated){let s=l._data;delete l._decimated,delete l._data,Object.defineProperty(l,"data",{value:s})}}function My(l){l.data.datasets.forEach(s=>{o1(s)})}function u3(l,s){let o=s.length,u=0,f,{iScale:n}=l,{min:x,max:w,minDefined:E,maxDefined:A}=n.getUserBounds();return E&&(u=Fi(vr(s,n.axis,x).lo,0,o-1)),A?f=Fi(vr(s,n.axis,w).hi+1,u,o)-u:f=o-u,{start:u,count:f}}var d3={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(l,s,o)=>{if(!o.enabled){My(l);return}let u=l.width;l.data.datasets.forEach((f,n)=>{let{_data:x,indexAxis:w}=f,E=l.getDatasetMeta(n),A=x||f.data;if(Ta([w,l.options.indexAxis])==="y"||!E.controller.supportsDecimation)return;let D=l.scales[E.xAxisID];if(D.type!=="linear"&&D.type!=="time"||l.options.parsing)return;let{start:B,count:G}=u3(E,A),rt=o.threshold||4*u;if(G<=rt){o1(f);return}Xe(x)&&(f._data=A,delete f.data,Object.defineProperty(f,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(dt){this._data=dt}}));let Q;switch(o.algorithm){case"lttb":Q=c3(A,B,G,u,o);break;case"min-max":Q=h3(A,B,G,u);break;default:throw new Error(`Unsupported decimation algorithm '${o.algorithm}'`)}f._decimated=Q})},destroy(l){My(l)}};function p3(l,s,o){let u=l.segments,f=l.points,n=s.points,x=[];for(let w of u){let{start:E,end:A}=w;A=Xm(E,A,f);let D=qm(o,f[E],f[A],w.loop);if(!s.segments){x.push({source:w,target:D,start:f[E],end:f[A]});continue}let B=Qd(s,D);for(let G of B){let rt=qm(o,n[G.start],n[G.end],G.loop),Q=Jd(w,f,rt);for(let dt of Q)x.push({source:dt,target:G,start:{[o]:Ay(D,rt,"start",Math.max)},end:{[o]:Ay(D,rt,"end",Math.min)}})}}return x}function qm(l,s,o,u){if(u)return;let f=s[l],n=o[l];return l==="angle"&&(f=yn(f),n=yn(n)),{property:l,start:f,end:n}}function f3(l,s){let{x:o=null,y:u=null}=l||{},f=s.points,n=[];return s.segments.forEach(({start:x,end:w})=>{w=Xm(x,w,f);let E=f[x],A=f[w];u!==null?(n.push({x:E.x,y:u}),n.push({x:A.x,y:u})):o!==null&&(n.push({x:o,y:E.y}),n.push({x:o,y:A.y}))}),n}function Xm(l,s,o){for(;s>l;s--){let u=o[s];if(!isNaN(u.x)&&!isNaN(u.y))break}return s}function Ay(l,s,o,u){return l&&s?u(l[o],s[o]):l?l[o]:s?s[o]:0}function a1(l,s){let o=[],u=!1;return ai(l)?(u=!0,o=l):o=f3(l,s),o.length?new Hr({points:o,options:{tension:0},_loop:u,_fullLoop:u}):null}function m3(l,s,o){let f=l[s].fill,n=[s],x;if(!o)return f;for(;f!==!1&&n.indexOf(f)===-1;){if(!Mi(f))return f;if(x=l[f],!x)return!1;if(x.visible)return f;n.push(f),f=x.fill}return!1}function _3(l,s,o){let u=v3(l);if(Ge(u))return isNaN(u.value)?!1:u;let f=parseFloat(u);return Mi(f)&&Math.floor(f)===f?g3(u[0],s,f,o):["origin","start","end","stack","shape"].indexOf(u)>=0&&u}function g3(l,s,o,u){return(l==="-"||l==="+")&&(o=s+o),o===s||o<0||o>=u?!1:o}function y3(l,s){let o=null;return l==="start"?o=s.bottom:l==="end"?o=s.top:Ge(l)?o=s.getPixelForValue(l.value):s.getBasePixel&&(o=s.getBasePixel()),o}function x3(l,s,o){let u;return l==="start"?u=o:l==="end"?u=s.options.reverse?s.min:s.max:Ge(l)?u=l.value:u=s.getBaseValue(),u}function v3(l){let s=l.options,o=s.fill,u=Pe(o&&o.target,o);return u===void 0&&(u=!!s.backgroundColor),u===!1||u===null?!1:u===!0?"origin":u}function b3(l){let{scale:s,index:o,line:u}=l,f=[],n=u.segments,x=u.points,w=w3(s,o);w.push(a1({x:null,y:s.bottom},u));for(let E=0;E<n.length;E++){let A=n[E];for(let D=A.start;D<=A.end;D++)T3(f,x[D],w)}return new Hr({points:f,options:{}})}function w3(l,s){let o=[],u=l.getMatchingVisibleMetas("line");for(let f=0;f<u.length;f++){let n=u[f];if(n.index===s)break;n.hidden||o.unshift(n.dataset)}return o}function T3(l,s,o){let u=[];for(let f=0;f<o.length;f++){let n=o[f],{first:x,last:w,point:E}=S3(n,s,"x");if(!(!E||x&&w)){if(x)u.unshift(E);else if(l.push(E),!w)break}}l.push(...u)}function S3(l,s,o){let u=l.interpolate(s,o);if(!u)return{};let f=u[o],n=l.segments,x=l.points,w=!1,E=!1;for(let A=0;A<n.length;A++){let D=n[A],B=x[D.start][o],G=x[D.end][o];if(xr(f,B,G)){w=f===B,E=f===G;break}}return{first:w,last:E,point:u}}var up=class{constructor(s){this.x=s.x,this.y=s.y,this.radius=s.radius}pathSegment(s,o,u){let{x:f,y:n,radius:x}=this;return o=o||{start:0,end:si},s.arc(f,n,x,o.end,o.start,!0),!u.bounds}interpolate(s){let{x:o,y:u,radius:f}=this,n=s.angle;return{x:o+Math.cos(n)*f,y:u+Math.sin(n)*f,angle:n}}};function E3(l){let{chart:s,fill:o,line:u}=l;if(Mi(o))return M3(s,o);if(o==="stack")return b3(l);if(o==="shape")return!0;let f=A3(l);return f instanceof up?f:a1(f,u)}function M3(l,s){let o=l.getDatasetMeta(s);return o&&l.isDatasetVisible(s)?o.dataset:null}function A3(l){return(l.scale||{}).getPointPositionForValue?I3(l):C3(l)}function C3(l){let{scale:s={},fill:o}=l,u=y3(o,s);if(Mi(u)){let f=s.isHorizontal();return{x:f?u:null,y:f?null:u}}return null}function I3(l){let{scale:s,fill:o}=l,u=s.options,f=s.getLabels().length,n=u.reverse?s.max:s.min,x=x3(o,s,n),w=[];if(u.grid.circular){let E=s.getPointPositionForValue(0,n);return new up({x:E.x,y:E.y,radius:s.getDistanceFromCenterForValue(x)})}for(let E=0;E<f;++E)w.push(s.getPointPositionForValue(E,x));return w}function Lm(l,s,o){let u=E3(s),{line:f,scale:n,axis:x}=s,w=f.options,E=w.fill,A=w.backgroundColor,{above:D=A,below:B=A}=E||{};u&&f.points.length&&(Zl(l,o),k3(l,{line:f,target:u,above:D,below:B,area:o,scale:n,axis:x}),Ul(l))}function k3(l,s){let{line:o,target:u,above:f,below:n,area:x,scale:w}=s,E=o._loop?"angle":s.axis;l.save(),E==="x"&&n!==f&&(Cy(l,u,x.top),Iy(l,{line:o,target:u,color:f,scale:w,property:E}),l.restore(),l.save(),Cy(l,u,x.bottom)),Iy(l,{line:o,target:u,color:n,scale:w,property:E}),l.restore()}function Cy(l,s,o){let{segments:u,points:f}=s,n=!0,x=!1;l.beginPath();for(let w of u){let{start:E,end:A}=w,D=f[E],B=f[Xm(E,A,f)];n?(l.moveTo(D.x,D.y),n=!1):(l.lineTo(D.x,o),l.lineTo(D.x,D.y)),x=!!s.pathSegment(l,w,{move:x}),x?l.closePath():l.lineTo(B.x,o)}l.lineTo(s.first().x,o),l.closePath(),l.clip()}function Iy(l,s){let{line:o,target:u,property:f,color:n,scale:x}=s,w=p3(o,u,f);for(let{source:E,target:A,start:D,end:B}of w){let{style:{backgroundColor:G=n}={}}=E,rt=u!==!0;l.save(),l.fillStyle=G,P3(l,x,rt&&qm(f,D,B)),l.beginPath();let Q=!!o.pathSegment(l,E),dt;if(rt){Q?l.closePath():ky(l,u,B,f);let W=!!u.pathSegment(l,A,{move:Q,reverse:!0});dt=Q&&W,dt||ky(l,u,D,f)}l.closePath(),l.fill(dt?"evenodd":"nonzero"),l.restore()}}function P3(l,s,o){let{top:u,bottom:f}=s.chart.chartArea,{property:n,start:x,end:w}=o||{};n==="x"&&(l.beginPath(),l.rect(x,u,w-x,f-u),l.clip())}function ky(l,s,o,u){let f=s.interpolate(o,u);f&&l.lineTo(f.x,f.y)}var z3={id:"filler",afterDatasetsUpdate(l,s,o){let u=(l.data.datasets||[]).length,f=[],n,x,w,E;for(x=0;x<u;++x)n=l.getDatasetMeta(x),w=n.dataset,E=null,w&&w.options&&w instanceof Hr&&(E={visible:l.isDatasetVisible(x),index:x,fill:_3(w,x,u),chart:l,axis:n.controller.options.indexAxis,scale:n.vScale,line:w}),n.$filler=E,f.push(E);for(x=0;x<u;++x)E=f[x],!(!E||E.fill===!1)&&(E.fill=m3(f,x,o.propagate))},beforeDraw(l,s,o){let u=o.drawTime==="beforeDraw",f=l.getSortedVisibleDatasetMetas(),n=l.chartArea;for(let x=f.length-1;x>=0;--x){let w=f[x].$filler;!w||(w.line.updateControlPoints(n,w.axis),u&&Lm(l.ctx,w,n))}},beforeDatasetsDraw(l,s,o){if(o.drawTime!=="beforeDatasetsDraw")return;let u=l.getSortedVisibleDatasetMetas();for(let f=u.length-1;f>=0;--f){let n=u[f].$filler;n&&Lm(l.ctx,n,l.chartArea)}},beforeDatasetDraw(l,s,o){let u=s.meta.$filler;!u||u.fill===!1||o.drawTime!=="beforeDatasetDraw"||Lm(l.ctx,u,l.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},Py=(l,s)=>{let{boxHeight:o=s,boxWidth:u=s}=l;return l.usePointStyle&&(o=Math.min(o,s),u=Math.min(u,s)),{boxWidth:u,boxHeight:o,itemHeight:Math.max(s,o)}},D3=(l,s)=>l!==null&&s!==null&&l.datasetIndex===s.datasetIndex&&l.index===s.index,dp=class extends Yn{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,o,u){this.maxWidth=s,this.maxHeight=o,this._margins=u,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let s=this.options.labels||{},o=li(s.generateLabels,[this.chart],this)||[];s.filter&&(o=o.filter(u=>s.filter(u,this.chart.data))),s.sort&&(o=o.sort((u,f)=>s.sort(u,f,this.chart.data))),this.options.reverse&&o.reverse(),this.legendItems=o}fit(){let{options:s,ctx:o}=this;if(!s.display){this.width=this.height=0;return}let u=s.labels,f=zi(u.font),n=f.size,x=this._computeTitleHeight(),{boxWidth:w,itemHeight:E}=Py(u,n),A,D;o.font=f.string,this.isHorizontal()?(A=this.maxWidth,D=this._fitRows(x,n,w,E)+10):(D=this.maxHeight,A=this._fitCols(x,n,w,E)+10),this.width=Math.min(A,s.maxWidth||this.maxWidth),this.height=Math.min(D,s.maxHeight||this.maxHeight)}_fitRows(s,o,u,f){let{ctx:n,maxWidth:x,options:{labels:{padding:w}}}=this,E=this.legendHitBoxes=[],A=this.lineWidths=[0],D=f+w,B=s;n.textAlign="left",n.textBaseline="middle";let G=-1,rt=-D;return this.legendItems.forEach((Q,dt)=>{let W=u+o/2+n.measureText(Q.text).width;(dt===0||A[A.length-1]+W+2*w>x)&&(B+=D,A[A.length-(dt>0?0:1)]=0,rt+=D,G++),E[dt]={left:0,top:rt,row:G,width:W,height:f},A[A.length-1]+=W+w}),B}_fitCols(s,o,u,f){let{ctx:n,maxHeight:x,options:{labels:{padding:w}}}=this,E=this.legendHitBoxes=[],A=this.columnSizes=[],D=x-s,B=w,G=0,rt=0,Q=0,dt=0;return this.legendItems.forEach((W,et)=>{let mt=u+o/2+n.measureText(W.text).width;et>0&&rt+f+2*w>D&&(B+=G+w,A.push({width:G,height:rt}),Q+=G+w,dt++,G=rt=0),E[et]={left:Q,top:rt,col:dt,width:mt,height:f},G=Math.max(G,mt),rt+=f+w}),B+=G,A.push({width:G,height:rt}),B}adjustHitBoxes(){if(!this.options.display)return;let s=this._computeTitleHeight(),{legendHitBoxes:o,options:{align:u,labels:{padding:f},rtl:n}}=this,x=bo(n,this.left,this.width);if(this.isHorizontal()){let w=0,E=qi(u,this.left+f,this.right-this.lineWidths[w]);for(let A of o)w!==A.row&&(w=A.row,E=qi(u,this.left+f,this.right-this.lineWidths[w])),A.top+=this.top+s+f,A.left=x.leftForLtr(x.x(E),A.width),E+=A.width+f}else{let w=0,E=qi(u,this.top+s+f,this.bottom-this.columnSizes[w].height);for(let A of o)A.col!==w&&(w=A.col,E=qi(u,this.top+s+f,this.bottom-this.columnSizes[w].height)),A.top=E,A.left+=this.left+f,A.left=x.leftForLtr(x.x(A.left),A.width),E+=A.height+f}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let s=this.ctx;Zl(s,this),this._draw(),Ul(s)}}_draw(){let{options:s,columnSizes:o,lineWidths:u,ctx:f}=this,{align:n,labels:x}=s,w=$e.color,E=bo(s.rtl,this.left,this.width),A=zi(x.font),{color:D,padding:B}=x,G=A.size,rt=G/2,Q;this.drawTitle(),f.textAlign=E.textAlign("left"),f.textBaseline="middle",f.lineWidth=.5,f.font=A.string;let{boxWidth:dt,boxHeight:W,itemHeight:et}=Py(x,G),mt=function(Vt,Yt,jt){if(isNaN(dt)||dt<=0||isNaN(W)||W<0)return;f.save();let ye=Pe(jt.lineWidth,1);if(f.fillStyle=Pe(jt.fillStyle,w),f.lineCap=Pe(jt.lineCap,"butt"),f.lineDashOffset=Pe(jt.lineDashOffset,0),f.lineJoin=Pe(jt.lineJoin,"miter"),f.lineWidth=ye,f.strokeStyle=Pe(jt.strokeStyle,w),f.setLineDash(Pe(jt.lineDash,[])),x.usePointStyle){let le={radius:dt*Math.SQRT2/2,pointStyle:jt.pointStyle,rotation:jt.rotation,borderWidth:ye},me=E.xPlus(Vt,dt/2),He=Yt+rt;Vl(f,le,me,He)}else{let le=Yt+Math.max((G-W)/2,0),me=E.leftForLtr(Vt,dt),He=Cs(jt.borderRadius);f.beginPath(),Object.values(He).some(Ye=>Ye!==0)?wa(f,{x:me,y:le,w:dt,h:W,radius:He}):f.rect(me,le,dt,W),f.fill(),ye!==0&&f.stroke()}f.restore()},St=function(Vt,Yt,jt){As(f,jt.text,Vt,Yt+et/2,A,{strikethrough:jt.hidden,textAlign:E.textAlign(jt.textAlign)})},_t=this.isHorizontal(),Mt=this._computeTitleHeight();_t?Q={x:qi(n,this.left+B,this.right-u[0]),y:this.top+B+Mt,line:0}:Q={x:this.left+B,y:qi(n,this.top+Mt+B,this.bottom-o[0].height),line:0},Yd(this.ctx,s.textDirection);let Rt=et+B;this.legendItems.forEach((Vt,Yt)=>{f.strokeStyle=Vt.fontColor||D,f.fillStyle=Vt.fontColor||D;let jt=f.measureText(Vt.text).width,ye=E.textAlign(Vt.textAlign||(Vt.textAlign=x.textAlign)),le=dt+rt+jt,me=Q.x,He=Q.y;E.setWidth(this.width),_t?Yt>0&&me+le+B>this.right&&(He=Q.y+=Rt,Q.line++,me=Q.x=qi(n,this.left+B,this.right-u[Q.line])):Yt>0&&He+Rt>this.bottom&&(me=Q.x=me+o[Q.line].width+B,Q.line++,He=Q.y=qi(n,this.top+Mt+B,this.bottom-o[Q.line].height));let Ye=E.x(me);mt(Ye,He,Vt),me=tm(ye,me+dt+rt,_t?me+le:this.right,s.rtl),St(E.x(me),He,Vt),_t?Q.x+=le+B:Q.y+=Rt}),Kd(this.ctx,s.textDirection)}drawTitle(){let s=this.options,o=s.title,u=zi(o.font),f=Wi(o.padding);if(!o.display)return;let n=bo(s.rtl,this.left,this.width),x=this.ctx,w=o.position,E=u.size/2,A=f.top+E,D,B=this.left,G=this.width;if(this.isHorizontal())G=Math.max(...this.lineWidths),D=this.top+A,B=qi(s.align,B,this.right-G);else{let Q=this.columnSizes.reduce((dt,W)=>Math.max(dt,W.height),0);D=A+qi(s.align,this.top,this.bottom-Q-s.labels.padding-this._computeTitleHeight())}let rt=qi(w,B,B+G);x.textAlign=n.textAlign(Eh(w)),x.textBaseline="middle",x.strokeStyle=o.color,x.fillStyle=o.color,x.font=u.string,As(x,o.text,rt,D,u)}_computeTitleHeight(){let s=this.options.title,o=zi(s.font),u=Wi(s.padding);return s.display?o.lineHeight+u.height:0}_getLegendItemAt(s,o){let u,f,n;if(xr(s,this.left,this.right)&&xr(o,this.top,this.bottom)){for(n=this.legendHitBoxes,u=0;u<n.length;++u)if(f=n[u],xr(s,f.left,f.left+f.width)&&xr(o,f.top,f.top+f.height))return this.legendItems[u]}return null}handleEvent(s){let o=this.options;if(!L3(s.type,o))return;let u=this._getLegendItemAt(s.x,s.y);if(s.type==="mousemove"||s.type==="mouseout"){let f=this._hoveredItem,n=D3(f,u);f&&!n&&li(o.onLeave,[s,f,this],this),this._hoveredItem=u,u&&!n&&li(o.onHover,[s,u,this],this)}else u&&li(o.onClick,[s,u,this],this)}};function L3(l,s){return!!((l==="mousemove"||l==="mouseout")&&(s.onHover||s.onLeave)||s.onClick&&(l==="click"||l==="mouseup"))}var R3={id:"legend",_element:dp,start(l,s,o){let u=l.legend=new dp({ctx:l.ctx,options:o,chart:l});on.configure(l,u,o),on.addBox(l,u)},stop(l){on.removeBox(l,l.legend),delete l.legend},beforeUpdate(l,s,o){let u=l.legend;on.configure(l,u,o),u.options=o},afterUpdate(l){let s=l.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(l,s){s.replay||l.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(l,s,o){let u=s.datasetIndex,f=o.chart;f.isDatasetVisible(u)?(f.hide(u),s.hidden=!0):(f.show(u),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:l=>l.chart.options.color,boxWidth:40,padding:10,generateLabels(l){let s=l.data.datasets,{labels:{usePointStyle:o,pointStyle:u,textAlign:f,color:n}}=l.legend.options;return l._getSortedDatasetMetas().map(x=>{let w=x.controller.getStyle(o?0:void 0),E=Wi(w.borderWidth);return{text:s[x.index].label,fillStyle:w.backgroundColor,fontColor:n,hidden:!x.visible,lineCap:w.borderCapStyle,lineDash:w.borderDash,lineDashOffset:w.borderDashOffset,lineJoin:w.borderJoinStyle,lineWidth:(E.width+E.height)/4,strokeStyle:w.borderColor,pointStyle:u||w.pointStyle,rotation:w.rotation,textAlign:f||w.textAlign,borderRadius:0,datasetIndex:x.index}},this)}},title:{color:l=>l.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:l=>!l.startsWith("on"),labels:{_scriptable:l=>!["generateLabels","filter","sort"].includes(l)}}},jh=class extends Yn{constructor(s){super(),this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,o){let u=this.options;if(this.left=0,this.top=0,!u.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=s,this.height=this.bottom=o;let f=ai(u.text)?u.text.length:1;this._padding=Wi(u.padding);let n=f*zi(u.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=n:this.width=n}isHorizontal(){let s=this.options.position;return s==="top"||s==="bottom"}_drawArgs(s){let{top:o,left:u,bottom:f,right:n,options:x}=this,w=x.align,E=0,A,D,B;return this.isHorizontal()?(D=qi(w,u,n),B=o+s,A=n-u):(x.position==="left"?(D=u+s,B=qi(w,f,o),E=mi*-.5):(D=n-s,B=qi(w,o,f),E=mi*.5),A=f-o),{titleX:D,titleY:B,maxWidth:A,rotation:E}}draw(){let s=this.ctx,o=this.options;if(!o.display)return;let u=zi(o.font),n=u.lineHeight/2+this._padding.top,{titleX:x,titleY:w,maxWidth:E,rotation:A}=this._drawArgs(n);As(s,o.text,0,0,u,{color:o.color,maxWidth:E,rotation:A,textAlign:Eh(o.align),textBaseline:"middle",translation:[x,w]})}};function B3(l,s){let o=new jh({ctx:l.ctx,options:s,chart:l});on.configure(l,o,s),on.addBox(l,o),l.titleBlock=o}var F3={id:"title",_element:jh,start(l,s,o){B3(l,o)},stop(l){let s=l.titleBlock;on.removeBox(l,s),delete l.titleBlock},beforeUpdate(l,s,o){let u=l.titleBlock;on.configure(l,u,o),u.options=o},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},np=new WeakMap,O3={id:"subtitle",start(l,s,o){let u=new jh({ctx:l.ctx,options:o,chart:l});on.configure(l,u,o),on.addBox(l,u),np.set(l,u)},stop(l){on.removeBox(l,np.get(l)),np.delete(l)},beforeUpdate(l,s,o){let u=np.get(l);on.configure(l,u,o),u.options=o},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Vh={average(l){if(!l.length)return!1;let s,o,u=0,f=0,n=0;for(s=0,o=l.length;s<o;++s){let x=l[s].element;if(x&&x.hasValue()){let w=x.tooltipPosition();u+=w.x,f+=w.y,++n}}return{x:u/n,y:f/n}},nearest(l,s){if(!l.length)return!1;let o=s.x,u=s.y,f=Number.POSITIVE_INFINITY,n,x,w;for(n=0,x=l.length;n<x;++n){let E=l[n].element;if(E&&E.hasValue()){let A=E.getCenterPoint(),D=Sh(s,A);D<f&&(f=D,w=E)}}if(w){let E=w.tooltipPosition();o=E.x,u=E.y}return{x:o,y:u}}};function Xr(l,s){return s&&(ai(s)?Array.prototype.push.apply(l,s):l.push(s)),l}function Ps(l){return(typeof l=="string"||l instanceof String)&&l.indexOf(`
`)>-1?l.split(`
`):l}function V3(l,s){let{element:o,datasetIndex:u,index:f}=s,n=l.getDatasetMeta(u).controller,{label:x,value:w}=n.getLabelAndValue(f);return{chart:l,label:x,parsed:n.getParsed(f),raw:l.data.datasets[u].data[f],formattedValue:w,dataset:n.getDataset(),dataIndex:f,datasetIndex:u,element:o}}function zy(l,s){let o=l.chart.ctx,{body:u,footer:f,title:n}=l,{boxWidth:x,boxHeight:w}=s,E=zi(s.bodyFont),A=zi(s.titleFont),D=zi(s.footerFont),B=n.length,G=f.length,rt=u.length,Q=Wi(s.padding),dt=Q.height,W=0,et=u.reduce((_t,Mt)=>_t+Mt.before.length+Mt.lines.length+Mt.after.length,0);if(et+=l.beforeBody.length+l.afterBody.length,B&&(dt+=B*A.lineHeight+(B-1)*s.titleSpacing+s.titleMarginBottom),et){let _t=s.displayColors?Math.max(w,E.lineHeight):E.lineHeight;dt+=rt*_t+(et-rt)*E.lineHeight+(et-1)*s.bodySpacing}G&&(dt+=s.footerMarginTop+G*D.lineHeight+(G-1)*s.footerSpacing);let mt=0,St=function(_t){W=Math.max(W,o.measureText(_t).width+mt)};return o.save(),o.font=A.string,ei(l.title,St),o.font=E.string,ei(l.beforeBody.concat(l.afterBody),St),mt=s.displayColors?x+2+s.boxPadding:0,ei(u,_t=>{ei(_t.before,St),ei(_t.lines,St),ei(_t.after,St)}),mt=0,o.font=D.string,ei(l.footer,St),o.restore(),W+=Q.width,{width:W,height:dt}}function Z3(l,s){let{y:o,height:u}=s;return o<u/2?"top":o>l.height-u/2?"bottom":"center"}function U3(l,s,o,u){let{x:f,width:n}=u,x=o.caretSize+o.caretPadding;if(l==="left"&&f+n+x>s.width||l==="right"&&f-n-x<0)return!0}function N3(l,s,o,u){let{x:f,width:n}=o,{width:x,chartArea:{left:w,right:E}}=l,A="center";return u==="center"?A=f<=(w+E)/2?"left":"right":f<=n/2?A="left":f>=x-n/2&&(A="right"),U3(A,l,s,o)&&(A="center"),A}function Dy(l,s,o){let u=o.yAlign||s.yAlign||Z3(l,o);return{xAlign:o.xAlign||s.xAlign||N3(l,s,o,u),yAlign:u}}function j3(l,s){let{x:o,width:u}=l;return s==="right"?o-=u:s==="center"&&(o-=u/2),o}function G3(l,s,o){let{y:u,height:f}=l;return s==="top"?u+=o:s==="bottom"?u-=f+o:u-=f/2,u}function Ly(l,s,o,u){let{caretSize:f,caretPadding:n,cornerRadius:x}=l,{xAlign:w,yAlign:E}=o,A=f+n,{topLeft:D,topRight:B,bottomLeft:G,bottomRight:rt}=Cs(x),Q=j3(s,w),dt=G3(s,E,A);return E==="center"?w==="left"?Q+=A:w==="right"&&(Q-=A):w==="left"?Q-=Math.max(D,G)+f:w==="right"&&(Q+=Math.max(B,rt)+f),{x:Fi(Q,0,u.width-s.width),y:Fi(dt,0,u.height-s.height)}}function rp(l,s,o){let u=Wi(o.padding);return s==="center"?l.x+l.width/2:s==="right"?l.x+l.width-u.right:l.x+u.left}function Ry(l){return Xr([],Ps(l))}function $3(l,s,o){return Wr(l,{tooltip:s,tooltipItems:o,type:"tooltip"})}function By(l,s){let o=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return o?l.override(o):l}var Gh=class extends Yn{constructor(s){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=s.chart||s._chart,this._chart=this.chart,this.options=s.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(s){this.options=s,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let s=this._cachedAnimations;if(s)return s;let o=this.chart,u=this.options.setContext(this.getContext()),f=u.enabled&&o.options.animation&&u.animations,n=new ap(this.chart,f);return f._cacheable&&(this._cachedAnimations=Object.freeze(n)),n}getContext(){return this.$context||(this.$context=$3(this.chart.getContext(),this,this._tooltipItems))}getTitle(s,o){let{callbacks:u}=o,f=u.beforeTitle.apply(this,[s]),n=u.title.apply(this,[s]),x=u.afterTitle.apply(this,[s]),w=[];return w=Xr(w,Ps(f)),w=Xr(w,Ps(n)),w=Xr(w,Ps(x)),w}getBeforeBody(s,o){return Ry(o.callbacks.beforeBody.apply(this,[s]))}getBody(s,o){let{callbacks:u}=o,f=[];return ei(s,n=>{let x={before:[],lines:[],after:[]},w=By(u,n);Xr(x.before,Ps(w.beforeLabel.call(this,n))),Xr(x.lines,w.label.call(this,n)),Xr(x.after,Ps(w.afterLabel.call(this,n))),f.push(x)}),f}getAfterBody(s,o){return Ry(o.callbacks.afterBody.apply(this,[s]))}getFooter(s,o){let{callbacks:u}=o,f=u.beforeFooter.apply(this,[s]),n=u.footer.apply(this,[s]),x=u.afterFooter.apply(this,[s]),w=[];return w=Xr(w,Ps(f)),w=Xr(w,Ps(n)),w=Xr(w,Ps(x)),w}_createItems(s){let o=this._active,u=this.chart.data,f=[],n=[],x=[],w=[],E,A;for(E=0,A=o.length;E<A;++E)w.push(V3(this.chart,o[E]));return s.filter&&(w=w.filter((D,B,G)=>s.filter(D,B,G,u))),s.itemSort&&(w=w.sort((D,B)=>s.itemSort(D,B,u))),ei(w,D=>{let B=By(s.callbacks,D);f.push(B.labelColor.call(this,D)),n.push(B.labelPointStyle.call(this,D)),x.push(B.labelTextColor.call(this,D))}),this.labelColors=f,this.labelPointStyles=n,this.labelTextColors=x,this.dataPoints=w,w}update(s,o){let u=this.options.setContext(this.getContext()),f=this._active,n,x=[];if(!f.length)this.opacity!==0&&(n={opacity:0});else{let w=Vh[u.position].call(this,f,this._eventPosition);x=this._createItems(u),this.title=this.getTitle(x,u),this.beforeBody=this.getBeforeBody(x,u),this.body=this.getBody(x,u),this.afterBody=this.getAfterBody(x,u),this.footer=this.getFooter(x,u);let E=this._size=zy(this,u),A=Object.assign({},w,E),D=Dy(this.chart,u,A),B=Ly(u,A,D,this.chart);this.xAlign=D.xAlign,this.yAlign=D.yAlign,n={opacity:1,x:B.x,y:B.y,width:E.width,height:E.height,caretX:w.x,caretY:w.y}}this._tooltipItems=x,this.$context=void 0,n&&this._resolveAnimations().update(this,n),s&&u.external&&u.external.call(this,{chart:this.chart,tooltip:this,replay:o})}drawCaret(s,o,u,f){let n=this.getCaretPosition(s,u,f);o.lineTo(n.x1,n.y1),o.lineTo(n.x2,n.y2),o.lineTo(n.x3,n.y3)}getCaretPosition(s,o,u){let{xAlign:f,yAlign:n}=this,{caretSize:x,cornerRadius:w}=u,{topLeft:E,topRight:A,bottomLeft:D,bottomRight:B}=Cs(w),{x:G,y:rt}=s,{width:Q,height:dt}=o,W,et,mt,St,_t,Mt;return n==="center"?(_t=rt+dt/2,f==="left"?(W=G,et=W-x,St=_t+x,Mt=_t-x):(W=G+Q,et=W+x,St=_t-x,Mt=_t+x),mt=W):(f==="left"?et=G+Math.max(E,D)+x:f==="right"?et=G+Q-Math.max(A,B)-x:et=this.caretX,n==="top"?(St=rt,_t=St-x,W=et-x,mt=et+x):(St=rt+dt,_t=St+x,W=et+x,mt=et-x),Mt=St),{x1:W,x2:et,x3:mt,y1:St,y2:_t,y3:Mt}}drawTitle(s,o,u){let f=this.title,n=f.length,x,w,E;if(n){let A=bo(u.rtl,this.x,this.width);for(s.x=rp(this,u.titleAlign,u),o.textAlign=A.textAlign(u.titleAlign),o.textBaseline="middle",x=zi(u.titleFont),w=u.titleSpacing,o.fillStyle=u.titleColor,o.font=x.string,E=0;E<n;++E)o.fillText(f[E],A.x(s.x),s.y+x.lineHeight/2),s.y+=x.lineHeight+w,E+1===n&&(s.y+=u.titleMarginBottom-w)}}_drawColorBox(s,o,u,f,n){let x=this.labelColors[u],w=this.labelPointStyles[u],{boxHeight:E,boxWidth:A,boxPadding:D}=n,B=zi(n.bodyFont),G=rp(this,"left",n),rt=f.x(G),Q=E<B.lineHeight?(B.lineHeight-E)/2:0,dt=o.y+Q;if(n.usePointStyle){let W={radius:Math.min(A,E)/2,pointStyle:w.pointStyle,rotation:w.rotation,borderWidth:1},et=f.leftForLtr(rt,A)+A/2,mt=dt+E/2;s.strokeStyle=n.multiKeyBackground,s.fillStyle=n.multiKeyBackground,Vl(s,W,et,mt),s.strokeStyle=x.borderColor,s.fillStyle=x.backgroundColor,Vl(s,W,et,mt)}else{s.lineWidth=x.borderWidth||1,s.strokeStyle=x.borderColor,s.setLineDash(x.borderDash||[]),s.lineDashOffset=x.borderDashOffset||0;let W=f.leftForLtr(rt,A-D),et=f.leftForLtr(f.xPlus(rt,1),A-D-2),mt=Cs(x.borderRadius);Object.values(mt).some(St=>St!==0)?(s.beginPath(),s.fillStyle=n.multiKeyBackground,wa(s,{x:W,y:dt,w:A,h:E,radius:mt}),s.fill(),s.stroke(),s.fillStyle=x.backgroundColor,s.beginPath(),wa(s,{x:et,y:dt+1,w:A-2,h:E-2,radius:mt}),s.fill()):(s.fillStyle=n.multiKeyBackground,s.fillRect(W,dt,A,E),s.strokeRect(W,dt,A,E),s.fillStyle=x.backgroundColor,s.fillRect(et,dt+1,A-2,E-2))}s.fillStyle=this.labelTextColors[u]}drawBody(s,o,u){let{body:f}=this,{bodySpacing:n,bodyAlign:x,displayColors:w,boxHeight:E,boxWidth:A,boxPadding:D}=u,B=zi(u.bodyFont),G=B.lineHeight,rt=0,Q=bo(u.rtl,this.x,this.width),dt=function(Yt){o.fillText(Yt,Q.x(s.x+rt),s.y+G/2),s.y+=G+n},W=Q.textAlign(x),et,mt,St,_t,Mt,Rt,Vt;for(o.textAlign=x,o.textBaseline="middle",o.font=B.string,s.x=rp(this,W,u),o.fillStyle=u.bodyColor,ei(this.beforeBody,dt),rt=w&&W!=="right"?x==="center"?A/2+D:A+2+D:0,_t=0,Rt=f.length;_t<Rt;++_t){for(et=f[_t],mt=this.labelTextColors[_t],o.fillStyle=mt,ei(et.before,dt),St=et.lines,w&&St.length&&(this._drawColorBox(o,s,_t,Q,u),G=Math.max(B.lineHeight,E)),Mt=0,Vt=St.length;Mt<Vt;++Mt)dt(St[Mt]),G=B.lineHeight;ei(et.after,dt)}rt=0,G=B.lineHeight,ei(this.afterBody,dt),s.y-=n}drawFooter(s,o,u){let f=this.footer,n=f.length,x,w;if(n){let E=bo(u.rtl,this.x,this.width);for(s.x=rp(this,u.footerAlign,u),s.y+=u.footerMarginTop,o.textAlign=E.textAlign(u.footerAlign),o.textBaseline="middle",x=zi(u.footerFont),o.fillStyle=u.footerColor,o.font=x.string,w=0;w<n;++w)o.fillText(f[w],E.x(s.x),s.y+x.lineHeight/2),s.y+=x.lineHeight+u.footerSpacing}}drawBackground(s,o,u,f){let{xAlign:n,yAlign:x}=this,{x:w,y:E}=s,{width:A,height:D}=u,{topLeft:B,topRight:G,bottomLeft:rt,bottomRight:Q}=Cs(f.cornerRadius);o.fillStyle=f.backgroundColor,o.strokeStyle=f.borderColor,o.lineWidth=f.borderWidth,o.beginPath(),o.moveTo(w+B,E),x==="top"&&this.drawCaret(s,o,u,f),o.lineTo(w+A-G,E),o.quadraticCurveTo(w+A,E,w+A,E+G),x==="center"&&n==="right"&&this.drawCaret(s,o,u,f),o.lineTo(w+A,E+D-Q),o.quadraticCurveTo(w+A,E+D,w+A-Q,E+D),x==="bottom"&&this.drawCaret(s,o,u,f),o.lineTo(w+rt,E+D),o.quadraticCurveTo(w,E+D,w,E+D-rt),x==="center"&&n==="left"&&this.drawCaret(s,o,u,f),o.lineTo(w,E+B),o.quadraticCurveTo(w,E,w+B,E),o.closePath(),o.fill(),f.borderWidth>0&&o.stroke()}_updateAnimationTarget(s){let o=this.chart,u=this.$animations,f=u&&u.x,n=u&&u.y;if(f||n){let x=Vh[s.position].call(this,this._active,this._eventPosition);if(!x)return;let w=this._size=zy(this,s),E=Object.assign({},x,this._size),A=Dy(o,s,E),D=Ly(s,E,A,o);(f._to!==D.x||n._to!==D.y)&&(this.xAlign=A.xAlign,this.yAlign=A.yAlign,this.width=w.width,this.height=w.height,this.caretX=x.x,this.caretY=x.y,this._resolveAnimations().update(this,D))}}_willRender(){return!!this.opacity}draw(s){let o=this.options.setContext(this.getContext()),u=this.opacity;if(!u)return;this._updateAnimationTarget(o);let f={width:this.width,height:this.height},n={x:this.x,y:this.y};u=Math.abs(u)<.001?0:u;let x=Wi(o.padding),w=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;o.enabled&&w&&(s.save(),s.globalAlpha=u,this.drawBackground(n,s,f,o),Yd(s,o.textDirection),n.y+=x.top,this.drawTitle(n,s,o),this.drawBody(n,s,o),this.drawFooter(n,s,o),Kd(s,o.textDirection),s.restore())}getActiveElements(){return this._active||[]}setActiveElements(s,o){let u=this._active,f=s.map(({datasetIndex:w,index:E})=>{let A=this.chart.getDatasetMeta(w);if(!A)throw new Error("Cannot find a dataset at index "+w);return{datasetIndex:w,element:A.data[E],index:E}}),n=!Ol(u,f),x=this._positionChanged(f,o);(n||x)&&(this._active=f,this._eventPosition=o,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(s,o,u=!0){if(o&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let f=this.options,n=this._active||[],x=this._getActiveElements(s,n,o,u),w=this._positionChanged(x,s),E=o||!Ol(x,n)||w;return E&&(this._active=x,(f.enabled||f.external)&&(this._eventPosition={x:s.x,y:s.y},this.update(!0,o))),E}_getActiveElements(s,o,u,f){let n=this.options;if(s.type==="mouseout")return[];if(!f)return o;let x=this.chart.getElementsAtEventForMode(s,n.mode,n,u);return n.reverse&&x.reverse(),x}_positionChanged(s,o){let{caretX:u,caretY:f,options:n}=this,x=Vh[n.position].call(this,s,o);return x!==!1&&(u!==x.x||f!==x.y)}};Gh.positioners=Vh;var q3={id:"tooltip",_element:Gh,positioners:Vh,afterInit(l,s,o){o&&(l.tooltip=new Gh({chart:l,options:o}))},beforeUpdate(l,s,o){l.tooltip&&l.tooltip.initialize(o)},reset(l,s,o){l.tooltip&&l.tooltip.initialize(o)},afterDraw(l){let s=l.tooltip;if(s&&s._willRender()){let o={tooltip:s};if(l.notifyPlugins("beforeTooltipDraw",o)===!1)return;s.draw(l.ctx),l.notifyPlugins("afterTooltipDraw",o)}},afterEvent(l,s){if(l.tooltip){let o=s.replay;l.tooltip.handleEvent(s.event,o,s.inChartArea)&&(s.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(l,s)=>s.bodyFont.size,boxWidth:(l,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:yr,title(l){if(l.length>0){let s=l[0],o=s.chart.data.labels,u=o?o.length:0;if(this&&this.options&&this.options.mode==="dataset")return s.dataset.label||"";if(s.label)return s.label;if(u>0&&s.dataIndex<u)return o[s.dataIndex]}return""},afterTitle:yr,beforeBody:yr,beforeLabel:yr,label(l){if(this&&this.options&&this.options.mode==="dataset")return l.label+": "+l.formattedValue||l.formattedValue;let s=l.dataset.label||"";s&&(s+=": ");let o=l.formattedValue;return Xe(o)||(s+=o),s},labelColor(l){let o=l.chart.getDatasetMeta(l.datasetIndex).controller.getStyle(l.dataIndex);return{borderColor:o.borderColor,backgroundColor:o.backgroundColor,borderWidth:o.borderWidth,borderDash:o.borderDash,borderDashOffset:o.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(l){let o=l.chart.getDatasetMeta(l.datasetIndex).controller.getStyle(l.dataIndex);return{pointStyle:o.pointStyle,rotation:o.rotation}},afterLabel:yr,afterBody:yr,beforeFooter:yr,footer:yr,afterFooter:yr}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:l=>l!=="filter"&&l!=="itemSort"&&l!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},W3=Object.freeze({__proto__:null,Decimation:d3,Filler:z3,Legend:R3,SubTitle:O3,Title:F3,Tooltip:q3}),X3=(l,s,o,u)=>(typeof s=="string"?(o=l.push(s)-1,u.unshift({index:o,label:s})):isNaN(s)&&(o=null),o);function H3(l,s,o,u){let f=l.indexOf(s);if(f===-1)return X3(l,s,o,u);let n=l.lastIndexOf(s);return f!==n?o:f}var Y3=(l,s)=>l===null?null:Fi(Math.round(l),0,s),Jl=class extends Ds{constructor(s){super(s),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(s){let o=this._addedLabels;if(o.length){let u=this.getLabels();for(let{index:f,label:n}of o)u[f]===n&&u.splice(f,1);this._addedLabels=[]}super.init(s)}parse(s,o){if(Xe(s))return null;let u=this.getLabels();return o=isFinite(o)&&u[o]===s?o:H3(u,s,Pe(o,s),this._addedLabels),Y3(o,u.length-1)}determineDataLimits(){let{minDefined:s,maxDefined:o}=this.getUserBounds(),{min:u,max:f}=this.getMinMax(!0);this.options.bounds==="ticks"&&(s||(u=0),o||(f=this.getLabels().length-1)),this.min=u,this.max=f}buildTicks(){let s=this.min,o=this.max,u=this.options.offset,f=[],n=this.getLabels();n=s===0&&o===n.length-1?n:n.slice(s,o+1),this._valueRange=Math.max(n.length-(u?0:1),1),this._startValue=this.min-(u?.5:0);for(let x=s;x<=o;x++)f.push({value:x});return f}getLabelForValue(s){let o=this.getLabels();return s>=0&&s<o.length?o[s]:s}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(s){return typeof s!="number"&&(s=this.parse(s)),s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getPixelForTick(s){let o=this.ticks;return s<0||s>o.length-1?null:this.getPixelForValue(o[s].value)}getValueForPixel(s){return Math.round(this._startValue+this.getDecimalForPixel(s)*this._valueRange)}getBasePixel(){return this.bottom}};Jl.id="category";Jl.defaults={ticks:{callback:Jl.prototype.getLabelForValue}};function K3(l,s){let o=[],{bounds:f,step:n,min:x,max:w,precision:E,count:A,maxTicks:D,maxDigits:B,includeBounds:G}=l,rt=n||1,Q=D-1,{min:dt,max:W}=s,et=!Xe(x),mt=!Xe(w),St=!Xe(A),_t=(W-dt)/(B+1),Mt=Ld((W-dt)/Q/rt)*rt,Rt,Vt,Yt,jt;if(Mt<1e-14&&!et&&!mt)return[{value:dt},{value:W}];jt=Math.ceil(W/Mt)-Math.floor(dt/Mt),jt>Q&&(Mt=Ld(jt*Mt/Q/rt)*rt),Xe(E)||(Rt=Math.pow(10,E),Mt=Math.ceil(Mt*Rt)/Rt),f==="ticks"?(Vt=Math.floor(dt/Mt)*Mt,Yt=Math.ceil(W/Mt)*Mt):(Vt=dt,Yt=W),et&&mt&&n&&sm((w-x)/n,Mt/1e3)?(jt=Math.round(Math.min((w-x)/Mt,D)),Mt=(w-x)/jt,Vt=x,Yt=w):St?(Vt=et?x:Vt,Yt=mt?w:Yt,jt=A-1,Mt=(Yt-Vt)/jt):(jt=(Yt-Vt)/Mt,va(jt,Math.round(jt),Mt/1e3)?jt=Math.round(jt):jt=Math.ceil(jt));let ye=Math.max(Bd(Mt),Bd(Vt));Rt=Math.pow(10,Xe(E)?ye:E),Vt=Math.round(Vt*Rt)/Rt,Yt=Math.round(Yt*Rt)/Rt;let le=0;for(et&&(G&&Vt!==x?(o.push({value:x}),Vt<x&&le++,va(Math.round((Vt+le*Mt)*Rt)/Rt,x,Fy(x,_t,l))&&le++):Vt<x&&le++);le<jt;++le)o.push({value:Math.round((Vt+le*Mt)*Rt)/Rt});return mt&&G&&Yt!==w?o.length&&va(o[o.length-1].value,w,Fy(w,_t,l))?o[o.length-1].value=w:o.push({value:w}):(!mt||Yt===w)&&o.push({value:Yt}),o}function Fy(l,s,{horizontal:o,minRotation:u}){let f=Hn(u),n=(o?Math.sin(f):Math.cos(f))||.001,x=.75*s*(""+l).length;return Math.min(s/n,x)}var Ql=class extends Ds{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,o){return Xe(s)||(typeof s=="number"||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){let{beginAtZero:s}=this.options,{minDefined:o,maxDefined:u}=this.getUserBounds(),{min:f,max:n}=this,x=E=>f=o?f:E,w=E=>n=u?n:E;if(s){let E=sr(f),A=sr(n);E<0&&A<0?w(0):E>0&&A>0&&x(0)}if(f===n){let E=1;(n>=Number.MAX_SAFE_INTEGER||f<=Number.MIN_SAFE_INTEGER)&&(E=Math.abs(n*.05)),w(n+E),s||x(f-E)}this.min=f,this.max=n}getTickLimit(){let s=this.options.ticks,{maxTicksLimit:o,stepSize:u}=s,f;return u?(f=Math.ceil(this.max/u)-Math.floor(this.min/u)+1,f>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${u} would result generating up to ${f} ticks. Limiting to 1000.`),f=1e3)):(f=this.computeTickLimit(),o=o||11),o&&(f=Math.min(o,f)),f}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let s=this.options,o=s.ticks,u=this.getTickLimit();u=Math.max(2,u);let f={maxTicks:u,bounds:s.bounds,min:s.min,max:s.max,precision:o.precision,step:o.stepSize,count:o.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:o.minRotation||0,includeBounds:o.includeBounds!==!1},n=this._range||this,x=K3(f,n);return s.bounds==="ticks"&&Rd(x,this,"value"),s.reverse?(x.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),x}configure(){let s=this.ticks,o=this.min,u=this.max;if(super.configure(),this.options.offset&&s.length){let f=(u-o)/Math.max(s.length-1,1)/2;o-=f,u+=f}this._startValue=o,this._endValue=u,this._valueRange=u-o}getLabelForValue(s){return Sa(s,this.chart.options.locale,this.options.ticks.format)}},$h=class extends Ql{determineDataLimits(){let{min:s,max:o}=this.getMinMax(!0);this.min=Mi(s)?s:0,this.max=Mi(o)?o:1,this.handleTickRangeOptions()}computeTickLimit(){let s=this.isHorizontal(),o=s?this.width:this.height,u=Hn(this.options.ticks.minRotation),f=(s?Math.sin(u):Math.cos(u))||.001,n=this._resolveTickFontOptions(0);return Math.ceil(o/Math.min(40,n.lineHeight/f))}getPixelForValue(s){return s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}};$h.id="linear";$h.defaults={ticks:{callback:pp.formatters.numeric}};function Oy(l){return l/Math.pow(10,Math.floor(Bn(l)))===1}function J3(l,s){let o=Math.floor(Bn(s.max)),u=Math.ceil(s.max/Math.pow(10,o)),f=[],n=Rn(l.min,Math.pow(10,Math.floor(Bn(s.min)))),x=Math.floor(Bn(n)),w=Math.floor(n/Math.pow(10,x)),E=x<0?Math.pow(10,Math.abs(x)):1;do f.push({value:n,major:Oy(n)}),++w,w===10&&(w=1,++x,E=x>=0?1:E),n=Math.round(w*Math.pow(10,x)*E)/E;while(x<o||x===o&&w<u);let A=Rn(l.max,n);return f.push({value:A,major:Oy(n)}),f}var qh=class extends Ds{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(s,o){let u=Ql.prototype.parse.apply(this,[s,o]);if(u===0){this._zero=!0;return}return Mi(u)&&u>0?u:null}determineDataLimits(){let{min:s,max:o}=this.getMinMax(!0);this.min=Mi(s)?Math.max(0,s):null,this.max=Mi(o)?Math.max(0,o):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:s,maxDefined:o}=this.getUserBounds(),u=this.min,f=this.max,n=E=>u=s?u:E,x=E=>f=o?f:E,w=(E,A)=>Math.pow(10,Math.floor(Bn(E))+A);u===f&&(u<=0?(n(1),x(10)):(n(w(u,-1)),x(w(f,1)))),u<=0&&n(w(f,-1)),f<=0&&x(w(u,1)),this._zero&&this.min!==this._suggestedMin&&u===w(this.min,0)&&n(w(u,-1)),this.min=u,this.max=f}buildTicks(){let s=this.options,o={min:this._userMin,max:this._userMax},u=J3(o,this);return s.bounds==="ticks"&&Rd(u,this,"value"),s.reverse?(u.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),u}getLabelForValue(s){return s===void 0?"0":Sa(s,this.chart.options.locale,this.options.ticks.format)}configure(){let s=this.min;super.configure(),this._startValue=Bn(s),this._valueRange=Bn(this.max)-Bn(s)}getPixelForValue(s){return(s===void 0||s===0)&&(s=this.min),s===null||isNaN(s)?NaN:this.getPixelForDecimal(s===this.min?0:(Bn(s)-this._startValue)/this._valueRange)}getValueForPixel(s){let o=this.getDecimalForPixel(s);return Math.pow(10,this._startValue+o*this._valueRange)}};qh.id="logarithmic";qh.defaults={ticks:{callback:pp.formatters.logarithmic,major:{enabled:!0}}};function Wm(l){let s=l.ticks;if(s.display&&l.display){let o=Wi(s.backdropPadding);return Pe(s.font&&s.font.size,$e.font.size)+o.height}return 0}function Q3(l,s,o){return o=ai(o)?o:[o],{w:um(l,s.string,o),h:o.length*s.lineHeight}}function Vy(l,s,o,u,f){return l===u||l===f?{start:s-o/2,end:s+o/2}:l<u||l>f?{start:s-o,end:s}:{start:s,end:s+o}}function t5(l){let s={l:l.left+l._padding.left,r:l.right-l._padding.right,t:l.top+l._padding.top,b:l.bottom-l._padding.bottom},o=Object.assign({},s),u=[],f=[],n=l._pointLabels.length,x=l.options.pointLabels,w=x.centerPointLabels?mi/n:0;for(let E=0;E<n;E++){let A=x.setContext(l.getPointLabelContext(E));f[E]=A.padding;let D=l.getPointPosition(E,l.drawingArea+f[E],w),B=zi(A.font),G=Q3(l.ctx,B,l._pointLabels[E]);u[E]=G;let rt=yn(l.getIndexAngle(E)+w),Q=Math.round(Ah(rt)),dt=Vy(Q,D.x,G.w,0,180),W=Vy(Q,D.y,G.h,90,270);e5(o,s,rt,dt,W)}l.setCenterPoint(s.l-o.l,o.r-s.r,s.t-o.t,o.b-s.b),l._pointLabelItems=i5(l,u,f)}function e5(l,s,o,u,f){let n=Math.abs(Math.sin(o)),x=Math.abs(Math.cos(o)),w=0,E=0;u.start<s.l?(w=(s.l-u.start)/n,l.l=Math.min(l.l,s.l-w)):u.end>s.r&&(w=(u.end-s.r)/n,l.r=Math.max(l.r,s.r+w)),f.start<s.t?(E=(s.t-f.start)/x,l.t=Math.min(l.t,s.t-E)):f.end>s.b&&(E=(f.end-s.b)/x,l.b=Math.max(l.b,s.b+E))}function i5(l,s,o){let u=[],f=l._pointLabels.length,n=l.options,x=Wm(n)/2,w=l.drawingArea,E=n.pointLabels.centerPointLabels?mi/f:0;for(let A=0;A<f;A++){let D=l.getPointPosition(A,w+x+o[A],E),B=Math.round(Ah(yn(D.angle+bi))),G=s[A],rt=s5(D.y,G.h,B),Q=n5(B),dt=r5(D.x,G.w,Q);u.push({x:D.x,y:rt,textAlign:Q,left:dt,top:rt,right:dt+G.w,bottom:rt+G.h})}return u}function n5(l){return l===0||l===180?"center":l<180?"left":"right"}function r5(l,s,o){return o==="right"?l-=s:o==="center"&&(l-=s/2),l}function s5(l,s,o){return o===90||o===270?l-=s/2:(o>270||o<90)&&(l-=s),l}function o5(l,s){let{ctx:o,options:{pointLabels:u}}=l;for(let f=s-1;f>=0;f--){let n=u.setContext(l.getPointLabelContext(f)),x=zi(n.font),{x:w,y:E,textAlign:A,left:D,top:B,right:G,bottom:rt}=l._pointLabelItems[f],{backdropColor:Q}=n;if(!Xe(Q)){let dt=Cs(n.borderRadius),W=Wi(n.backdropPadding);o.fillStyle=Q;let et=D-W.left,mt=B-W.top,St=G-D+W.width,_t=rt-B+W.height;Object.values(dt).some(Mt=>Mt!==0)?(o.beginPath(),wa(o,{x:et,y:mt,w:St,h:_t,radius:dt}),o.fill()):o.fillRect(et,mt,St,_t)}As(o,l._pointLabels[f],w,E+x.lineHeight/2,x,{color:n.color,textAlign:A,textBaseline:"middle"})}}function l1(l,s,o,u){let{ctx:f}=l;if(o)f.arc(l.xCenter,l.yCenter,s,0,si);else{let n=l.getPointPosition(0,s);f.moveTo(n.x,n.y);for(let x=1;x<u;x++)n=l.getPointPosition(x,s),f.lineTo(n.x,n.y)}}function a5(l,s,o,u){let f=l.ctx,n=s.circular,{color:x,lineWidth:w}=s;!n&&!u||!x||!w||o<0||(f.save(),f.strokeStyle=x,f.lineWidth=w,f.setLineDash(s.borderDash),f.lineDashOffset=s.borderDashOffset,f.beginPath(),l1(l,o,n,u),f.closePath(),f.stroke(),f.restore())}function l5(l,s,o){return Wr(l,{label:o,index:s,type:"pointLabel"})}var Ca=class extends Ql{constructor(s){super(s),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let s=this._padding=Wi(Wm(this.options)/2),o=this.width=this.maxWidth-s.width,u=this.height=this.maxHeight-s.height;this.xCenter=Math.floor(this.left+o/2+s.left),this.yCenter=Math.floor(this.top+u/2+s.top),this.drawingArea=Math.floor(Math.min(o,u)/2)}determineDataLimits(){let{min:s,max:o}=this.getMinMax(!1);this.min=Mi(s)&&!isNaN(s)?s:0,this.max=Mi(o)&&!isNaN(o)?o:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Wm(this.options))}generateTickLabels(s){Ql.prototype.generateTickLabels.call(this,s),this._pointLabels=this.getLabels().map((o,u)=>{let f=li(this.options.pointLabels.callback,[o,u],this);return f||f===0?f:""}).filter((o,u)=>this.chart.getDataVisibility(u))}fit(){let s=this.options;s.display&&s.pointLabels.display?t5(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(s,o,u,f){this.xCenter+=Math.floor((s-o)/2),this.yCenter+=Math.floor((u-f)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(s,o,u,f))}getIndexAngle(s){let o=si/(this._pointLabels.length||1),u=this.options.startAngle||0;return yn(s*o+Hn(u))}getDistanceFromCenterForValue(s){if(Xe(s))return NaN;let o=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-s)*o:(s-this.min)*o}getValueForDistanceFromCenter(s){if(Xe(s))return NaN;let o=s/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-o:this.min+o}getPointLabelContext(s){let o=this._pointLabels||[];if(s>=0&&s<o.length){let u=o[s];return l5(this.getContext(),s,u)}}getPointPosition(s,o,u=0){let f=this.getIndexAngle(s)-bi+u;return{x:Math.cos(f)*o+this.xCenter,y:Math.sin(f)*o+this.yCenter,angle:f}}getPointPositionForValue(s,o){return this.getPointPosition(s,this.getDistanceFromCenterForValue(o))}getBasePosition(s){return this.getPointPositionForValue(s||0,this.getBaseValue())}getPointLabelPosition(s){let{left:o,top:u,right:f,bottom:n}=this._pointLabelItems[s];return{left:o,top:u,right:f,bottom:n}}drawBackground(){let{backgroundColor:s,grid:{circular:o}}=this.options;if(s){let u=this.ctx;u.save(),u.beginPath(),l1(this,this.getDistanceFromCenterForValue(this._endValue),o,this._pointLabels.length),u.closePath(),u.fillStyle=s,u.fill(),u.restore()}}drawGrid(){let s=this.ctx,o=this.options,{angleLines:u,grid:f}=o,n=this._pointLabels.length,x,w,E;if(o.pointLabels.display&&o5(this,n),f.display&&this.ticks.forEach((A,D)=>{if(D!==0){w=this.getDistanceFromCenterForValue(A.value);let B=f.setContext(this.getContext(D-1));a5(this,B,w,n)}}),u.display){for(s.save(),x=n-1;x>=0;x--){let A=u.setContext(this.getPointLabelContext(x)),{color:D,lineWidth:B}=A;!B||!D||(s.lineWidth=B,s.strokeStyle=D,s.setLineDash(A.borderDash),s.lineDashOffset=A.borderDashOffset,w=this.getDistanceFromCenterForValue(o.ticks.reverse?this.min:this.max),E=this.getPointPosition(x,w),s.beginPath(),s.moveTo(this.xCenter,this.yCenter),s.lineTo(E.x,E.y),s.stroke())}s.restore()}}drawBorder(){}drawLabels(){let s=this.ctx,o=this.options,u=o.ticks;if(!u.display)return;let f=this.getIndexAngle(0),n,x;s.save(),s.translate(this.xCenter,this.yCenter),s.rotate(f),s.textAlign="center",s.textBaseline="middle",this.ticks.forEach((w,E)=>{if(E===0&&!o.reverse)return;let A=u.setContext(this.getContext(E)),D=zi(A.font);if(n=this.getDistanceFromCenterForValue(this.ticks[E].value),A.showLabelBackdrop){s.font=D.string,x=s.measureText(w.label).width,s.fillStyle=A.backdropColor;let B=Wi(A.backdropPadding);s.fillRect(-x/2-B.left,-n-D.size/2-B.top,x+B.width,D.size+B.height)}As(s,w.label,0,-n,D,{color:A.color})}),s.restore()}drawTitle(){}};Ca.id="radialLinear";Ca.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:pp.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(l){return l},padding:5,centerPointLabels:!1}};Ca.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};Ca.descriptors={angleLines:{_fallback:"grid"}};var fp={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Fn=Object.keys(fp);function c5(l,s){return l-s}function Zy(l,s){if(Xe(s))return null;let o=l._adapter,{parser:u,round:f,isoWeekday:n}=l._parseOpts,x=s;return typeof u=="function"&&(x=u(x)),Mi(x)||(x=typeof u=="string"?o.parse(x,u):o.parse(x)),x===null?null:(f&&(x=f==="week"&&(xa(n)||n===!0)?o.startOf(x,"isoWeek",n):o.startOf(x,f)),+x)}function Uy(l,s,o,u){let f=Fn.length;for(let n=Fn.indexOf(l);n<f-1;++n){let x=fp[Fn[n]],w=x.steps?x.steps:Number.MAX_SAFE_INTEGER;if(x.common&&Math.ceil((o-s)/(w*x.size))<=u)return Fn[n]}return Fn[f-1]}function h5(l,s,o,u,f){for(let n=Fn.length-1;n>=Fn.indexOf(o);n--){let x=Fn[n];if(fp[x].common&&l._adapter.diff(f,u,x)>=s-1)return x}return Fn[o?Fn.indexOf(o):0]}function u5(l){for(let s=Fn.indexOf(l)+1,o=Fn.length;s<o;++s)if(fp[Fn[s]].common)return Fn[s]}function Ny(l,s,o){if(!o)l[s]=!0;else if(o.length){let{lo:u,hi:f}=kh(o,s),n=o[u]>=s?o[u]:o[f];l[n]=!0}}function d5(l,s,o,u){let f=l._adapter,n=+f.startOf(s[0].value,u),x=s[s.length-1].value,w,E;for(w=n;w<=x;w=+f.add(w,1,u))E=o[w],E>=0&&(s[E].major=!0);return s}function jy(l,s,o){let u=[],f={},n=s.length,x,w;for(x=0;x<n;++x)w=s[x],f[w]=x,u.push({value:w,major:!1});return n===0||!o?u:d5(l,u,f,o)}var Ia=class extends Ds{constructor(s){super(s),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(s,o){let u=s.time||(s.time={}),f=this._adapter=new Vb._date(s.adapters.date);ya(u.displayFormats,f.formats()),this._parseOpts={parser:u.parser,round:u.round,isoWeekday:u.isoWeekday},super.init(s),this._normalized=o.normalized}parse(s,o){return s===void 0?null:Zy(this,s)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let s=this.options,o=this._adapter,u=s.time.unit||"day",{min:f,max:n,minDefined:x,maxDefined:w}=this.getUserBounds();function E(A){!x&&!isNaN(A.min)&&(f=Math.min(f,A.min)),!w&&!isNaN(A.max)&&(n=Math.max(n,A.max))}(!x||!w)&&(E(this._getLabelBounds()),(s.bounds!=="ticks"||s.ticks.source!=="labels")&&E(this.getMinMax(!1))),f=Mi(f)&&!isNaN(f)?f:+o.startOf(Date.now(),u),n=Mi(n)&&!isNaN(n)?n:+o.endOf(Date.now(),u)+1,this.min=Math.min(f,n-1),this.max=Math.max(f+1,n)}_getLabelBounds(){let s=this.getLabelTimestamps(),o=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;return s.length&&(o=s[0],u=s[s.length-1]),{min:o,max:u}}buildTicks(){let s=this.options,o=s.time,u=s.ticks,f=u.source==="labels"?this.getLabelTimestamps():this._generate();s.bounds==="ticks"&&f.length&&(this.min=this._userMin||f[0],this.max=this._userMax||f[f.length-1]);let n=this.min,x=this.max,w=_m(f,n,x);return this._unit=o.unit||(u.autoSkip?Uy(o.minUnit,this.min,this.max,this._getLabelCapacity(n)):h5(this,w.length,o.minUnit,this.min,this.max)),this._majorUnit=!u.major.enabled||this._unit==="year"?void 0:u5(this._unit),this.initOffsets(f),s.reverse&&w.reverse(),jy(this,w,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(s=>+s.value))}initOffsets(s){let o=0,u=0,f,n;this.options.offset&&s.length&&(f=this.getDecimalForValue(s[0]),s.length===1?o=1-f:o=(this.getDecimalForValue(s[1])-f)/2,n=this.getDecimalForValue(s[s.length-1]),s.length===1?u=n:u=(n-this.getDecimalForValue(s[s.length-2]))/2);let x=s.length<3?.5:.25;o=Fi(o,0,x),u=Fi(u,0,x),this._offsets={start:o,end:u,factor:1/(o+1+u)}}_generate(){let s=this._adapter,o=this.min,u=this.max,f=this.options,n=f.time,x=n.unit||Uy(n.minUnit,o,u,this._getLabelCapacity(o)),w=Pe(n.stepSize,1),E=x==="week"?n.isoWeekday:!1,A=xa(E)||E===!0,D={},B=o,G,rt;if(A&&(B=+s.startOf(B,"isoWeek",E)),B=+s.startOf(B,A?"day":x),s.diff(u,o,x)>1e5*w)throw new Error(o+" and "+u+" are too far apart with stepSize of "+w+" "+x);let Q=f.ticks.source==="data"&&this.getDataTimestamps();for(G=B,rt=0;G<u;G=+s.add(G,w,x),rt++)Ny(D,G,Q);return(G===u||f.bounds==="ticks"||rt===1)&&Ny(D,G,Q),Object.keys(D).sort((dt,W)=>dt-W).map(dt=>+dt)}getLabelForValue(s){let o=this._adapter,u=this.options.time;return u.tooltipFormat?o.format(s,u.tooltipFormat):o.format(s,u.displayFormats.datetime)}_tickFormatFunction(s,o,u,f){let n=this.options,x=n.time.displayFormats,w=this._unit,E=this._majorUnit,A=w&&x[w],D=E&&x[E],B=u[o],G=E&&D&&B&&B.major,rt=this._adapter.format(s,f||(G?D:A)),Q=n.ticks.callback;return Q?li(Q,[rt,o,u],this):rt}generateTickLabels(s){let o,u,f;for(o=0,u=s.length;o<u;++o)f=s[o],f.label=this._tickFormatFunction(f.value,o,s)}getDecimalForValue(s){return s===null?NaN:(s-this.min)/(this.max-this.min)}getPixelForValue(s){let o=this._offsets,u=this.getDecimalForValue(s);return this.getPixelForDecimal((o.start+u)*o.factor)}getValueForPixel(s){let o=this._offsets,u=this.getDecimalForPixel(s)/o.factor-o.end;return this.min+u*(this.max-this.min)}_getLabelSize(s){let o=this.options.ticks,u=this.ctx.measureText(s).width,f=Hn(this.isHorizontal()?o.maxRotation:o.minRotation),n=Math.cos(f),x=Math.sin(f),w=this._resolveTickFontOptions(0).size;return{w:u*n+w*x,h:u*x+w*n}}_getLabelCapacity(s){let o=this.options.time,u=o.displayFormats,f=u[o.unit]||u.millisecond,n=this._tickFormatFunction(s,0,jy(this,[s],this._majorUnit),f),x=this._getLabelSize(n),w=Math.floor(this.isHorizontal()?this.width/x.w:this.height/x.h)-1;return w>0?w:1}getDataTimestamps(){let s=this._cache.data||[],o,u;if(s.length)return s;let f=this.getMatchingVisibleMetas();if(this._normalized&&f.length)return this._cache.data=f[0].controller.getAllParsedValues(this);for(o=0,u=f.length;o<u;++o)s=s.concat(f[o].controller.getAllParsedValues(this));return this._cache.data=this.normalize(s)}getLabelTimestamps(){let s=this._cache.labels||[],o,u;if(s.length)return s;let f=this.getLabels();for(o=0,u=f.length;o<u;++o)s.push(Zy(this,f[o]));return this._cache.labels=this._normalized?s:this.normalize(s)}normalize(s){return jd(s.sort(c5))}};Ia.id="time";Ia.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};function sp(l,s,o){let u=0,f=l.length-1,n,x,w,E;o?(s>=l[u].pos&&s<=l[f].pos&&({lo:u,hi:f}=vr(l,"pos",s)),{pos:n,time:w}=l[u],{pos:x,time:E}=l[f]):(s>=l[u].time&&s<=l[f].time&&({lo:u,hi:f}=vr(l,"time",s)),{time:n,pos:w}=l[u],{time:x,pos:E}=l[f]);let A=x-n;return A?w+(E-w)*(s-n)/A:w}var Wh=class extends Ia{constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let s=this._getTimestampsForTable(),o=this._table=this.buildLookupTable(s);this._minPos=sp(o,this.min),this._tableRange=sp(o,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){let{min:o,max:u}=this,f=[],n=[],x,w,E,A,D;for(x=0,w=s.length;x<w;++x)A=s[x],A>=o&&A<=u&&f.push(A);if(f.length<2)return[{time:o,pos:0},{time:u,pos:1}];for(x=0,w=f.length;x<w;++x)D=f[x+1],E=f[x-1],A=f[x],Math.round((D+E)/2)!==A&&n.push({time:A,pos:x/(w-1)});return n}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;let o=this.getDataTimestamps(),u=this.getLabelTimestamps();return o.length&&u.length?s=this.normalize(o.concat(u)):s=o.length?o:u,s=this._cache.all=s,s}getDecimalForValue(s){return(sp(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){let o=this._offsets,u=this.getDecimalForPixel(s)/o.factor-o.end;return sp(this._table,u*this._tableRange+this._minPos,!0)}};Wh.id="timeseries";Wh.defaults=Ia.defaults;var p5=Object.freeze({__proto__:null,CategoryScale:Jl,LinearScale:$h,LogarithmicScale:qh,RadialLinearScale:Ca,TimeScale:Ia,TimeSeriesScale:Wh}),c1=[Ob,l3,W3,p5];Aa.register(...c1);var h1=Aa;var wp=x0(d1());var xn=63710088e-1,p1={centimeters:xn*100,centimetres:xn*100,degrees:xn/111325,feet:xn*3.28084,inches:xn*39.37,kilometers:xn/1e3,kilometres:xn/1e3,meters:xn,metres:xn,miles:xn/1609.344,millimeters:xn*1e3,millimetres:xn*1e3,nauticalmiles:xn/1852,radians:1,yards:xn*1.0936},e6={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/xn,yards:1.0936133};function Eo(l,s,o){o===void 0&&(o={});var u={type:"Feature"};return(o.id===0||o.id)&&(u.id=o.id),o.bbox&&(u.bbox=o.bbox),u.properties=s||{},u.geometry=l,u}function br(l,s,o){if(o===void 0&&(o={}),!l)throw new Error("coordinates is required");if(!Array.isArray(l))throw new Error("coordinates must be an Array");if(l.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Km(l[0])||!Km(l[1]))throw new Error("coordinates must contain numbers");var u={type:"Point",coordinates:l};return Eo(u,s,o)}function Mo(l,s,o){if(o===void 0&&(o={}),l.length<2)throw new Error("coordinates must be an array of two or more positions");var u={type:"LineString",coordinates:l};return Eo(u,s,o)}function Hh(l,s){s===void 0&&(s={});var o={type:"FeatureCollection"};return s.id&&(o.id=s.id),s.bbox&&(o.bbox=s.bbox),o.features=l,o}function f1(l,s){s===void 0&&(s="kilometers");var o=p1[s];if(!o)throw new Error(s+" units is invalid");return l*o}function m1(l,s){s===void 0&&(s="kilometers");var o=p1[s];if(!o)throw new Error(s+" units is invalid");return l/o}function Yh(l){var s=l%(2*Math.PI);return s*180/Math.PI}function On(l){var s=l%360;return s*Math.PI/180}function Km(l){return!isNaN(l)&&l!==null&&!Array.isArray(l)}function Ao(l){if(!l)throw new Error("coord is required");if(!Array.isArray(l)){if(l.type==="Feature"&&l.geometry!==null&&l.geometry.type==="Point")return l.geometry.coordinates;if(l.type==="Point")return l.coordinates}if(Array.isArray(l)&&l.length>=2&&!Array.isArray(l[0])&&!Array.isArray(l[1]))return l;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ls(l){if(Array.isArray(l))return l;if(l.type==="Feature"){if(l.geometry!==null)return l.geometry.coordinates}else if(l.coordinates)return l.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function mp(l,s,o){if(o===void 0&&(o={}),o.final===!0)return f5(l,s);var u=Ao(l),f=Ao(s),n=On(u[0]),x=On(f[0]),w=On(u[1]),E=On(f[1]),A=Math.sin(x-n)*Math.cos(E),D=Math.cos(w)*Math.sin(E)-Math.sin(w)*Math.cos(E)*Math.cos(x-n);return Yh(Math.atan2(A,D))}function f5(l,s){var o=mp(s,l);return o=(o+180)%360,o}function m5(l,s,o){o===void 0&&(o={});var u=Ao(l),f=Ao(s),n=On(f[1]-u[1]),x=On(f[0]-u[0]),w=On(u[1]),E=On(f[1]),A=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(x/2),2)*Math.cos(w)*Math.cos(E);return f1(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)),o.units)}var tc=m5;function _p(l,s,o,u){u===void 0&&(u={});var f=Ao(l),n=On(f[0]),x=On(f[1]),w=On(o),E=m1(s,u.units),A=Math.asin(Math.sin(x)*Math.cos(E)+Math.cos(x)*Math.sin(E)*Math.cos(w)),D=n+Math.atan2(Math.sin(w)*Math.sin(E)*Math.cos(x),Math.cos(E)-Math.sin(x)*Math.sin(A)),B=Yh(D),G=Yh(A);return br([B,G],u.properties)}function Jm(l,s){if(l.type==="Feature")s(l,0);else if(l.type==="FeatureCollection")for(var o=0;o<l.features.length&&s(l.features[o],o)!==!1;o++);}function _5(l,s){var o,u,f,n,x,w,E,A,D,B,G=0,rt=l.type==="FeatureCollection",Q=l.type==="Feature",dt=rt?l.features.length:1;for(o=0;o<dt;o++){for(w=rt?l.features[o].geometry:Q?l.geometry:l,A=rt?l.features[o].properties:Q?l.properties:{},D=rt?l.features[o].bbox:Q?l.bbox:void 0,B=rt?l.features[o].id:Q?l.id:void 0,E=w?w.type==="GeometryCollection":!1,x=E?w.geometries.length:1,f=0;f<x;f++){if(n=E?w.geometries[f]:w,n===null){if(s(null,G,A,D,B)===!1)return!1;continue}switch(n.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(s(n,G,A,D,B)===!1)return!1;break}case"GeometryCollection":{for(u=0;u<n.geometries.length;u++)if(s(n.geometries[u],G,A,D,B)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}G++}}function gp(l,s){_5(l,function(o,u,f,n,x){var w=o===null?null:o.type;switch(w){case null:case"Point":case"LineString":case"Polygon":return s(Eo(o,f,{bbox:n,id:x}),u,0)===!1?!1:void 0}var E;switch(w){case"MultiPoint":E="Point";break;case"MultiLineString":E="LineString";break;case"MultiPolygon":E="Polygon";break}for(var A=0;A<o.coordinates.length;A++){var D=o.coordinates[A],B={type:E,coordinates:D};if(s(Eo(B,f),u,A)===!1)return!1}})}function g5(l){if(!l)throw new Error("geojson is required");var s=[];return gp(l,function(o){y5(o,s)}),Hh(s)}function y5(l,s){var o=[],u=l.geometry;if(u!==null){switch(u.type){case"Polygon":o=Ls(u);break;case"LineString":o=[Ls(u)]}o.forEach(function(f){var n=x5(f,l.properties);n.forEach(function(x){x.id=s.length,s.push(x)})})}}function x5(l,s){var o=[];return l.reduce(function(u,f){var n=Mo([u,f],s);return n.bbox=v5(u,f),o.push(n),f}),o}function v5(l,s){var o=l[0],u=l[1],f=s[0],n=s[1],x=o<f?o:f,w=u<n?u:n,E=o>f?o:f,A=u>n?u:n;return[x,w,E,A]}var Qm=g5;var D1=x0(P1(),1);function W5(l,s){var o={},u=[];if(l.type==="LineString"&&(l=Eo(l)),s.type==="LineString"&&(s=Eo(s)),l.type==="Feature"&&s.type==="Feature"&&l.geometry!==null&&s.geometry!==null&&l.geometry.type==="LineString"&&s.geometry.type==="LineString"&&l.geometry.coordinates.length===2&&s.geometry.coordinates.length===2){var f=z1(l,s);return f&&u.push(f),Hh(u)}var n=(0,D1.default)();return n.load(Qm(s)),Jm(Qm(l),function(x){Jm(n.search(x),function(w){var E=z1(x,w);if(E){var A=Ls(E).join(",");o[A]||(o[A]=!0,u.push(E))}})}),Hh(u)}function z1(l,s){var o=Ls(l),u=Ls(s);if(o.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(u.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var f=o[0][0],n=o[0][1],x=o[1][0],w=o[1][1],E=u[0][0],A=u[0][1],D=u[1][0],B=u[1][1],G=(B-A)*(x-f)-(D-E)*(w-n),rt=(D-E)*(n-A)-(B-A)*(f-E),Q=(x-f)*(n-A)-(w-n)*(f-E);if(G===0)return rt===0&&Q===0,null;var dt=rt/G,W=Q/G;if(dt>=0&&dt<=1&&W>=0&&W<=1){var et=f+dt*(x-f),mt=n+dt*(w-n);return br([et,mt])}return null}var L1=W5;function X5(l,s,o){o===void 0&&(o={});var u=br([1/0,1/0],{dist:1/0}),f=0;return gp(l,function(n){for(var x=Ls(n),w=0;w<x.length-1;w++){var E=br(x[w]);E.properties.dist=tc(s,E,o);var A=br(x[w+1]);A.properties.dist=tc(s,A,o);var D=tc(E,A,o),B=Math.max(E.properties.dist,A.properties.dist),G=mp(E,A),rt=_p(s,B,G+90,o),Q=_p(s,B,G-90,o),dt=L1(Mo([rt.geometry.coordinates,Q.geometry.coordinates]),Mo([E.geometry.coordinates,A.geometry.coordinates])),W=null;dt.features.length>0&&(W=dt.features[0],W.properties.dist=tc(s,W,o),W.properties.location=f+tc(E,W,o)),E.properties.dist<u.properties.dist&&(u=E,u.properties.index=w,u.properties.location=f),A.properties.dist<u.properties.dist&&(u=A,u.properties.index=w+1,u.properties.location=f+D),W&&W.properties.dist<u.properties.dist&&(u=W,u.properties.index=w),f+=D}}),u}var R1=X5;var d_={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Highland Perthshire Gravel Trails Dunkeld Lochs Loop",time:"2020-03-31T07:59:28.367Z",coordTimes:["2020-03-31T07:59:28.367Z","2020-03-31T07:59:31.963Z","2020-03-31T07:59:39.939Z","2020-03-31T07:59:44.841Z","2020-03-31T07:59:44.881Z","2020-03-31T07:59:47.008Z","2020-03-31T07:59:48.524Z","2020-03-31T07:59:48.536Z","2020-03-31T07:59:48.646Z","2020-03-31T07:59:48.646Z","2020-03-31T08:00:13.315Z","2020-03-31T08:00:16.700Z","2020-03-31T08:00:20.216Z","2020-03-31T08:00:30.842Z","2020-03-31T08:00:51.098Z","2020-03-31T08:00:53.238Z","2020-03-31T08:01:29.317Z","2020-03-31T08:02:03.622Z","2020-03-31T08:02:06.322Z","2020-03-31T08:02:20.686Z","2020-03-31T08:02:32.192Z","2020-03-31T08:03:45.744Z","2020-03-31T08:03:54.165Z","2020-03-31T08:05:02.055Z","2020-03-31T08:06:33.452Z","2020-03-31T08:07:09.929Z","2020-03-31T08:07:35.355Z","2020-03-31T08:08:34.463Z","2020-03-31T08:09:32.435Z","2020-03-31T08:10:26.430Z","2020-03-31T08:11:10.592Z","2020-03-31T08:11:40.159Z","2020-03-31T08:11:54.220Z","2020-03-31T08:12:46.971Z","2020-03-31T08:13:14.612Z","2020-03-31T08:13:29.326Z","2020-03-31T08:14:17.168Z","2020-03-31T08:14:29.961Z","2020-03-31T08:15:12.702Z","2020-03-31T08:15:25.609Z","2020-03-31T08:15:29.262Z","2020-03-31T08:15:37.701Z","2020-03-31T08:15:48.604Z","2020-03-31T08:15:52.567Z","2020-03-31T08:15:59.881Z","2020-03-31T08:16:06.346Z","2020-03-31T08:16:11.002Z","2020-03-31T08:16:14.964Z","2020-03-31T08:16:20.933Z","2020-03-31T08:16:23.414Z","2020-03-31T08:16:43.151Z","2020-03-31T08:16:47.905Z","2020-03-31T08:17:07.817Z","2020-03-31T08:17:15.149Z","2020-03-31T08:17:26.891Z","2020-03-31T08:17:46.119Z","2020-03-31T08:17:57.057Z","2020-03-31T08:18:22.628Z","2020-03-31T08:18:32.770Z","2020-03-31T08:18:54.387Z","2020-03-31T08:19:25.524Z","2020-03-31T08:20:46.366Z","2020-03-31T08:21:13.662Z","2020-03-31T08:21:37.542Z","2020-03-31T08:21:56.562Z","2020-03-31T08:22:29.934Z","2020-03-31T08:22:44.622Z","2020-03-31T08:22:57.959Z","2020-03-31T08:22:58.175Z","2020-03-31T08:23:07.790Z","2020-03-31T08:23:21.689Z","2020-03-31T08:23:25.430Z","2020-03-31T08:23:25.439Z","2020-03-31T08:23:28.184Z","2020-03-31T08:23:32.682Z","2020-03-31T08:23:35.766Z","2020-03-31T08:24:17.510Z","2020-03-31T08:24:51.279Z","2020-03-31T08:25:12.669Z","2020-03-31T08:25:39.209Z","2020-03-31T08:26:00.725Z","2020-03-31T08:26:30.077Z","2020-03-31T08:27:10.798Z","2020-03-31T08:28:16.721Z","2020-03-31T08:29:05.326Z","2020-03-31T08:30:24.177Z","2020-03-31T08:32:27.763Z","2020-03-31T08:36:09.815Z","2020-03-31T08:36:21.301Z","2020-03-31T08:37:03.774Z","2020-03-31T08:37:12.035Z","2020-03-31T08:37:40.851Z","2020-03-31T08:37:53.815Z","2020-03-31T08:38:22.216Z","2020-03-31T08:38:53.043Z","2020-03-31T08:38:59.900Z","2020-03-31T08:39:15.749Z","2020-03-31T08:39:27.790Z","2020-03-31T08:39:52.796Z","2020-03-31T08:40:28.097Z","2020-03-31T08:40:47.136Z","2020-03-31T08:41:26.198Z","2020-03-31T08:41:53.883Z","2020-03-31T08:42:31.844Z","2020-03-31T08:43:05.989Z","2020-03-31T08:43:36.726Z","2020-03-31T08:44:04.260Z","2020-03-31T08:45:22.524Z","2020-03-31T08:45:41.483Z","2020-03-31T08:45:52.743Z","2020-03-31T08:46:08.171Z","2020-03-31T08:46:27.187Z","2020-03-31T08:46:47.478Z","2020-03-31T08:47:00.695Z","2020-03-31T08:47:15.932Z","2020-03-31T08:47:49.796Z","2020-03-31T08:47:52.673Z","2020-03-31T08:47:55.824Z","2020-03-31T08:48:17.653Z","2020-03-31T08:48:31.762Z","2020-03-31T08:49:11.637Z","2020-03-31T08:49:26.583Z","2020-03-31T08:50:10.787Z","2020-03-31T08:50:39.068Z","2020-03-31T08:51:19.472Z","2020-03-31T08:51:38.979Z","2020-03-31T08:51:54.737Z","2020-03-31T08:52:35.043Z","2020-03-31T08:53:29.196Z","2020-03-31T08:53:38.350Z","2020-03-31T08:53:52.195Z","2020-03-31T08:54:22.484Z","2020-03-31T08:54:48.950Z","2020-03-31T08:55:02.076Z","2020-03-31T08:55:32.456Z","2020-03-31T08:55:54.673Z","2020-03-31T08:56:57.916Z","2020-03-31T08:57:05.869Z","2020-03-31T08:57:13.560Z","2020-03-31T08:57:19.963Z","2020-03-31T08:57:24.027Z","2020-03-31T08:57:42.555Z","2020-03-31T08:57:47.519Z","2020-03-31T08:57:56.657Z","2020-03-31T08:58:00.689Z","2020-03-31T08:58:06.742Z","2020-03-31T08:58:14.458Z","2020-03-31T08:58:17.967Z","2020-03-31T08:58:19.528Z","2020-03-31T08:58:31.267Z","2020-03-31T08:58:48.177Z","2020-03-31T08:59:22.308Z","2020-03-31T08:59:32.918Z","2020-03-31T08:59:51.484Z","2020-03-31T08:59:56.168Z","2020-03-31T09:00:16.983Z","2020-03-31T09:00:44.632Z","2020-03-31T09:00:48.134Z","2020-03-31T09:00:59.711Z","2020-03-31T09:01:05.426Z","2020-03-31T09:01:19.165Z","2020-03-31T09:01:30.382Z","2020-03-31T09:01:48.774Z","2020-03-31T09:02:05.146Z","2020-03-31T09:02:09.940Z","2020-03-31T09:02:21.443Z","2020-03-31T09:02:27.974Z","2020-03-31T09:02:36.693Z","2020-03-31T09:02:43.964Z","2020-03-31T09:02:57.515Z","2020-03-31T09:03:03.170Z","2020-03-31T09:03:05.025Z","2020-03-31T09:03:06.545Z","2020-03-31T09:03:08.923Z","2020-03-31T09:03:15.755Z","2020-03-31T09:03:17.256Z","2020-03-31T09:03:22.460Z","2020-03-31T09:03:59.929Z","2020-03-31T09:04:53.927Z","2020-03-31T09:04:57.814Z","2020-03-31T09:05:09.141Z","2020-03-31T09:05:18.820Z","2020-03-31T09:05:24.370Z","2020-03-31T09:06:18.661Z","2020-03-31T09:07:11.809Z","2020-03-31T09:07:21.098Z","2020-03-31T09:07:32.196Z","2020-03-31T09:07:47.536Z","2020-03-31T09:08:02.793Z","2020-03-31T09:08:53.079Z","2020-03-31T09:09:03.250Z","2020-03-31T09:09:13.579Z","2020-03-31T09:09:43.898Z","2020-03-31T09:09:47.476Z","2020-03-31T09:09:50.053Z","2020-03-31T09:09:55.805Z","2020-03-31T09:10:02.256Z","2020-03-31T09:10:16.370Z","2020-03-31T09:10:24.609Z","2020-03-31T09:10:29.778Z","2020-03-31T09:10:43.034Z","2020-03-31T09:10:43.577Z","2020-03-31T09:10:48.801Z","2020-03-31T09:11:01.081Z","2020-03-31T09:11:18.059Z","2020-03-31T09:11:24.758Z","2020-03-31T09:11:30.627Z","2020-03-31T09:11:41.034Z","2020-03-31T09:11:50.537Z","2020-03-31T09:11:57.695Z","2020-03-31T09:12:26.961Z","2020-03-31T09:12:58.060Z","2020-03-31T09:13:12.130Z","2020-03-31T09:13:28.367Z","2020-03-31T09:13:42.377Z","2020-03-31T09:13:52.354Z","2020-03-31T09:14:02.135Z","2020-03-31T09:14:08.374Z","2020-03-31T09:14:16.002Z","2020-03-31T09:14:47.315Z","2020-03-31T09:14:59.062Z","2020-03-31T09:15:04.520Z","2020-03-31T09:15:55.732Z","2020-03-31T09:16:33.301Z","2020-03-31T09:16:47.860Z","2020-03-31T09:16:55.764Z","2020-03-31T09:17:03.346Z","2020-03-31T09:17:43.576Z","2020-03-31T09:18:10.334Z","2020-03-31T09:18:21.801Z","2020-03-31T09:18:40.836Z","2020-03-31T09:19:25.166Z","2020-03-31T09:19:49.424Z","2020-03-31T09:20:11.923Z","2020-03-31T09:20:21.691Z","2020-03-31T09:20:50.654Z","2020-03-31T09:21:36.716Z","2020-03-31T09:22:02.775Z","2020-03-31T09:22:18.049Z","2020-03-31T09:22:43.488Z","2020-03-31T09:22:49.667Z","2020-03-31T09:22:56.145Z","2020-03-31T09:23:15.662Z","2020-03-31T09:23:30.923Z","2020-03-31T09:23:34.010Z","2020-03-31T09:23:41.962Z","2020-03-31T09:23:51.510Z","2020-03-31T09:24:00.968Z","2020-03-31T09:24:04.368Z","2020-03-31T09:24:08.041Z","2020-03-31T09:24:28.171Z","2020-03-31T09:24:34.389Z","2020-03-31T09:24:44.862Z","2020-03-31T09:25:00.914Z","2020-03-31T09:25:35.055Z","2020-03-31T09:26:16.665Z","2020-03-31T09:26:36.225Z","2020-03-31T09:26:46.961Z","2020-03-31T09:26:55.776Z","2020-03-31T09:27:08.180Z","2020-03-31T09:27:13.198Z","2020-03-31T09:27:18.627Z","2020-03-31T09:27:32.535Z","2020-03-31T09:27:49.928Z","2020-03-31T09:28:15.966Z","2020-03-31T09:28:33.040Z","2020-03-31T09:28:48.642Z","2020-03-31T09:28:57.607Z","2020-03-31T09:29:03.505Z","2020-03-31T09:29:18.680Z","2020-03-31T09:29:28.237Z","2020-03-31T09:29:39.090Z","2020-03-31T09:29:55.969Z","2020-03-31T09:30:04.172Z","2020-03-31T09:30:17.918Z","2020-03-31T09:30:35.445Z","2020-03-31T09:30:44.651Z","2020-03-31T09:31:02.472Z","2020-03-31T09:31:09.097Z","2020-03-31T09:31:20.181Z","2020-03-31T09:31:30.951Z","2020-03-31T09:31:50.255Z","2020-03-31T09:31:56.247Z","2020-03-31T09:32:05.125Z","2020-03-31T09:32:10.753Z","2020-03-31T09:32:39.512Z","2020-03-31T09:32:54.318Z","2020-03-31T09:33:06.724Z","2020-03-31T09:33:11.778Z","2020-03-31T09:33:16.725Z","2020-03-31T09:33:26.737Z","2020-03-31T09:33:30.434Z","2020-03-31T09:33:44.776Z","2020-03-31T09:33:49.454Z","2020-03-31T09:33:56.505Z","2020-03-31T09:33:57.556Z","2020-03-31T09:33:58.489Z","2020-03-31T09:34:19.622Z","2020-03-31T09:34:59.540Z","2020-03-31T09:35:21.689Z","2020-03-31T09:35:22.948Z","2020-03-31T09:35:24.295Z","2020-03-31T09:35:30.308Z","2020-03-31T09:35:31.095Z","2020-03-31T09:35:32.643Z","2020-03-31T09:35:39.739Z","2020-03-31T09:35:57.830Z","2020-03-31T09:36:08.950Z","2020-03-31T09:36:17.177Z","2020-03-31T09:36:27.788Z","2020-03-31T09:36:44.575Z","2020-03-31T09:36:49.443Z","2020-03-31T09:37:00.120Z","2020-03-31T09:37:10.733Z","2020-03-31T09:37:39.507Z","2020-03-31T09:38:03.423Z","2020-03-31T09:38:27.194Z","2020-03-31T09:38:29.303Z","2020-03-31T09:38:29.303Z","2020-03-31T09:38:29.304Z","2020-03-31T09:38:31.648Z","2020-03-31T09:38:42.557Z","2020-03-31T09:38:50.217Z","2020-03-31T09:39:06.653Z","2020-03-31T09:39:08.896Z","2020-03-31T09:39:51.058Z","2020-03-31T09:40:16.198Z","2020-03-31T09:40:25.627Z","2020-03-31T09:41:04.379Z","2020-03-31T09:41:18.912Z","2020-03-31T09:41:27.161Z","2020-03-31T09:41:30.394Z","2020-03-31T09:41:31.724Z","2020-03-31T09:42:05.802Z","2020-03-31T09:42:11.118Z","2020-03-31T09:42:21.979Z","2020-03-31T09:42:35.299Z","2020-03-31T09:42:39.196Z","2020-03-31T09:42:43.658Z","2020-03-31T09:42:55.841Z","2020-03-31T09:42:57.796Z","2020-03-31T09:43:00.619Z","2020-03-31T09:43:04.054Z","2020-03-31T09:43:08.245Z","2020-03-31T09:43:17.407Z","2020-03-31T09:43:22.839Z","2020-03-31T09:43:29.779Z","2020-03-31T09:43:41.307Z","2020-03-31T09:43:48.587Z","2020-03-31T09:43:56.019Z","2020-03-31T09:44:12.240Z","2020-03-31T09:44:27.314Z","2020-03-31T09:44:54.674Z","2020-03-31T09:44:58.707Z","2020-03-31T09:45:01.439Z","2020-03-31T09:45:11.560Z","2020-03-31T09:45:22.108Z","2020-03-31T09:45:28.040Z","2020-03-31T09:45:39.500Z","2020-03-31T09:45:46.056Z","2020-03-31T09:45:53.573Z","2020-03-31T09:46:08.220Z","2020-03-31T09:46:32.625Z","2020-03-31T09:46:37.408Z","2020-03-31T09:46:40.609Z","2020-03-31T09:46:45.355Z","2020-03-31T09:46:49.445Z","2020-03-31T09:46:57.305Z","2020-03-31T09:47:06.645Z","2020-03-31T09:47:14.274Z","2020-03-31T09:47:29.900Z","2020-03-31T09:47:35.727Z","2020-03-31T09:47:47.233Z","2020-03-31T09:47:57.775Z","2020-03-31T09:48:12.915Z","2020-03-31T09:48:26.709Z","2020-03-31T09:48:37.210Z","2020-03-31T09:48:42.035Z","2020-03-31T09:48:45.424Z","2020-03-31T09:48:46.843Z","2020-03-31T09:48:47.354Z","2020-03-31T09:49:12.696Z","2020-03-31T09:49:15.276Z","2020-03-31T09:49:28.494Z","2020-03-31T09:49:52.490Z","2020-03-31T09:49:54.078Z","2020-03-31T09:49:55.389Z","2020-03-31T09:50:03.953Z","2020-03-31T09:50:10.724Z","2020-03-31T09:50:17.043Z","2020-03-31T09:50:25.106Z","2020-03-31T09:50:27.669Z","2020-03-31T09:50:37.527Z","2020-03-31T09:50:46.173Z","2020-03-31T09:50:48.137Z","2020-03-31T09:50:52.725Z","2020-03-31T09:51:03.971Z","2020-03-31T09:51:15.389Z","2020-03-31T09:51:30.327Z","2020-03-31T09:51:39.244Z","2020-03-31T09:51:42.465Z","2020-03-31T09:51:45.038Z","2020-03-31T09:51:53.940Z","2020-03-31T09:51:58.152Z","2020-03-31T09:52:09.929Z","2020-03-31T09:52:23.818Z","2020-03-31T09:52:40.000Z","2020-03-31T09:52:47.204Z","2020-03-31T09:52:53.899Z","2020-03-31T09:53:06.568Z","2020-03-31T09:53:13.536Z","2020-03-31T09:53:18.193Z","2020-03-31T09:53:22.262Z","2020-03-31T09:53:37.776Z","2020-03-31T09:53:40.679Z","2020-03-31T09:53:41.447Z","2020-03-31T09:53:42.985Z","2020-03-31T09:53:46.686Z","2020-03-31T09:53:58.678Z","2020-03-31T09:54:10.744Z","2020-03-31T09:54:13.997Z","2020-03-31T09:54:18.951Z","2020-03-31T09:54:24.542Z","2020-03-31T09:54:44.623Z","2020-03-31T09:54:49.454Z","2020-03-31T09:54:53.771Z","2020-03-31T09:55:03.433Z","2020-03-31T09:55:06.168Z","2020-03-31T09:55:29.055Z","2020-03-31T09:55:34.830Z","2020-03-31T09:56:12.581Z","2020-03-31T09:56:28.143Z","2020-03-31T09:56:36.205Z","2020-03-31T09:56:44.363Z","2020-03-31T09:56:57.082Z","2020-03-31T09:57:09.585Z","2020-03-31T09:57:24.745Z","2020-03-31T09:57:29.560Z","2020-03-31T09:58:01.192Z","2020-03-31T09:58:13.152Z","2020-03-31T09:58:19.266Z","2020-03-31T09:58:25.238Z","2020-03-31T09:58:42.299Z","2020-03-31T09:58:51.734Z","2020-03-31T09:58:58.369Z","2020-03-31T09:59:02.646Z","2020-03-31T09:59:03.335Z","2020-03-31T09:59:20.970Z","2020-03-31T09:59:30.830Z","2020-03-31T09:59:46.334Z","2020-03-31T09:59:53.196Z","2020-03-31T10:00:00.071Z","2020-03-31T10:00:14.598Z","2020-03-31T10:00:22.135Z","2020-03-31T10:00:30.348Z","2020-03-31T10:00:51.215Z","2020-03-31T10:01:06.685Z","2020-03-31T10:01:11.143Z","2020-03-31T10:01:17.036Z","2020-03-31T10:01:21.201Z","2020-03-31T10:01:27.233Z","2020-03-31T10:01:37.029Z","2020-03-31T10:01:44.663Z","2020-03-31T10:01:56.508Z","2020-03-31T10:02:04.091Z","2020-03-31T10:02:23.522Z","2020-03-31T10:02:39.253Z","2020-03-31T10:02:53.975Z","2020-03-31T10:03:06.831Z","2020-03-31T10:03:29.480Z","2020-03-31T10:04:20.568Z","2020-03-31T10:05:20.915Z","2020-03-31T10:05:38.647Z","2020-03-31T10:06:09.515Z","2020-03-31T10:06:22.867Z","2020-03-31T10:06:28.033Z","2020-03-31T10:06:35.266Z","2020-03-31T10:06:51.076Z","2020-03-31T10:07:29.343Z","2020-03-31T10:07:49.970Z","2020-03-31T10:08:45.555Z","2020-03-31T10:10:15.529Z","2020-03-31T10:11:04.231Z","2020-03-31T10:11:23.668Z","2020-03-31T10:12:04.635Z","2020-03-31T10:12:36.293Z","2020-03-31T10:13:22.083Z","2020-03-31T10:13:46.239Z","2020-03-31T10:14:56.796Z","2020-03-31T10:15:29.605Z","2020-03-31T10:15:36.106Z","2020-03-31T10:15:38.272Z","2020-03-31T10:15:50.502Z","2020-03-31T10:16:00.832Z","2020-03-31T10:16:07.841Z","2020-03-31T10:16:13.742Z","2020-03-31T10:16:18.948Z","2020-03-31T10:16:25.903Z","2020-03-31T10:16:42.460Z","2020-03-31T10:16:46.044Z","2020-03-31T10:16:57.333Z","2020-03-31T10:17:20.830Z","2020-03-31T10:17:48.848Z","2020-03-31T10:17:54.325Z","2020-03-31T10:18:25.849Z","2020-03-31T10:18:36.296Z","2020-03-31T10:18:39.940Z","2020-03-31T10:18:41.210Z","2020-03-31T10:18:42.495Z","2020-03-31T10:18:49.564Z","2020-03-31T10:18:55.390Z","2020-03-31T10:19:00.006Z","2020-03-31T10:19:02.991Z","2020-03-31T10:19:03.963Z","2020-03-31T10:19:07.053Z","2020-03-31T10:19:09.622Z","2020-03-31T10:19:11.960Z","2020-03-31T10:19:19.909Z","2020-03-31T10:19:24.678Z","2020-03-31T10:19:29.298Z","2020-03-31T10:19:30.524Z","2020-03-31T10:19:31.153Z","2020-03-31T10:19:32.646Z","2020-03-31T10:19:34.072Z","2020-03-31T10:19:37.784Z","2020-03-31T10:19:37.789Z"]},geometry:{type:"LineString",coordinates:[[-3.585504,56.56562,55.563449],[-3.585836,56.565587,55.563449],[-3.586477,56.565522,55.563449],[-3.586889,56.565481,55.563449],[-3.586889,56.565481,55.563449],[-3.586994,56.565561,55.563449],[-3.586995,56.56564,55.612639],[-3.586995,56.56564,55.612639],[-3.586995,56.56564,55.612639],[-3.586995,56.56564,55.612639],[-3.587434,56.566163,56.136796],[-3.587522,56.566164,56.18091],[-3.587592,56.566197,56.227083],[-3.587803,56.566296,56.365982],[-3.588142,56.566519,56.630585],[-3.588141,56.566488,56.658789],[-3.588267,56.565974,57.13059],[-3.588587,56.565514,57.878618],[-3.588612,56.565478,57.941416],[-3.588945,56.565384,58.277283],[-3.589244,56.56538,58.545763],[-3.591158,56.565355,60.180658],[-3.591302,56.565263,60.255357],[-3.591092,56.564295,60.854792],[-3.593323,56.563839,61.044182],[-3.594239,56.563702,60.899204],[-3.5949,56.563692,60.798201],[-3.596409,56.563525,60.653202],[-3.597915,56.563479,60.542013],[-3.599296,56.563336,61.040257],[-3.600425,56.563219,61.831516],[-3.601187,56.563278,62.361519],[-3.601498,56.563384,62.613395],[-3.602803,56.56362,63.321603],[-3.60344,56.563804,63.672341],[-3.603816,56.563845,63.859258],[-3.60506,56.563863,64.09906],[-3.605382,56.563816,63.800441],[-3.606305,56.564159,62.802407],[-3.60662,56.564222,62.501994],[-3.606324,56.56438,62.132547],[-3.607033,56.56445,61.486837],[-3.607892,56.564583,61.279795],[-3.608172,56.564613,61.233612],[-3.608749,56.564675,61.138432],[-3.60925,56.564742,61.054963],[-3.609491,56.564898,60.994765],[-3.609599,56.564995,60.961326],[-3.609768,56.565148,60.908696],[-3.60992,56.565199,60.923293],[-3.610781,56.565208,63.714891],[-3.610953,56.565145,64.384421],[-3.611576,56.565149,66.404135],[-3.611793,56.565208,67.188565],[-3.611994,56.565331,68.162341],[-3.61234,56.56557,69.961021],[-3.612461,56.56573,70.980818],[-3.612444,56.566084,74.406393],[-3.612321,56.566191,75.776567],[-3.611959,56.566346,78.509198],[-3.611551,56.566602,82.194797],[-3.610714,56.567354,91.501104],[-3.610258,56.567555,93.971819],[-3.609743,56.567694,96.398093],[-3.6094,56.567877,98.41816],[-3.609067,56.568385,102.565748],[-3.608805,56.568595,104.522574],[-3.60842,56.568743,105.742029],[-3.60842,56.568743,105.742029],[-3.608066,56.568794,106.621334],[-3.607549,56.568853,107.890111],[-3.607413,56.568895,108.264776],[-3.607413,56.568895,108.264776],[-3.60733,56.568942,108.550803],[-3.607267,56.569017,108.911276],[-3.607246,56.569095,109.255223],[-3.60898,56.568987,114.215002],[-3.610092,56.568907,119.285314],[-3.610678,56.568865,121.957095],[-3.611393,56.568885,125.193958],[-3.611912,56.568967,127.697547],[-3.612579,56.569128,131.686983],[-3.613343,56.56947,137.07993],[-3.614451,56.570284,146.803021],[-3.614759,56.570939,152.185651],[-3.615059,56.572056,161.065692],[-3.615295,56.573853,174.589174],[-3.614823,56.576926,198.034746],[-3.614877,56.577115,199.430667],[-3.615435,56.57783,202.653115],[-3.615435,56.577996,203.251023],[-3.615199,56.578616,205.532728],[-3.615188,56.578917,206.617107],[-3.614872,56.579552,208.343516],[-3.614727,56.580252,210.154042],[-3.614824,56.580394,210.543925],[-3.61521,56.580663,211.451096],[-3.615314,56.580909,212.357758],[-3.615014,56.581387,214.173197],[-3.61478,56.582065,216.650518],[-3.614968,56.582424,217.995006],[-3.614673,56.583163,220.761969],[-3.614606,56.5837,222.730338],[-3.61404,56.584424,224.958061],[-3.613925,56.585243,226.349372],[-3.613625,56.586108,227.27915],[-3.61363,56.587027,226.657143],[-3.614019,56.589761,222.97884],[-3.613978,56.590453,221.263175],[-3.61386,56.590875,220.205152],[-3.613493,56.591443,218.408427],[-3.613818,56.592194,215.454716],[-3.614493,56.592931,212.422877],[-3.614598,56.593401,213.158866],[-3.614434,56.593848,213.867636],[-3.614628,56.594535,214.948214],[-3.614646,56.594582,215.022869],[-3.614614,56.594594,215.055999],[-3.614071,56.594776,217.953048],[-3.613713,56.594795,219.993157],[-3.613316,56.594352,225.082657],[-3.613127,56.59425,226.583906],[-3.612397,56.59403,231.304553],[-3.611982,56.593841,234.507497],[-3.611332,56.593645,239.673072],[-3.610989,56.593597,242.139854],[-3.61076,56.593503,244.13081],[-3.610317,56.593173,249.325807],[-3.610052,56.592606,256.63311],[-3.609888,56.592555,257.405244],[-3.609595,56.592543,258.609702],[-3.609016,56.592751,261.443829],[-3.608669,56.593075,264.244365],[-3.60848,56.593251,265.766696],[-3.607815,56.593653,269.815182],[-3.607394,56.594066,270.196106],[-3.60407,56.595073,268.595047],[-3.603705,56.595321,267.531009],[-3.603205,56.595476,266.477913],[-3.602803,56.595627,265.584787],[-3.60262,56.595775,264.860659],[-3.601552,56.596337,259.500236],[-3.601191,56.596436,258.036925],[-3.600746,56.596757,255.375664],[-3.600474,56.596836,254.259869],[-3.600286,56.597066,252.950482],[-3.600308,56.597382,251.969227],[-3.600274,56.597522,251.530948],[-3.600179,56.597556,251.337387],[-3.599346,56.597549,249.914267],[-3.598289,56.597741,248.012924],[-3.596408,56.597831,248.164123],[-3.59616,56.598075,248.308192],[-3.595512,56.598383,248.551034],[-3.595313,56.598425,248.609369],[-3.594326,56.598365,248.471366],[-3.592791,56.598343,248.257966],[-3.592599,56.598407,248.226772],[-3.592165,56.598764,247.322108],[-3.591847,56.598905,246.0659],[-3.590822,56.598975,242.888315],[-3.590286,56.599365,240.155254],[-3.588978,56.599774,234.371802],[-3.588093,56.600338,228.338853],[-3.58792,56.600532,226.589428],[-3.58709,56.600752,222.89836],[-3.586591,56.600817,221.505765],[-3.586054,56.60105,219.648828],[-3.585781,56.601313,218.154425],[-3.58496,56.601599,215.515853],[-3.584606,56.601635,214.674821],[-3.584484,56.601648,214.685793],[-3.584552,56.601714,214.697964],[-3.584509,56.601824,214.716012],[-3.584239,56.602061,214.760885],[-3.584305,56.602122,214.772273],[-3.584493,56.602231,214.796382],[-3.586264,56.602972,215.417753],[-3.588029,56.604023,218.536625],[-3.5881,56.604121,218.766535],[-3.58801,56.604423,219.460954],[-3.588092,56.604679,220.055516],[-3.588281,56.604785,220.395212],[-3.590398,56.605692,223.585831],[-3.592811,56.606543,226.183878],[-3.593141,56.606796,226.345503],[-3.593637,56.607069,226.545857],[-3.59453,56.607357,226.84148],[-3.595548,56.607591,226.974809],[-3.598579,56.608863,225.904133],[-3.59916,56.609164,225.53845],[-3.599646,56.609525,225.164314],[-3.600811,56.610697,223.690674],[-3.601037,56.610796,223.49591],[-3.601231,56.610844,223.352492],[-3.60166,56.610949,223.035919],[-3.602014,56.611162,222.682259],[-3.602465,56.611746,222.106979],[-3.602808,56.61206,221.785973],[-3.603151,56.612194,221.58315],[-3.604086,56.612391,221.100409],[-3.60412,56.61241,221.077045],[-3.604089,56.61262,221.351769],[-3.604045,56.613026,222.1155],[-3.604346,56.613488,223.037102],[-3.604414,56.613678,223.400732],[-3.604434,56.613813,223.655073],[-3.604304,56.614064,224.145162],[-3.604079,56.614233,224.692865],[-3.603982,56.614386,225.380332],[-3.604084,56.615,227.996084],[-3.603827,56.615614,230.669173],[-3.603537,56.615868,231.941776],[-3.603054,56.616106,233.054387],[-3.602743,56.616379,234.032232],[-3.602411,56.616532,234.755411],[-3.602255,56.616762,235.500465],[-3.602266,56.616927,236.00156],[-3.6024,56.617122,236.634256],[-3.603199,56.617937,238.460679],[-3.603199,56.618318,239.030269],[-3.603017,56.618471,239.303638],[-3.601053,56.619582,242.142175],[-3.599421,56.619983,244.262865],[-3.598761,56.620011,245.302887],[-3.598431,56.620082,245.85959],[-3.598215,56.620225,246.39055],[-3.598108,56.62124,249.31395],[-3.598945,56.621736,251.380037],[-3.599095,56.622007,252.244825],[-3.599181,56.622468,253.659512],[-3.598852,56.623493,257.416589],[-3.599117,56.624014,259.476662],[-3.598988,56.624498,261.339348],[-3.598752,56.624664,262.355819],[-3.59765,56.624638,265.284979],[-3.596341,56.625192,269.670826],[-3.595555,56.625431,272.086235],[-3.595204,56.625617,273.39989],[-3.595016,56.62608,275.724412],[-3.594871,56.626187,276.378338],[-3.594657,56.626237,277.005022],[-3.593857,56.626268,278.953209],[-3.593154,56.626279,279.617388],[-3.592969,56.626298,279.795121],[-3.592671,56.626442,280.169712],[-3.592401,56.626695,280.673371],[-3.592113,56.62696,281.203419],[-3.592012,56.627044,281.376318],[-3.591904,56.62717,281.615471],[-3.591189,56.627851,282.483863],[-3.590987,56.62804,282.685853],[-3.5907,56.628362,283.01625],[-3.590008,56.628675,283.470277],[-3.589024,56.629461,285.333652],[-3.587208,56.630017,287.896896],[-3.586349,56.630223,289.441918],[-3.585958,56.630388,290.25444],[-3.585703,56.630564,290.92903],[-3.585433,56.630836,291.857953],[-3.585215,56.630805,292.229189],[-3.585005,56.630732,292.638768],[-3.584654,56.630518,293.95124],[-3.58421,56.630315,295.477498],[-3.583394,56.630121,297.82749],[-3.583123,56.62982,299.441782],[-3.582626,56.629671,300.938109],[-3.582283,56.629644,301.587891],[-3.582079,56.629633,301.809531],[-3.58155,56.629731,302.4131],[-3.581182,56.629808,302.838829],[-3.580857,56.629966,303.307831],[-3.580548,56.630341,304.117187],[-3.580234,56.630494,304.570764],[-3.579377,56.630634,304.31389],[-3.578281,56.630394,302.979624],[-3.577814,56.630167,302.274717],[-3.576693,56.629913,300.841719],[-3.576339,56.629759,300.237867],[-3.575851,56.629444,299.23121],[-3.575159,56.629311,298.250462],[-3.573874,56.629204,296.604974],[-3.573482,56.629243,296.212476],[-3.572944,56.62937,295.635641],[-3.572575,56.629381,295.271539],[-3.570746,56.629237,293.539711],[-3.569845,56.629116,293.045708],[-3.569137,56.629281,292.63615],[-3.569017,56.629441,292.46855],[-3.569006,56.629606,292.308667],[-3.569228,56.629915,291.986935],[-3.56907,56.630001,291.899101],[-3.568289,56.630181,291.856312],[-3.568121,56.630296,291.842759],[-3.568094,56.63052,291.822136],[-3.568075,56.630557,291.818604],[-3.568067,56.630571,291.817256],[-3.567171,56.63099,291.757829],[-3.565643,56.631881,291.140602],[-3.564513,56.632341,290.678862],[-3.564426,56.632354,290.603019],[-3.564341,56.632367,290.476523],[-3.563972,56.632397,289.941706],[-3.56392,56.632388,289.863545],[-3.563808,56.632373,289.698268],[-3.563368,56.6323,289.039324],[-3.562129,56.632199,287.243449],[-3.561453,56.631978,286.115908],[-3.561045,56.631748,285.23195],[-3.56082,56.631364,284.110285],[-3.560836,56.63073,282.347476],[-3.560734,56.630556,281.839199],[-3.560246,56.630261,280.764338],[-3.559844,56.629933,279.818223],[-3.558878,56.629007,277.264726],[-3.558181,56.628207,275.491875],[-3.557081,56.627605,273.916382],[-3.556965,56.627555,273.766748],[-3.556965,56.627555,273.766748],[-3.556965,56.627555,273.766748],[-3.556976,56.627455,273.581826],[-3.556986,56.626976,273.223024],[-3.556609,56.626723,273.104239],[-3.555472,56.626469,272.859118],[-3.555364,56.62641,272.828715],[-3.554485,56.625029,273.398873],[-3.553779,56.624256,273.865881],[-3.553433,56.623979,273.919372],[-3.55159,56.622821,274.244744],[-3.551214,56.622284,274.523002],[-3.551191,56.621995,274.662879],[-3.55121,56.621862,274.727388],[-3.551214,56.62183,274.742897],[-3.551365,56.620726,275.652051],[-3.551438,56.620579,275.822849],[-3.55177,56.620278,276.217472],[-3.551931,56.619864,276.69199],[-3.551856,56.619735,276.843791],[-3.551684,56.619628,277.003892],[-3.551063,56.619428,277.334979],[-3.550963,56.619404,277.384919],[-3.550784,56.619363,277.473671],[-3.550678,56.619256,277.575056],[-3.550614,56.619132,277.682298],[-3.550539,56.618814,277.94908],[-3.550515,56.618613,278.116665],[-3.550571,56.618388,278.305603],[-3.550473,56.617981,278.712351],[-3.550247,56.617763,279.018197],[-3.54999,56.617574,279.305852],[-3.549335,56.617261,279.887564],[-3.548606,56.617055,280.437079],[-3.546986,56.61683,280.978915],[-3.546771,56.616813,281.026426],[-3.546578,56.616842,281.070187],[-3.545881,56.61686,281.222813],[-3.545119,56.616771,281.393202],[-3.544679,56.616765,281.213491],[-3.543788,56.616866,280.686291],[-3.543252,56.61686,280.375602],[-3.542673,56.616753,280.021638],[-3.541492,56.616689,279.313145],[-3.539636,56.616317,278.040321],[-3.539357,56.616175,277.795424],[-3.539261,56.616045,277.631097],[-3.539014,56.615892,277.391285],[-3.538757,56.615785,277.182135],[-3.538199,56.615638,276.780642],[-3.537469,56.615555,276.29688],[-3.536943,56.615378,275.896743],[-3.536182,56.614811,274.831965],[-3.535806,56.61464,274.188911],[-3.535152,56.614233,272.887352],[-3.534379,56.613938,271.647217],[-3.533349,56.613418,268.390111],[-3.532534,56.612804,264.381974],[-3.531708,56.612414,261.197306],[-3.531418,56.61219,259.603409],[-3.531192,56.612055,258.539658],[-3.53116,56.611948,257.911224],[-3.531137,56.611905,257.651456],[-3.530151,56.61007,247.444889],[-3.530151,56.609887,246.591712],[-3.530728,56.608987,242.093398],[-3.532447,56.607448,232.772695],[-3.532554,56.607342,232.012384],[-3.532544,56.607242,231.384426],[-3.531937,56.606673,227.247257],[-3.531331,56.606262,223.928455],[-3.530631,56.60594,220.266384],[-3.529601,56.605621,214.794414],[-3.529312,56.605485,213.03396],[-3.528453,56.604824,206.09469],[-3.527874,56.60418,199.399553],[-3.527845,56.604018,197.882776],[-3.528091,56.603663,194.342549],[-3.528145,56.602742,186.302355],[-3.528496,56.601841,178.726753],[-3.528711,56.600643,168.618122],[-3.52896,56.599931,162.470943],[-3.528907,56.599665,160.169404],[-3.528732,56.599473,157.966324],[-3.528562,56.59873,150.286045],[-3.528668,56.598381,146.657078],[-3.528295,56.597415,137.371117],[-3.527995,56.596293,127.560227],[-3.527102,56.595156,120.263701],[-3.526503,56.594733,117.292428],[-3.525802,56.594431,115.153278],[-3.527035,56.59383,111.727031],[-3.527421,56.593392,109.887293],[-3.527755,56.593135,108.994047],[-3.528131,56.592949,108.294596],[-3.529761,56.592456,105.721129],[-3.530021,56.592338,105.254872],[-3.530076,56.5923,105.132751],[-3.529946,56.592226,104.946547],[-3.529649,56.592058,104.574089],[-3.528822,56.591444,103.359677],[-3.528522,56.590717,102.220007],[-3.528329,56.590563,102.268435],[-3.52819,56.590315,102.335612],[-3.528147,56.590038,102.407568],[-3.527267,56.589287,102.638896],[-3.527106,56.58914,102.691567],[-3.527074,56.588945,102.84537],[-3.526961,56.588566,103.147073],[-3.526934,56.588478,103.21718],[-3.526612,56.587503,103.995636],[-3.526741,56.587231,104.04047],[-3.528071,56.585258,103.201038],[-3.528855,56.584472,102.614783],[-3.52937,56.584106,102.318022],[-3.530142,56.583917,102.123022],[-3.531397,56.583763,101.826251],[-3.53261,56.583775,101.597562],[-3.533989,56.583862,101.85295],[-3.534401,56.583887,101.929215],[-3.536901,56.584171,102.603286],[-3.537845,56.584212,102.937097],[-3.538307,56.584124,103.109427],[-3.538714,56.583982,103.279272],[-3.539766,56.583444,103.503436],[-3.54056,56.583291,103.617559],[-3.541171,56.583237,103.701513],[-3.541495,56.583119,103.754211],[-3.541558,56.583096,103.764466],[-3.54159,56.582156,103.595602],[-3.541,56.581725,103.492875],[-3.539873,56.581169,103.367765],[-3.539465,56.58088,103.32303],[-3.538961,56.580644,103.278506],[-3.53821,56.580011,103.258881],[-3.538038,56.579645,103.365977],[-3.537963,56.579243,103.480454],[-3.538071,56.57828,103.757063],[-3.538371,56.577582,103.978728],[-3.538397,56.577378,104.041925],[-3.538446,56.577086,104.132546],[-3.538607,56.576891,104.198746],[-3.53894,56.576649,104.259314],[-3.539474,56.576228,104.142987],[-3.540223,56.576195,104.049239],[-3.541415,56.576225,103.900365],[-3.542137,56.576098,103.85405],[-3.543768,56.575581,103.80749],[-3.544926,56.575155,104.062199],[-3.545978,56.574875,104.720911],[-3.546723,56.574582,105.237004],[-3.547571,56.573932,106.504888],[-3.550032,56.572967,109.911908],[-3.553856,56.572444,114.483481],[-3.554791,56.572212,116.022848],[-3.55617,56.571957,118.737125],[-3.556753,56.571907,120.388901],[-3.556712,56.571836,120.767526],[-3.556656,56.571737,121.294485],[-3.556743,56.571515,122.448637],[-3.557522,56.571174,125.234144],[-3.557728,56.5709,126.740646],[-3.558915,56.570445,130.477627],[-3.560753,56.569646,136.218134],[-3.561705,56.569184,138.748071],[-3.562085,56.569,139.75694],[-3.562635,56.568496,141.712559],[-3.562911,56.568068,141.966888],[-3.563569,56.567519,142.335268],[-3.564111,56.567343,142.529357],[-3.56538,56.566612,136.915133],[-3.565501,56.566147,133.190911],[-3.565641,56.566095,132.453392],[-3.565801,56.566036,131.612406],[-3.56667,56.565715,126.218572],[-3.56737,56.565387,119.819003],[-3.567987,56.565449,115.451101],[-3.568496,56.565396,111.843484],[-3.568884,56.565269,108.700445],[-3.569394,56.565103,105.053234],[-3.570589,56.564735,99.59416],[-3.570857,56.564685,98.465847],[-3.571737,56.564667,94.954228],[-3.573078,56.564138,91.982215],[-3.574565,56.563776,90.93545],[-3.574852,56.563895,90.704173],[-3.576842,56.564687,90.354789],[-3.577782,56.564937,90.155184],[-3.57814,56.564972,89.036525],[-3.57828,56.564983,88.601431],[-3.57845,56.564996,88.073381],[-3.579352,56.565027,85.292818],[-3.580091,56.565168,82.886692],[-3.580722,56.565205,80.934351],[-3.581146,56.56521,80.212761],[-3.58127,56.565195,80.212761],[-3.58169,56.565142,80.212761],[-3.582006,56.565068,80.212761],[-3.582338,56.56505,80.212761],[-3.583425,56.565187,80.212761],[-3.584018,56.565352,80.212761],[-3.584443,56.565593,80.212761],[-3.584599,56.565615,80.212761],[-3.584677,56.565626,80.212761],[-3.584865,56.565633,80.212761],[-3.585044,56.56564,80.212761],[-3.585504,56.56562,80.212761],[-3.585504,56.56562,80.212761]]}}]},H5=Mo(d_.features[0].geometry.coordinates);wp.default.accessToken="pk.eyJ1IjoiYnJldHRkZXdvb2R5LWhwYyIsImEiOiJjbDJ6M2xja2UwOGttM2NsN3R6NGwyaTRxIn0.gyD2ms-l3bqNMpDH-Tj8LA";var wr=new wp.default.Map({container:"map",style:"mapbox://styles/brettdewoody-hpc/cl3090ifb004q14ndex03dg5g",center:{lat:56.5405969,lon:-4.1580719},zoom:11,cooperativeGestures:!0});wr.scrollZoom.disable();wr.addControl(new wp.default.NavigationControl);wr.fitBounds([[-3.615435,56.563219],[-3.525802,56.632397]],{padding:20});var Jh={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:""}}]};wr.on("load",()=>{wr.addSource("route",{type:"geojson",data:d_}),wr.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff00ff","line-width":5}}),wr.addSource("point",{type:"geojson",data:Jh}),wr.addLayer({id:"point",source:"point",type:"circle",paint:{"circle-radius":6.75,"circle-color":"#ff0000"}})});var Y5=document.getElementById("chart_div"),K5=[0,.02,.06,.09,.09,.1,.11,.11,.11,.11,.17,.18,.18,.2,.23,.23,.29,.35,.35,.37,.39,.51,.52,.63,.78,.84,.88,.97,1.06,1.15,1.22,1.27,1.29,1.37,1.42,1.44,1.52,1.54,1.6,1.63,1.65,1.69,1.75,1.77,1.8,1.83,1.86,1.87,1.89,1.9,1.95,1.97,2,2.02,2.04,2.07,2.09,2.13,2.14,2.17,2.21,2.31,2.34,2.38,2.41,2.47,2.5,2.53,2.53,2.55,2.58,2.59,2.59,2.6,2.61,2.62,2.72,2.79,2.83,2.87,2.9,2.95,3.01,3.12,3.2,3.32,3.52,3.87,3.89,3.97,3.99,4.06,4.1,4.17,4.25,4.26,4.3,4.33,4.39,4.46,4.51,4.59,4.65,4.74,4.83,4.93,5.03,5.33,5.41,5.46,5.52,5.61,5.7,5.76,5.81,5.88,5.89,5.89,5.93,5.95,6.01,6.02,6.07,6.11,6.15,6.17,6.19,6.24,6.3,6.31,6.33,6.37,6.42,6.44,6.5,6.55,6.78,6.82,6.85,6.88,6.9,6.99,7.02,7.06,7.08,7.11,7.15,7.16,7.17,7.22,7.29,7.4,7.43,7.49,7.5,7.56,7.66,7.67,7.72,7.74,7.8,7.86,7.95,8.03,8.06,8.11,8.15,8.19,8.22,8.28,8.3,8.31,8.32,8.33,8.36,8.37,8.39,8.52,8.68,8.69,8.73,8.76,8.77,8.94,9.11,9.15,9.19,9.25,9.32,9.56,9.6,9.65,9.8,9.82,9.83,9.86,9.89,9.96,10.01,10.03,10.09,10.1,10.12,10.16,10.22,10.24,10.25,10.28,10.31,10.33,10.39,10.46,10.5,10.54,10.57,10.6,10.63,10.64,10.67,10.77,10.81,10.83,11.01,11.12,11.16,11.18,11.2,11.31,11.39,11.42,11.47,11.59,11.65,11.7,11.72,11.79,11.89,11.95,11.98,12.03,12.04,12.06,12.11,12.15,12.16,12.19,12.22,12.25,12.26,12.28,12.37,12.39,12.43,12.49,12.59,12.72,12.78,12.81,12.83,12.87,12.88,12.9,12.93,12.96,13.02,13.05,13.09,13.11,13.12,13.16,13.18,13.21,13.25,13.28,13.33,13.41,13.44,13.52,13.55,13.59,13.64,13.72,13.74,13.78,13.8,13.91,13.97,14.02,14.03,14.05,14.09,14.1,14.16,14.17,14.2,14.2,14.2,14.27,14.41,14.5,14.5,14.51,14.53,14.53,14.54,14.57,14.65,14.69,14.73,14.77,14.85,14.87,14.91,14.95,15.07,15.17,15.27,15.28,15.28,15.28,15.29,15.34,15.38,15.45,15.46,15.62,15.72,15.76,15.93,15.99,16.02,16.04,16.04,16.17,16.18,16.22,16.27,16.28,16.3,16.34,16.35,16.36,16.38,16.39,16.43,16.45,16.47,16.52,16.55,16.57,16.63,16.68,16.78,16.79,16.8,16.85,16.89,16.92,16.98,17.01,17.05,17.12,17.24,17.26,17.28,17.3,17.32,17.36,17.41,17.44,17.52,17.55,17.61,17.67,17.75,17.84,17.91,17.94,17.96,17.97,17.97,18.19,18.21,18.31,18.51,18.53,18.54,18.61,18.67,18.73,18.8,18.82,18.91,18.99,19.01,19.05,19.16,19.26,19.39,19.47,19.5,19.53,19.61,19.65,19.76,19.88,20.02,20.08,20.14,20.24,20.29,20.33,20.36,20.47,20.49,20.5,20.51,20.53,20.62,20.7,20.72,20.75,20.78,20.88,20.9,20.92,20.97,20.98,21.09,21.12,21.35,21.45,21.5,21.55,21.63,21.71,21.79,21.82,21.97,22.03,22.06,22.09,22.18,22.23,22.27,22.29,22.3,22.4,22.46,22.55,22.6,22.64,22.72,22.76,22.81,22.91,22.99,23.02,23.05,23.07,23.11,23.16,23.21,23.28,23.33,23.44,23.53,23.6,23.66,23.75,23.93,24.17,24.24,24.33,24.36,24.37,24.38,24.41,24.47,24.5,24.59,24.73,24.81,24.84,24.91,24.96,25.03,25.07,25.18,25.23,25.24,25.26,25.32,25.38,25.41,25.45,25.47,25.51,25.59,25.61,25.67,25.77,25.87,25.89,26.04,26.1,26.12,26.13,26.14,26.2,26.25,26.29,26.31,26.32,26.35,26.37,26.39,26.46,26.5,26.53,26.54,26.55,26.56,26.57,26.6,26.6],J5={labels:K5,datasets:[{label:"Elevation",data:[56,56,56,56,56,56,56,56,56,56,56,56,56,56,57,57,57,58,58,58,59,60,60,61,61,61,61,61,61,61,62,62,63,63,64,64,64,64,63,63,62,61,61,61,61,61,61,61,61,61,64,64,66,67,68,70,71,74,76,79,82,92,94,96,98,103,105,106,106,107,108,108,108,109,109,109,114,119,122,125,128,132,137,147,152,161,175,198,199,203,203,206,207,208,210,211,211,212,214,217,218,221,223,225,226,227,227,223,221,220,218,215,212,213,214,215,215,215,218,220,225,227,231,235,240,242,244,249,257,257,259,261,264,266,270,270,269,268,266,266,265,260,258,255,254,253,252,252,251,250,248,248,248,249,249,248,248,248,247,246,243,240,234,228,227,223,222,220,218,216,215,215,215,215,215,215,215,215,219,219,219,220,220,224,226,226,227,227,227,226,226,225,224,223,223,223,223,222,222,222,221,221,221,222,223,223,224,224,225,225,228,231,232,233,234,235,236,236,237,238,239,239,242,244,245,246,246,249,251,252,254,257,259,261,262,265,270,272,273,276,276,277,279,280,280,280,281,281,281,282,282,283,283,283,285,288,289,290,291,292,292,293,294,295,298,299,301,302,302,302,303,303,304,305,304,303,302,301,300,299,298,297,296,296,295,294,293,293,292,292,292,292,292,292,292,292,292,292,291,291,291,290,290,290,290,289,287,286,285,284,282,282,281,280,277,275,274,274,274,274,274,273,273,273,273,273,274,274,274,275,275,275,275,276,276,276,277,277,277,277,277,277,278,278,278,278,278,279,279,279,280,280,281,281,281,281,281,281,281,280,280,279,278,278,278,277,277,277,276,276,275,274,273,272,268,264,261,260,259,258,258,247,247,242,233,232,231,227,224,220,215,213,206,199,198,194,186,179,169,162,160,158,150,147,137,128,120,117,115,112,110,109,108,106,105,105,105,105,103,102,102,102,102,103,103,103,103,103,104,104,103,103,102,102,102,102,102,102,103,103,103,103,104,104,104,104,104,104,103,103,103,103,103,103,103,104,104,104,104,104,104,104,104,104,104,104,104,105,105,107,110,114,116,119,120,121,121,122,125,127,130,136,139,140,142,142,142,143,137,133,132,132,126,120,115,112,109,105,100,98,95,92,91,91,90,90,89,89,88,85,83,81,80,80,80,80,80,80,80,80,80,80,80,80,80,80],fill:!1,tension:.25,borderColor:"#ff00ff"}]},bp=new h1(Y5,{type:"line",data:J5,options:{plugins:{tooltip:{mode:"x",intersect:!1,position:"nearest",callbacks:{beforeLabel:l=>{Jh.features[0].geometry.coordinates=d_.features[0].geometry.coordinates[l.dataIndex],wr.getSource("point").setData(Jh)}}}},parsing:{xAxisKey:"x",yAxisKey:"y"},elements:{point:{pointRadius:0}}}}),q6=bp.chartArea,Q5=bp.tooltip;wr.on("click","route",l=>{let s=br(l.lngLat.toArray()),o=R1(H5,s,{units:"miles"});Jh.features[0].geometry.coordinates=o.geometry.coordinates,wr.getSource("point").setData(Jh),bp.setActiveElements([{datasetIndex:0,index:o.properties.index}]),Q5.setActiveElements([{datasetIndex:0,index:o.properties.index}],{x:0,y:0}),bp.update()});})();
/*!
 * @kurkle/color v0.2.1
 * https://github.com/kurkle/color#readme
 * (c) 2022 Jukka Kurkela
 * Released under the MIT License
 */
/*!
 * Chart.js v3.8.0
 * https://www.chartjs.org
 * (c) 2022 Chart.js Contributors
 * Released under the MIT License
 */
